{"version":3,"sources":["constants/app.ts","components/shared/Header.tsx","constants/links.ts","components/shared/MainNav.tsx","components/shared/Footer.tsx","components/shared/Layout.tsx","constants/routes.ts","components/shared/ErrorBoundary.tsx","utils/url.ts","components/world/utils/events.ts","components/world/controllers/CarJoystickController.tsx","hooks/useKeyPress.ts","components/world/constants/world.ts","components/world/controllers/CarKeyboardController.tsx","components/shared/FadeIn.tsx","components/world/World.tsx","components/world/surroundings/Ground.tsx","components/world/constants/models.ts","components/world/utils/models.ts","libs/math/floats.ts","libs/math/polynomial.ts","libs/math/sigmoid.ts","libs/math/geometry.ts","libs/carGenetic.ts","components/world/car/constants.ts","components/world/utils/materials.ts","components/world/car/ChassisModel.tsx","components/world/car/SensorRay.tsx","components/world/constants/performance.ts","components/world/car/Sensors.tsx","components/world/car/CarLabel.tsx","components/world/car/ChassisModelSimple.tsx","components/world/car/Chassis.tsx","components/world/car/WheelModel.tsx","components/world/car/WheelModelSimple.tsx","components/world/car/Wheel.tsx","utils/logger.ts","utils/storage.ts","components/world/constants/parking.ts","components/evolution/utils/evolution.ts","components/evolution/constants/evolution.ts","components/world/car/Car.tsx","components/world/cars/StaticCars.tsx","components/world/utils/uuid.ts","components/world/constants/cars.ts","components/world/cars/DynamicCars.tsx","components/world/utils/controllers.ts","utils/colors.ts","components/world/surroundings/ParkingSpot.tsx","components/world/parkings/ParkingManual.tsx","components/evolution/EvolutionTabManual.tsx","libs/math/probability.ts","libs/genetic.ts","components/shared/FormElementsRow.tsx","components/shared/Hint.tsx","components/shared/Row.tsx","components/evolution/EvolutionBoardParams.tsx","components/evolution/PopulationTable.tsx","components/shared/Timer.tsx","components/evolution/EvolutionTiming.tsx","components/evolution/LossHistory.tsx","components/evolution/GenomePreview.tsx","components/evolution/BestGenomes.tsx","components/evolution/EvolutionAnalytics.tsx","components/world/parkings/ParkingAutomatic.tsx","components/evolution/EvolutionCheckpointSaver.tsx","components/evolution/EvolutionTabEvolution.tsx","components/evolution/constants/genomes.ts","components/evolution/AutomaticParkingAnalytics.tsx","components/evolution/EvolutionTabAutomatic.tsx","components/evolution/EvolutionTabs.tsx","components/screens/HomeScreen.tsx","App.tsx","index.tsx"],"names":["APP_BASE_PATH","Header","style","margin","onClick","document","location","href","textDecoration","cursor","$style","fontWeight","textTransform","display","alignItems","flexWrap","size","marginTop","GITHUB_LINK","MainNav","marginBottom","marginRight","IconLink","props","url","title","Icon","marginLeft","color","Footer","flexDirection","justifyContent","FaGithub","engine","Styletron","Layout","children","value","theme","LightTheme","span","routes","path","ErrorBoundary","state","hasError","error","errorInfo","console","this","setState","kind","KIND","negative","overrides","Body","width","React","Component","getSearchParam","name","getSearchParams","get","setSearchParam","searchParams","set","relativeURL","toString","hash","window","history","pushState","deleteSearchParam","delete","searchQuery","search","substring","URLSearchParams","getIntSearchParam","defaultValue","searchParam","parseInt","carEvents","trigger","eventType","data","event","CustomEvent","detail","dispatchEvent","on","listener","addEventListener","off","removeEventListener","CarJoystickController","nippleSize","delta","onMoveThrottled","throttle","angle","degree","leading","trailing","onEndThrottled","throttleTimeout","height","Math","floor","position","options","dynamicPage","mode","top","left","onMove","onEnd","useKeyPress","target","useState","keyPressed","setKeyPressed","downHandlerCallback","useCallback","key","includes","upHandlerCallback","useEffect","WORLD_CONTAINER_HEIGHT","CarKeyboardController","forward","backward","right","brake","paddingLeft","FadeIn","className","worldBackgroundColor","WorldSpinner","withStyle","StyledSpinnerNext","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth","borderTopColor","WorldContainer","styled","boxSizing","borderStyle","borderColor","borderWidth","World","withJoystickControl","withKeyboardControl","version","performanceBoost","stats","Stats","showPanel","preLoader","backgroundColor","joystickController","keyboardController","cameraFov","innerWidth","environment","Environment","background","preset","overflow","shadows","PerspectiveCamera","makeDefault","fov","OrbitControls","attach","args","intensity","groundColor","THREE","penumbra","shadow-mapSize-width","shadow-mapSize-height","castShadow","step","gravity","iterations","defaultContactMaterial","friction","restitution","contactEquationRelaxation","broadphase","allowSleep","AdaptiveDpr","pixelated","Ground","usePlane","type","rotation","PI","ref","receiveShadow","opacity","MODEL_BASE_PATH","getModelPath","modelFileName","precisionConfigs","signBitsCount","exponentBitsCount","fractionBitsCount","totalBitsCount","bitsToFloat","bits","precisionConfig","sign","exponentBias","exponent","slice","reduce","exponentSoFar","currentBit","bitIndex","fraction","fractionSoFar","linearPolynomial","coefficients","variables","length","Error","result","forEach","coefficient","coefficientIndex","sigmoid","x","E","sigmoidToCategories","sigmoidValue","aroundZeroMargin","euclideanDistance","from","to","fromX","fromZ","toX","toZ","sqrt","GENES_PER_NUMBER","ENGINE_FORMULA_GENES_NUM","WHEELS_FORMULA_GENES_NUM","GENOME_LENGTH","carLoss","params","wheelsPosition","parkingLotCorners","flWheel","fl","frWheel","fr","brWheel","br","blWheel","bl","flCorner","frCorner","brCorner","blCorner","carLossToFitness","loss","alpha","decodeGenome","genome","engineGenes","wheelsGenes","engineFormulaCoefficients","genomeToNumbers","wheelsFormulaCoefficients","genesPerNumber","numbers","numberIndex","number","push","WHEEL_MODEL_PATH","CHASSIS_OBJECT_NAME","CHASSIS_WIDTH","CHASSIS_SIZE","CHASSIS_BASE_COLOR","CHASSIS_GROUND_CLEARANCE","CHASSIS_MODEL_PATH","CHASSIS_RELATIVE_POSITION","CAR_MAX_STEER_VALUE","getSteel","metalness","roughness","getRubber","getPlastic","getGlass","transmission","transparent","ChassisModel","bodyProps","wireframe","baseColor","useGLTF","nodes","materials","Object","keys","geometryKey","startsWith","geometry","boundsTree","MeshBVH","material","chassis_1","chassis_2","chassis_3","chassis_4","chassis_5","chassis_6","chassis_7","chassis_8","chassis_9","chassis_10","chassis_11","chassis_12","chassis_13","chassis_14","chassis_15","chassis_16","beamColor","beamWarningColor","beamDangerColor","prototype","raycast","acceleratedRaycast","SensorRay","index","angleX","obstacles","visible","onRay","distance","lineRef","useRef","positionRef","directionRef","raycasterRef","intersectObjectsThrottledRef","onRayCallbackThrottledRef","intersectionRef","current","near","far","firstHitOnly","intersectObjects","useFrame","getWorldPosition","getWorldDirection","undefined","SENSOR_DISTANCE","onUnmount","cancel","rotateY","lineGeometry","setFromPoints","linewidth","Sensors","visibleSensors","sensorsNum","onSensors","sensorDistances","Array","fill","scene","useThree","onSensorsCallbackThrottledRef","filter","object","map","getObjectByName","userData","isSensorObstacle","angleStep","sensorRays","_","CarLabel","content","Html","padding","borderRadius","fontSize","whiteSpace","ChassisModelSimple","boxArgs","CHASSIS_HEIGHT","CHASSIS_LENGTH","Chassis","forwardRef","movable","withSensors","weight","label","chassisPosition","collisionFilterGroup","collisionFilterMask","onCollide","boxSize","useBox","mass","groupProps","sensors","carLabel","chassisModel","WheelModel","tire","wheel_1","disc","wheel_2","cap","wheel_3","tireMaterial","Rubber","discMaterial","capMaterial","Chrom","WheelModelSimple","cylinderArgs","Wheel","radius","segments","isLeft","wheelSize","useCylinder","wheelModel","logToConsole","loggerBuilder","context","info","message","optionalParams","log","warn","write","logger","stringifiedData","JSON","stringify","localStorage","setItem","read","getItem","parse","remove","removeItem","PARKING_SPOT_POSITION","y","z","innerW","innerL","innerX","innerZ","PARKING_SPOT_OUTER_CORNERS","PARKING_SPOT_POINTS","GENERATION_STORAGE_KEY","GENERATION_INDEX_STORAGE_KEY","LOSS_HISTORY_INDEX_STORAGE_KEY","AVG_LOSS_HISTORY_INDEX_STORAGE_KEY","generationToCars","generationIndex","generation","onLossUpdate","cars","genomeIndex","licencePlate","genomeIdx","generateLicencePlate","onEngine","formulaOutput","rawResult","normalizedResult","engineFormula","cleanUpSensors","onWheel","wheelsFormula","wheelsPoints","onHit","sensor","formatLossValue","lossValue","ceil","genomeStringToGenome","genomeString","split","geneString","loadGenerationFromStorage","lossHistory","avgLossHistory","saveGenerationToStorage","keySuccess","generationSuccess","lossHistorySuccess","avgLossHistorySuccess","FITNESS_ALPHA","Car","uuid","wheelRadius","withLabel","onCarReady","onCarDestroy","car","chassis","apiRef","wheelsRef","wheelsPositionRef","setCarLoss","onUpdateLabelThrottledRef","onMoveThrottledRef","wheels","wheelInfos","wheelInfo","isFrontWheel","directionLocal","axleLocal","chassisConnectionPointLocal","suspensionStiffness","suspensionRestLength","maxSuspensionForce","maxSuspensionTravel","dampingRelaxation","dampingCompression","frictionSlip","rollInfluence","useCustomSlidingRotationalSpeed","customSlidingRotationalSpeed","flWheelInfo","frWheelInfo","CHASSIS_WHEEL_WIDTH","blWheelInfo","brWheelInfo","useRaycastVehicle","chassisBody","indexForwardAxis","indexRightAxis","indexUpAxis","vehicle","vehicleAPI","wheelMetaData","wheelBodyProps","carMetaData","api","wheelsNum","wheelsPositions","getCarLoss","wheelPositions","toArray","distanceColor","StaticCars","rows","cols","skipCells","carBaseColors","setCarBaseColors","carBaseColorsRef","touchedCarUUID","newCarBaseColors","staticCarPositions","row","col","find","skipRow","skipCol","staticCars","DYNAMIC_CARS_POSITION_MIDDLE","DYNAMIC_CARS_POSITION_FRONT","DynamicCars","withLabels","controllable","withRandomColors","withRandomStartingPoint","carsPosition","carsUUIDs","carsAPIs","activeCars","onForward","carAPI","wheelIdx","setBrake","applyEngineForce","onEngineForward","onBackward","onEngineBackward","onNeutral","onLeft","setSteeringValue","onRight","onStraight","onBreak","onPressBreak","onBreakRelease","onReleaseBreak","random","styledCar","carColor","flatColors","colors","flat","getRandomColor","angularVelocity","ParkingSpot","Line","points","lineWidth","dashed","ParkingManual","EvolutionTabManual","weightedRandom","items","weights","cumulativeWeights","i","randomNumber","item","createGeneration","generationSize","genomeLength","mutate","mutationProbability","geneIndex","gene","mutatedGene","mate","father","mother","firstChild","secondChild","marginX","FormElementsRow","buttons","alignBottom","node","nodeIndex","flex","buttonsRow","Hint","hint","accessibilityType","shape","BUTTON_SHAPE","round","BUTTON_KIND","minimal","BaseButton","paddingTop","paddingBottom","paddingRight","Row","GENERATION_SIZES","BATCH_SIZES","EvolutionBoardParams","batchSize","generationLifetime","longLivingChampionsPercentage","onGenerationSizeChange","onBatchSizeChange","onGenerationLifetimeChange","onMutationProbabilityChange","onLongLivingChampionsPercentageChange","onPerformanceBoost","onReset","mutationProbabilityInternal","setMutationProbabilityInternal","generationLifetimeInternal","setGenerationLifetimeInternal","longLivingChampionsPercentageInternal","setLongLivingChampionsPercentageInternal","confirmationModalOpen","setConfirmationModalOpen","onConfirmationModalClose","generationSizeCurrentValue","id","generationSizes","generationSizeSelector","onChange","labelKey","valueKey","SELECT_SIZE","compact","clearable","searchable","batchSizeCurrentValue","batchSizes","batchSizeSelector","sliderOverrides","TickBar","InnerThumb","$value","$thumbIndex","Fragment","ThumbValue","Thumb","generationLifetimeChanger","caption","marks","persistentThumb","min","max","onFinalChange","valueToLabel","genesToBeMutated","mutationProbabilityChanger","longLivingChampionsCount","longLivingChampionsChanger","resetButton","BUTTON_SIZE","pill","startEnhancer","performanceBooster","checked","e","labelPlacement","LABEL_PLACEMENT","resetConfirmationModal","onClose","closeable","isOpen","animate","autoFocus","SIZE","default","role","ROLE","dialog","NOTIFICATION_KIND","warning","tertiary","primary","CellSpinner","carsLoss","hasOwnProperty","PopulationTable","carsInProgress","rowsData","values","sort","carA","carB","lossA","lossB","licencePlateCell","TAG_KIND","neutral","variant","TAG_VARIANT","light","carLossFormatted","carLossColor","lossCell","fitnessValue","getCarFitness","columns","emptyMessage","divider","DIVIDER","grid","TABLE_SIZE","Root","maxHeight","TableBodyCell","verticalAlign","formatTime","timeMs","timeSec","secPrefix","timeMin","Timer","timeout","interval","timePassed","setTimePassed","timePassedRef","timerRef","reversedTime","onIntervalCallback","clearInterval","setInterval","formattedTime","TimingColumn","textAlign","EvolutionTiming","batchIndex","totalBatches","generationLifetimeMs","batchVersion","worldVersion","retry","groupLabel","batchLifetimeLabel","batchesCounter","generationInfo","solid","groupInfo","groupLifetime","worldAge","InnerContainer","LossHistory","avgHistory","showAvgHistory","setShowAvgHistory","showMinLoss","setShowMinLoss","historyData","Infinity","avgHistoryData","chartData","minLossSeriesId","avgLossSeriesId","chart","bottom","xScale","yScale","yFormat","curve","axisBottom","legend","legendOffset","legendPosition","axisLeft","pointSize","pointColor","datum","pointBorderWidth","pointBorderColor","useMesh","enableCrosshair","enableSlices","tooltip","point","serieId","boxShadow","xFormatted","yFormatted","legends","anchor","direction","justify","translateX","translateY","itemsSpacing","itemDirection","itemWidth","itemHeight","itemOpacity","symbolSize","symbolShape","symbolBorderColor","chartControls","disabled","fontFamily","commonGenomeStyles","lineHeight","Coefficients","shortNumbers","coefficientsString","formatCoefficient","join","CodeBlock","border","GenomePreview","editable","onGenomeEdit","shortEngineFormula","shortWheelsFormula","isEditableGenome","setIsEditableGenome","editedGenome","setEditedGenome","genomeError","setGenomeError","genomeCaption","genomeEditButtonIcon","genomeSaveButtonIcon","genomeEditButtons","genomePreviewLabel","genomePreviewOutput","editedGenomeString","genomeEditableOutput","genomeFromString","trim","onGenomeUpdate","Input","genomeOutput","decodedEngineFormula","decodedWheelsFormula","blocksMarginBottom","GENOME_PANELS","BestGenomes","bestGenomePanelTitle","bestGenome","bestCarLicencePlate","minLoss","secondBestGenomePanelTitle","secondBestGenome","secondBestCarLicencePlate","secondMinLoss","onBestGenomeEdit","genomeExpandedTabs","setGenomeExpandedTabs","bestGenomePreview","secondBestGenomePreview","panels","firstBestGenomePanel","secondBestGenomePanel","expanded","newGenomeExpandedTabs","openedTabIndex","indexOf","splice","EvolutionAnalytics","carsBatchIndex","needToRetry","worldIndex","carsBatchSize","timingDetails","evolutionParams","lossHistoryChart","populationTable","ParkingAutomatic","withVisibleSensors","EvolutionCheckpointSaver","onRestoreFromCheckpoint","onCheckpointToFile","showCheckpointModal","setShowCheckpointModal","checkpointIsProcessing","setCheckpointIsProcessing","checkpointErrorMessage","setCheckpointErrorMessage","onCheckpointModalClose","checkpointError","checkpointModal","secondary","demoCheckpoint","onCancel","onDrop","acceptedFiles","fileReader","FileReader","onload","checkpoint","readAsText","accept","multiple","progressMessage","fileName","checkpointString","checkpointBlob","Blob","saveAs","GENERATION_SIZE_URL_PARAM","GROUP_SIZE_URL_PARAM","GENERATION_LIFETIME_URL_PARAM","MUTATION_PROBABILITY_URL_PARAM","LONG_LIVING_CHAMPIONS_URL_PARAM","PERFORMANCE_BOOST_URL_PARAM","EvolutionTabEvolution","enqueue","useSnackbar","toLowerCase","getBooleanSearchParam","setPerformanceBoost","setWorldIndex","setGenerationSize","restoredFromGenerationIndex","setRestoredFromGenerationIndex","setGenerationIndex","setGeneration","setGenerationLifetime","setCars","carsBatch","setCarsBatch","setCarsBatchSize","setCarsBatchIndex","carsRef","setBestGenome","setMinLoss","setBestCarLicencePlate","setSecondBestGenome","setSecondMinLoss","setSecondBestCarLicencePlate","dynamicCarsPosition","batchTimer","carsLossRef","setCarsLoss","setLossHistory","setAvgLossHistory","genomeLossRef","parseFloat","getFloatSearchParam","setMutationProbability","setLongLivingChampionsPercentage","badSimulationRetriesNum","setBadSimulationRetriesNum","carsBatchesTotal","batch","generateWorldVersion","onEvolutionRestart","cancelBatchTimer","onCarLossUpdate","licensePlate","carGenomeIndex","carGenomeKey","clearTimeout","isValidGenerationFromStorage","getGenerationIndexFromStorage","generationFromStorage","generationIndexFromStorage","startEvolution","generationStartIndex","lossHistoryFromStorage","getLossHistoryFromStorage","avgLossHistoryFromStorage","getAvgLossHistoryFromStorage","createFirstGeneration","firstGeneration","debugGenerationSize","debugGenomeLength","err","getGenerationFromStorage","DURATION","medium","mateExistingGeneration","newGeneration","fitness","oldGeneration","genomeA","genomeB","fitnessA","fitnessB","longLiversCount","longLivingGenome","fitnessPerOldGenome","fatherGenomeIndex","matherGenomeIndex","randomFather","randomFatherGenomeIndex","select","genomeKey","carFitnessFunction","exceptionMessage","onBatchLifetimeEnd","cloneDeep","generationLoss","newLossHistory","minVal","currVal","newAvgLossHistory","nonNullLosses","ascSortedGenerationLoss","a","b","aTuned","bTuned","lossSum","sum","syncLossHistory","bestLicensePlateSoFar","secondBestCarLicensePlate","secondBestGenomeIndex","syncSecondBestGenome","bestCarLicensePlate","bestGenomeIndex","syncBestGenome","nextBatchIndex","createCarsFromGeneration","batchStart","batchEnd","generateNextCarsBatch","onLifetimeEnd","setTimeout","probability","time","percentage","reload","dateTime","Date","toISOString","BEST_GENOMES","AutomaticParkingAnalytics","genomes","selectedGenomeIndex","onCarsPositionChange","onChangeGenomeIndex","carLicencePlates","carsSwitcher","selectedCarsPosition","carsStartPositionChanger","BUTTON_GROUP_MODE","radio","BUTTON_GROUP_SIZE","selected","_event","positionIndex","GENOME_IDX_URL_PARAM","START_POSITION_URL_PARAM","DEFAULT_START_POSITION","EvolutionTabAutomatic","bestTrainedCarLossRef","onTrainedCarLossUpdate","setSelectedGenomeIndex","carPositionFromUrl","getStringSearchParam","getCarsPositionFromURL","setDynamicCarsPosition","bestDefaultTrainedGeneration","bestTrainedCarLoss","setBestTrainedCarLoss","bestTrainedCarCycleIndex","setBestTrainedCarCycleIndex","bestTrainedGeneration","setBestTrainedGeneration","bestTrainedCars","setBestTrainedCars","automaticParkingLifetimeTimer","automaticWorldVersion","onAutomaticCycleLifetimeEnd","cancelAutomaticCycleTimer","countDownAutomaticParkingCycleLifetime","TRAINED_CAR_GENERATION_LIFETIME","updatedGeneration","WORLD_SEARCH_PARAM","TAB_KEYS","evolution","automatic","manual","tabBarStyle","tabContentStyle","tabStyle","TabTitle","icon","EvolutionTabs","worldKey","activeWorldKey","setActiveWorldKey","TabBar","TabContent","Tab","activeKey","HomeScreen","App","exact","ReactDOM","render","StrictMode","getElementById"],"mappings":"yhnWAAaA,EAAgB,8B,OCqCdC,MA/Bf,WAKE,OACE,sBAAKC,MAAO,CAAEC,OAAQ,UAAtB,UACE,cAAC,IAAD,CACEC,QAPU,WACdC,SAASC,SAASC,KAAOP,GAOrBE,MAAO,CAAEM,eAAgB,OAAQC,OAAQ,WAF3C,SAIE,eAAC,IAAD,CACEC,OAAQ,CACNC,WAAY,IACZC,cAAe,YACfC,QAAS,OACTC,WAAY,SACZC,SAAU,OACVZ,OAAQ,KAPZ,8BAUmB,cAAC,IAAD,CAAQa,KAAM,GAAId,MAAO,CAAEC,OAAQ,YAVtD,kBAaF,cAAC,IAAD,CAAYO,OAAQ,CAAEO,UAAW,OAAjC,6E,SC7BOC,EAAc,2DCyBZC,MArBf,WAYE,OACE,qBAAKjB,MAAO,CAAEW,QAAS,OAAQO,aAAc,QAA7C,SACE,eAAC,IAAD,CAAYb,KAAMW,EAAahB,MAbF,CAC/BW,QAAS,OACTC,WAAY,SACZO,YAAa,OACbD,aAAc,QASZ,UACE,cAAC,IAAD,CAAUlB,MAPiB,CAC/BmB,YAAa,SAKX,qB,iBCYN,SAASC,EAASC,GAChB,IAAOC,EAAoBD,EAApBC,IAAKC,EAAeF,EAAfE,MAAOC,EAAQH,EAARG,KACnB,OACE,cAAC,IAAD,CAAOC,WAAW,OAAON,YAAY,OAArC,SACE,mBAAGd,KAAMiB,EAAKtB,MAAO,CAAC0B,MAAO,SAAUH,MAAOA,EAA9C,SACE,cAACC,EAAD,CAAMV,KAAM,SAMLa,MAnCf,WACE,OACE,cAAC,IAAD,CACET,aAAa,OACbH,UAAU,OACVJ,QAAQ,OACRiB,cAAc,MACdC,eAAe,SALjB,SAOE,cAACT,EAAD,CACEE,IAAKN,EACLO,MAAM,oBACNC,KAAMM,SCPRC,EAAS,IAAIC,IA8BJC,MAxBf,SAAgBZ,GACd,IAAQa,EAAab,EAAba,SACR,OACE,cAAC,IAAD,CAAmBC,MAAOJ,EAA1B,SACE,cAAC,IAAD,CAAcK,MAAOC,IAArB,SACE,cAAC,IAAD,UACE,eAAC,IAAD,WACE,eAAC,IAAD,CAAMC,KAAM,CAAC,EAAG,EAAG,IAAnB,UACE,cAAC,EAAD,IACA,cAAC,EAAD,OAEF,cAAC,IAAD,CAAMA,KAAM,CAAC,EAAG,EAAG,IAAnB,SACGJ,IAEH,cAAC,IAAD,CAAMI,KAAM,CAAC,EAAG,EAAG,IAAnB,SACE,cAAC,EAAD,gBCzBDC,EACL,CACJC,KAAM,K,uEC6CKC,E,kDA3Cb,WAAYpB,GAAe,IAAD,8BACxB,cAAMA,IACDqB,MAAQ,CACXC,UAAU,GAHY,E,qDAc1B,SAAkBC,EAAcC,GAG9BC,QAAQF,MAAMA,EAAOC,GACrBE,KAAKC,SAAS,CAAEL,UAAU,M,oBAG5B,WACE,IAAQT,EAAaa,KAAK1B,MAAlBa,SAGR,OAFqBa,KAAKL,MAAlBC,SAKJ,cAAC,IAAD,CACEM,KAAMC,IAAKC,SACXC,UAAW,CACTC,KAAM,CAACrD,MAAO,CAACsD,MAAO,UAH1B,mCAWGpB,K,uCAhCT,WAEE,MAAO,CACLS,UAAU,O,GAXYY,IAAMC,WCXrBC,EAAiB,SAACC,GAE7B,OADqBC,IACDC,IAAIF,IAGbG,EAAiB,SAACH,EAAcvB,GAC3C,IAAM2B,EAAeH,IACrBG,EAAaC,IAAIL,EAAMvB,GACvB,IAAM6B,EAAc,IAAMF,EAAaG,WAAa9D,SAASC,SAAS8D,KACtEC,OAAOC,QAAQC,UAAU,KAAM,GAAIL,IAGxBM,EAAoB,SAACZ,GAChC,IAAMI,EAAeH,IACrBG,EAAaS,OAAOb,GACpB,IAAMM,EAAc,IAAMF,EAAaG,WAAa9D,SAASC,SAAS8D,KACtEC,OAAOC,QAAQC,UAAU,KAAM,GAAIL,IAG/BL,EAAkB,WACtB,IAAMa,EAAcrE,SAASC,SAASqE,OAAOC,UAAU,GACvD,OAAO,IAAIC,gBAAgBH,IAWhBI,EAAoB,SAAClB,EAAcmB,GAC9C,IAAMC,EAA6BrB,EAAeC,GAClD,OAAoB,OAAhBoB,EACKD,EAEFE,SAASD,I,iIC/BLE,GACI,gBADJA,GAEK,iBAFLA,GAGI,gBAHJA,GAIC,aAJDA,GAKE,cALFA,GAMK,iBANLA,GAOC,aAPDA,GAQG,eAGHC,GAAU,SAACC,GAAyC,IAApBC,EAAmB,uDAAP,GACjDC,EAAQ,IAAIC,YAAYH,EAAW,CAAEI,OAAQH,IACnDhF,SAASoF,cAAcH,IAGZI,GAAK,SAACN,EAAqBO,GACtCtF,SAASuF,iBAAiBR,EAAWO,IAG1BE,GAAM,SAACT,EAAqBO,GACvCtF,SAASyF,oBAAoBV,EAAWO,ICoC3BI,OAzDf,WACE,IAAMC,EAAa,IACbC,EAAQ,GAiBRC,EAAkBC,MAdT,SAACb,EAAYD,GAC1B,IAAMe,EAAQf,EAAKe,MAAMC,OACrBD,EAAS,IAAeA,EAAS,IACnCjB,GAAQD,IACCkB,EAAS,KAAeA,EAAS,KAC1CjB,GAAQD,IAENkB,EAAQH,GAASG,EAAS,IAC5BjB,GAAQD,IACCkB,EAAS,KAAgBA,EAAS,KAC3CjB,GAAQD,MAZY,IAgBkC,CACxDoB,SAAS,EACTC,UAAU,IASNC,EAAiBL,MANT,SAACb,EAAYD,GACzBF,GAAQD,IACRC,GAAQD,IACRC,GAAQD,MAG6BuB,IAAsB,CAC3DH,SAAS,EACTC,UAAU,IAGZ,OAAO,cAAC,KAAD,CACLrG,MAAO,CACLsD,MAAOwC,EACPU,OAAQV,EACR/E,WAAW,IACXU,WAAW,cAAD,OAAgBgF,KAAKC,MAAMZ,IAA3B,OACVa,SAAU,YAGZC,QAAS,CACPC,aAAa,EACbnF,MAAO,QACPoF,KAAM,SACNhG,KAAMgF,EACNa,SAAU,CAAEI,IAAK,MAAOC,KAAM,QAGhCC,OAAQjB,EACRkB,MAAOZ,KCzDJ,SAASa,GAAYC,GAC1B,MAAoCC,oBAAS,GAA7C,mBAAOC,EAAP,KAAmBC,EAAnB,KAQMC,EAAsBC,uBANR,SAAC,GAA4B,IAA1BC,EAAyB,EAAzBA,IACjBN,EAAOO,SAASD,IAClBH,GAAc,KAImC,CAACH,IAQhDQ,EAAoBH,uBANR,SAAC,GAA4B,IAA1BC,EAAyB,EAAzBA,IACfN,EAAOO,SAASD,IAClBH,GAAc,KAI+B,CAACH,IAWlD,OATAS,qBAAU,WAGR,OAFA1D,OAAOuB,iBAAiB,UAAW8B,GACnCrD,OAAOuB,iBAAiB,QAASkC,GAC1B,WACLzD,OAAOyB,oBAAoB,UAAW4B,GACtCrD,OAAOyB,oBAAoB,QAASgC,MAErC,CAACA,EAAmBJ,IAEhBF,EC9BF,IAAMQ,GAAyB,IC+DvBC,OAvDf,WAOE,IAAMC,EAAUb,GAAY,CAAC,MACvBc,EAAWd,GAAY,CAAC,MACxBH,EAAOG,GAAY,CAAC,MACpBe,EAAQf,GAAY,CAAC,MACrBgB,EAAQhB,GAAY,CAAC,MA8B3B,OA5BAU,qBAAU,WAGN5C,GADE+B,IAASkB,EACHlD,GACCkD,IAAUlB,EACXhC,GAEAA,IAKRC,GADE+C,IAAYC,EACNjD,GACCiD,IAAaD,EACdhD,GAEAA,IAINmD,GACFlD,GAAQD,IAELmD,GACHlD,GAAQD,MAET,CAACgD,EAASC,EAAUjB,EAAMkB,EAAOC,IAGlC,cAAC,IAAD,CACExB,SAAS,WACT5F,UAAS,WAAK,IAAL,MACTqH,YAAY,OAHd,SAKE,eAAC,IAAD,CAAY5H,OAAQ,CAACkB,MAAO,SAA5B,UAEE,wCAFF,mBAEmC,yCAFnC,mB,OCtCS2G,OATf,SAAgBhH,GACd,IAAOa,EAAYb,EAAZa,SACP,OACE,qBAAKoG,UAAU,oBAAf,SACGpG,KCWDqG,GAAuB,YAEvBC,GAAeC,aAAUC,KAAmB,CAChDpF,MAAO,OACPkD,OAAQ,OACRmC,gBAAiB,MACjBC,iBAAkB,MAClBC,eAAgB,MAChBC,kBAAmB,MACnBC,eAAgB,UA0GlB,IAAMC,GAAiBC,aAAO,MAAO,CACnCzC,OAAO,GAAD,OAAKsB,GAAL,MACNoB,UAAW,aACXC,YAAa,SACbC,YAAa,qBACbC,YAAa,IAGAC,GA7Gf,SAAejI,GACb,IACEa,EAKEb,EALFa,SADF,EAMIb,EAJFkI,2BAFF,WAMIlI,EAHFmI,2BAHF,WAMInI,EAFFoI,eAJF,MAIY,IAJZ,IAMIpI,EADFqI,wBALF,SAQA,EAAmBrC,qBAAoB5D,EAXV,UAavBkG,EAFN,oBAGE,cAACC,EAAA,EAAD,CAAOC,UAAW,IAChB,KAEEC,EACJ,qBAAK9J,MAAO,CACVW,QAAS,OACTkB,eAAgB,SAChBjB,WAAY,SACZ+F,SAAU,WACVrD,MAAO,OACP4F,UAAW,aACX1C,OAAO,GAAD,OAAKsB,GAAL,MACNqB,YAAa,SACbC,YAAa,qBACbT,gBAAiB,EACjBC,iBAAkB,EAClBE,kBAAmB,EACnBD,eAAgB,EAChBkB,gBAAiBxB,IAdnB,SAgBE,cAAC,GAAD,UACE,cAACC,GAAD,QAKAwB,EAAqBT,EACzB,cAAC,GAAD,IACE,KAEEU,EAAqBT,EACzB,cAAC,GAAD,IACE,KAEEU,EAAY/F,OAAOgG,WHlFkB,IGkF2B,GAAK,GAErEC,EAAcV,EAAmB,KACrC,cAACW,EAAA,EAAD,CAAaC,YAAY,EAAOC,OAAQ,UAG1C,OACE,eAAC,IAAD,CAAO5D,SAAS,WAAW6D,SAAS,SAAS7J,QAAQ,QAAQ6F,OAAM,UAAKsB,GAAL,MAAnE,UACGgC,EACD,cAACd,GAAD,UACE,eAAC,IAAD,CAAQyB,SAAO,EAAf,UACE,cAACC,EAAA,EAAD,CACEC,aAAW,EACXC,IAAKV,EACLvD,SAAU,EAAE,GAAI,GAAI,KAEtB,cAACkE,EAAA,EAAD,IACA,uBAAOC,OAAO,aAAaC,KAAM,CAACxC,MAClC,iCAAiByC,UAAW,EAAGC,YAAa,IAAIC,SAAa,UAC7D,2BACEvE,SAAU,EAAE,GAAI,GAAI,IACpBT,MAAO,GACPiF,SAAU,EACVH,UAAW,IACXI,uBAAsB,KACtBC,wBAAuB,KACvBC,YAAU,IAEZ,eAAC,IAAD,CACEC,KAAM,EAAI,GACVC,QAAS,CAAC,GAAI,GAAI,GAClBC,WAAY,GACZC,uBAAwB,CACtBC,SAAU,IACVC,YAAa,IACbC,0BAA2B,GAE7BC,WAAW,MACXC,YAAU,EAVZ,UAYG3B,EACAlI,KAIH,cAAC8J,EAAA,EAAD,CAAaC,WAAS,MAnCHxC,KAsCtBO,EACAC,EACAN,M,SCjHQuC,OAhBf,SAAgB7K,GACd,IAAM0J,EAAgB,CAAC,IAAK,KAC5B,EAAcoB,aAAS,gCACrBC,KAAM,SACNC,SAAU,EAAE5F,KAAK6F,GAAK,EAAG,EAAG,GAC5BvB,QACG1J,MAJEkL,EAAP,oBAMA,OACE,uBAAMA,IAAKA,EAAKC,eAAa,EAA7B,UACE,qCAAqBzB,KAAMA,IAC3B,gCAAgBrJ,MAAM,UAAU+K,QAAS,S,SCblCC,GAAe,UAAM5M,EAAN,WCAf6M,GAAe,SAACC,GAC3B,MAAM,GAAN,OAAUF,GAAV,YAA6BE,ICwBlBC,GAEH,CACNC,cAAe,EACfC,kBAAmB,EACnBC,kBAAmB,EACnBC,eAAgB,IA0BpB,SAASC,GAAYC,EAAYC,GAC/B,IAAQN,EAAqCM,EAArCN,cAAeC,EAAsBK,EAAtBL,kBAGjBM,EAAI,UAAK,EAAMF,EAAK,IAGpBG,EAAe,WAAMP,EAAoB,GAAK,EAS9CQ,EAReJ,EAAKK,MAAMV,EAAeA,EAAgBC,GACzBU,QACpC,SAACC,EAAuBC,EAAiBC,GAEvC,OAAOF,EAAgBC,EADJ,SAAG,EAAMZ,EAAoBa,EAAW,KAG7D,GAEkCN,EAI9BO,EADeV,EAAKK,MAAMV,EAAgBC,GAClBU,QAC5B,SAACK,EAAuBH,EAAiBC,GAEvC,OAAOE,EAAgBH,EADJ,SAAG,IAAOC,EAAW,MAG1C,GAIF,OAAOP,EAAI,SAAI,EAAKE,IAAa,EAAIM,GCxFhC,IAAME,GAAmB,SAACC,EAAwBC,GACvD,GAAID,EAAaE,SAAYD,EAAUC,OAAS,EAC9C,MAAM,IAAIC,MAAJ,qEAAwEH,EAAaE,OAArF,gBAAmGD,EAAUC,SAErH,IAAIE,EAAS,EAQb,OAPAJ,EAAaK,SAAQ,SAACC,EAAqBC,GACrCA,EAAmBN,EAAUC,OAC/BE,GAAUE,EAAcL,EAAUM,GAElCH,GAAUE,KAGPF,GCZII,GAAU,SAACC,GACtB,OAAO,GAAK,WAAIhI,KAAKiI,GAAMD,KAGhBE,GAAsB,SACjCC,GAEgB,IADhBC,EACe,uDADY,OAE3B,OAAID,EAAgB,GAAMC,GAChB,EAEND,EAAgB,GAAMC,EACjB,EAEF,GCVIC,GAAoB,SAACC,EAAeC,GAC/C,IAAMC,EAAQF,EAAK,GACbG,EAAQH,EAAK,GACbI,EAAMH,EAAG,GACTI,EAAMJ,EAAG,GACf,OAAOvI,KAAK4I,KAAK,SAACJ,EAAQE,EAAQ,GAAjB,SAAsBD,EAAQE,EAAQ,KCK5CE,GAAmBzC,GAAwBI,eAK3CsC,GAA2B,EAAiCD,GAC5DE,GAA2B,EAAiCF,GAG5DG,GAAgBF,GAA2BC,GAS3CE,GAAU,SAACC,GACtB,IAAQC,EAAsCD,EAAtCC,eAAgBC,EAAsBF,EAAtBE,kBAGlBC,EAIFF,EAJFG,GACIC,EAGFJ,EAHFK,GACIC,EAEFN,EAFFO,GACIC,EACFR,EADFS,GAIIC,EAIFT,EAJFE,GACIQ,EAGFV,EAHFI,GACIO,EAEFX,EAFFM,GACIM,EACFZ,EADFQ,GAQF,OALmBvB,GAAkBgB,EAASQ,GAC3BxB,GAAkBkB,EAASO,GAC3BzB,GAAkBoB,EAASM,GAC3B1B,GAAkBsB,EAASK,IAEe,GAGlDC,GAAmB,SAACC,GAA6C,IAA/BC,EAA8B,uDAAd,EAC7D,OAAO,GAAKA,EAAQD,EAAO,IAchBE,GAAe,SAACC,GAC3B,IAAMC,EAAsBD,EAAOtD,MAAM,EAAG+B,IACtCyB,EAAsBF,EAAOtD,MACjC+B,GACAA,GAA2BC,IAM7B,MAAO,CACLyB,0BAJqDC,GAAgBH,EAAazB,IAKlF6B,0BAJqDD,GAAgBF,EAAa1B,MAQzE4B,GAAkB,SAACJ,EAAgBM,GAC9C,GAAIN,EAAO5C,OAASkD,IAAmB,EACrC,MAAM,IAAIjD,MAAM,+CAGlB,IADA,IAAMkD,EAAoB,GACjBC,EAAc,EAAGA,EAAcR,EAAO5C,OAAQoD,GAAeF,EAAgB,CACpF,IAAMG,EJIDrE,GIJgC4D,EAAOtD,MAAM8D,EAAaA,EAAcF,GJItDvE,IIHvBwE,EAAQG,KAAKD,GAEf,OAAOF,GCxFII,GAAmB9E,GAAa,aAYhC+E,GAAsB,UAEtBC,GAAgB,IAEhBC,GAAwB,CAACD,GADR,EAFA,GAKjBE,GAAqB,UAKrBC,IAA4B,IAE5BC,GAAqBpF,GAAa,cAClCqF,GAAqC,CAAC,GAAI,GAAK,GAS/CC,GAAsB,G,oBCvCtBC,GAAW,SAAC7Q,GACvB,OAAO,IAAI6J,wBAAJ,cACLiH,UAAW,GACXC,UAAW,IACR/Q,KAIMgR,GAAY,SAAChR,GACxB,OAAO,IAAI6J,wBAAJ,gBACF7J,KAIMiR,GAAa,SAACjR,GACzB,OAAO,IAAI6J,wBAAJ,gBACF7J,KAIMkR,GAAW,SAAClR,GACvB,OAAO,IAAI6J,wBAAJ,2BACLiH,UAAW,GACXC,UAAW,EACXI,aAAc,IACXnR,GAJE,IAKLoR,aAAa,EACb/Q,MAAO,cC6GIgR,OAvHf,SAAsBrR,GACpB,MAOIA,EANFsR,iBADF,MACc,GADd,IAOItR,EALFuR,iBAFF,WAOIvR,EAJF4H,cAHF,WAOI5H,EAHFiK,kBAJF,WAOIjK,EAFFmL,qBALF,SAMa9K,EACTL,EADFwR,UAGF,EAAwCC,aAAQf,IAAxCgB,EAAR,EAAQA,MAAOC,EAAf,EAAeA,UASf,OAPAC,OAAOC,KAAKH,GAAO1E,SAAQ,SAAC8E,GACtBA,EAAYC,WAAW,cAEzBL,EAAMI,GAAaE,SAASC,WAAa,IAAIC,KAAQR,EAAMI,GAAaE,cAK1E,oDAAWV,GAAX,cACE,sBACEnG,cAAeA,EACflB,WAAYA,EACZkI,SAAUvK,EAAS+J,EAAU,eAAiBd,GAAS,CAACU,YAAWlR,MAAO,YAC1E2R,SAAUN,EAAMU,UAAUJ,WAE5B,sBACE7G,cAAeA,EACflB,WAAYA,EACZkI,SAAUvK,EAAS+J,EAAS,OAAaX,GAAU,CAACO,YAAWlR,MAAO,YACtE2R,SAAUN,EAAMW,UAAUL,WAE5B,sBACE7G,cAAeA,EACflB,WAAYA,EACZkI,SAAUvK,EAAS+J,EAAS,MAAYd,GAAS,CAACU,YAAWlR,UAC7D2R,SAAUN,EAAMY,UAAUN,WAE5B,sBACE7G,cAAeA,EACflB,WAAYA,EACZkI,SAAUvK,EAAS+J,EAAS,UAAgBd,GAAS,CAACU,YAAWlR,MAAO,YACxE2R,SAAUN,EAAMa,UAAUP,WAE5B,sBACE7G,cAAeA,EACflB,WAAYA,EACZkI,SAAUvK,EAAS+J,EAAS,MAAYd,GAAS,CAACU,YAAWlR,UAC7D2R,SAAUN,EAAMc,UAAUR,WAE5B,sBACE7G,cAAeA,EACflB,WAAYA,EACZkI,SAAUvK,EAAS+J,EAAU,mBAAqBV,GAAW,CAACM,YAAWlR,MAAO,YAChF2R,SAAUN,EAAMe,UAAUT,WAE5B,sBACE7G,cAAeA,EACflB,WAAYA,EACZkI,SAAUvK,EAAS+J,EAAU,oBAAsBV,GAAW,CAACM,YAAWlR,UAC1E2R,SAAUN,EAAMgB,UAAUV,WAE5B,sBACE7G,cAAeA,EACflB,WAAYA,EACZkI,SAAUvK,EAAS+J,EAAS,UAAgBV,GAAW,CAACM,YAAWlR,UACnE2R,SAAUN,EAAMiB,UAAUX,WAE5B,sBACE7G,cAAeA,EACflB,WAAYA,EACZkI,SAAUvK,EAAS+J,EAAS,MAAYT,GAAS,CAACK,YAAWlR,UAC7D2R,SAAUN,EAAMkB,UAAUZ,WAC5B,sBACE7G,cAAeA,EACflB,WAAYA,EACZkI,SAAUvK,EAAS+J,EAAS,MAAYd,GAAS,CAACU,YAAWlR,UAC7D2R,SAAUN,EAAMmB,WAAWb,WAE7B,sBACE7G,cAAeA,EACflB,WAAYA,EACZkI,SAAUvK,EAAS+J,EAAU,iBAAmBV,GAAW,CAACM,YAAWlR,MAAO,YAC9E2R,SAAUN,EAAMoB,WAAWd,WAE7B,sBACE7G,cAAeA,EACflB,WAAYA,EACZkI,SAAUvK,EAAS+J,EAAS,UAAgBT,GAAS,CAACK,YAAWlR,UACjE2R,SAAUN,EAAMqB,WAAWf,WAE7B,sBACE7G,cAAeA,EACflB,WAAYA,EACZkI,SAAUvK,EAAS+J,EAAU,kBAAoBT,GAAS,CAACK,YAAWlR,UACtE2R,SAAUN,EAAMsB,WAAWhB,WAC7B,sBACE7G,cAAeA,EACflB,WAAYA,EACZkI,SAAUvK,EAAS+J,EAAU,kBAAoBV,GAAW,CAACM,YAAWlR,UACxE2R,SAAUN,EAAMuB,WAAWjB,WAE7B,sBACE7G,cAAeA,EACflB,WAAYA,EACZkI,SAAUvK,EAAS+J,EAAU,eAAiBT,GAAS,CAACK,YAAWlR,UACnE2R,SAAUN,EAAMwB,WAAWlB,WAE7B,sBACE7G,cAAeA,EACflB,WAAYA,EACZkI,SAAUvK,EAAS+J,EAAU,iBAAmBd,GAAS,CAACU,YAAWlR,UACrE2R,SAAUN,EAAMyB,WAAWnB,gB,kBCzH7BoB,GAAY,IAAIvJ,SAAY,OAC5BwJ,GAAmB,IAAIxJ,SAAY,UACnCyJ,GAAkB,IAAIzJ,SAAY,UAGxCA,QAAW0J,UAAUC,QAAUC,KAY/B,IA4HeC,GA5HG,SAAC1T,GACjB,IACE2T,EAOE3T,EAPF2T,MACAjG,EAME1N,EANF0N,KACAC,EAKE3N,EALF2N,GACAiG,EAIE5T,EAJF4T,OAJF,EAQI5T,EAHF6T,iBALF,MAKc,GALd,IAQI7T,EAFF8T,eANF,WAQI9T,EADF+T,aAPF,MAOU,SAACJ,EAAOK,KAPlB,EAUMC,EAAUC,mBAEVC,EAAcD,iBAAsB,IAAIrK,YACxCuK,EAAeF,iBAAsB,IAAIrK,YACzCwK,EAAeH,iBAAwB,IAAIrK,cAE3CyK,EAA+BJ,iBAAsD,MACrFK,EAA4BL,iBAAsD,MAElFM,EAAkBN,iBAAuB,IAC/CG,EAAaI,QAAQC,KAAO,EAC5BL,EAAaI,QAAQE,IHbQ,EGgB7BN,EAAaI,QAAQG,cAAe,EAYpCN,EAA6BG,QAAU7P,MAVd,WACvB4P,EAAgBC,QAAUJ,EAAaI,QAAQI,iBAAiBhB,GAAW,KC1DrC,IDmEsD,CAC5F9O,SAAS,EACTC,UAAU,IAOPuP,EAA0BE,UAC7BF,EAA0BE,QAAU7P,MALhB,SAAC+O,EAAeK,GACpCD,EAAMJ,EAAOK,KCtEsB,ID0EkD,CACnFjP,SAAS,EACTC,UAAU,KAId8P,aAAS,SAACzT,EAAkBqD,GAC1B,GAAI,OAACuP,QAAD,IAACA,OAAD,EAACA,EAASQ,QAAd,CAIAR,EAAQQ,QAAQM,iBAAiBZ,EAAYM,SAC7CR,EAAQQ,QAAQO,kBAAkBZ,EAAaK,SAE/CJ,EAAaI,QAAQ/R,IAAIyR,EAAYM,QAASL,EAAaK,SAEvDH,EAA6BG,SAC/BH,EAA6BG,UAG/B,IAAMT,EAAWQ,EAAgBC,QAAQ5H,OACrC2H,EAAgBC,QAAQ,GAAGT,cAC3BiB,EAEAV,EAA0BE,SAC5BF,EAA0BE,QAAQd,EAAOK,GAIzCC,EAAQQ,QAAQtC,SAAS9R,WADV4U,IAAbjB,EAC+BZ,GACxBY,EAAYkB,EACY7B,GAEAC,OAIrC,IAAM6B,EAAY,WACZb,EAA6BG,SAC/BH,EAA6BG,QAAQW,SAEnCb,EAA0BE,SAC5BF,EAA0BE,QAAQW,UAItC5O,qBAAU,WACR,OAAO2O,IACN,IAEH3O,qBAAU,WACHyN,EAAQQ,SAGbR,EAAQQ,QAAQY,QAAQzB,KACvB,CAACA,IAEJ,IAAM0B,GAAe,IAAIzL,mBAAuB0L,cAAc,CAAC,aACzD1L,WADwD,aACvC6D,IADuC,aAExD7D,WAFwD,aAEvC8D,MAGvB,OACE,gCAEE,sBAAMzC,IAAK+I,EAASjC,SAAUsD,EAA9B,SACE,mCACE7L,OAAO,WACPpJ,MAAO+S,GACPoC,UAlIQ,GAmIR1B,QAASA,SE1DJ2B,GAzEC,SAACzV,GACf,MAAqEA,EAA7D0V,sBAAR,SAAgCC,EAAqC3V,EAArC2V,WAAhC,EAAqE3V,EAAzB4V,iBAA5C,MAAwD,aAAxD,EACM/B,EAAYK,iBAAyB,IACrC2B,EAAkB3B,iBAAyB,IAAI4B,MAAMH,GAAYI,UAAKd,IACpEe,EAAUC,cAAVD,MACFE,EAAgChC,iBAAsD,MAMvFgC,EAA8BzB,UACjCyB,EAA8BzB,QAAU7P,MALhB,WACxBgR,EAAUC,EAAgBpB,WDlBa,ICsB0D,CAC/F1P,SAAS,EACTC,UAAU,KAId,IAAM+O,EAAQ,SAACJ,EAAeK,GAC5B6B,EAAgBpB,QAAQd,GAA6B,kBAAbK,EACpCA,EACA,KACAkC,EAA8BzB,SAChCyB,EAA8BzB,WAKlCZ,EAAUY,QAAUuB,EAAMnV,SACvBsV,QAAO,SAACC,GAAD,MAA4C,UAAhBA,EAAOrL,QAC1CsL,KAAI,SAACD,GAAD,OAA4BA,EAAOE,gBAAgBjG,OACvD8F,QAAO,SAACC,GACP,IAAKA,IAAWA,EAAOG,SACrB,OAAO,EAGT,IAAMA,EAAwBH,EAAOG,SACrC,cAAOA,QAAP,IAAOA,OAAP,EAAOA,EAAUC,oBAGrB,IAAMC,EAAY,EAAIrR,KAAK6F,GAAK0K,EAC1Be,EAAa,IAAIZ,MAAMH,GAAYI,KAAK,MAAMM,KAAI,SAACM,EAAGhD,GAC1D,OACE,cAAC,GAAD,CAEEA,MAAOA,EACPjG,KAAM,CAAC,GLxBc,IKwBI,GACzBC,GAAI,CAAC,GLzBgB,IACE,GKyBvBiG,OAAQ6C,EAAY9C,EACpBG,QAAS4B,EACT7B,UAAWA,EAAUY,QACrBV,MAAOA,GAPFJ,MAYLwB,EAAY,WACZe,EAA8BzB,SAChCyB,EAA8BzB,QAAQW,UAQ1C,OAJA5O,qBAAU,WACR,OAAO2O,IACN,IAGD,mCACGuB,K,UCzDQE,OArBf,SAAkB5W,GAChB,IAAQ6W,EAAY7W,EAAZ6W,QAWR,OACE,cAACC,GAAA,EAAD,CAAMxR,SAAU,CAAC,EAAG,IAAK,GAAzB,SACE,qBAAK3G,MAXyB,CAChC+J,gBAAiB,2BACjBqO,QAAS,UACTC,aAAc,OACd3W,MAAO,QACP4W,SAAU,OACVC,WAAY,UAKV,SACGL,OCcMM,OAtBf,SAA4BnX,GAC1B,MAIIA,EAHFiK,kBADF,WAIIjK,EAFFmL,qBAFF,SAGa9K,EACTL,EADFwR,UAGI4F,EAAoB,CACxB9G,IACA+G,GACAC,KAGF,OACE,uBAAMrN,WAAYA,EAAYkB,cAAeA,EAA7C,UAEE,mCAAmBzB,KAAM0N,IACzB,sCAAsB/W,MAAOA,QCyFpBkX,GArFCC,sBAAqD,SAACxX,EAAOkL,GAC3E,IACEyK,EAmBE3V,EAnBF2V,WADF,EAoBI3V,EAlBFuR,iBAFF,WAoBIvR,EAjBF4H,cAHF,WAoBI5H,EAhBFiK,kBAJF,WAoBIjK,EAfFmL,qBALF,WAoBInL,EAdFyX,eANF,WAoBIzX,EAbF0X,mBAPF,WAoBI1X,EAZF0V,sBARF,WAoBI1V,EAXF2X,cATF,MRV0B,EQU1B,IAoBI3X,EAVF4X,aAVF,MAUU,KAVV,EAWEpG,EASExR,EATFwR,UACAqG,EAQE7X,EARF6X,gBACAvG,EAOEtR,EAPFsR,UAbF,EAoBItR,EANFuW,gBAdF,MAca,GAdb,EAeEuB,EAKE9X,EALF8X,qBACAC,EAIE/X,EAJF+X,oBAhBF,EAoBI/X,EAHFgY,iBAjBF,MAiBc,aAjBd,IAoBIhY,EAFF4V,iBAlBF,MAkBc,aAlBd,EAmBEvN,EACErI,EADFqI,iBAGI4P,EAAU1H,GAChB2H,aACE,gCACEC,KAAMR,EACNjN,YAAY,EACZhB,KAAMuO,EACNH,uBACAC,sBACAC,YACAzB,WACAxL,KAAM0M,EAAU,UAAY,UACzBnG,KAGLpG,GAGF,IAAMkN,EAAyB,CAC7B9S,SAAUuS,GAGNQ,EAAUX,EACd,cAAC,GAAD,CACEhC,eAAgBA,EAChBC,WAAYA,EACZC,UAAWA,IAEX,KAEE0C,EAAWV,EACf,cAAC,GAAD,CAAUf,QAASe,IACjB,KAEEW,EAAelQ,EACnB,cAAC,GAAD,CACEiJ,UAAW8G,EACXnO,WAAYA,EACZkB,cAAeA,EACfqG,UAAWA,IAGb,cAAC,GAAD,CACEF,UAAW8G,EACXnO,WAAYA,EACZkB,cAAeA,EACfoG,UAAWA,EACX3J,OAAQA,EACR4J,UAAWA,IAIf,OACE,wBAAOtG,IAAKA,EAAK7I,KAAMgO,GAAvB,UACE,+BACGkI,IAEFF,EACAC,QCxCQE,OAtDf,SAAoBxY,GAAyB,IAAD,MAC1C,EAOIA,EANFiK,kBADF,WAOIjK,EALFmL,qBAFF,WAOInL,EAJFoY,kBAHF,MAGe,GAHf,IAOIpY,EAHF4H,cAJF,WAOI5H,EAFFuR,iBALF,SAMalR,EACTL,EADFwR,UAGF,EAAwCC,aAAQrB,IAAxCsB,EAAR,EAAQA,MAAOC,EAAf,EAAeA,UAET8G,EAAI,UAAG/G,EAAMgH,eAAT,aAAG,EAAe1G,SACtB2G,EAAI,UAAGjH,EAAMkH,eAAT,aAAG,EAAe5G,SACtB6G,EAAG,UAAGnH,EAAMoH,eAAT,aAAG,EAAe9G,SAErB+G,EAAenR,EACjB+J,EAAUqH,OACVhI,GAAU,CAAEO,YAAWlR,MAAO,YAM5B4Y,EAAepI,GAAS,CAAEU,YAAWlR,UAErC6Y,EAActR,EAChB+J,EAAUwH,MACVtI,GAAS,CAAEU,YAAWlR,UAE1B,OACE,oDAAW+X,GAAX,cACE,sBACEpG,SAAUyG,EACVtG,SAAU4G,EACV9O,WAAYA,EACZkB,cAAeA,IAEjB,sBACE6G,SAAU2G,EACVxG,SAAU8G,EACVhP,WAAYA,EACZkB,cAAeA,IAEjB,sBACE6G,SAAU6G,EACV1G,SAAU+G,EACVjP,WAAYA,EACZkB,cAAeA,SCjCRiO,OAtBf,SAA0BpZ,GACxB,MAIIA,EAHFiK,kBADF,WAIIjK,EAFFmL,qBAFF,SAGa9K,EACTL,EADFwR,UAGI6H,EAAiD,CVd7B,MACD,GUiBvB,IAGF,OACE,uBAAMpP,WAAYA,EAAYkB,cAAeA,EAA7C,UACE,wCAAwBzB,KAAM2P,IAC9B,sCAAsBhZ,MAAOA,QCqDpBiZ,GA1DD9B,sBAAmD,SAACxX,EAAOkL,GACvE,IACEqO,EAYEvZ,EAZFuZ,OADF,EAaIvZ,EAXFiC,aAFF,MXnByB,GWmBzB,IAaIjC,EAVFmY,YAHF,MXrBwB,GWqBxB,IAaInY,EATFwZ,gBAJF,MAIa,GAJb,IAaIxZ,EARFiK,kBALF,WAaIjK,EAPFmL,qBANF,WAaInL,EANFyZ,cAPF,WAaIzZ,EALF4H,cARF,WAaI5H,EAJFuR,iBATF,WAaIvR,EAHFsR,iBAVF,MAUc,GAVd,EAWEE,EAEExR,EAFFwR,UACAnJ,EACErI,EADFqI,iBAGIqR,EAAqB,CAACH,EAAQA,EAAQtX,EAAOuX,GAG7CxO,EAAoB,CAAC,EAAG,GAAKyO,EAAS,GAAK,GAAKrU,KAAK6F,GAAM,GAEjE0O,aACE,gCACExB,OACApN,KAAM,YACN+M,qBAAsB,EACtBpO,KAAMgQ,GACHpI,KAGLpG,GAGF,IAAM0O,EAAavR,EACjB,cAAC,GAAD,CACE4B,WAAYA,EACZkB,cAAeA,EACfqG,UAAWA,IAGb,cAAC,GAAD,CACEvH,WAAYA,EACZkB,cAAeA,EACfvD,OAAQA,EACR2J,UAAWA,EACXC,UAAWA,IAIf,OACE,sBAAMtG,IAAKA,EAAK7I,KXvEa,QWuE7B,SACE,sBAAM2I,SAAUA,EAAhB,SACG4O,SC1EHC,KAAiBzX,EAFO,SAgBjB0X,GAAgB,SAACxL,GAC5B,IAAQyL,EAAYzL,EAAZyL,QAmCR,MAAO,CAAEC,KAjCoB,SAACC,GAAgC,IAAD,EAC3D,GAAKJ,GAAL,CAD2D,2BAAnBK,EAAmB,iCAAnBA,EAAmB,mBAI3D,EAAAzY,SAAQ0Y,IAAR,qBACOJ,GACL,wEACA,SACAE,GAJF,OAKKC,MAwBQE,KApBc,SAACH,GAAgC,IAAD,EAC3D,GAAKJ,GAAL,CAD2D,2BAAnBK,EAAmB,iCAAnBA,EAAmB,mBAI3D,EAAAzY,SAAQuY,KAAR,qBACOD,GACL,qEACA,SACAE,GAJF,OAKKC,MAWc3Y,MAPS,SAAC0Y,GAAgC,IAAD,EAC5D,GAAKJ,GAAL,CAD4D,2BAAnBK,EAAmB,iCAAnBA,EAAmB,mBAI5D,EAAAzY,SAAQF,MAAR,SAAcwY,EAASE,GAAvB,OAAmCC,QCjD1BG,GAAQ,SAAChU,EAAavC,GACjC,IAAMwW,EAASR,GAAc,CAACC,QAAS,mBACvC,IACE,IAAMQ,EAAkBC,KAAKC,UAAU3W,GACvC4W,aAAaC,QAAQtU,EAAKkU,GAC1BD,EAAON,KAAP,mCAAwC3T,EAAxC,8BACA,MAAO9E,GAEP,OADA+Y,EAAO/Y,MAAM,+BAAgCA,IACtC,EAET,OAAO,GAGIqZ,GAAO,SAACvU,GACnB,IAAMiU,EAASR,GAAc,CAACC,QAAS,kBACvC,IACE,IAAMQ,EAAiCG,aAAaG,QAAQxU,GAE5D,OADAiU,EAAON,KAAP,kCAAuC3T,EAAvC,gCACKkU,EAGEC,KAAKM,MAAMP,GAFTA,EAGT,MAAOhZ,GAEP,OADA+Y,EAAO/Y,MAAM,8BAA+BA,GACrC,OAIEwZ,GAAS,SAAC1U,GACrB,IAAMiU,EAASR,GAAc,CAACC,QAAS,oBACvCW,aAAaM,WAAW3U,GACxBiU,EAAON,KAAP,qCAA0C3T,EAA1C,oBC1BI4U,GAAiC,EAAE,IAAK,GAAI,KAE3C7N,GAAW6N,GAAlB,GAAUC,GAAQD,GAAlB,GAAaE,GAAKF,GAAlB,GAKMG,GAAS,IACTC,GAAS,KAETC,GAASlO,IANAkD,IAMc8K,IAAU,EAEjCG,GAASJ,IAPA7D,IAOc+D,IAAU,EAE1BG,GAAyD,CACpE,CAACpO,GAXYkD,IAWA4K,GAAGC,GAVH7D,KAWb,CAAClK,GAAG8N,GAAGC,GAXM7D,KAYb,CAAClK,GAAG8N,GAAGC,IACP,CAAC/N,GAdYkD,IAcA4K,GAAGC,KAULM,GAAuC,CAClD/M,GAAI,CAAC4M,GAASF,GAlBDF,GAkBiBK,GAASF,IACvCzM,GAAI,CAAC0M,GAnBQJ,GAmBQK,GAASF,IAC9BvM,GAAI,CAACwM,GApBQJ,GAoBQK,IACrBvM,GAAI,CAACsM,GAASF,GArBDF,GAqBiBK,KCzB1BG,GAAyB,aACzBC,GAA+B,mBAC/BC,GAAiC,eACjCC,GAAqC,mBAiB9BC,GAAmB,SAAC9b,GAC/B,IACE+b,EAGE/b,EAHF+b,gBACAC,EAEEhc,EAFFgc,WAFF,EAIIhc,EADFic,oBAHF,MAGiB,aAHjB,EAKMC,EAAiB,GA6CvB,OA5CAF,EAAWhP,SAAQ,SAACyC,EAAgB0M,GAClC,IAAMC,EAvBmB,SAC3BL,EACAI,GAEA,IACME,EAAYF,EAAc,EAChC,MAAM,OAAN,OAF0C,OAApBJ,EAA4BA,EAAkB,EAAK,GAEzE,YAA+BM,GAiBRC,CAAqBP,EAAiBI,GAgC3DD,EAAKE,GAAgB,CACnBA,eACAL,gBAAqC,OAApBA,EAA2BA,GAAmB,EAC/DpG,WhBrEyB,EgBsEzBwG,cACAI,SAnCe,SAAClE,GAChB,IAAMmE,EhBuDiB,SAAC/M,EAAgB4I,GAC5C,IAAOzI,EAA6BJ,GAAaC,GAA1CG,0BACD6M,EAAY/P,GAAiBkD,EAA2ByI,GACxDqE,EAAmBvP,GAAQsP,GACjC,OAAOnP,GAAoBoP,GgB3DDC,CAAclN,EAAQmN,GAAevE,IAC3D,OAAuB,IAAnBmE,EACK,YAEa,IAAlBA,EACK,UAEF,WA4BPK,QAzBc,SAACxE,GACf,IAAMmE,EhBmDiB,SAAC/M,EAAgB4I,GAC5C,IAAOvI,EAA6BN,GAAaC,GAA1CK,0BACD2M,EAAY/P,GAAiBoD,EAA2BuI,GACxDqE,EAAmBvP,GAAQsP,GACjC,OAAOnP,GAAoBoP,GgBvDDI,CAAcrN,EAAQmN,GAAevE,IAC3D,OAAuB,IAAnBmE,EACK,OAEa,IAAlBA,EACK,QAEF,YAkBP5W,OAfa,SAACmX,GACd,IAAMzN,EAAOjB,GAAQ,CACnBE,eAAgBwO,EAChBvO,kBAAmBiN,KAErBQ,EAAaG,EAAc9M,IAW3B0N,MAAO,iBAGJd,GAGHU,GAAiB,SAACvE,GACtB,OAAOA,EAAQhC,KAAI,SAAC4G,GAClB,OAAe,OAAXA,QAA8BhI,IAAXgI,EfjDa,EeoD7BA,MAIEC,GAAkB,SAACC,GAC9B,MAAyB,kBAAdA,EACF,KAEF/X,KAAKgY,KAAiB,IAAZD,GAAmB,KAYzBE,GAAuB,SAACC,GACnC,OAAOA,EACJC,MAAM,KACNlH,KAAU,SAACmH,GAEV,OADgD,IAA7B9Z,SAAS8Z,EAAY,IAAY,EAAI,MAYjDC,GAA4B,WACvC,IAAM1B,EAAiCnB,GAAKe,IAI5C,MAAO,CACLK,WAJoCpB,GAAKc,IAKzCK,kBACA2B,YALmC9C,GAAKgB,IAMxC+B,eALsC/C,GAAKiB,MASlC+B,GAA0B,SAAC9Z,GACtC,IACEkY,EAIElY,EAJFkY,WACAD,EAGEjY,EAHFiY,gBACA2B,EAEE5Z,EAFF4Z,YACAC,EACE7Z,EADF6Z,eAGF,IAAK3B,IAAeA,EAAWnP,SAAWkP,IAAoB2B,IAAgBC,EAC5E,OAAO,EAGT,IAAME,EAAaxD,GAAMsB,GAA8BI,GACjD+B,EAAoBzD,GAAMqB,GAAwBM,GAClD+B,EAAqB1D,GAAMuB,GAAgC8B,GAC3DM,EAAwB3D,GAAMwB,GAAoC8B,GAExE,OAAOE,GAAcC,GAAqBC,GAAsBC,GC5JrDC,GAAgB,GCsYdC,OA5Tf,SAAale,GACX,IACEme,EAmBEne,EAnBFme,KADF,EAoBIne,EAlBFoe,mBAFF,MjBvE0B,GiBuE1B,IAoBIpe,EAjBFuR,iBAHF,WAoBIvR,EAhBFqe,iBAJF,WAoBIre,EAfF4H,cALF,WAoBI5H,EAdF0X,mBANF,WAoBI1X,EAbF0V,sBAPF,WAoBI1V,EAZFyX,eARF,WAoBIzX,EAXFwR,iBATF,MASchB,GATd,EAUEsH,EAUE9X,EAVF8X,qBACAC,EASE/X,EATF+X,oBAXF,EAoBI/X,EARFsR,iBAZF,MAYc,GAZd,IAoBItR,EAPFgY,iBAbF,MAac,aAbd,IAoBIhY,EANFse,kBAdF,MAce,aAdf,IAoBIte,EALFue,oBAfF,MAeiB,aAfjB,IAoBIve,EAJF4V,iBAhBF,MAgBc,aAhBd,IAoBI5V,EAHF4F,cAjBF,MAiBW,aAjBX,IAoBI5F,EAFFwe,WAlBF,MAkBQ,CAAEpC,aAAc,GAAIL,gBAAiB,EAAGI,YAAa,GAlB7D,IAoBInc,EADFqI,wBAnBF,SAsBMoW,EAAUvK,mBACVwK,EAASxK,mBACTyK,EAAYzK,iBAAuD,IACnE0K,EAAoB1K,iBAA6B,CACrDxF,GAAI,IAAI7E,WACR+E,GAAI,IAAI/E,WACRmF,GAAI,IAAInF,WACRiF,GAAI,IAAIjF,aAEV,EAA8B7D,mBAAwB,MAAtD,mBAAOqI,EAAP,KAAgBwQ,EAAhB,KACMC,EAA4B5K,iBAAsD,MAClF6K,EAAqB7K,iBAAsD,MAE3E8K,EAAyD,GACzDC,EAAiC,GAEjCC,EAAY,CAChBC,cAAc,EACd5F,OAAQ6E,EACRgB,eAAgB,CAAC,GAAI,EAAG,GACxBC,UAAW,EAAE,EAAG,EAAG,GACnBC,4BAA6B,CAAC,EAAG,EAAG,GACpCC,oBjBhHsC,GiBiHtCC,qBjBhHwC,GiBiHxCC,mBjBhHsC,IiBiHtCC,oBjBhHuC,GiBiHvCC,kBjBhHoC,IiBiHpCC,mBjBhHqC,IiBiHrCC,ajBhH+B,EiBiH/BC,cjBhHgC,IiBiHhCC,iCAAiC,EACjCC,8BjBjH+C,IiBqH3CvR,GAAUyF,mBACV+L,GAAW,6BACZf,GADY,IAEfC,cAAc,EACdG,4BAA6B,EAC3B,GACA7O,GjB/GmC,OiBqHjC9B,GAAUuF,mBACVgM,GAAW,6BACZhB,GADY,IAEfC,cAAc,EACdG,4BAA6B,CAC3Ba,GACA1P,GjB3HmC,OiBiIjC1B,GAAUmF,mBACVkM,GAAW,6BACZlB,GADY,IAEfC,cAAc,EACdG,4BAA6B,EAC3B,GACA7O,IjBtIkC,QiB4IhC5B,GAAUqF,mBACVmM,GAAW,6BACZnB,GADY,IAEfC,cAAc,EACdG,4BAA6B,CAC3Ba,GACA1P,IjBlJkC,QiBuJtCuO,EA9GmB,GA8GIvQ,GACvBuQ,EA9GmB,GA8GIrQ,GACvBqQ,EA9GmB,GA8GIjQ,GACvBiQ,EA9GmB,GA8GInQ,GAEvBoQ,EAnHmB,GAmHQgB,GAC3BhB,EAnHmB,GAmHQiB,GAC3BjB,EAnHmB,GAmHQmB,GAC3BnB,EAnHmB,GAmHQoB,GAE3B,IAAM7J,IAAoBiB,EAE1B,GAA8B6I,aAAkB,iBAAO,CACrDC,YAAa9B,EACbO,SACAC,aACAuB,iBAAkB,EAClBC,eAAgB,EAChBC,YAAa,MANf,qBAAOC,GAAP,MAAgBC,GAAhB,MASMC,GAA6B,CACjC1C,KAAM,QACNpT,KAAM,QACNyL,qBAGIsK,GAAgC,CACpCxb,SAAUgM,EAAUhM,SACpBiR,SAAUsK,IAGNE,GAA2B,CAC/B5C,OACApT,KAAM,UACNyL,qBAGFkI,EAAOjK,QAAUmM,GACjBjC,EAAUlK,QAAUuK,EAEpB,IAAM7J,GAAY,WACZ2J,EAA0BrK,SAC5BqK,EAA0BrK,QAAQW,SAEhC2J,EAAmBtK,SACrBsK,EAAmBtK,QAAQW,SAE7BmJ,KAGF/X,qBAAU,WACR,OAAKkY,EAAOjK,SAAYgK,EAAQhK,SAGhC6J,EAAW,CACT0C,IAAKtC,EAAOjK,QACZgK,QAASA,EAAQhK,QACjBwM,UAAWtC,EAAUlK,QAAQ5H,SAExBsI,IAPEA,KASR,IAEE4J,EAAmBtK,UACtBsK,EAAmBtK,QAAU7P,KAASgB,Eb7OF,Ia6OoC,CACtEb,SAAS,EACTC,UAAU,KAcT8Z,EAA0BrK,UAC7BqK,EAA0BrK,QAAU7P,MAThB,SAACsc,GACrB,IAAM5R,EAAO6R,GAAW,CACtB5S,eAAgB2S,EAChB1S,kBAAmBiN,KAErBoD,EAAWvP,KbvPiC,Ia2PkD,CAC5FvK,SAAS,EACTC,UAAU,KAId8P,aAAS,SAACzT,EAAkBqD,GAC1B,GAAKsa,GAA4B,IAAlBA,EAAOnS,QAInBmS,EA3Mc,GA2MOvK,SACrBuK,EA3Mc,GA2MOvK,SACrBuK,EA3Mc,GA2MOvK,SACrBuK,EA3Mc,GA2MOvK,QAJxB,CAUAuK,EApNiB,GAoNIvK,QAAQM,iBAAiB6J,EAAkBnK,QAAQ7F,IAExEoQ,EArNiB,GAqNIvK,QAAQM,iBAAiB6J,EAAkBnK,QAAQ/F,IAExEsQ,EAtNiB,GAsNIvK,QAAQM,iBAAiB6J,EAAkBnK,QAAQ3F,IAExEkQ,EAvNiB,GAuNIvK,QAAQM,iBAAiB6J,EAAkBnK,QAAQzF,IAExE,MAAyB4P,EAAkBnK,QAApC/F,EAAP,EAAOA,GAAIE,EAAX,EAAWA,GAAII,EAAf,EAAeA,GAAIF,EAAnB,EAAmBA,GACbsS,EAAkC,CACtC1S,GAAIA,EAAG2S,UACPzS,GAAIA,EAAGyS,UACPrS,GAAIA,EAAGqS,UACPvS,GAAIA,EAAGuS,WAELtC,EAAmBtK,SACrBsK,EAAmBtK,QAAQ2M,GAKzB/C,GAAaS,EAA0BrK,SACzCqK,EAA0BrK,QAAQ2M,OAItC,IAAIE,GAAgB,QACJ,OAAZjT,IAEAiT,GADEjT,GDxTiC,ECyTnB,YACPA,GDzTyB,EC0TlB,SAEA,OAGpB,IAAMuJ,GAAQyG,EACZ,yCAEG,IACD,sBAAM1f,MAAO,CAAC0B,MAAOihB,GAAeliB,WAAY,QAAhD,SACG8d,GAAgB7O,QAGnB,KAEJ,OACE,wBAAOnD,IAAKyV,GAAZ,UACE,cAAC,GAAD,CACEzV,IAAKuT,EACL9I,WAAY6I,EAAI7I,YlBtUO,EkBuUvBkC,gBAAiBlH,GACjB/I,OAAQA,EACR2J,UAAWA,EACXkG,QAASA,EACTG,MAAOA,GACPF,YAAaA,EACbhC,eAAgBA,EAChBlE,UAAWA,EACXF,UAAS,gBAAOA,GAChB0G,UAAW,SAACjU,GAAD,OAAWiU,EAAU+I,GAAahd,IAC7C6R,UAAWA,EACXW,SAAUwK,GACVjJ,qBAAsBA,EACtBC,oBAAqBA,EACrB1P,iBAAkBA,IAEpB,cAAC,GAAD,CACE6C,IAAKuD,GACL8K,OAAQ6E,EACR9M,UAAWwP,GACXlZ,OAAQA,EACR2J,UAAWA,EACXC,UAAWA,EACXnJ,iBAAkBA,EAClBoR,QAAM,IAER,cAAC,GAAD,CACEvO,IAAKyD,GACL4K,OAAQ6E,EACR9M,UAAWwP,GACXlZ,OAAQA,EACR2J,UAAWA,EACXC,UAAWA,EACXnJ,iBAAkBA,IAEpB,cAAC,GAAD,CACE6C,IAAK6D,GACLwK,OAAQ6E,EACR9M,UAAWwP,GACXlZ,OAAQA,EACR2J,UAAWA,EACXC,UAAWA,EACXnJ,iBAAkBA,EAClBoR,QAAM,IAER,cAAC,GAAD,CACEvO,IAAK2D,GACL0K,OAAQ6E,EACR9M,UAAWwP,GACXlZ,OAAQA,EACR2J,UAAWA,EACXC,UAAWA,EACXnJ,iBAAkBA,QC7SXkZ,OAnEf,SAAoBvhB,GA2BlB,IA1BA,IACEwhB,EAMExhB,EANFwhB,KACAC,EAKEzhB,EALFyhB,KACA3J,EAIE9X,EAJF8X,qBACAC,EAGE/X,EAHF+X,oBAJF,EAOI/X,EAFF0hB,iBALF,MAKc,CAAC,IALf,IAOI1hB,EADFqI,wBANF,SASA,EAA0CrC,mBAAwB,IAAlE,mBAAO2b,EAAP,KAAsBC,EAAtB,KACMC,EAAmB3N,iBAAsB,IAEzC8D,EAAY,SAAC+I,EAA0Bhd,GAC3C,IAAM+d,EAAiBf,EAAY5C,KACnC,GAAK2D,EAAL,CAGA,IAAMC,EAAgB,6BACjBF,EAAiBpN,SADA,mBAEnBqN,ElBVmC,YkBYtCD,EAAiBpN,QAAUsN,EAC3BH,EAAiBG,KAGbC,EAAgC,GA1BI,WA2BjCC,GACP,IA5BwC,eA4B/BC,GACP,GAAIR,EAAUS,MAAK,mCAAEC,EAAF,KAAWC,EAAX,YAAyBD,IAAYH,GAAOI,IAAYH,KACzE,iBAEF,IAEM9U,EADgB,KACW6U,EAAvB,MACJ9G,EAHiB,IAGS+G,EAAtB,KACVF,EAAmB7R,KAAK,CAAC/C,EAAG,GAAK+N,KAR1B+G,EAAM,EAAGA,EAAMT,EAAMS,GAAO,EAAG,EAA/BA,IADFD,EAAM,EAAGA,EAAMT,EAAMS,GAAO,EAAI,EAAhCA,GAaT,IAAMK,EAAaN,EAAmB3L,KAAI,SAAC/Q,EAAmBqO,GAC5D,IAAMwK,ECzDF,cAAN,ODyDqCxK,GAC7BnC,EAAY2M,KAAQwD,EAAgBA,EAAcxD,GAAQ3N,GAChE,OACE,cAAC,GAAD,CAEE2N,KAAMA,EACN7M,UAAW,CAAEhM,YACbiM,WAAW,EACX3J,QAAQ,EACR6P,SAAS,EACTjG,UAAWA,EACXsG,qBAAsBA,EACtBC,oBAAqBA,EACrBC,UAAWA,EACX3P,iBAAkBA,GAVbsL,MAeX,OACE,mCACG2O,K,UE9EMC,GAAoD,SACpDC,GAAmD,QC6KjDC,OAjJf,SAAqBziB,GACnB,IACEkc,EAWElc,EAXFkc,KACApE,EAUE9X,EAVF8X,qBACAC,EASE/X,EATF+X,oBAHF,EAYI/X,EARF0X,mBAJF,WAYI1X,EAPF0V,sBALF,WAYI1V,EANF0iB,kBANF,WAYI1iB,EALF2iB,oBAPF,WAYI3iB,EAJF4iB,wBARF,WAYI5iB,EAHF6iB,+BATF,WAYI7iB,EAFFqI,wBAVF,WAYIrI,EADF8iB,oBAXF,MAWiBN,GAXjB,EAaMO,EAAY7O,iBAAsB,IAClC8O,EAAW9O,iBAA4C,IAEvD+O,EAAa/G,EAAK7F,KAAI,SAACmI,GAC3B,IAAML,EAAOK,EAAIpC,aACjB2G,EAAUtO,QAAQtE,KAAKgO,GAEvB,IAAM+E,EAAY,YClDS,SAACC,GAC9B,IADgG,IAAjClC,EAAgC,uDAAZ,EAC1EmC,EAAW,EAAGA,EAAWnC,EAAWmC,GAAY,EACvDD,EAAOE,SAAS,EAAGD,GAErBD,EAAOG,kBtBsCoB,EsBtCa,GACxCH,EAAOG,kBtBqCoB,EsBrCa,GD6CZC,CAAgBP,EAASvO,QAAQ0J,GAAM6C,MAC3DwC,EAAa,YC3CS,SAACL,GAC/B,IADiG,IAAjClC,EAAgC,uDAAZ,EAC3EmC,EAAW,EAAGA,EAAWnC,EAAWmC,GAAY,EACvDD,EAAOE,SAAS,EAAGD,GAErBD,EAAOG,iBtB8BoB,EsB9BY,GACvCH,EAAOG,iBtB6BoB,EsB7BY,GDsCVG,CAAiBT,EAASvO,QAAQ0J,GAAM6C,MAC7D0C,EAAY,WCpCS,IAACP,KDoCcH,EAASvO,QAAQ0J,GAAM6C,KCnC5DsC,iBAAiB,EAAG,GAC3BH,EAAOG,iBAAiB,EAAG,IDmCnBK,EAAS,WChCS,IAACR,KDgCWH,EAASvO,QAAQ0J,GAAM6C,KC/BtD4C,iBAAiBhT,GAAqB,GAC7CuS,EAAOS,iBAAiBhT,GAAqB,ID+BrCiT,EAAU,WC5BS,IAACV,KD4BYH,EAASvO,QAAQ0J,GAAM6C,KC3BxD4C,kBAAiB,GAAsB,GAC9CT,EAAOS,kBAAiB,GAAsB,ID2BtCE,EAAa,WCxBS,IAACX,KDwBeH,EAASvO,QAAQ0J,GAAM6C,KCvB9D4C,iBAAiB,EAAG,GAC3BT,EAAOS,iBAAiB,EAAG,IDuBnBG,EAAU,YCpBQ,SAACZ,GAC3B,IAD6F,IAAjClC,EAAgC,uDAAZ,EACvEmC,EAAW,EAAGA,EAAWnC,EAAWmC,GAAY,EACvDD,EAAOE,StBKwB,EsBLMD,GDkBbY,CAAahB,EAASvO,QAAQ0J,GAAM6C,MACtDiD,EAAiB,YCfG,SAACd,GAC7B,IAD+F,IAAjClC,EAAgC,uDAAZ,EACzEmC,EAAW,EAAGA,EAAWnC,EAAWmC,GAAY,EACvDD,EAAOE,SAAS,EAAGD,GDaYc,CAAelB,EAASvO,QAAQ0J,GAAM6C,MAyE/D1b,EAAW,CAAC,EAAG,EAPmC,CACtD,KAAQud,GAA2B,EAAI,EAAIzd,KAAK+e,UAAY,EAC5D,OAAU,EACV,MAAStB,EAA0B,EAAI,EAAIzd,KAAK+e,SAAW,GAGxCrB,IAIfsB,GAAaxB,EACbyB,EAAWzB,EEvIS,WAC5B,IAAM0B,EAAaC,GAAOC,OAE1B,OAAOF,EADYlf,KAAKC,MAAMD,KAAK+e,SAAWG,EAAWzX,SFsInD4X,GACApc,ErB/GqC,cqBiHnC4M,EAEN,OACE,cAAC,GAAD,CAEEkJ,KAAMA,EACN7M,UAAW,CACThM,WACAof,gBAfkB,EAAE,GAAK,EAAG,IAiB9BnT,WAAW,EACXuG,qBAAsBA,EACtBC,oBAAqBA,EACrBL,YAAaA,EACbhC,eAAgBA,EAChB4I,WA9Fe,SAAC5U,GAClBsZ,EAASvO,QAAQ0J,GAAQzU,EACrBiZ,IACFxe,GAAGR,GAAyBuf,GAC5B/e,GAAGR,GAA0B6f,GAC7Brf,GAAGR,GAAyB+f,GAC5Bvf,GAAGR,GAAsBggB,GACzBxf,GAAGR,GAAuBkgB,GAC1B1f,GAAGR,GAA0BmgB,GAC7B3f,GAAGR,GAAsBogB,GACzB5f,GAAGR,GAAwBsgB,KAqF3B1F,aAjFiB,WACfoE,IACFre,GAAIX,GAAyBuf,GAC7B5e,GAAIX,GAA0B6f,GAC9Blf,GAAIX,GAAyB+f,GAC7Bpf,GAAIX,GAAsBggB,GAC1Brf,GAAIX,GAAuBkgB,GAC3Bvf,GAAIX,GAA0BmgB,GAC9Bxf,GAAIX,GAAsBogB,GAC1Bzf,GAAIX,GAAwBsgB,KAyE5BrO,UArEc,SAACyC,GACjB,GAAImG,EAAIjC,SAEN,OADwCiC,EAAIjC,SAASlE,IAEnD,IAAK,YACHmL,IACA,MACF,IAAK,UACHE,IACA,MACF,IAAK,UACHR,IAIN,GAAI1E,EAAI3B,QAEN,OADsC2B,EAAI3B,QAAQxE,IAEhD,IAAK,OACHsL,IACA,MACF,IAAK,WACHG,IACA,MACF,IAAK,QACHD,MA6CJje,OAvCW,SAACsb,GACV1C,EAAI5Y,QACN4Y,EAAI5Y,OAAOsb,IAsCXzJ,SAAO,EACP7P,OAAQwc,EACR5S,UAAW6S,EACX7F,IAAKA,EACLH,UAAWqE,EACXra,iBAAkBA,GApBb8V,MAyBX,OACE,mCACG8E,K,UGhIQ0B,OA/Bf,SAAqB3kB,GACnB,MAA6BA,EAArBK,aAAR,MAAgB,SAAhB,EAcA,OACE,qCACE,cAACukB,GAAA,EAAD,CACEC,OAAM,uBACDrJ,IADC,CAEJA,GAA2B,KAE7Bnb,MAAOA,EACPykB,UAAW,EACXC,QAAQ,IAXV,SCiCSC,OAtCf,SAAuBhlB,GACrB,MAIIA,EAHF0iB,kBADF,WAII1iB,EAFF0X,mBAFF,WAII1X,EADFqI,wBAHF,SAMA,OACE,qCACE,cAAC,GAAD,CACEkO,SAAU,CAAE4H,KAAM,UAClBrG,qBArB+B,EAsB/BC,oBAvB4B,IAyB9B,cAAC,GAAD,IACA,cAAC,GAAD,CACEmE,KAAM,CAAC,CAACE,aAAc,aAAcL,gBAAiB,EAAGI,YAAa,IACrErE,qBA5B4B,EA6B5BC,oBA5B+B,EA6B/BL,YAAaA,EACbgL,WAAYA,EACZra,iBAAkBA,EAClBya,aAAcP,GACdI,cAAY,EACZjN,gBAAc,IAEhB,cAAC,GAAD,CACE8L,KAAM,EACNC,KAAM,EACNC,UAAW,CAAC,CAAC,EAAG,IAChB5J,qBAxC+B,EAyC/BC,oBA1C4B,EA2C5B1P,iBAAkBA,QCtBX4c,OAxBf,WACE,OACE,eAAC,IAAD,WACE,cAAC,GAAD,CACE5c,kBAAkB,EAClBH,qBAAmB,EACnBC,qBAAmB,EAHrB,SAKE,cAAC,GAAD,CACEE,kBAAkB,EAClBqa,YAAU,EACVhL,aAAW,MAGf,cAAC,IAAD,CAAOhY,UAAU,OAAjB,SACE,eAAC,IAAD,CAAcqC,UAAW,CAACC,KAAM,CAACrD,MAAO,CAACsD,MAAO,UAAhD,4CACiC,uBAAK,uBACpC,qG,kDCtBGijB,GAAiB,SAAIC,EAAYC,GAC5C,GAAID,EAAMtY,SAAWuY,EAAQvY,OAC3B,MAAM,IAAIC,MAAM,8CAQlB,IADA,IAAMuY,EAA8B,GAC3BC,EAAI,EAAGA,EAAIF,EAAQvY,OAAQyY,GAAK,EACvCD,EAAkBC,GAAKF,EAAQE,IAAMD,EAAkBC,EAAI,IAAM,GAanE,IALA,IACMC,EADsBF,EAAkBA,EAAkBxY,OAAS,GAC9BzH,KAAK+e,SAIvCmB,EAAI,EAAGA,EAAIH,EAAMtY,OAAQyY,GAAK,EACrC,GAAID,EAAkBC,IAAMC,EAC1B,MAAO,CACLC,KAAML,EAAMG,GACZ3R,MAAO2R,GAIb,MAAO,CACLE,KAAML,EAAMA,EAAMtY,OAAS,GAC3B8G,MAAOwR,EAAMtY,OAAS,ICjBnB,SAAS4Y,GAAiBnX,GAC/B,IAAQoX,EAAiCpX,EAAjCoX,eAAgBC,EAAiBrX,EAAjBqX,aACxB,OAAO,IAAI7P,MAAM4P,GACd3P,KAAK,MACLM,KAAI,kBATA,IAAIP,MASe6P,GARvB5P,KAAK,MACLM,KAAI,kBAAOjR,KAAK+e,SAAW,GAAM,EAAI,QAiB1C,SAASyB,GAAOnW,EAAgBoW,GAE9B,IAAK,IAAIC,EAAY,EAAGA,EAAYrW,EAAO5C,OAAQiZ,GAAa,EAAG,CACjE,IAAMC,EAAatW,EAAOqW,GACpBE,EAA6B,IAATD,EAAa,EAAI,EAC3CtW,EAAOqW,GAAa1gB,KAAK+e,SAAW0B,EAAsBG,EAAcD,EAE1E,OAAOtW,EAUT,SAASwW,GACPC,EACAC,EACAN,GAEA,GAAIK,EAAOrZ,SAAWsZ,EAAOtZ,OAC3B,MAAM,IAAIC,MAAM,iCAOlB,IAJA,IAAMsZ,EAAqB,GACrBC,EAAsB,GAGnBP,EAAY,EAAGA,EAAYI,EAAOrZ,OAAQiZ,GAAa,EAC9DM,EAAWjW,KACT/K,KAAK+e,SAAW,GAAM+B,EAAOJ,GAAaK,EAAOL,IAEnDO,EAAYlW,KACV/K,KAAK+e,SAAW,GAAM+B,EAAOJ,GAAaK,EAAOL,IAIrD,MAAO,CACLF,GAAOQ,EAAYP,GACnBD,GAAOS,EAAaR,I,wHCjElBS,GAAU,OAmDDC,GAjDS,SAACvmB,GACvB,IAAO0R,EAAuC1R,EAAvC0R,MAAO8U,EAAgCxmB,EAAhCwmB,QAAd,EAA8CxmB,EAAvBymB,mBAAvB,SAEMjF,EAAO9P,EAAM2E,KAAI,SAACqQ,EAAuBC,GAC7C,IAAMvmB,EAA2B,IAAdumB,EAAkB,EAAIL,GACnCxmB,EAAc6mB,IAAejV,EAAM7E,OAAS,GAAO2Z,EAAcF,GAAJ,EAEnE,OACE,cAAC,IAAD,CAEEhnB,QAAQ,OACRsnB,KAAM,EACNxmB,WAAY,CAAC,EAAGA,EAAYA,GAC5BN,YAAa,CAAC,EAAGA,EAAaA,GAC9BS,cAAc,SACdC,eAAe,WAPjB,SASGkmB,GARIC,MAaLE,EAAaL,EACjB,cAAC,IAAD,CACElnB,QAAQ,OACRc,WAAY,CAAC,EAAGkmB,GAASA,IACzB/lB,cAAc,SACdC,eAAe,WAJjB,SAMGgmB,IAED,KAEEjnB,EAAaknB,EAAc,WAAa,aAE9C,OACE,eAAC,IAAD,CACEnnB,QAAQ,OACRsnB,KAAM,EACNrmB,cAAe,CAAC,SAAU,MAAO,OACjChB,WAAY,CAAC,UAAWA,EAAYA,GACpCiB,eAAe,SALjB,UAOGghB,EACAqF,M,oBClBQC,GA5BF,SAAC9mB,GACZ,IAAO+mB,EAAQ/mB,EAAR+mB,KAEP,OACE,cAAC,KAAD,CACEC,kBAAmB,UACnBnQ,QAASkQ,EAFX,SAIE,cAAC,KAAD,CACEE,MAAOC,KAAaC,MACpBvlB,KAAMwlB,KAAYC,QAClBtlB,UAAW,CACTulB,WAAY,CACV3oB,MAAO,CACL4oB,WAAY,EACZC,cAAe,EACfzgB,YAAa,EACb0gB,aAAc,KATtB,SAcE,cAAC,KAAD,SCTOC,GAfH,SAAC1nB,GACX,IAAOa,EAAYb,EAAZa,SAEP,OACE,cAAC,IAAD,CACEvB,QAAQ,OACRiB,cAAc,MACdC,eAAe,SACfjB,WAAW,SAJb,SAMGsB,KCeD8mB,GAA6B,CAAC,EAAG,GAAI,GAAI,IAAK,IAAK,IAAK,IAAM,KAC9DC,GAAwB,CAAC,EAAG,EAAG,EAAG,EAAG,GAAI,GAAI,GAAI,GAAI,GAAI,KA2ThDC,OAjSf,SAA8B7nB,GAC5B,IACE0lB,EAaE1lB,EAbF0lB,eACAoC,EAYE9nB,EAZF8nB,UACAC,EAWE/nB,EAXF+nB,mBACAC,EAUEhoB,EAVFgoB,8BACAC,EASEjoB,EATFioB,uBACA5f,EAQErI,EARFqI,iBACA6f,EAOEloB,EAPFkoB,kBACAC,EAMEnoB,EANFmoB,2BACAtC,EAKE7lB,EALF6lB,oBACAuC,EAIEpoB,EAJFooB,4BACAC,EAGEroB,EAHFqoB,sCACAC,EAEEtoB,EAFFsoB,mBACAC,EACEvoB,EADFuoB,QAGF,EAAsEviB,mBAAsB6f,GAA5F,mBAAO2C,EAAP,KAAoCC,EAApC,KACA,EAAoEziB,mBAAiB+hB,GAArF,mBAAOW,EAAP,KAAmCC,EAAnC,KACA,EAA0F3iB,mBAAqBgiB,GAA/G,mBAAOY,EAAP,KAA8CC,EAA9C,KACA,EAA0D7iB,oBAAkB,GAA5E,mBAAO8iB,EAAP,KAA8BC,EAA9B,KAEAviB,qBAAU,WACRiiB,EAA+B5C,GAC/B8C,EAA8BZ,GAC9Bc,EAAyCb,KACxC,CAACnC,EAAqBkC,EAAoBC,IAE7C,IAIMgB,EAA2B,WAC/BD,GAAyB,IAQrBE,EAA6B,CAAC,CAClCC,GAAG,GAAD,OAAKxD,GACPjmB,KAAMimB,IAEFyD,EAAkBxB,GAAiBtR,KAAI,SAAC5W,GAC5C,MAAO,CACLypB,GAAG,GAAD,OAAKzpB,GACPA,WAGE2pB,EACJ,cAAC,KAAD,CAAaxR,MAAO,iBAAM,mBAA1B,SACE,cAAC,KAAD,CACErS,QAAS4jB,EACTroB,MAAOmoB,EACPI,SAAU,SAAC/a,GAAD,OAA4B2Z,EAAuB3Z,EAAOxN,MAAM,GAAGrB,OAC7E6pB,SAAS,KACTC,SAAS,OACT9pB,KAAM+pB,KAAYC,QAClBC,WAAW,EACXC,YAAY,MAKZC,EAAwB,CAAC,CAC7BV,GAAG,GAAD,OAAKpB,GACProB,KAAMqoB,IAEF+B,EAAajC,GAAYvR,KAAI,SAAC5W,GAClC,MAAO,CACLypB,GAAG,GAAD,OAAKzpB,GACPA,WAGEqqB,EACJ,cAAC,KAAD,CAAalS,MAAO,iBAAM,cAA1B,SACE,cAAC,KAAD,CACErS,QAASskB,EACT/oB,MAAO8oB,EACPP,SAAU,SAAC/a,GAAD,OAA4B4Z,EAAkB5Z,EAAOxN,MAAM,GAAGrB,OACxE6pB,SAAS,KACTC,SAAS,OACT9pB,KAAM+pB,KAAYC,QAClBC,WAAW,EACXC,YAAY,MAKZI,EAAkB,CACtBC,QAAS,CACPrrB,MAAO,CACL6oB,cAAe,IAGnByC,WAAY,gBAAEC,EAAF,EAAEA,OAAQC,EAAV,EAAUA,YAAV,OACV,cAAC,IAAMC,SAAP,UAAiBF,EAAOC,MAE1BE,WAAY,kBAAM,MAClBC,MAAO,CACL3rB,MAAO,iBAAO,CACZ0B,MAAO,QACP4W,SAAU,OACV7X,WAAY,QAKZmrB,EACJ,cAAC,KAAD,CACE3S,MAAO,iBAAM,0BACb4S,QAAS,iBAAM,kCAFjB,SAIE,cAAC,KAAD,CACEtgB,KAAM,EACNugB,OAAO,EACPC,iBAAe,EACfC,IAAK,GACLC,IAAK,GACL9pB,MAAO,CAAC4nB,GACRW,SAAU,gBAAGvoB,EAAH,EAAGA,MAAH,OAAeA,GAAS6nB,EAA8B7nB,EAAM,KACtE+pB,cAAe,gBAAE/pB,EAAF,EAAEA,MAAF,OAAaqnB,EAA2BrnB,EAAM,KAC7DgqB,aAAc,SAAChqB,GAAD,gBAAcA,EAAd,MACdiB,UAAWgoB,MAKXgB,EAAmB3lB,KAAKC,MAAM+I,GAAgBoa,GAE9CwC,EACJ,cAAC,KAAD,CACEpT,MAAO,iBAAM,gCACb4S,QAAS,iCAAUO,EAAV,mBAAqC3c,GAArC,+BAFX,SAIE,cAAC,KAAD,CACElE,KAAM,EACNugB,OAAO,EACPC,iBAAe,EACfC,IAAK,EACLC,IAAK,IACL9pB,MAAO,CAACsE,KAAKC,MAAoC,IAA9BmjB,IACnBa,SAAU,gBAAGvoB,EAAH,EAAGA,MAAH,OAAeA,GAAS2nB,EAA+B3nB,EAAM,GAAK,MAC5E+pB,cAAe,gBAAE/pB,EAAF,EAAEA,MAAF,OAAasnB,EAA4BtnB,EAAM,GAAK,MACnEgqB,aAAc,SAAChqB,GAAD,gBAAcA,EAAd,MACdiB,UAAWgoB,MAKXkB,EAA2B7lB,KAAKC,MAAMqgB,EAAiBkD,EAAwC,KAC/FsC,EACJ,cAAC,KAAD,CACEtT,MAAO,iBAAM,4BACb4S,QAAS,2BAASS,EAAT,qDAFX,SAIE,cAAC,KAAD,CACE/gB,KAAM,EACNugB,OAAO,EACPC,iBAAe,EACfC,IAAK,EACLC,IAAK,IACL9pB,MAAO,CAAC8nB,GACRS,SAAU,gBAAGvoB,EAAH,EAAGA,MAAH,OAAeA,GAAS+nB,EAAyC/nB,EAAM,KACjF+pB,cAAe,gBAAE/pB,EAAF,EAAEA,MAAF,OAAaunB,EAAsCvnB,EAAM,KACxEgqB,aAAc,SAAChqB,GAAD,gBAAcA,EAAd,MACdiB,UAAWgoB,MAKXoB,EACJ,cAAC,KAAD,UACE,cAAC,KAAD,CACE1rB,KAAM2rB,KAAY3B,QAClBxC,MAAOC,KAAamE,KACpBxsB,QAtJ0B,WAC9BkqB,GAAyB,IAsJrBuC,cAAe,kBAAM,cAAC,KAAD,CAAS7rB,KAAM,MACpCsC,UAAW,CACTulB,WAAY,CACVtnB,MAAO,CACLE,MAAO,yDARf,qBAkBEqrB,EACJ,cAAC,IAAD,UACE,cAAC,KAAD,UACE,cAAC,IAAD,CAAO7rB,UAAU,OAAjB,SACE,cAAC,KAAD,CACE8rB,QAASnjB,EAETghB,SAAU,SAAAoC,GAAC,OAAInD,EAAmBmD,EAAE1lB,OAAOylB,UAC3CE,eAAgBC,KAAgB9kB,MAJlC,SAME,eAAC,GAAD,WACE,cAAC,IAAD,CAAO/G,YAAY,MAAnB,SACE,wDAEF,cAAC,GAAD,CACEinB,KAAK,mEASb6E,EACJ,eAAC,KAAD,CACEC,QAAS7C,EACT8C,WAAS,EACTC,OAAQjD,EACRkD,SAAO,EACPC,WAAS,EACTxsB,KAAMysB,KAAKC,QACXC,KAAMC,KAAKC,OAPb,UASE,cAAC,KAAD,0CAGA,cAAC,KAAD,UACE,cAAC,IAAD,CACE1qB,KAAM2qB,IAAkBC,QACxBzqB,UAAW,CACTC,KAAM,CAACrD,MAAO,CAACsD,MAAO,UAH1B,+FASF,eAAC,KAAD,WACE,cAAC,KAAD,CACExC,KAAM2rB,KAAY3B,QAClBxC,MAAOC,KAAamE,KACpBxsB,QAASmqB,EACTpnB,KAAMwlB,KAAYqF,SAJpB,oBAQA,cAAC,KAAD,CACEhtB,KAAM2rB,KAAY3B,QAClBxC,MAAOC,KAAamE,KACpBxsB,QAxN2B,WACjCkqB,GAAyB,GACzBR,KAuNM3mB,KAAMwlB,KAAYsF,QAClBpB,cAAe,kBAAM,cAAC,KAAD,CAAS7rB,KAAM,MALtC,yBAaN,OACE,eAAC,IAAD,CAAOH,QAAQ,OAAOiB,cAAc,SAApC,UACE,cAAC,GAAD,CACEmR,MAAO,CACL6Y,EACAS,EACAE,KAGJ,cAAC,GAAD,CACExZ,MAAO,CACL0X,EACAU,GAEFtD,QAAS2E,EACT1E,aAAW,IAEb,cAAC,GAAD,CACE/U,MAAO,CACL6Z,KAGHK,M,sCC/TDe,GAAcvlB,aAAUC,KAAmB,CAC/CpF,MAAO,OACPkD,OAAQ,OACRmC,gBAAiB,MACjBC,iBAAkB,MAClBC,eAAgB,MAChBC,kBAAmB,MACnBC,eAAgB,UAgHlB,SAASyZ,GAAWyL,EAAwBpO,GAC1C,OAAOoO,EAASC,eAAerO,EAAIpC,eAAuD,kBAA/BwQ,EAASpO,EAAIpC,cACpEc,GAAgB0P,EAASpO,EAAIpC,eAC7B,KASS0Q,OAzHf,SAAyB9sB,GACvB,IAAQkc,EAAmClc,EAAnCkc,KAAM6Q,EAA6B/sB,EAA7B+sB,eAAgBH,EAAa5sB,EAAb4sB,SASxBI,EARuBpb,OAAOqb,OAAgB/Q,GASjDgR,MAAK,SAACC,EAAeC,GAIpB,IAAMC,EAAQlM,GAAWyL,EAAUO,GAC7BG,EAAQnM,GAAWyL,EAAUQ,GACnC,OAAc,OAAVC,GAA4B,OAAVC,EACb,EAEK,OAAVD,GAA4B,OAAVC,GACZ,EAEI,OAAVD,GAA4B,OAAVC,GAGlBD,IAAUC,EAFL,EAKLD,GAASC,GACH,EAEH,KAERjX,KAAI,SAACmI,GACJ,IAAM+O,EACJ,cAAC,KAAD,CACEzB,WAAW,EACXlqB,KAAM4rB,KAASC,QACfC,QAASC,KAAYC,MAHvB,SAKGpP,EAAIpC,eAIHyR,EAAkC1M,GAAWyL,EAAUpO,GACzDsP,EAAe,GACM,OAArBD,IAEAC,EADED,EjBlF6B,EiBmFhB,YACNA,EjBnFqB,EiBoFf,SAEA,OAGnB,IAAME,EAAWhB,EAAevO,EAAIpC,cAClC,cAAC,GAAD,UACE,cAACuQ,GAAD,MAGF,cAAC,IAAD,CAAOtsB,MAAOytB,EAAd,SACGD,IAICG,EAiDZ,SAAuBpB,EAAwBpO,GAC7C,OAAOoO,EAASC,eAAerO,EAAIpC,eAAuD,kBAA/BwQ,EAASpO,EAAIpC,cACpEc,GAAgB7N,GAAiBud,EAASpO,EAAIpC,eAAiB,EAAG6B,KAClE,KApDoCgQ,CAAcrB,EAAUpO,GAW5D,MAAO,CACL+O,EACAQ,EAZkBhB,EAAevO,EAAIpC,cACrC,cAAC,GAAD,UACE,cAACuQ,GAAD,MAGF,cAAC,IAAD,CAAOtsB,MAAOytB,EAAd,SACGE,QAWT,OACE,cAAC,IAAD,UACE,cAAC,KAAD,CACEE,QAnFU,CACd,gBACA,OACA,WAiFIpqB,KAAMkpB,EACNmB,aAAa,oBACbC,QAASC,KAAQC,KACjB7uB,KAAM8uB,KAAW9E,QACjB1nB,UAAW,CACTysB,KAAM,CACJ7vB,MAAO,CACL8vB,UAAW,UAGfC,cAAe,CACb/vB,MAAO,CACLgwB,cAAe,iB,iBCxE7B,SAASC,GAAWC,GAClB,IAAIC,EAAU1pB,KAAKwlB,IAAIxlB,KAAKC,MAAMwpB,EAAS,KAAO,GAC9CE,EAAY,GAChB,GAAID,EAAU,GAEZ,MAAM,GAAN,OADAC,EAAYD,EAAU,GAAK,IAAM,IACjC,OAAsBA,EAAtB,KAEF,IAAME,EAAU5pB,KAAKC,MAAMypB,EAAU,IAGrC,OADAC,GADAD,GAAoB,IACE,GAAK,IAAM,GAC3B,GAAN,OAAUE,EAAV,YAAqBD,GAArB,OAAiCD,EAAjC,KAGaG,OA7Df,SAAejvB,GACb,MAAwDA,EAAjDkvB,eAAP,MAAiB,KAAjB,IAAwDlvB,EAAjCmvB,gBAAvB,MAAkC,IAAlC,IAAwDnvB,EAAhBoI,eAAxC,MAAkD,GAAlD,EAEA,EAAoCpC,mBAAiB,GAArD,mBAAOopB,EAAP,KAAmBC,EAAnB,KACMC,EAAgBpb,iBAAe,GAE/Bqb,EAAWrb,iBAA8B,MAEzCsb,EAA2B,OAAZN,EAQfO,EAAqBrpB,uBANR,WACjBkpB,EAAc7a,SAAW0a,EACzBE,EAAcC,EAAc7a,WAIqB,CAACya,EAASC,IAE7D3oB,qBAAU,WAOR,OANI+oB,EAAS9a,SACXib,cAAcH,EAAS9a,SAEzB6a,EAAc7a,QAAU,EACxB4a,EAAc,GACdE,EAAS9a,QAAUkb,YAAYF,EAAoBN,GAC5C,WACDI,EAAS9a,SACXib,cAAcH,EAAS9a,YAG1B,CAACgb,EAAoBN,EAAU/mB,IAElC,IAAMwnB,EACFhB,GAD8B,OAAZM,EACPA,EAAUE,EACVA,GAEf,OACE,eAAC,IAAD,CAAO9vB,QAAQ,OAAOiB,cAAc,MAAMhB,WAAW,WAArD,UACE,cAAC,IAAD,CAAOO,YAAY,MAAnB,SACE,qBAAKmH,UAAWuoB,EAAe,uBAAyB,mBAE1D,cAAC,IAAD,UACE,4BAAG,+BAAOI,YCoDlB,SAASC,GAAa7vB,GACpB,IAAOwqB,EAAqBxqB,EAArBwqB,QAAS3pB,EAAYb,EAAZa,SAChB,OACE,eAAC,IAAD,CACEvB,QAAQ,OACRiB,cAAe,CAAC,MAAO,SAAU,OACjChB,WAAW,SACXa,WAAW,MACXN,YAAY,MALd,UAOE,eAAC,IAAD,CACEA,YAAa,CAAC,MAAO,IAAK,OAC1BD,aAAc,CAAC,IAAK,MAAO,KAC3BQ,MAAM,QACNlB,OAAQ,CAAC2wB,UAAW,UAJtB,UAMGtF,EANH,OAQA,cAAC,IAAD,UACG3pB,OAMMkvB,OAhHf,SAAyB/vB,GACvB,IACE+b,EASE/b,EATF+b,gBACAiU,EAQEhwB,EARFgwB,WACAC,EAOEjwB,EAPFiwB,aACAC,EAMElwB,EANFkwB,qBACAC,EAKEnwB,EALFmwB,aACAC,EAIEpwB,EAJFowB,aANF,EAUIpwB,EAHFqwB,aAPF,WAUIrwB,EAFFswB,kBARF,MAQe,QARf,IAUItwB,EADFuwB,0BATF,MASuB,iBATvB,EAYMC,EAAiBH,EACrB,cAAC,IAAD,CAAOxwB,aAAa,OAApB,SACE,cAAC,KAAD,CAAiBK,MAAM,8DAGzB,qCACE,uCAAkB8vB,GAAc,GAAK,EACpCC,GAAiB,uCAAUA,QAI1BQ,OAAqCxb,IAApB8G,EACrB,cAAC8T,GAAD,CAAcrF,QAAQ,aAAtB,SACE,eAAC,KAAD,CAAKsB,WAAW,EAAO4B,QAASC,KAAY+C,MAAO9uB,KAAK,UAAxD,UACE,uCAAkBma,GAAmB,GAAK,OAG5C,KAEE4U,OAA2B1b,IAAf+a,EAChB,cAACH,GAAD,CAAcrF,QAAS8F,EAAvB,SACE,cAAC,KAAD,CAAKxE,WAAW,EAAO4B,QAASC,KAAY+C,MAAO9uB,KAAK,UAAxD,SACG4uB,MAGH,KAEEI,OAAyC3b,IAAzBib,QAAuDjb,IAAjBkb,EAC1D,cAACN,GAAD,CAAcrF,QAAS+F,EAAvB,SACE,cAAC,IAAD,CAAOxZ,QAAQ,MAAf,SACE,cAAC,GAAD,CAAOmY,QAASgB,EAAsB9nB,QAAS+nB,QAGjD,KAEEU,OAA4B5b,IAAjBmb,EACf,cAACP,GAAD,CAAcrF,QAAQ,YAAtB,SACE,cAAC,IAAD,CAAOzT,QAAQ,MAAf,SACE,cAAC,GAAD,CAAO3O,QAASgoB,QAGlB,KAEJ,OACE,cAAC,IAAD,CACEtE,WAAW,EACXlqB,KAAM2qB,IAAkBC,QACxBzqB,UAAW,CACTC,KAAM,CAACrD,MAAO,CAACsD,MAAO,SACtB6uB,eAAgB,CAACnyB,MAAO,CAACioB,KAAM,KALnC,SAQE,eAAC,IAAD,CACEtnB,QAAQ,OACRiB,cAAe,CAAC,SAAU,MAAO,OACjChB,WAAY,CAAC,aAAc,WAAY,UACvCiB,eAAe,gBACfyB,MAAM,OACN2kB,KAAK,IANP,UAQG6J,EACAE,EACAC,EACAC,Q,UCmFME,OAtKf,SAAqB/wB,GACnB,IAAO+C,EAAuB/C,EAAvB+C,QAASiuB,EAAchxB,EAAdgxB,WAEhB,EAA4ChrB,oBAAkB,GAA9D,mBAAOirB,EAAP,KAAuBC,EAAvB,KACA,EAAsClrB,oBAAkB,GAAxD,mBAAOmrB,EAAP,KAAoBC,EAApB,KAGMC,GAAwBtuB,EAAQ8J,OAAS9J,EADP,CAAC,IACuCsT,KAC9E,SAAC/G,EAAcyM,GAEb,MAAO,CACL3O,EAAG2O,EACHb,EAHW5L,IAASgiB,IAAW,KAAOpU,GAAgB5N,OAStDiiB,GAA2BP,EAAWnkB,OAASmkB,EADV,CAAC,IACgD3a,KAC1F,SAAC/G,EAAcyM,GAEb,MAAO,CACL3O,EAAG2O,EACHb,EAHW5L,IAASgiB,IAAW,KAAOpU,GAAgB5N,OAQtDkiB,EAAqB,GAErBC,EAAkB,WAClBC,EAAkB,eAEpBP,GACFK,EAAUrhB,KAAK,CACb+Y,GAAIuI,EACJ3tB,KAAMutB,EACNhxB,MAAO,UAIP4wB,GACFO,EAAUrhB,KAAK,CACb+Y,GAAIwI,EACJ5tB,KAAMytB,EACNlxB,MAAO,YAIX,IAAMsxB,EACJ,cAAC,KAAD,CACE7tB,KAAM0tB,EACN5yB,OAAQ,CAAE8G,IAAK,EAAGmB,MAAO,GAAI+qB,OAAQ,GAAIjsB,KAAM,IAC/CksB,OAAQ9uB,EAAQ8J,QAAU,GACtB,CAAE9B,KAAM,SACR,CAAEA,KAAM,SAAU4f,IAAK,EAAGC,IAAK,QAEnCkH,OAAQ,CAAE/mB,KAAM,SAAU4f,IAAK,EAAGC,IAAK,QACvCmH,QAAQ,SACRC,MAAO,YACPC,WAAY,CACVC,OAAQ,eACRC,aAAc,GACdC,eAAgB,UAElBC,SAAU,CACRH,OAAQ,OACRC,cAAe,GACfC,eAAgB,UAElBE,UAAW,EACXC,WAAY,SAACC,GACX,OAAOA,EAAMnyB,OAAS,SAExBoyB,iBAAkB,EAClBC,iBAAkB,QAClBC,SAAS,EACTC,iBAAiB,EACjBC,cAAc,EACdtO,OAAQ,SAACiO,GACP,OAAOA,EAAMnyB,OAAS,SAExByyB,QAAS,YAA8B,IAA5BC,EAA2B,EAA3BA,MACFjvB,EAAiBivB,EAAjBjvB,KAAMkvB,EAAWD,EAAXC,QACb,OACE,eAAC,IAAD,CAAO7zB,OAAQ,CACbuJ,gBAAiB,QACjBqO,QAAS,MACTC,aAAc,MACdic,UAAW,8FAJb,UAME,cAAC,IAAD,CAAOpzB,aAAa,MAApB,SACE,iDACc,4BAAIiE,EAAKovB,kBAGzB,cAAC,IAAD,UACE,kCACGF,EADH,KACa,4BAAIlvB,EAAKqvB,sBAM9BC,QAAS,CACP,CACEC,OAAQ,YACRC,UAAW,SACXC,SAAS,EACTC,YAAa,GACbC,WAAY,EACZC,aAAc,EACdC,cAAe,gBACfC,UAAW,GACXC,WAAY,GACZC,YAAa,EACbC,WAAY,EACZC,YAAa,SACbC,kBAAmB,wBAMrBC,EACJ,eAAC,IAAD,CAAO50B,QAAQ,OAAOiB,cAAc,MAAMb,UAAU,OAAOU,WAAW,OAAtE,UACE,cAAC,IAAD,CAAON,YAAY,OAAnB,SACE,cAAC,KAAD,CACEq0B,UAAWlD,EACXzF,QAAS2F,EACT9H,SAAU,kBAAM+H,GAAgBD,IAHlC,SAKGM,MAIL,cAAC,IAAD,UACE,cAAC,KAAD,CACE0C,UAAWhD,EACX3F,QAASyF,EACT5H,SAAU,kBAAM6H,GAAmBD,IAHrC,SAKGS,SAMT,OACE,eAAC,IAAD,WACE,cAAC,IAAD,CACEvsB,OAAO,QACPhG,OAAQ,CACNi1B,WAAY,4DACZnd,SAAU,QAJd,SAOG0a,IAEH,cAAC,IAAD,UACGuC,Q,8BCrJHG,GAAoC,CACxC9M,WAAY,OACZE,aAAc,OACdD,cAAe,OACfzgB,YAAa,OACbkQ,SAAU,OACVvO,gBAAiB,UACjB4rB,WAAY,OACZF,WAAY,aAkOd,SAASG,GAAav0B,GACpB,IAAO2M,EAA8C3M,EAA9C2M,aAAciL,EAAgC5X,EAAhC4X,MAAO4S,EAAyBxqB,EAAzBwqB,QAASgK,EAAgBx0B,EAAhBw0B,aAC/BC,EAAqB9nB,EACxB0J,KAAI,SAACpJ,GAAD,OAqCT,SAA2BA,GACzB,KADmF,yDAEjF,OAAO7H,KAAKgY,KAAmB,IAAdnQ,GAAsB,IAEzC,OAAOA,EAzCyBynB,CAAkBznB,EAAaunB,MAC5DG,KAAK,MACR,OACE,cAAC,IAAD,UACE,cAAC,KAAD,CACE/c,MAAO,kBAAMA,GACb4S,QAAS,kBAAMA,GAFjB,SAIE,cAACoK,GAAD,UACGH,QAWX,SAASG,GAAU50B,GACjB,IAAOa,EAAYb,EAAZa,SACP,OACE,mCACE,cAAC,IAAD,CAAO1B,OAAM,6BACRk1B,IADQ,IAEXQ,OAAQ,qBACR7d,aAAc,QAHhB,SAKE,+BACGnW,QAcIi0B,OA9Qf,SAAuB90B,GACrB,IACEE,EAMEF,EANFE,MACAuP,EAKEzP,EALFyP,OACA2M,EAIEpc,EAJFoc,aACA9M,EAGEtP,EAHFsP,KAJF,EAOItP,EAFF+0B,gBALF,WAOI/0B,EADFg1B,oBANF,MAMiB,SAACvlB,KANlB,EASA,EAA6BzJ,oBAAkB,GAAxCivB,EAAP,oBACA,EAA6BjvB,oBAAkB,GAAxCkvB,EAAP,oBAEA,EAAgDlvB,oBAAkB,GAAlE,mBAAOmvB,EAAP,KAAyBC,EAAzB,KACA,EAAwCpvB,mBAAwByJ,GAAhE,mBAAO4lB,EAAP,KAAqBC,EAArB,KACA,EAAsCtvB,mBAAwB,MAA9D,mBAAOuvB,EAAP,KAAoBC,EAApB,KA+BMC,EACJ,eAAC,IAAD,CAAOn2B,QAAQ,OAAOiB,cAAc,MAApC,UACGkP,GACC,eAAC,IAAD,CAAO3P,YAAY,OAAnB,oBACS,4BAAI2P,EAAO5C,YAGrBuP,GACC,eAAC,IAAD,CAAOtc,YAAY,OAAnB,4BACiB,4BAAIsc,OAGtB9M,GACC,eAAC,IAAD,CAAOxP,YAAY,OAAnB,mBACQ,4BAAIod,GAAgB5N,QAG7BA,GACC,eAAC,IAAD,uBACW,4BAAI4N,GAAgB7N,GAAiBC,EAAM2O,aAMtDrG,EAAQ1X,GAAS,aAEjBw1B,EAAwBP,EAE1B,KADF,cAAC,KAAD,CAAQj1B,MAAM,gBAGVy1B,EAAuBR,EAC3B,cAAC,IAAD,CAAWj1B,MAAM,gBACf,KAEE01B,EAAoBb,EACxB,cAAC,IAAD,CACEz1B,QAAQ,OACRiB,cAAc,MACdC,eAAe,WACfjB,WAAW,SACXM,aAAa,QALf,SAOE,cAAC,KAAD,CACEhB,QAnDe,WACfw2B,GAAgBF,IAAqBI,GACvCP,EAAaK,GAEfD,GAAqBD,IAgDjBlO,MAAOC,KAAamE,KACpBzpB,KAAMwlB,KAAYC,QAClB5nB,KAAM2rB,KAAYe,QAClBgI,WAAYoB,EACZxzB,UAAW,CACTulB,WAAY,CACV3oB,MAAO,CACL4oB,WAAY,EACZE,aAAc,EACdD,cAAe,EACfzgB,YAAa,EACbrH,UAAW,MACXJ,QAAS,SAEXU,MAAO,CACLE,MAAOi1B,EAAmB,cAAgB,iBAjBlD,SAsBE,eAAC,IAAD,WACGO,EACAC,SAIL,KAEEE,EACJ,cAAC,IAAD,UACGje,IAIC0F,GAAgB7N,GAAU,IAAIklB,KA1Id,KA2IhBmB,EACJ,cAAC,KAAD,CACEle,MAAOie,EACPrL,QAASiL,EAFX,SAIE,cAACb,GAAD,UACGtX,MAKDyY,GAAsBV,GAAgB,IAAIV,KAtJ1B,KAuJhBqB,EACJ,cAAC,KAAD,CACEpe,MAAO,kBAAMie,GACbrL,QACE,2GAIFjpB,MAAOg0B,EAPT,SASE,cAAC,KAAD,CACEz0B,MAAOi1B,EACP1M,SAAU,SAACtlB,IArIM,SAACuZ,GACtB,GAAK7N,EAAL,CAIA,IAAMwmB,EAA2B3Y,EAC9B4Y,OACA3Y,MAAM,IACNpH,QAAO,SAACqH,GAAD,MAAwB,CAAC,IAAK,KAAKlX,SAASkX,MACnDnH,KAAI,SAACmH,GAEJ,MADkC,MAAfA,EAAqB,EAAI,KAGhD8X,EAAgBW,GAEZA,EAAiBppB,SAAW4C,EAAO5C,OACrC2oB,EAAe,oBAAD,OAAqB/lB,EAAO5C,OAA5B,oCAA8DopB,EAAiBppB,OAA/E,YAEd2oB,EAAe,OAqHXW,CAAepyB,EAAMgC,OAAOjF,QAE9BiB,UAAW,CACTq0B,MAAO,CACLz3B,MAAM,6BACD01B,IADA,IAEHlvB,OAAQ,YAId5D,QAASg0B,EACTtJ,WAAS,MAKToK,EAAelB,EAAmBa,EAAuBF,EAE3DQ,EAAuB,KACvBC,EAAuB,KAC3B,GAAI9mB,EAAQ,CACV,MAAiED,GAAaC,GAAtEG,EAAR,EAAQA,0BAA2BE,EAAnC,EAAmCA,0BACnCwmB,EACE,cAAC/B,GAAD,CACE3c,MAAM,iBACN4S,QAAO,0BtC7MgB,EsC6MhB,wFAGP7d,aAAciD,EACd4kB,aAAcS,IAGlBsB,EACE,cAAChC,GAAD,CACE3c,MAAM,iBACN4S,QAAO,0BtCvNgB,EsCuNhB,wFAGP7d,aAAcmD,EACd0kB,aAAcU,IAKpB,IAAMsB,EAAqB,OAE3B,OACE,eAAC,IAAD,WACE,eAAC,IAAD,CAAO32B,aAAc22B,EAArB,UACGZ,EACAS,KAGH,cAAC,IAAD,CAAOx2B,aAAc22B,EAArB,SACGF,IAGH,cAAC,IAAD,CAAOz2B,aAAc22B,EAArB,SACGD,QChPHE,GACa,oBADbA,GAEc,qBA8FLC,OA9Ef,SAAqB12B,GACnB,MAWIA,EAVF22B,4BADF,MACyB,sBADzB,EAEEC,EASE52B,EATF42B,WACAC,EAQE72B,EARF62B,oBACAC,EAOE92B,EAPF82B,QAJF,EAWI92B,EANF+2B,kCALF,MAK+B,sBAL/B,EAMEC,EAKEh3B,EALFg3B,iBACAC,EAIEj3B,EAJFi3B,0BACAC,EAGEl3B,EAHFk3B,cARF,EAWIl3B,EAFF+0B,gBATF,WAWI/0B,EADFm3B,wBAVF,MAUqB,SAAC1nB,KAVtB,EAaA,EAAoDvN,IAAM8D,SAAsB,CAC9EywB,KADF,mBAAOW,EAAP,KAA2BC,EAA3B,KAiBMC,EACJ,cAAC,GAAD,CACE7nB,OAAQmnB,EACRxa,aAAcya,EACdvnB,KAAMwnB,EACN/B,SAAUA,EACVC,aAAcmC,IAIZI,OAA+CtiB,IAArB+hB,EAC9B,cAAC,GAAD,CACEvnB,OAAQunB,EACR5a,aAAc6a,EACd3nB,KAAM4nB,IAEN,KAEEM,EAAS,GAETC,EACJ,cAAC,KAAD,CAAOv3B,MAAOy2B,EAAd,SACGW,GADsCb,IAKrCiB,EAAwBH,EAC5B,cAAC,KAAD,CAAOr3B,MAAO62B,EAAd,SACGQ,GAD4Cd,IAG7C,KAOJ,OALAe,EAAOrnB,KAAKsnB,GACRC,GACFF,EAAOrnB,KAAKunB,GAIZ,cAAC,KAAD,CACEC,SAAUP,EACV/N,SArDkB,SAAC,GAEjB,IADHhjB,EACE,EADFA,IAEKuxB,GADH,EADGD,SAEqB,aAAOP,IAC5BS,EAAiBD,EAAsBE,QAAQzxB,IAC7B,IAApBwxB,EACFD,EAAsBznB,KAAK9J,GAE3BuxB,EAAsBG,OAAOF,GAE/BR,EAAsBO,IAyCtB,SAIGJ,KCgEQQ,OApHf,SAA4Bh4B,GAC1B,IACE+b,EA+BE/b,EA/BF+b,gBACAkc,EA8BEj4B,EA9BFi4B,eACAhI,EA6BEjwB,EA7BFiwB,aACAiI,EA4BEl4B,EA5BFk4B,YACArS,EA2BE7lB,EA3BF6lB,oBACAmC,EA0BEhoB,EA1BFgoB,8BACAmQ,EAyBEn4B,EAzBFm4B,WACAjI,EAwBElwB,EAxBFkwB,qBACAxK,EAuBE1lB,EAvBF0lB,eACArd,EAsBErI,EAtBFqI,iBACA+vB,EAqBEp4B,EArBFo4B,cACArQ,EAoBE/nB,EApBF+nB,mBACAoI,EAmBEnwB,EAnBFmwB,aACAlI,EAkBEjoB,EAlBFioB,uBACAC,EAiBEloB,EAjBFkoB,kBACAC,EAgBEnoB,EAhBFmoB,2BACAI,EAeEvoB,EAfFuoB,QACAH,EAcEpoB,EAdFooB,4BACAC,EAaEroB,EAbFqoB,sCACAC,EAYEtoB,EAZFsoB,mBACA5K,EAWE1d,EAXF0d,YACAC,EAUE3d,EAVF2d,eACAzB,EASElc,EATFkc,KACA6Q,EAQE/sB,EARF+sB,eACAH,EAOE5sB,EAPF4sB,SACAgK,EAME52B,EANF42B,WACAC,EAKE72B,EALF62B,oBACAC,EAIE92B,EAJF82B,QACAE,EAGEh3B,EAHFg3B,iBACAC,EAEEj3B,EAFFi3B,0BACAC,EACEl3B,EADFk3B,cAGImB,EACJ,cAAC,IAAD,CAAOx4B,aAAa,OAAOH,UAAU,OAArC,SACE,cAAC,GAAD,CACEqc,gBAAiBA,EACjBiU,WAAYiI,EACZhI,aAAcA,EACdE,aAAcA,EACdC,aAAY,UAAK+H,GACjBjI,qBAAsBA,EACtBG,MAAO6H,MAKPI,EACJ,cAAC,IAAD,CAAOz4B,aAAa,OAApB,SACE,cAAC,GAAD,CACE6lB,eAAgBA,EAChBoC,UAAWsQ,EACXvS,oBAAqBA,EACrBkC,mBAAoBA,EACpBC,8BAA+BA,EAC/B3f,iBAAkBA,EAClB4f,uBAAwBA,EACxBC,kBAAmBA,EACnBC,2BAA4BA,EAC5BC,4BAA6BA,EAC7BC,sCAAuCA,EACvCC,mBAAoBA,EACpBC,QAASA,MAKTgQ,EACJ,cAAC,IAAD,CAAO14B,aAAa,OAApB,SACE,cAAC,GAAD,CACEkD,QAAS2a,EACTsT,WAAYrT,MAKZ6a,EACJ,cAAC,IAAD,UACE,cAAC,GAAD,CACEtc,KAAMA,EACN6Q,eAAgBA,EAChBH,SACsB,OAApB7Q,GAA4B6Q,EAAS7Q,GACjC6Q,EAAS7Q,GACT,OAMZ,OACE,qCACGsc,EACAC,EACD,eAAC,IAAD,CAAOh5B,QAAQ,OAAOiB,cAAe,CAAC,SAAU,SAAU,eAA1D,UACE,cAAC,IAAD,CAAOqmB,KAAM,EAAG/mB,aAAa,OAAOO,WAAY,CAAC,MAAO,MAAO,QAA/D,SACGm4B,IAEH,cAAC,IAAD,CAAO3R,KAAM,EAAG/mB,aAAa,OAAOC,YAAa,CAAC,MAAO,MAAO,QAAhE,SACG04B,OAGL,cAAC,GAAD,CACE5B,WAAYA,EACZC,oBAAqBA,EACrBC,QAASA,EACTE,iBAAkBA,EAClBC,0BAA2BA,EAC3BC,cAAeA,QC1FRuB,OAzCf,SAA0Bz4B,GACxB,IACEkc,EAKElc,EALFkc,KADF,EAMIlc,EAJF04B,0BAFF,WAMI14B,EAHF0iB,kBAHF,WAMI1iB,EAFFqI,wBAJF,SAKEya,EACE9iB,EADF8iB,aAGF,OACE,qCACE,cAAC,GAAD,CACEvM,SAAU,CAAE4H,KAAM,UAClBrG,qBAzB+B,EA0B/BC,oBA3B4B,IA6B9B,cAAC,GAAD,IACA,cAAC,GAAD,CACEmE,KAAMA,EACNpE,qBAhC4B,EAiC5BC,oBAhC+B,EAiC/B4K,cAAY,EACZjL,aAAW,EACXhC,eAAgBgjB,EAChBhW,WAAYA,EACZE,kBAAkB,EAClBva,iBAAkBA,EAClBya,aAAcA,IAEhB,cAAC,GAAD,CACEtB,KAAM,EACNC,KAAM,EACNC,UAAW,CAAC,CAAC,EAAG,IAChB5J,qBA7C+B,EA8C/BC,oBA/C4B,EAgD5B1P,iBAAkBA,Q,8BCuIXswB,OAtJf,SAAkC34B,GAChC,IACE44B,EAEE54B,EAFF44B,wBACAC,EACE74B,EADF64B,mBAGF,EAAsD7yB,oBAAkB,GAAxE,mBAAO8yB,EAAP,KAA4BC,EAA5B,KACA,EAA4D/yB,oBAAkB,GAA9E,mBAAOgzB,EAAP,KAA+BC,EAA/B,KACA,EAA4DjzB,mBAAwB,MAApF,mBAAOkzB,EAAP,KAA+BC,EAA/B,KAmBMC,EAAyB,WAC7BL,GAAuB,IAsCnBM,EAAkBH,EACtB,cAAC,IAAD,CACEt3B,KAAM2qB,IAAkBzqB,SACxBC,UAAW,CACTC,KAAM,CAACrD,MAAO,CAACsD,MAAO,UAH1B,SAMGi3B,IAED,KAEEI,EACJ,eAAC,KAAD,CACEzN,QAASuN,EACTtN,WAAS,EACTC,OAAQ+M,EACR9M,SAAO,EACPC,WAAS,EACTxsB,KAAMysB,KAAKC,QACXC,KAAMC,KAAKC,OAPb,UASE,cAAC,KAAD,yDACA,eAAC,KAAD,WACG+M,EACD,eAAC,IAAD,8BACkB,wCADlB,yGAGA,cAAC,IAAD,+EAIA,cAAC,IAAD,CAAOx5B,aAAa,OAApB,SACE,cAAC,KAAD,CACEJ,KAAM2rB,KAAY3B,QAClBxC,MAAOC,KAAamE,KACpBzpB,KAAMwlB,KAAYmS,UAClB16B,QA9CkB,WAC1B,IAEE+5B,EAAwBY,IACxBJ,IACA,MAAO73B,GACP43B,EAA0B53B,EAAM0Y,WAoC5B,mCAUF,cAAC,KAAD,CACEwf,SA9EyB,WAC/BR,GAA0B,IA8EpBS,OA3EW,SAACC,GAClB,IACEV,GAA0B,GAE1B,IAQMW,EAAa,IAAIC,WACvBD,EAAWE,OATgB,SAAC/1B,GAE1B,IAAMg2B,EAAkCvf,KAAKM,MAAM/W,EAAMgC,OAAOgH,QAChE6rB,EAAwBmB,GACxBd,GAA0B,GAC1BG,KAKFQ,EAAWI,WAAWL,EAAc,IACpC,MAAOp4B,GACP43B,EAA0B53B,EAAM0Y,SAChCgf,GAA0B,KA2DtBgB,OAAO,mBACPC,UAAU,EACVC,gBAAiBnB,EAAyB,gBAAkB,WAMpE,OACE,qCACE,eAAC,GAAD,WACE,cAAC,IAAD,CAAOl5B,YAAY,MAAnB,SACE,cAAC,KAAD,CACEwrB,cAAe,kBAAM,cAAC,KAAD,CAAY7rB,KAAM,MACvCA,KAAM2rB,KAAY3B,QAClBxC,MAAOC,KAAamE,KACpBxsB,QArHc,WACtB,IAAMk7B,EAAkClB,IAClCuB,EAAQ,2BAAuBL,EAAWrU,eAAlC,wBAAgEqU,EAAWhe,gBAA3E,SACRse,EAA2B7f,KAAKC,UAAUsf,GAC1CO,EAAiB,IAAIC,KACzB,CAACF,GACD,CAAEtvB,KAAM,qBAEVyvB,kBAAOF,EAAgBF,IAyGjB,8BAUF,cAAC,IAAD,CAAOh6B,WAAW,MAAlB,SACE,cAAC,KAAD,CACEkrB,cAAe,kBAAM,cAAC,KAAD,CAAU7rB,KAAM,MACrCA,KAAM2rB,KAAY3B,QAClBxC,MAAOC,KAAamE,KACpBxsB,QArHoB,WAC5Bs6B,EAA0B,MAC1BF,GAA0B,GAC1BF,GAAuB,IA8GjB,oCAWHO,MCjJDmB,GAA4B,aAC5BC,GAAuB,QACvBC,GAAgC,WAChCC,GAAiC,WACjCC,GAAkC,YAClCC,GAA8B,QAysBrBC,OAlsBf,WACE,IAAOC,EAAWC,cAAXD,QAEP,EAAgDh1B,mB1DXb,SAAC3D,EAAcmB,GAClD,IAAMC,EAA6BrB,EAAeC,GAClD,OAAoB,OAAhBoB,EACKD,EAE4B,SAA9BC,EAAYy3B,c0DOjBC,CAAsBL,GVzBwB,QUwBhD,mBAAOzyB,EAAP,KAAyB+yB,EAAzB,KAIA,EAAoCp1B,mBAAiB,GAArD,mBAAOmyB,EAAP,KAAmBkD,EAAnB,KAEA,EAA4Cr1B,mBAC1CzC,EAAkBk3B,GV9ByB,MU6B7C,mBAAO/U,EAAP,KAAuB4V,EAAvB,KAGA,EAAsEt1B,mBAAwB,MAA9F,mBAAOu1B,EAAP,KAAoCC,EAApC,KACA,EAA8Cx1B,mBAAwB,MAAtE,mBAAO+V,EAAP,KAAwB0f,EAAxB,KACA,EAAoCz1B,mBAAqB,IAAzD,mBAAOgW,EAAP,KAAmB0f,EAAnB,KACA,EAAoD11B,mBAClDzC,EAAkBo3B,GVhC6B,KU+BjD,mBAAO5S,EAAP,KAA2B4T,EAA3B,KAIA,EAAwB31B,mBAAmB,IAA3C,mBAAOkW,EAAP,KAAa0f,EAAb,KACA,EAAkC51B,mBAAoB,IAAtD,mBAAO61B,EAAP,KAAkBC,EAAlB,KACA,EAA0C91B,mBACxCzC,EAAkBm3B,GVzCoB,IUwCxC,mBAAOtC,EAAP,KAAsB2D,EAAtB,KAGA,EAA4C/1B,mBAAwB,MAApE,mBAAOiyB,EAAP,KAAuB+D,GAAvB,KACMC,GAAU/nB,iBAAiB,IAEjC,GAAoClO,mBAAwB,MAA5D,qBAAO4wB,GAAP,MAAmBsF,GAAnB,MACA,GAA8Bl2B,mBAAwB,MAAtD,qBAAO8wB,GAAP,MAAgBqF,GAAhB,MACA,GAAsDn2B,mBAAqC,MAA3F,qBAAO6wB,GAAP,MAA4BuF,GAA5B,MACA,GAAgDp2B,mBAAwB,MAAxE,qBAAOgxB,GAAP,MAAyBqF,GAAzB,MACA,GAA0Cr2B,mBAAwB,MAAlE,qBAAOkxB,GAAP,MAAsBoF,GAAtB,MACA,GAAkEt2B,mBAAqC,MAAvG,qBAAOixB,GAAP,MAAkCsF,GAAlC,MAEA,GAA8Bv2B,mBAA8Bwc,IAArDga,GAAP,qBAEMC,GAAavoB,iBAA8B,MAE3CwoB,GAAcxoB,iBAAuB,CAAC,KAC5C,GAAgClO,mBAAyB,CAAC,KAA1D,qBAAO4mB,GAAP,MAAiB+P,GAAjB,MACA,GAAsC32B,mBAAmB,IAAzD,qBAAO0X,GAAP,MAAoBkf,GAApB,MACA,GAA4C52B,mBAAmB,IAA/D,qBAAO2X,GAAP,MAAuBkf,GAAvB,MACMC,GAAgB5oB,iBAAyB,CAAC,KAEhD,GAAsDlO,mB1D5DrB,SAAC3D,EAAcmB,GAChD,IAAMC,EAA6BrB,EAAeC,GAClD,OAAoB,OAAhBoB,EACKD,EAEFu5B,WAAWt5B,G0DwDhBu5B,CAAoBpC,GV/DiC,MU8DvD,qBAAO/U,GAAP,MAA4BoX,GAA5B,MAGA,GAA0Ej3B,mBACxEzC,EAAkBs3B,GVjE8C,IUgElE,qBAAO7S,GAAP,MAAsCkV,GAAtC,MAIA,GAA8Dl3B,mB1BpGtB,G0BoGxC,qBAAOm3B,GAAP,MAAgCC,GAAhC,MAEM9iB,GAASR,GAAc,CAAEC,QAAS,iBAClCsjB,GAA2Bj4B,KAAKgY,KAAKxL,OAAOC,KAAKqK,GAAMrP,OAASurB,GAChErL,GAAqC8O,EAAUzvB,QAAO,SAAC8P,EAA0BsC,GAErF,OADAtC,EAAKsC,EAAIpC,eAAgB,EAClBF,IACN,IACGiU,G3BX4B,SAClCpU,EACAiU,GAEA,IACMsN,EAAuB,OAAftN,GAAuB,EAAGA,EACxC,MAAM,SAAN,OAFuC,OAApBjU,GAA4B,EAAIA,EAEnD,YAA8BuhB,G2BKTC,CAAqBxhB,EAAiBkc,GACrD/H,GVtFsB,IUsFCnI,EAoBvByV,GAAqB,WACzBC,KAlBA/B,EAAc,IACdI,EAAa,IACbF,EAAQ,IACRe,GAAY,CAAC,KACbV,GAAQxnB,QAAU,GAClBioB,GAAYjoB,QAAU,CAAC,IACvBqoB,GAAcroB,QAAU,CAAC,IACzBmoB,GAAe,IACfC,GAAkB,IAClBX,GAAc,MACdC,GAAW,MACXC,GAAuB,MACvBC,GAAoB,MACpBC,GAAiB,MACjBC,GAA6B,MAM7BlB,EAAclD,EAAa,GAC3BsD,EAAmB,GACnBO,GAAkB,OAGd0B,GAAkB,SAACC,EAAmCruB,GAC1D,GAAwB,OAApByM,IAKC2gB,GAAYjoB,QAAQsH,KACvB2gB,GAAYjoB,QAAQsH,GAAmB,IAEzC2gB,GAAYjoB,QAAQsH,GAAiB4hB,GAAgBruB,EAGhDwtB,GAAcroB,QAAQsH,KACzB+gB,GAAcroB,QAAQsH,GAAmB,IAEvCkgB,GAAQxnB,QAAQkpB,IAAe,CACjC,IAAMC,EAAiB3B,GAAQxnB,QAAQkpB,GAAcxhB,YAE/C0hB,EADoB7hB,EAAW4hB,GACKjJ,KAAK,IAC/CmI,GAAcroB,QAAQsH,GAAiB8hB,GAAgBvuB,IAmGrDmuB,GAAmB,WACvBnjB,GAAON,KAAK,gCACe,OAAvByiB,GAAWhoB,UAGfqpB,aAAarB,GAAWhoB,SACxBgoB,GAAWhoB,QAAU,OAmKjBspB,GAA+B,SAAC/hB,GACpC,SACEA,GACAA,EAAWnP,SAAW6Y,GACtB1J,EAAW,GAAGnP,SAAWuB,KAIvB4vB,GAAgC,WACpC,MAGIvgB,KAFUwgB,EADd,EACEjiB,WACiBkiB,EAFnB,EAEEniB,gBAEF,OACEgiB,GAA6BE,IAC7BC,EAEOA,EAEF,MAkDHC,GAAiB,WACrB7jB,GAAON,KAAK,mBACZ,IAAIokB,EAAuB,EAErBF,EAA6BF,KAC7BK,EApD0B,WAChC,MAGI5gB,KAFW4gB,EADf,EACE3gB,YACYugB,EAFd,EAEEjiB,WAEF,OACE+hB,GAA6BE,IAC7BI,EAEOA,EAEF,KAyCwBC,GACzBC,EAvC6B,WACnC,MAGI9gB,KAFc8gB,EADlB,EACE5gB,eACYsgB,EAFd,EAEEjiB,WAEF,OACE+hB,GAA6BE,IAC7BM,EAEOA,EAEF,KA4B2BC,GAE9BN,GAA8BG,GAA0BE,IAC1DH,EAAuBF,EACvB1C,EAA+B0C,GAC/BtB,GAAeyB,GACfxB,GAAkB0B,IAGpB9C,EAAmB2C,IAGfK,GAAwB,WAC5B,GAAwB,OAApB1iB,EAAJ,CAGAzB,GAAON,KAAK,2BACZ,IAAI0kB,EAA8BjZ,GAAiB,CACjDC,iBACAC,aAAcvX,KAGV6vB,EA/CyB,WAC/B,IACcA,EACVxgB,KADFzB,WAEF,GAAI+hB,GAA6BE,GAC/B,OAAOA,EAET,GAAIA,EACF,IACE,IAAMU,EAAsBV,EAAsBpxB,OAC5C+xB,EAAoBX,EAAsB,GAAGpxB,OACnDyN,GAAOF,KAAP,8DAAmEukB,EAAnE,2BAAyGC,IACzG,MAAOC,GACPvkB,GAAOF,KAAK,sCAGhB,OAAO,KA+B0C0kB,GAC3CZ,EAA4CF,KAC9CC,GAAyBC,IAC3BQ,EAAkBT,EAClBjD,EAAQ,CACN/gB,QAAQ,eAAD,OACUikB,EADV,gGAEP5S,cAAe,gBAAE7rB,EAAF,EAAEA,KAAF,OAAY,cAAC,KAAD,CAAUA,KAAMA,MAC1Cs/B,KAASC,SAGdtD,EAAcgD,GACdxC,GAAcwC,EAAgB,IAC9BrC,GAAoBqC,EAAgB,MAGhCO,GAAyB,WAC7B,GAAwB,OAApBljB,EAAJ,CAGAzB,GAAON,KAAP,2BAAgC+B,IAChC,IACE,IAAMmjB,EdrdL,SACLljB,EACAmjB,EACA55B,GAEA,IACEsgB,EAEEtgB,EAFFsgB,oBACAmC,EACEziB,EADFyiB,8BAGIkX,EAA4B,GAE5BE,EAAa,aAAOpjB,GAE1BojB,EAAclS,MAAK,SAACmS,EAAiBC,GACnC,IAAMC,EAAWJ,EAAQE,GACnBG,EAAWL,EAAQG,GACzB,OAAIC,EAAWC,EACN,EAELD,EAAWC,GACL,EAEH,KAIT,IAAMC,EAAkBr6B,KAAKC,MAAM2iB,EAAgCoX,EAAcvyB,OAAS,KACtF4yB,GACFL,EAAcjzB,MAAM,EAAGszB,GAAiBzyB,SAAQ,SAAC0yB,GAC/CR,EAAc/uB,KAAKuvB,MAQvB,IAHA,IAAMC,EAAgCP,EAAc/oB,KAAI,SAAC5G,GAAD,OAAoB0vB,EAAQ1vB,MAG7EyvB,EAAcryB,OAASmP,EAAWnP,QAAQ,CAU/C,IAPA,IAAIqZ,EAAwB,KACxB0Z,EAAmC,KACnCzZ,EAAwB,KACxB0Z,EAAmC,MAI/B3Z,IAAWC,GAAUyZ,IAAsBC,GAAmB,CACpE,MAGI3a,GAAuBlJ,EAAY2jB,GAF/BG,EADR,EACEta,KACOua,EAFT,EAEEpsB,MAGF,EAGIuR,GAAuBlJ,EAAY2jB,GAEvCzZ,EAAS4Z,EACTF,EAAoBG,EAEpB5Z,EARA,EACEX,KAQFqa,EATA,EAEElsB,MAWJ,MAAkCsS,GAAKC,EAAQC,EAAQN,GAAvD,mBAAOO,EAAP,KAAmBC,EAAnB,KAEA6Y,EAAc/uB,KAAKiW,GAIf8Y,EAAcryB,OAASmP,EAAWnP,QACpCqyB,EAAc/uB,KAAKkW,GAIvB,OAAO6Y,EcuYmBc,CACpBhkB,EAxIqB,SAACD,GAAD,OAA6B,SAACtM,GACvD,IAAMwwB,EAAYxwB,EAAOklB,KAAK,IAC9B,GACsB,OAApB5Y,IACC+gB,GAAcroB,QAAQsH,IACsC,kBAAtD+gB,GAAcroB,QAAQsH,GAAiBkkB,GAE9C,MAAM,IAAInzB,MAAM,mDAElB,IAAMwC,EAAOwtB,GAAcroB,QAAQsH,GAAiBkkB,GACpD,GAAoB,kBAAT3wB,EACT,MAAM,IAAIxC,MAAM,8BAElB,OAAOuC,GAAiBC,EAAM2O,KA4H1BiiB,CAAmBnkB,EAAkB,GACrC,CACE8J,uBACAmC,8BAA+BA,KAGnC0T,EAAcwD,GACdthB,GAAwB,CACtB5B,WAAYkjB,EACZnjB,kBACA2B,eACAC,oBAEF,MAAO8N,GAEPiQ,EAAc,aAAI1f,IAClB,IACMmkB,EAAmB1U,GAAKA,EAAExR,QAAUwR,EAAExR,QAAU,GACtDK,GAAOF,KAFc,wGAEK+lB,MAoCxBjI,G1BxlBwC,I0B0lB5CD,GACAkF,GAA0B,GAC1Bzf,GAAY7Q,OAAS,GACrB6Q,GAAYA,GAAY7Q,OAAS,G1B3lBsB,I0B2lBhB6Q,GAAYA,GAAY7Q,OAAS,GAAmD,IAEvHuzB,GAAqB,WACzB,GAAuB,OAAnBnI,EAAJ,CAGA3d,GAAON,KAAP,iBAAsBie,EAAtB,oBACA0E,GAAYhmB,KAAE0pB,UAA0B3D,GAAYjoB,UA3Q9B,WACtB,GAAwB,OAApBsH,EAAJ,CAGA,IAAMukB,EAA+B5D,GAAYjoB,QAAQsH,GAGnDwkB,EAAc,aAAO7iB,IAEzB6iB,EAAexkB,GADbukB,EACgC1uB,OAAOqb,OAAOqT,GAAgBl0B,QAC9D,SAACo0B,EAAgBC,GACf,OAAgB,OAAZA,EACKD,EAEFp7B,KAAKulB,IAAI6V,EAAQC,KAE1BnP,KAGgCA,IAEpCsL,GAAe2D,GAGf,IAAMG,EAAiB,aAAO/iB,IAC9B,GAAI2iB,EAAgB,CAClB,IAAIK,EAAgB,EAEdC,EAA0BhvB,OAAOqb,OAAsBqT,GAC1DpT,MAAK,SAAC2T,EAAkBC,GACvB,IAAMC,EAAuB,OAANF,EAAavP,IAAWuP,EACzCG,EAAuB,OAANF,EAAaxP,IAAWwP,EAC/C,OAAIC,EAASC,GACH,EAEND,EAASC,EACJ,EAEF,KASLC,EALoBL,EAAwBz0B,MAChD,EACA/G,KAAKgY,KAAsC,GAAjCwjB,EAAwB/zB,SAGFT,QAChC,SAAC80B,EAAaT,GACZ,OAAgB,OAAZA,EACKS,GAETP,GAAiB,EACVO,EAAMT,KAEf,GAEFC,EAAkB3kB,GAAmB4kB,EAAgBM,EAAUN,EAAgB,OAE/ED,EAAkB3kB,GAAmBuV,IAEvCuL,GAAkB6D,IA+MlBS,GAvT2B,SAC3BC,GAEA,GAAwB,OAApBrlB,GAA6BqlB,EAAjC,CAIA,IAAMd,EAA+B5D,GAAYjoB,QAAQsH,GACzD,GAAKukB,EAAL,CAIA,IAAIe,EAAwD,KACxDnK,EAAwB5F,IACxBgQ,GAAiC,EAkBrC,GAhBA1vB,OAAOC,KAAKyuB,GAAgBtzB,SAAQ,SAACoP,GAEnC,GAAIA,IAAiBglB,EAArB,CAGA,IAAM/yB,EAAyBiyB,EAAelkB,GAC9B,OAAZ/N,GAGAA,EAAU6oB,IACZA,EAAgB7oB,EAChBgzB,EAA4BjlB,EAC5BklB,EAAwBplB,EAAKE,GAAcD,kBAIhB,IAA3BmlB,EAIJhF,GAAiBpF,GACjBmF,GAAoBrgB,EAAWslB,IAC/B/E,GAA6B8E,KAmR7BE,CA9VqB,WACrB,GAAwB,OAApBxlB,EAAJ,CAIA,IAAMukB,EAA+B5D,GAAYjoB,QAAQsH,GACzD,GAAKukB,EAAL,CAIA,IAAIkB,EAAkD,KAClD1K,EAAkBxF,IAClBmQ,GAA2B,EAc/B,GAZA7vB,OAAOC,KAAKyuB,GAAgBtzB,SAAQ,SAACoP,GACnC,IAAM/N,EAAyBiyB,EAAelkB,GAC9B,OAAZ/N,GAGAA,EAAUyoB,IACZA,EAAUzoB,EACVmzB,EAAsBplB,EACtBqlB,EAAkBvlB,EAAKE,GAAcD,iBAIhB,IAArBslB,EAQJ,OAJAtF,GAAWrF,GACXoF,GAAclgB,EAAWylB,IACzBrF,GAAuBoF,GAEhBA,IA2TkBE,IAEzB,IAAIC,EAAiB1J,EAAiB,EAgBtC,GAbsCA,IACJ,IAA5BkF,GACElF,E1B7mBoC,I0B8mBtC3d,GAAON,KAAP,4D1B7mBgC,I0B8mBhCojB,G1B9mBgC,I0BgnBzBlF,KACT5d,GAAON,KAAP,gDAAqDmjB,GAA0B,IAC/EC,GAA2BD,GAA0B,GACrDwE,EAAiB,IAIjBA,GAAkBtE,GAMpB,OALAvB,EAAa,SACW,OAApB/f,IACFigB,GAAkB,MAClBP,EAAmB1f,EAAkB,KAIzCigB,GAAkB2F,KAoDpB,OApCAn7B,qBAAU,WACR23B,OAEC,IAGH33B,qBAAU,WACgB,IAApBuV,GAAyBA,IAAoBwf,EAC/CkD,KAEAQ,OAGD,CAACljB,EAAiBoc,IAGrB3xB,qBAAU,YAxGuB,WAC/B,GAAKwV,GAAeA,EAAWnP,OAA/B,CAGAyN,GAAON,KAAP,uCAA4C+B,IAC5C,IAAMG,EAAOJ,GAAiB,CAC5BE,aACAD,kBACAE,aAAcyhB,KAEhB9B,EAAQ1f,GACR8f,GAAkB,GAClBC,GAAQxnB,QAAUkC,KAAE0pB,UAAUnkB,IA6F9B0lB,KAEC,CAAC5lB,IAGJxV,qBAAU,YA/FoB,WAC5B,GAAuB,OAAnByxB,GAA+C,OAApBlc,GAG1BG,GAAStK,OAAOC,KAAKqK,GAAMrP,UAG5BorB,GAAkBoF,IAAtB,CAGA/iB,GAAON,KAAP,+BAAoCie,IACpC,IAAM4J,EAAazJ,EAAgBH,EAC7B6J,EAAWD,EAAazJ,EACxByD,EAAuBjqB,OAAOqb,OAAO/Q,GAAM/P,MAAM01B,EAAYC,GACnEhG,EAAaD,IAkFbkG,KAEC,CAAC9J,IAGJzxB,qBAAU,WAzCqB,IAACw7B,EA2C9B,OA3C8BA,EA0CP5B,GAzCA,OAAnBnI,GAGC4D,GAAcA,EAAUhvB,SAG7ByN,GAAON,KAAP,iBAAsBie,EAAtB,sBACAwF,KACAhB,GAAWhoB,QAAUwtB,WAAWD,EAAe9R,KAkCxC,WACLuN,QAGD,CAAC5B,IAGF,eAAC,IAAD,WACE,cAAC,GAAD,CACEzzB,QAAS+nB,GACT9nB,iBAAkBA,EAFpB,SAIE,cAAC,GAAD,CACEA,iBAAkBA,EAClB6T,KAAM2f,EACNnD,oBAAkB,EAClBhW,YAAU,EACVI,aAAc0Z,OAGlB,cAAC,IAAD,CAAO98B,UAAU,OAAjB,SACE,eAAC,IAAD,CAAcqC,UAAW,CAACC,KAAM,CAACrD,MAAO,CAACsD,MAAO,UAAhD,qEAC0D,uBAAK,uBAC7D,uIAGJ,cAAC,GAAD,CACE4jB,oBAAqBA,GACrBuC,4BAzgB8B,SAAC8Z,GACnCjF,GAAuBiF,GACvB1/B,EAAeo4B,GAAD,UAAoCsH,KAwgB9Cla,8BAA+BA,GAC/BjM,gBAAiBA,EACjBkc,eAAgBA,EAChBhI,aAAcoN,GACdlF,WAAYA,EACZD,YAAaA,GACbhI,qBAAsBA,GACtBxK,eAAgBA,EAChBrd,iBAAkBA,EAClB+vB,cAAeA,EACfrQ,mBAAoBA,EACpBoI,aAAcA,GACdlI,uBAtjByB,SAACxoB,GAC9B67B,EAAkB77B,GAClB+C,EAAei4B,GAAD,UAA+Bh7B,IAC7C+9B,MAojBItV,kBAxgBoB,SAACzoB,GACzBs8B,EAAiBt8B,GACjB+C,EAAek4B,GAAD,UAA0Bj7B,IACxC+9B,MAsgBIrV,2BAngB6B,SAACga,GAClCxG,EAAsBwG,GACtB3/B,EAAem4B,GAAD,UAAmCwH,KAkgB7C9Z,sCAphBwC,SAAC+Z,GAC7ClF,GAAiCkF,GACjC5/B,EAAeq4B,GAAD,UAAqCuH,KAmhB/C9Z,mBAhhBqB,SAACjnB,GAC1B+5B,EAAoB/5B,GACpBmB,EAAes4B,GAAD,UAAiCz5B,EAAQ,OAAS,WA+gB5DknB,QAriBU,W3B1BhBxN,GAAOW,IACPX,GAAOY,IACPZ,GAAOa,IACPb,GAAOc,I2BQL5Y,EAAkBw3B,IAClBx3B,EAAkBy3B,IAClBz3B,EAAkB03B,IAClB13B,EAAkB23B,IAClB33B,EAAkB43B,IAClB53B,EAAkB63B,IAElBQ,EVjJ2C,KUkJ3CS,EVjJsC,GUkJtCJ,EV/I+C,IUgJ/CsB,GVlJqD,KUmJrDC,GVlJgE,GUmJhE9B,GVvJ8C,GU6J9CoC,KACAxC,EAAQ,CACN/gB,QAAS,wDACTqR,cAAe,gBAAE7rB,EAAF,EAAEA,KAAF,OAAY,cAAC,KAAD,CAAOA,KAAMA,MACvCs/B,KAASC,SA+hBRthB,YAAaA,GACbC,eAAgBA,GAChBzB,KAAMA,EACN6Q,eAAgBA,GAChBH,SAAUA,GACVgK,WAAYA,GACZC,oBAAqBA,GACrBC,QAASA,GACTE,iBAAkBA,GAClBC,0BAA2BA,GAC3BC,cAAeA,KAGjB,cAAC,IAAD,CAAOx3B,UAAU,OAAjB,SACE,cAAC,GAAD,CACEk5B,wBAjhBwB,SAACmB,GAC/B0D,KAEAj7B,EAAeo4B,GAAD,UAAoCb,EAAWlU,sBAC7DrjB,EAAeq4B,GAAD,UAAqCd,EAAW/R,gCAC9DxlB,EAAem4B,GAAD,UAAmCZ,EAAWhS,qBAC5DvlB,EAAes4B,GAAD,UAAiCf,EAAW1xB,iBAAmB,OAAS,UACtF7F,EAAei4B,GAAD,UAA+BV,EAAWrU,iBACxDljB,EAAek4B,GAAD,UAA0BX,EAAW3B,gBAEnDxa,GAAwB,CACtB5B,WAAY+d,EAAW/d,WACvBD,gBAAiBge,EAAWhe,gBAC5B2B,YAAaqc,EAAWrc,YACxBC,eAAgBoc,EAAWpc,iBAG7B7e,SAASC,SAASsjC,UAigBZxJ,mBA9fmB,WAczB,MAbwC,CACtCyJ,UAAW,IAAIC,MAAQC,cACvBzmB,gBAAiBA,GAAmB,EACpC1T,mBACAqd,iBACAqC,qBACAqQ,gBACAvS,uBACAmC,iCACAtK,eACAC,kBACA3B,uBC7POymB,GAAsD,CACjE,KAAQ,GAAGpsB,KAAY,SAACiH,GAAD,OAA0BD,GAAqBC,MACtE,OAAU,CACR,0WACA,2WACAjH,KAAY,SAACiH,GAAD,OAA0BD,GAAqBC,MAC7D,MAAS,CACP,0WACA,0WACA,0WACA,2WAIAjH,KAAY,SAACiH,GAAD,OAA0BD,GAAqBC,O,oBC2JhDolB,OA/If,SAAmC1iC,GACjC,IACE2iC,EAaE3iC,EAbF2iC,QACA/L,EAYE52B,EAZF42B,WACA1G,EAWElwB,EAXFkwB,qBACAC,EAUEnwB,EAVFmwB,aACA2G,EASE92B,EATF82B,QACAmB,EAQEj4B,EARFi4B,eACA2K,EAOE5iC,EAPF4iC,oBACAv6B,EAMErI,EANFqI,iBACAya,EAKE9iB,EALF8iB,aACA+f,EAIE7iC,EAJF6iC,qBACAC,EAGE9iC,EAHF8iC,oBACAxa,EAEEtoB,EAFFsoB,mBAZF,EAcItoB,EADFm3B,wBAbF,MAaqB,SAAC1nB,KAbtB,EAgBM4oB,EACJ,cAAC,IAAD,CAAOx4B,aAAa,OAAOH,UAAU,OAArC,SACE,cAAC,GAAD,CACEswB,WAAYiI,EACZ9H,aAAcA,EACdD,qBAAsBA,EACtBI,WAAW,kBACXC,mBAAmB,eAKnBwS,EAAmBJ,EAAQtsB,KAAI,SAAC5G,EAAgB0M,GAAjB,OACnC,cAAC,IAAD,CAEE7c,QAAQ,eACRQ,YAAY,MACZD,aAAa,MAJf,SAME,eAAC,KAAD,CACEJ,KAAM2rB,KAAY3B,QAClBxC,MAAOC,KAAamE,KACpBzpB,KAAMua,IAAgBymB,EAAsBxb,KAAYsF,QAAUtF,KAAYmS,UAC9E16B,QAAS,WACPikC,EAAoB3mB,IALxB,iBAQOA,MAbFA,MAkBH6mB,EACJ,cAAC,IAAD,CAAOtjC,UAAU,OAAOG,aAAa,OAArC,SACE,cAAC,KAAD,CACE+X,MAAO,iBAAM,qCADf,SAGE,cAAC,IAAD,UACGmrB,QAMHxX,EACJ,cAAC,KAAD,UACE,cAAC,IAAD,UACE,cAAC,KAAD,CACEC,QAASnjB,EAETghB,SAAU,SAAAoC,GAAC,OAAInD,EAAmBmD,EAAE1lB,OAAOylB,UAC3CE,eAAgBC,KAAgB9kB,MAJlC,SAME,eAAC,GAAD,WACE,cAAC,IAAD,CAAO/G,YAAY,MAAnB,SACE,wDAEF,cAAC,GAAD,CACEinB,KAAK,iEAQXkc,EAA4D,CAChE,OAAU,EACV,MAAS,EACT,KAAQ,GASJC,EACJ,cAAC,IAAD,UACE,cAAC,KAAD,CAAatrB,MAAM,qBAAnB,SACE,eAAC,KAAD,CACEnS,KAAM09B,KAAkBC,MACxB3jC,KAAM4jC,KAAkB5Z,QACxB6Z,SAAUL,EAAqBngB,GAC/BjkB,QAAS,SAAC0kC,EAAQ5vB,GAbI,IAAC6vB,EAcrBX,GAdqBW,EAcsB7vB,EAZV/B,OAAOC,KAAKoxB,GACpCO,MAMb,UAQE,cAAC,KAAD,qBACA,cAAC,KAAD,2BAMR,OACE,qCACGnL,EAED,eAAC,IAAD,CACE/4B,QAAQ,OACRiB,cAAc,MACdhB,WAAW,WAHb,UAKE,cAAC,IAAD,CAAOO,YAAY,OAAnB,SACGojC,IAEH,cAAC,IAAD,CAAOrjC,aAAa,MAApB,SACG0rB,OAIJyX,EAED,cAAC,GAAD,CACErM,qBAAqB,0BACrBC,WAAYA,EACZE,QAASA,EACTK,iBAAkBA,EAClBpC,UAAQ,QC/IV0O,GAAuB,aACvBC,GAA2B,WAC3BC,GAAyBnhB,GAwKhBohB,OAtKf,WACE,IAAO5I,EAAWC,cAAXD,QAED6I,EAAwB3vB,iBAAsB,MAC9C4vB,EAAyB,SAACnG,EAAmCruB,GACjEu0B,EAAsBpvB,QAAUnF,GAGlC,EAAgDtJ,oBAAkB,GAAlE,mBAAOqC,EAAP,KAAyB+yB,EAAzB,KAEA,EAAsDp1B,mBACpDzC,EAAkBkgC,GAjBK,IAgBzB,mBAAOb,EAAP,KAA4BmB,EAA5B,KAIA,EAAsD/9B,mBA4IxD,WAEE,IAAMg+B,E7DhK4B,SAAC3hC,EAAcmB,GACjD,IAAMC,EAA6BrB,EAAeC,GAClD,OAAoB,OAAhBoB,EACKD,EAEFC,E6D2JyCwgC,CAC9CP,GACAC,IAEF,GAAI,CAACnhB,GAA6BD,IAA8Bjc,SAAS09B,GACvE,OAAOA,EAET,OAAOL,GArJ6EO,IAApF,mBAAO1H,EAAP,KAA4B2H,EAA5B,KAEMC,EAA2C,CAC/C3B,GAAajG,GAvBU,IA0BzB,EAAoDx2B,mBAAwB,MAA5E,mBAAOq+B,EAAP,KAA2BC,EAA3B,KACA,EAAgEt+B,mBAAiB,GAAjF,mBAAOu+B,EAAP,KAAiCC,EAAjC,KACA,EAA0Dx+B,mBAAqBo+B,GAA/E,mBAAOK,EAAP,KAA8BC,EAA9B,KACA,EAA8C1+B,mBAC5C4L,OAAOqb,OACLnR,GAAiB,CACfE,WAAYooB,EACZroB,gBAAiB,EACjBE,aAAc6nB,MALpB,mBAAOa,EAAP,KAAwBC,EAAxB,KAUMC,EAAgC3wB,iBAA8B,MAE9DoG,EAASR,GAAc,CAAEC,QAAS,iBAGlC+qB,EAAqB,oBAAgBP,GAErCQ,EAA8B,WAClCzqB,EAAON,KAAP,2BAAgCuqB,EAAhC,oBACAD,EAAsBT,EAAsBpvB,SAC5C+vB,EAA4BD,EAA2B,IAGnDS,EAA4B,WAChC1qB,EAAON,KAAK,kDACkC,OAA1C6qB,EAA8BpwB,UAGlCqpB,aAAa+G,EAA8BpwB,SAC3CowB,EAA8BpwB,QAAU,OAGpCwwB,EAAyC,SAACjD,GAC9C1nB,EAAON,KAAP,mCACAgrB,IACAH,EAA8BpwB,QAAUwtB,WAAWD,EArBbkD,OA4BlC/N,EAAmB,SAAC9B,GACxB/a,EAAON,KAAK,kBAAmBqb,GAE/B,IAAM8P,EAAgC,CAAC9P,GAEvCqP,EAAyBS,GAEzBP,EAAmBhzB,OAAOqb,OACxBnR,GAAiB,CACfE,WAAYmpB,EACZppB,gBAAiB,EACjBE,aAAc6nB,MAIlBD,EAAsBpvB,QAAU,KAChC6vB,EAAsB,MACtBE,EAA4BD,EAA2B,GAEvDU,EAAuCF,GAEvC/J,EAAQ,CACN/gB,QAAS,2DACTqR,cAAe,gBAAE7rB,EAAF,EAAEA,KAAF,OAAY,cAAC,KAAD,CAAOA,KAAMA,MACvCs/B,KAASC,SA0Bd,OARAx4B,qBAAU,WAER,OADAy+B,EAAuCF,GAChC,WACLC,OAGD,CAACT,IAGF,eAAC,IAAD,WACE,cAAC,GAAD,CACEn8B,QAAS08B,EACTz8B,iBAAkBA,EAFpB,SAIE,cAAC,GAAD,CACEA,iBAAkBA,EAClB6T,KAAMyoB,EACN7hB,aAAc0Z,EACd9D,oBAAkB,EAClBhW,YAAU,MAGd,cAAC,IAAD,CAAOhjB,UAAU,OAAjB,SACE,eAAC,IAAD,CAAcqC,UAAW,CAACC,KAAM,CAACrD,MAAO,CAACsD,MAAO,UAAhD,gEACqD,uBAAK,uBACxD,oHAGJ,cAAC,GAAD,CACE0gC,QAASF,GAAajG,GACtB5F,WAAY6N,EAAsB,GAClC3N,QAASuN,EACTnU,qBAtGkCgV,KAuGlC/U,aAAc2U,EACd7M,eAAgBsM,EAChBl8B,iBAAkBA,EAClBu6B,oBAAqBA,EACrB9f,aAAc0Z,EACdqG,qBA/CuB,SAACv9B,GAC5B6+B,EAAuB7+B,GACvBy+B,EA1GuB,GA2GvB5M,EAAiBsL,GAAan9B,GA3GP,IA4GvB9C,EAAekhC,GAA0Bp+B,GACzC9C,EAAeihC,GAAD,UA7GS,KAwJnBtM,iBAAkBA,EAClB2L,oBAvDsB,SAACnvB,GAC3BowB,EAAuBpwB,GACvBwjB,EAAiBsL,GAAajG,GAAqB7oB,IACnDnR,EAAeihC,GAAD,UAA0B9vB,KAqDpC2U,mBAvFqB,SAACjnB,GAC1B+5B,EAAoB/5B,U,UC5ElB+jC,GAAqB,UAErBC,GAAmC,CACvCC,UAAW,YACXC,UAAW,YACXC,OAAQ,UAGJC,GAA2B,CAC/B1+B,YAAa,EACb0gB,aAAc,EACdte,SAAU,UAGNu8B,GAA+B,CACnC3+B,YAAa,EACb0gB,aAAc,EACdF,WAAY,EACZC,cAAe,GAGXme,GAAwB,CAC5BvlC,WAAY,EACZN,YAAa,EACbiH,YAAa,OACb0gB,aAAc,QA4EhB,IAAMme,GAAW,SAAC5lC,GAChB,IAAO6lC,EAAe7lC,EAAf6lC,KAAM3lC,EAASF,EAATE,MACb,OACE,eAAC,IAAD,CACEZ,QAAQ,OACRiB,cAAc,MACdhB,WAAW,SAHb,UAKE,cAAC,IAAD,CACED,QAAS,CAAC,OAAQ,OAAQ,QAC1BQ,YAAa,CAAC,IAAK,IAAK,OACxBS,cAAc,MACdhB,WAAW,SAJb,SAMGsmC,IAEH,cAAC,IAAD,UACG3lC,QAMM4lC,GAhGf,WACE,IAAIC,EAAmB3jC,EAAegjC,KAAuBC,GAASC,UACjED,GAASxY,eAAekZ,KAC3BA,EAAWV,GAASC,WAGtB,MAA4Ct/B,mBAA0B+/B,GAAtE,mBAAOC,EAAP,KAAuBC,EAAvB,KAOA,OACE,eAAC,IAAD,CACElkC,UAAW,CACTmkC,OAAQ,CAAEvnC,MAAO8mC,IACjBU,WAAY,CAAExnC,MAAO+mC,IACrBU,IAAK,CAAEznC,MAAOgnC,KAEhBtc,SAZgB,SAAC,GAA2C,IAAzCgd,EAAwC,EAAxCA,UACrBJ,EAAkBI,GAClB7jC,EAAe4iC,GAAD,UAAwBiB,KAWpCA,UAAWL,EAPb,UASE,cAAC,IAAD,CAEE9lC,MACE,cAAC,GAAD,CACE2lC,KAAM,cAAC,KAAD,CAAOpmC,KAAM,KACnBS,MAAM,sBALZ,SASE,cAAC,EAAD,UACE,cAAC,GAAD,OATGmlC,GAASC,WAahB,cAAC,IAAD,CAEEplC,MACE,cAAC,GAAD,CACE2lC,KAAM,cAAC,KAAD,CAAcpmC,KAAM,KAC1BS,MAAM,sBALZ,SASE,cAAC,EAAD,UACE,cAAC,GAAD,OATGmlC,GAASE,WAahB,cAAC,IAAD,CAEErlC,MACE,cAAC,GAAD,CACE2lC,KAAM,cAAC,IAAD,CAAgBpmC,KAAM,KAC5BS,MAAM,mBALZ,SASE,cAAC,EAAD,UACE,cAAC,GAAD,OATGmlC,GAASG,YCpFPc,OANf,WACE,OACE,cAAC,GAAD,KCeWC,OAdf,WACE,OACE,cAAC,IAAD,UACE,cAAC,EAAD,UACE,cAAC,IAAD,UACE,cAAC,IAAD,CAAOplC,KAAM,CAACD,EAAYC,MAAOqlC,OAAK,EAAtC,SACE,cAAC,GAAD,aCTZC,IAASC,OACP,cAAC,IAAMC,WAAP,UACE,cAAC,GAAD,MAEF7nC,SAAS8nC,eAAe,W","file":"static/js/main.91bb658b.chunk.js","sourcesContent":["export const APP_BASE_PATH = '/self-parking-car-evolution';\r\n","import React from 'react';\r\nimport { H5, Paragraph3 } from 'baseui/typography';\r\nimport { StyledLink } from 'baseui/link';\r\nimport { GiDna2 } from 'react-icons/all';\r\nimport { APP_BASE_PATH } from '../../constants/app';\r\n\r\nfunction Header() {\r\n  const onClick = () => {\r\n    document.location.href = APP_BASE_PATH;\r\n  };\r\n\r\n  return (\r\n    <div style={{ margin: '30px 0' }}>\r\n      <StyledLink\r\n        onClick={onClick}\r\n        style={{ textDecoration: 'none', cursor: 'pointer' }}\r\n      >\r\n        <H5\r\n          $style={{\r\n            fontWeight: 800,\r\n            textTransform: 'uppercase',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            flexWrap: 'wrap',\r\n            margin: '0',\r\n          }}\r\n        >\r\n          Self-Parking Car <GiDna2 size={30} style={{ margin: '0 10px' }} /> Evolution\r\n        </H5>\r\n      </StyledLink>\r\n      <Paragraph3 $style={{ marginTop: '5px' }}>\r\n        Training the car to do self-parking using genetic algorithm\r\n      </Paragraph3>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default Header;\r\n","\r\nexport const GITHUB_LINK = 'https://github.com/Mykyta-lab/self-parking-car-evolution';\r\n","import React, { CSSProperties } from 'react';\r\nimport { StyledLink } from 'baseui/link';\r\nimport { SiGithub } from 'react-icons/all';\r\nimport { GITHUB_LINK } from '../../constants/links';\r\n\r\nfunction MainNav() {\r\n  const linkStyle: CSSProperties = {\r\n    display: 'flex',\r\n    alignItems: 'center',\r\n    marginRight: '20px',\r\n    marginBottom: '10px',\r\n  };\r\n\r\n  const iconStyle: CSSProperties = {\r\n    marginRight: '5px',\r\n  };\r\n\r\n  return (\r\n    <nav style={{ display: 'flex', marginBottom: '20px' }}>\r\n      <StyledLink href={GITHUB_LINK} style={linkStyle}>\r\n        <SiGithub style={iconStyle} /> Source-code\r\n      </StyledLink>\r\n    </nav>\r\n  );\r\n}\r\n\r\nexport default MainNav;\r\n","import React from 'react';\r\nimport { Block } from 'baseui/block';\r\nimport { FaGithub, FaTwitter, RiFilePaper2Fill } from 'react-icons/all';\r\nimport { IconType } from 'react-icons/lib';\r\n\r\nimport { GITHUB_LINK } from '../../constants/links';\r\n\r\nfunction Footer() {\r\n  return (\r\n    <Block\r\n      marginBottom=\"50px\"\r\n      marginTop=\"50px\"\r\n      display=\"flex\"\r\n      flexDirection=\"row\"\r\n      justifyContent=\"center\"\r\n    >\r\n      <IconLink\r\n        url={GITHUB_LINK}\r\n        title=\"Project on GitHub\"\r\n        Icon={FaGithub}\r\n      />\r\n    </Block>\r\n  );\r\n}\r\n\r\ntype IconLinkProps = {\r\n  url: string,\r\n  title: string,\r\n  Icon: IconType,\r\n};\r\n\r\nfunction IconLink(props: IconLinkProps) {\r\n  const {url, title, Icon} = props;\r\n  return (\r\n    <Block marginLeft=\"10px\" marginRight=\"10px\">\r\n      <a href={url} style={{color: 'black'}} title={title}>\r\n        <Icon size={20} />\r\n      </a>\r\n    </Block>\r\n  );\r\n}\r\n\r\nexport default Footer;\r\n","import React from 'react';\r\nimport { Client as Styletron } from 'styletron-engine-atomic';\r\nimport { Provider as StyletronProvider } from 'styletron-react';\r\nimport { BaseProvider, LightTheme } from 'baseui';\r\nimport { Cell, Grid } from 'baseui/layout-grid';\r\nimport { SnackbarProvider } from 'baseui/snackbar';\r\n\r\nimport './Layout.css';\r\nimport Header from './Header';\r\nimport MainNav from './MainNav';\r\nimport Footer from './Footer';\r\n\r\nconst engine = new Styletron();\r\n\r\ntype LayoutProps = {\r\n  children: React.ReactNode,\r\n};\r\n\r\nfunction Layout(props: LayoutProps) {\r\n  const { children } = props;\r\n  return (\r\n    <StyletronProvider value={engine}>\r\n      <BaseProvider theme={LightTheme}>\r\n        <SnackbarProvider>\r\n          <Grid>\r\n            <Cell span={[4, 8, 12]}>\r\n              <Header />\r\n              <MainNav />\r\n            </Cell>\r\n            <Cell span={[4, 8, 12]}>\r\n              {children}\r\n            </Cell>\r\n            <Cell span={[4, 8, 12]}>\r\n              <Footer />\r\n            </Cell>\r\n          </Grid>\r\n        </SnackbarProvider>\r\n      </BaseProvider>\r\n    </StyletronProvider>\r\n  );\r\n}\r\n\r\nexport default Layout;\r\n","type RouteID = 'home';\r\n\r\ntype Route = {\r\n  path: string,\r\n};\r\n\r\ntype Routes = Record<RouteID, Route>;\r\n\r\nexport const routes: Routes = {\r\n  home: {\r\n    path: '/',\r\n  },\r\n};\r\n","import React, { ErrorInfo } from 'react';\r\nimport { Notification, KIND } from 'baseui/notification';\r\n\r\ntype Props = {\r\n  children: React.ReactNode,\r\n};\r\n\r\ntype State = {\r\n  hasError: boolean,\r\n};\r\n\r\nclass ErrorBoundary extends React.Component<Props, State> {\r\n  constructor(props: Props) {\r\n    super(props);\r\n    this.state = {\r\n      hasError: false,\r\n    };\r\n  }\r\n\r\n  static getDerivedStateFromError(): State {\r\n    // Update state so the next render will show the fallback UI.\r\n    return {\r\n      hasError: true,\r\n    };\r\n  }\r\n\r\n  componentDidCatch(error: Error, errorInfo: ErrorInfo): void {\r\n    // You can also log the error to an error reporting service.\r\n    // eslint-disable-next-line no-console\r\n    console.error(error, errorInfo);\r\n    this.setState({ hasError: true });\r\n  }\r\n\r\n  render(): React.ReactNode {\r\n    const { children } = this.props;\r\n    const { hasError } = this.state;\r\n\r\n    if (hasError) {\r\n      // You can render any custom fallback UI\r\n      return (\r\n        <Notification\r\n          kind={KIND.negative}\r\n          overrides={{\r\n            Body: {style: {width: 'auto'}},\r\n          }}\r\n        >\r\n          Component has crashed\r\n        </Notification>\r\n      );\r\n    }\r\n\r\n    return children;\r\n  }\r\n}\r\n\r\nexport default ErrorBoundary;\r\n","export const getSearchParam = (name: string): string | null => {\r\n  const searchParams = getSearchParams();\r\n  return searchParams.get(name);\r\n};\r\n\r\nexport const setSearchParam = (name: string, value: string): void => {\r\n  const searchParams = getSearchParams();\r\n  searchParams.set(name, value);\r\n  const relativeURL = '?' + searchParams.toString() + document.location.hash;\r\n  window.history.pushState(null, '', relativeURL);\r\n};\r\n\r\nexport const deleteSearchParam = (name: string): void => {\r\n  const searchParams = getSearchParams();\r\n  searchParams.delete(name);\r\n  const relativeURL = '?' + searchParams.toString() + document.location.hash;\r\n  window.history.pushState(null, '', relativeURL);\r\n};\r\n\r\nconst getSearchParams = (): URLSearchParams => {\r\n  const searchQuery = document.location.search.substring(1);\r\n  return new URLSearchParams(searchQuery);\r\n};\r\n\r\nexport const getStringSearchParam = (name: string, defaultValue: string): string => {\r\n  const searchParam: string | null = getSearchParam(name);\r\n  if (searchParam === null) {\r\n    return defaultValue;\r\n  }\r\n  return searchParam;\r\n};\r\n\r\nexport const getIntSearchParam = (name: string, defaultValue: number): number => {\r\n  const searchParam: string | null = getSearchParam(name);\r\n  if (searchParam === null) {\r\n    return defaultValue;\r\n  }\r\n  return parseInt(searchParam);\r\n};\r\n\r\nexport const getFloatSearchParam = (name: string, defaultValue: number): number => {\r\n  const searchParam: string | null = getSearchParam(name);\r\n  if (searchParam === null) {\r\n    return defaultValue;\r\n  }\r\n  return parseFloat(searchParam);\r\n};\r\n\r\nexport const getBooleanSearchParam = (name: string, defaultValue: boolean): boolean => {\r\n  const searchParam: string | null = getSearchParam(name);\r\n  if (searchParam === null) {\r\n    return defaultValue;\r\n  }\r\n  return searchParam.toLowerCase() === 'true' ? true : false;\r\n};\r\n","// @see: https://developer.mozilla.org/en-US/docs/Web/API/CustomEvent/CustomEvent\r\n\r\ntype CarEvent = 'engineforward' | 'enginebackward' | 'engineneutral' | 'wheelsleft' | 'wheelsright' | 'wheelsstraight' | 'pressbreak' | 'releasebreak';\r\n\r\ntype CarEvents = Record<string, CarEvent>;\r\n\r\nexport const carEvents: CarEvents = {\r\n  engineForward: 'engineforward',\r\n  engineBackward: 'enginebackward',\r\n  engineNeutral: 'engineneutral',\r\n  wheelsLeft: 'wheelsleft',\r\n  wheelsRight: 'wheelsright',\r\n  wheelsStraight: 'wheelsstraight',\r\n  pressBreak: 'pressbreak',\r\n  releaseBreak: 'releasebreak',\r\n};\r\n\r\nexport const trigger = (eventType: CarEvent, data: any = {}) => {\r\n  const event = new CustomEvent(eventType, { detail: data });\r\n  document.dispatchEvent(event);\r\n};\r\n\r\nexport const on = (eventType: CarEvent, listener: (evt: Event) => void) => {\r\n  document.addEventListener(eventType, listener);\r\n};\r\n\r\nexport const off = (eventType: CarEvent, listener: (evt: Event) => void) => {\r\n  document.removeEventListener(eventType, listener);\r\n};\r\n","import React from 'react';\r\nimport throttle from 'lodash/throttle';\r\nimport ReactNipple from 'react-nipple';\r\n\r\nimport { carEvents, trigger } from '../utils/events';\r\n\r\nfunction CarJoystickController() {\r\n  const nippleSize = 100;\r\n  const delta = 30;\r\n  const throttleTimeout = 250;\r\n\r\n  const onMove = (event: any, data: any) => {\r\n    const angle = data.angle.degree;\r\n    if (angle < (90 - delta) || angle > (270 + delta)) {\r\n      trigger(carEvents.wheelsRight);\r\n    } else if (angle > (90 + delta) && angle < (270 - delta)) {\r\n      trigger(carEvents.wheelsLeft);\r\n    }\r\n    if (angle > delta && angle < (180 - delta)) {\r\n      trigger(carEvents.engineForward);\r\n    } else if (angle > (180 + delta) && angle < (360 - delta)) {\r\n      trigger(carEvents.engineBackward);\r\n    }\r\n  };\r\n\r\n  const onMoveThrottled = throttle(onMove, throttleTimeout, {\r\n    leading: false,\r\n    trailing: true,\r\n  });\r\n\r\n  const onEnd = (event: any, data: any) => {\r\n    trigger(carEvents.releaseBreak);\r\n    trigger(carEvents.engineNeutral);\r\n    trigger(carEvents.wheelsStraight);\r\n  };\r\n\r\n  const onEndThrottled = throttle(onEnd, throttleTimeout + 10, {\r\n    leading: false,\r\n    trailing: true,\r\n  });\r\n\r\n  return <ReactNipple\r\n    style={{\r\n      width: nippleSize,\r\n      height: nippleSize,\r\n      marginTop: -nippleSize - 20,\r\n      marginLeft: `calc(50% - ${Math.floor(nippleSize / 2)}px)`,\r\n      position: 'absolute',\r\n    }}\r\n    // @see: https://github.com/yoannmoinet/nipplejs#options\r\n    options={{\r\n      dynamicPage: true,\r\n      color: 'white',\r\n      mode: 'static',\r\n      size: nippleSize,\r\n      position: { top: '50%', left: '50%' },\r\n    }}\r\n    // @see: https://github.com/yoannmoinet/nipplejs#start\r\n    onMove={onMoveThrottled}\r\n    onEnd={onEndThrottled}\r\n  />\r\n}\r\n\r\nexport default CarJoystickController;\r\n","import { useCallback, useEffect, useState } from 'react';\r\n\r\nexport function useKeyPress(target: string[]): boolean {\r\n  const [keyPressed, setKeyPressed] = useState(false)\r\n\r\n  const downHandler = ({ key }: KeyboardEvent) => {\r\n    if (target.includes(key)) {\r\n      setKeyPressed(true);\r\n    }\r\n  };\r\n\r\n  const downHandlerCallback = useCallback(downHandler, [target]);\r\n\r\n  const upHandler = ({ key }: KeyboardEvent) => {\r\n    if (target.includes(key)) {\r\n      setKeyPressed(false);\r\n    }\r\n  };\r\n\r\n  const upHandlerCallback = useCallback(upHandler, [target]);\r\n\r\n  useEffect(() => {\r\n    window.addEventListener('keydown', downHandlerCallback)\r\n    window.addEventListener('keyup', upHandlerCallback)\r\n    return () => {\r\n      window.removeEventListener('keydown', downHandlerCallback)\r\n      window.removeEventListener('keyup', upHandlerCallback)\r\n    }\r\n  }, [upHandlerCallback, downHandlerCallback]);\r\n\r\n  return keyPressed;\r\n}\r\n","export const WORLD_CONTAINER_HEIGHT = 400;\r\nexport const WIDER_CAMERA_SCREEN_MAX_WIDTH = 600;\r\n","import { Paragraph4 } from 'baseui/typography';\r\nimport React, { useEffect } from 'react';\r\n\r\nimport { useKeyPress } from '../../../hooks/useKeyPress';\r\nimport { trigger, carEvents } from '../utils/events';\r\nimport { Block } from 'baseui/block';\r\nimport { WORLD_CONTAINER_HEIGHT } from '../constants/world';\r\n\r\nfunction CarKeyboardController() {\r\n  // const forward = useKeyPress(['w', 'ArrowUp']);\r\n  // const backward = useKeyPress(['s', 'ArrowDown']);\r\n  // const left = useKeyPress(['a', 'ArrowLeft']);\r\n  // const right = useKeyPress(['d', 'ArrowRight']);\r\n  // const brake = useKeyPress([' ']);\r\n\r\n  const forward = useKeyPress(['w']);\r\n  const backward = useKeyPress(['s']);\r\n  const left = useKeyPress(['a']);\r\n  const right = useKeyPress(['d']);\r\n  const brake = useKeyPress([' ']);\r\n\r\n  useEffect(() => {\r\n    // Left-right.\r\n    if (left && !right) {\r\n      trigger(carEvents.wheelsLeft);\r\n    } else if (right && !left) {\r\n      trigger(carEvents.wheelsRight);\r\n    } else {\r\n      trigger(carEvents.wheelsStraight);\r\n    }\r\n\r\n    // Front-back.\r\n    if (forward && !backward) {\r\n      trigger(carEvents.engineForward);\r\n    } else if (backward && !forward) {\r\n      trigger(carEvents.engineBackward);\r\n    } else {\r\n      trigger(carEvents.engineNeutral);\r\n    }\r\n\r\n    // Break.\r\n    if (brake) {\r\n      trigger(carEvents.pressBreak);\r\n    }\r\n    if (!brake) {\r\n      trigger(carEvents.releaseBreak);\r\n    }\r\n  }, [forward, backward, left, right, brake]);\r\n\r\n  return (\r\n    <Block\r\n      position=\"relative\"\r\n      marginTop={`${-WORLD_CONTAINER_HEIGHT}px`}\r\n      paddingLeft=\"15px\"\r\n    >\r\n      <Paragraph4 $style={{color: 'white'}}>\r\n        {/*<code>WASD</code> or <code>↑→↓←</code> to drive. <code>SPACE</code> to break.*/}\r\n        <code>WASD</code> keys to drive. <code>SPACE</code> to break.\r\n      </Paragraph4>\r\n    </Block>\r\n  );\r\n}\r\n\r\nexport default CarKeyboardController;\r\n","import * as React from 'react';\r\n\r\nimport './FadeIn.css';\r\n\r\ntype FadeInProps = {\r\n  children: React.ReactNode,\r\n};\r\n\r\nfunction FadeIn(props: FadeInProps) {\r\n  const {children} = props;\r\n  return (\r\n    <div className=\"component-fade-in\">\r\n      {children}\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default FadeIn\r\n","import React, { useState } from 'react';\r\nimport { Canvas } from '@react-three/fiber';\r\nimport { OrbitControls, Stats, Environment, AdaptiveDpr, PerspectiveCamera } from '@react-three/drei';\r\nimport { Physics } from '@react-three/cannon';\r\nimport * as THREE from 'three';\r\nimport { styled, withStyle } from 'baseui';\r\nimport { StyledSpinnerNext } from 'baseui/spinner';\r\nimport { Block } from 'baseui/block';\r\n\r\nimport CarJoystickController from './controllers/CarJoystickController';\r\nimport CarKeyboardController from './controllers/CarKeyboardController';\r\nimport { WIDER_CAMERA_SCREEN_MAX_WIDTH, WORLD_CONTAINER_HEIGHT } from './constants/world';\r\nimport FadeIn from '../shared/FadeIn';\r\nimport { getSearchParam } from '../../utils/url';\r\n\r\ntype WorldProps = {\r\n  children: React.ReactNode,\r\n  withJoystickControl?: boolean,\r\n  withKeyboardControl?: boolean,\r\n  version?: string,\r\n  performanceBoost?: boolean, \r\n};\r\n\r\nconst worldBackgroundColor = 'lightblue';\r\n\r\nconst WorldSpinner = withStyle(StyledSpinnerNext, {\r\n  width: '30px',\r\n  height: '30px',\r\n  borderLeftWidth: '6px',\r\n  borderRightWidth: '6px',\r\n  borderTopWidth: '6px',\r\n  borderBottomWidth: '6px',\r\n  borderTopColor: 'black',\r\n});\r\n\r\nconst STAT_SEARCH_PARAM_NAME = 'debug';\r\n\r\nfunction World(props: WorldProps) {\r\n  const {\r\n    children,\r\n    withJoystickControl = false,\r\n    withKeyboardControl = false,\r\n    version = '0',\r\n    performanceBoost = false,\r\n  } = props;\r\n\r\n  const [withStat] = useState<boolean>(!!getSearchParam(STAT_SEARCH_PARAM_NAME));\r\n\r\n  const stats = withStat ? (\r\n    <Stats showPanel={0} />\r\n  ) : null;\r\n\r\n  const preLoader = (\r\n    <div style={{\r\n      display: 'flex',\r\n      justifyContent: 'center',\r\n      alignItems: 'center',\r\n      position: 'absolute',\r\n      width: '100%',\r\n      boxSizing: 'border-box',\r\n      height: `${WORLD_CONTAINER_HEIGHT}px`,\r\n      borderStyle: 'dashed',\r\n      borderColor: 'rgb(220, 220, 220)',\r\n      borderLeftWidth: 0,\r\n      borderRightWidth: 0,\r\n      borderBottomWidth: 0,\r\n      borderTopWidth: 0,\r\n      backgroundColor: worldBackgroundColor,\r\n    }}>\r\n      <FadeIn>\r\n        <WorldSpinner />\r\n      </FadeIn>\r\n    </div>\r\n  );\r\n\r\n  const joystickController = withJoystickControl ? (\r\n    <CarJoystickController />\r\n  ) : null;\r\n\r\n  const keyboardController = withKeyboardControl ? (\r\n    <CarKeyboardController />\r\n  ) : null;\r\n\r\n  const cameraFov = window.innerWidth < WIDER_CAMERA_SCREEN_MAX_WIDTH ? 30 : 25;\r\n\r\n  const environment = performanceBoost ? null : (\r\n    <Environment background={false} preset={'night'} />\r\n  );\r\n\r\n  return (\r\n    <Block position=\"relative\" overflow=\"hidden\" display=\"block\" height={`${WORLD_CONTAINER_HEIGHT}px`}>\r\n      {preLoader}\r\n      <WorldContainer>\r\n        <Canvas shadows key={version}>\r\n          <PerspectiveCamera\r\n            makeDefault\r\n            fov={cameraFov}\r\n            position={[-20, 20, 0]}\r\n          />\r\n          <OrbitControls />\r\n          <color attach=\"background\" args={[worldBackgroundColor]} />\r\n          <hemisphereLight intensity={1} groundColor={new THREE.Color( 0x080820 )} />\r\n          <spotLight\r\n            position={[-10, 20, 10]}\r\n            angle={0.8}\r\n            penumbra={1}\r\n            intensity={1.5}\r\n            shadow-mapSize-width={2048}\r\n            shadow-mapSize-height={2048}\r\n            castShadow\r\n          />\r\n          <Physics\r\n            step={1 / 60}\r\n            gravity={[0, -10, 0]}\r\n            iterations={10}\r\n            defaultContactMaterial={{\r\n              friction: 0.01,\r\n              restitution: 0.01,\r\n              contactEquationRelaxation: 4,\r\n            }}\r\n            broadphase=\"SAP\"\r\n            allowSleep\r\n          >\r\n            {environment}\r\n            {children}\r\n          </Physics>\r\n\r\n          {/* @see: https://docs.pmnd.rs/drei/performance/adaptive-dpr */}\r\n          <AdaptiveDpr pixelated />\r\n        </Canvas>\r\n      </WorldContainer>\r\n      {joystickController}\r\n      {keyboardController}\r\n      {stats}\r\n    </Block>\r\n  );\r\n}\r\n\r\nconst WorldContainer = styled('div', {\r\n  height: `${WORLD_CONTAINER_HEIGHT}px`,\r\n  boxSizing: 'border-box',\r\n  borderStyle: 'dashed',\r\n  borderColor: 'rgb(220, 220, 220)',\r\n  borderWidth: 0,\r\n});\r\n\r\nexport default World;\r\n","import React from 'react';\r\nimport { usePlane, PlaneProps, } from '@react-three/cannon';\r\nimport { NumVec2 } from '../../../types/vectors';\r\n\r\nfunction Ground(props: PlaneProps) {\r\n  const args: NumVec2 = [200, 200];\r\n  const [ref] = usePlane(() => ({\r\n    type: 'Static',\r\n    rotation: [-Math.PI / 2, 0, 0],\r\n    args,\r\n    ...props,\r\n  }))\r\n  return (\r\n    <mesh ref={ref} receiveShadow>\r\n      <planeBufferGeometry args={args} />\r\n      <shadowMaterial color=\"#225380\" opacity={0.4} />\r\n    </mesh>\r\n  )\r\n}\r\n\r\nexport default Ground;\r\n","import { APP_BASE_PATH } from '../../../constants/app';\r\n\r\nexport const MODEL_BASE_PATH = `${APP_BASE_PATH}/models`;\r\n","import { MODEL_BASE_PATH } from '../constants/models';\r\n\r\nexport const getModelPath = (modelFileName: string): string => {\r\n  return `${MODEL_BASE_PATH}/${modelFileName}`;\r\n};\r\n","export type Bit = 0 | 1;\r\n\r\nexport type Bits = Bit[];\r\n\r\nexport type PrecisionConfig = {\r\n  signBitsCount: number,\r\n  exponentBitsCount: number,\r\n  fractionBitsCount: number,\r\n  totalBitsCount: number,\r\n};\r\n\r\nexport type PrecisionConfigs = {\r\n  custom: PrecisionConfig,\r\n  half: PrecisionConfig,\r\n  single: PrecisionConfig,\r\n  double: PrecisionConfig,\r\n};\r\n\r\n/*\r\n  ┌───────────────── sign bit\r\n  │   ┌───────────── exponent bits\r\n  │   │       ┌───── fraction bits\r\n  │   │       │\r\n  X XXXXX XXXXXXXXXX\r\n\r\n  @see: https://trekhleb.dev/blog/2021/binary-floating-point/\r\n */\r\nexport const precisionConfigs: PrecisionConfigs = {\r\n  // Custom-made 10-bits precision for faster evolution progress.\r\n  custom: {\r\n    signBitsCount: 1,\r\n    exponentBitsCount: 4,\r\n    fractionBitsCount: 5,\r\n    totalBitsCount: 10,\r\n  },\r\n  // @see: https://en.wikipedia.org/wiki/Half-precision_floating-point_format\r\n  half: {\r\n    signBitsCount: 1,\r\n    exponentBitsCount: 5,\r\n    fractionBitsCount: 10,\r\n    totalBitsCount: 16,\r\n  },\r\n  // @see: https://en.wikipedia.org/wiki/Single-precision_floating-point_format\r\n  single: {\r\n    signBitsCount: 1,\r\n    exponentBitsCount: 8,\r\n    fractionBitsCount: 23,\r\n    totalBitsCount: 32,\r\n  },\r\n  // @see: https://en.wikipedia.org/wiki/Double-precision_floating-point_format\r\n  double: {\r\n    signBitsCount: 1,\r\n    exponentBitsCount: 11,\r\n    fractionBitsCount: 52,\r\n    totalBitsCount: 64,\r\n  },\r\n};\r\n\r\n// Converts the binary representation of the floating point number to decimal float number.\r\nfunction bitsToFloat(bits: Bits, precisionConfig: PrecisionConfig): number {\r\n  const { signBitsCount, exponentBitsCount } = precisionConfig;\r\n\r\n  // Figuring out the sign.\r\n  const sign = (-1) ** bits[0]; // -1^1 = -1, -1^0 = 1\r\n\r\n  // Calculating the exponent value.\r\n  const exponentBias = 2 ** (exponentBitsCount - 1) - 1;\r\n  const exponentBits = bits.slice(signBitsCount, signBitsCount + exponentBitsCount);\r\n  const exponentUnbiased = exponentBits.reduce(\r\n    (exponentSoFar: number, currentBit: Bit, bitIndex: number) => {\r\n      const bitPowerOfTwo = 2 ** (exponentBitsCount - bitIndex - 1);\r\n      return exponentSoFar + currentBit * bitPowerOfTwo;\r\n    },\r\n    0,\r\n  );\r\n  const exponent = exponentUnbiased - exponentBias;\r\n\r\n  // Calculating the fraction value.\r\n  const fractionBits = bits.slice(signBitsCount + exponentBitsCount);\r\n  const fraction = fractionBits.reduce(\r\n    (fractionSoFar: number, currentBit: Bit, bitIndex: number) => {\r\n      const bitPowerOfTwo = 2 ** -(bitIndex + 1);\r\n      return fractionSoFar + currentBit * bitPowerOfTwo;\r\n    },\r\n    0,\r\n  );\r\n\r\n  // Putting all parts together to calculate the final number.\r\n  return sign * (2 ** exponent) * (1 + fraction);\r\n}\r\n\r\n// Converts the 16-bit binary representation of the floating point number to decimal float number.\r\nexport function bitsToFloat16(bits: Bits): number {\r\n  return bitsToFloat(bits, precisionConfigs.half);\r\n}\r\n\r\n// Converts the 8-bit binary representation of the floating point number to decimal float number.\r\nexport function bitsToFloat10(bits: Bits): number {\r\n  return bitsToFloat(bits, precisionConfigs.custom);\r\n}\r\n","export const linearPolynomial = (coefficients: number[], variables: number[]): number => {\r\n  if (coefficients.length !== (variables.length + 1)) {\r\n    throw new Error(`Incompatible number polynomial coefficients and variables: ${coefficients.length} and ${variables.length}`);\r\n  }\r\n  let result = 0;\r\n  coefficients.forEach((coefficient: number, coefficientIndex: number) => {\r\n    if (coefficientIndex < variables.length) {\r\n      result += coefficient * variables[coefficientIndex];\r\n    } else {\r\n      result += coefficient\r\n    }\r\n  });\r\n  return result;\r\n};\r\n","export const sigmoid = (x: number): number => {\r\n  return 1 / (1 + Math.E ** -x);\r\n};\r\n\r\nexport const sigmoidToCategories = (\r\n  sigmoidValue: number,\r\n  aroundZeroMargin: number = 0.49999, // Value between 0 and 0.5:  [0 ... (0.5 - margin) ... 0.5 ... (0.5 + margin) ... 1]\r\n): -1 | 0 | 1 => {\r\n  if (sigmoidValue < (0.5 - aroundZeroMargin)) {\r\n    return -1;\r\n  }\r\n  if (sigmoidValue > (0.5 + aroundZeroMargin)) {\r\n    return 1;\r\n  }\r\n  return 0;\r\n};\r\n","import { NumVec3 } from '../../types/vectors';\r\n\r\n// Calculates the XZ distance between two points in space.\r\n// The vertical Y distance is not being taken into account.\r\nexport const euclideanDistance = (from: NumVec3, to: NumVec3) => {\r\n  const fromX = from[0];\r\n  const fromZ = from[2];\r\n  const toX = to[0];\r\n  const toZ = to[2];\r\n  return Math.sqrt((fromX - toX) ** 2 + (fromZ - toZ) ** 2);\r\n};\r\n","import { RectanglePoints } from '../types/vectors';\r\nimport { Gene, Genome } from './genetic';\r\nimport { bitsToFloat10, precisionConfigs } from './math/floats';\r\nimport { linearPolynomial } from './math/polynomial';\r\nimport { sigmoid, sigmoidToCategories } from './math/sigmoid';\r\nimport { euclideanDistance } from './math/geometry';\r\n\r\n// Car has 8 distance sensors.\r\nexport const CAR_SENSORS_NUM = 8;\r\n\r\n// Additional formula coefficient that is not connected to a sensor.\r\nexport const BIAS_UNITS = 1;\r\n\r\n// How many genes we need to encode each numeric parameter for the formulas.\r\nexport const GENES_PER_NUMBER = precisionConfigs.custom.totalBitsCount;\r\n\r\n// Based on 8 distance sensors we need to provide two formulas that would define car's behaviour:\r\n// 1. Engine formula (input: 8 sensors; output: -1 (backward), 0 (neutral), +1 (forward))\r\n// 2. Wheels formula (input: 8 sensors; output: -1 (left), 0 (straight), +1 (right))\r\nexport const ENGINE_FORMULA_GENES_NUM = (CAR_SENSORS_NUM + BIAS_UNITS) * GENES_PER_NUMBER;\r\nexport const WHEELS_FORMULA_GENES_NUM = (CAR_SENSORS_NUM + BIAS_UNITS) * GENES_PER_NUMBER;\r\n\r\n// The length of the binary genome of the car.\r\nexport const GENOME_LENGTH = ENGINE_FORMULA_GENES_NUM + WHEELS_FORMULA_GENES_NUM;\r\n\r\ntype LossParams = {\r\n  wheelsPosition: RectanglePoints,\r\n  parkingLotCorners: RectanglePoints,\r\n};\r\n\r\n// Loss function calculates how far the car is from the parking lot\r\n// by comparing the wheels positions with parking lot corners positions.\r\nexport const carLoss = (params: LossParams): number => {\r\n  const { wheelsPosition, parkingLotCorners } = params;\r\n\r\n  const {\r\n    fl: flWheel,\r\n    fr: frWheel,\r\n    br: brWheel,\r\n    bl: blWheel,\r\n  } = wheelsPosition;\r\n\r\n  const {\r\n    fl: flCorner,\r\n    fr: frCorner,\r\n    br: brCorner,\r\n    bl: blCorner,\r\n  } = parkingLotCorners;\r\n\r\n  const flDistance = euclideanDistance(flWheel, flCorner);\r\n  const frDistance = euclideanDistance(frWheel, frCorner);\r\n  const brDistance = euclideanDistance(brWheel, brCorner);\r\n  const blDistance = euclideanDistance(blWheel, blCorner);\r\n\r\n  return (flDistance + frDistance + brDistance + blDistance) / 4;\r\n};\r\n\r\nexport const carLossToFitness = (loss: number, alpha: number = 1): number => {\r\n  return 1 / (alpha * loss + 1);\r\n};\r\n\r\nexport type SensorValues = number[];\r\n\r\nexport type FormulaCoefficients = number[];\r\n\r\nexport type FormulaResult = -1 | 0 | 1;\r\n\r\ntype DecodedGenome = {\r\n  engineFormulaCoefficients: FormulaCoefficients,\r\n  wheelsFormulaCoefficients: FormulaCoefficients,\r\n}\r\n\r\nexport const decodeGenome = (genome: Genome): DecodedGenome => {\r\n  const engineGenes: Gene[] = genome.slice(0, ENGINE_FORMULA_GENES_NUM);\r\n  const wheelsGenes: Gene[] = genome.slice(\r\n    ENGINE_FORMULA_GENES_NUM,\r\n    ENGINE_FORMULA_GENES_NUM + WHEELS_FORMULA_GENES_NUM,\r\n  );\r\n\r\n  const engineFormulaCoefficients: FormulaCoefficients = genomeToNumbers(engineGenes, GENES_PER_NUMBER);\r\n  const wheelsFormulaCoefficients: FormulaCoefficients = genomeToNumbers(wheelsGenes, GENES_PER_NUMBER);\r\n\r\n  return {\r\n    engineFormulaCoefficients,\r\n    wheelsFormulaCoefficients,\r\n  };\r\n};\r\n\r\nexport const genomeToNumbers = (genome: Genome, genesPerNumber: number): number[] => {\r\n  if (genome.length % genesPerNumber !== 0) {\r\n    throw new Error('Wrong number of genes in the numbers genome');\r\n  }\r\n  const numbers: number[] = [];\r\n  for (let numberIndex = 0; numberIndex < genome.length; numberIndex += genesPerNumber) {\r\n    const number: number = bitsToFloat10(genome.slice(numberIndex, numberIndex + genesPerNumber));\r\n    numbers.push(number);\r\n  }\r\n  return numbers;\r\n};\r\n\r\nexport const engineFormula = (genome: Genome, sensors: SensorValues): FormulaResult => {\r\n  const {engineFormulaCoefficients} = decodeGenome(genome);\r\n  const rawResult = linearPolynomial(engineFormulaCoefficients, sensors);\r\n  const normalizedResult = sigmoid(rawResult);\r\n  return sigmoidToCategories(normalizedResult);\r\n};\r\n\r\nexport const wheelsFormula = (genome: Genome, sensors: SensorValues): FormulaResult => {\r\n  const {wheelsFormulaCoefficients} = decodeGenome(genome);\r\n  const rawResult = linearPolynomial(wheelsFormulaCoefficients, sensors);\r\n  const normalizedResult = sigmoid(rawResult);\r\n  return sigmoidToCategories(normalizedResult);\r\n};\r\n","import { NumVec3 } from '../../../types/vectors';\r\nimport { getModelPath } from '../utils/models';\r\nimport { CAR_SENSORS_NUM } from '../../../libs/carGenetic';\r\n\r\n// Wheels.\r\nexport const WHEEL_OBJECT_NAME = 'wheel';\r\nexport const WHEEL_MASS = 0.1;\r\nexport const WHEEL_RADIUS = 0.3;\r\nexport const WHEEL_WIDTH = 0.5;\r\nexport const WHEEL_MODEL_PATH = getModelPath('wheel.glb');\r\nexport const WHEEL_SUSPENSION_STIFFNESS = 30;\r\nexport const WHEEL_SUSPENSION_REST_LENGTH = 0.3;\r\nexport const WHEEL_MAX_SUSPENSION_FORCE = 10000;\r\nexport const WHEEL_MAX_SUSPENSION_TRAVEL = 0.3;\r\nexport const WHEEL_DAMPING_RELAXATION = 2.3;\r\nexport const WHEEL_DAMPING_COMPRESSION = 4.4;\r\nexport const WHEEL_FRICTION_SLIP = 5;\r\nexport const WHEEL_ROLL_INFLUENCE = 0.01;\r\nexport const WHEEL_CUSTOM_SLIDING_ROTATION_SPEED = -30;\r\n\r\n// Roughly the cars' visual dimensions.\r\nexport const CHASSIS_OBJECT_NAME = 'chassis';\r\nexport const CHASSIS_LENGTH = 4;\r\nexport const CHASSIS_WIDTH = 1.5;\r\nexport const CHASSIS_HEIGHT = 1;\r\nexport const CHASSIS_SIZE: NumVec3 = [CHASSIS_WIDTH, CHASSIS_HEIGHT, CHASSIS_LENGTH];\r\nexport const CHASSIS_MASS = 3; // kg\r\nexport const CHASSIS_BASE_COLOR = '#FFFFFF';\r\nexport const CHASSIS_SIMPLIFIED_BASE_COLOR = 'orange';\r\nexport const CHASSIS_BASE_TOUCHED_COLOR = '#FF1111';\r\nexport const CHASSIS_FRONT_WHEEL_SHIFT = 1.3;\r\nexport const CHASSIS_BACK_WHEEL_SHIFT = -1.15;\r\nexport const CHASSIS_GROUND_CLEARANCE = -0.04;\r\nexport const CHASSIS_WHEEL_WIDTH = 1.2;\r\nexport const CHASSIS_MODEL_PATH = getModelPath('beetle.glb');\r\nexport const CHASSIS_RELATIVE_POSITION: NumVec3 = [0, -0.6, 0];\r\n\r\n// Sensors.\r\nexport const SENSORS_NUM = CAR_SENSORS_NUM;\r\nexport const SENSOR_HEIGHT = -0.15;\r\nexport const SENSOR_DISTANCE = 4;\r\nexport const SENSOR_DISTANCE_FALLBACK = 0;\r\n\r\n// Car.\r\nexport const CAR_MAX_STEER_VALUE = 0.6;\r\nexport const CAR_MAX_FORCE = 2;\r\nexport const CAR_MAX_BREAK_FORCE = 2;\r\n","import * as THREE from 'three';\r\nimport { Material } from 'three/src/materials/Material';\r\nimport { MeshStandardMaterialParameters } from 'three/src/materials/MeshStandardMaterial';\r\nimport { MeshPhysicalMaterialParameters } from 'three';\r\n\r\nexport const getSteel = (props: MeshStandardMaterialParameters): Material => {\r\n  return new THREE.MeshStandardMaterial({\r\n    metalness: 0.9,\r\n    roughness: 0.1,\r\n    ...props,\r\n  });\r\n};\r\n\r\nexport const getRubber = (props: MeshStandardMaterialParameters): Material => {\r\n  return new THREE.MeshStandardMaterial({\r\n    ...props,\r\n  });\r\n};\r\n\r\nexport const getPlastic = (props: MeshStandardMaterialParameters): Material => {\r\n  return new THREE.MeshStandardMaterial({\r\n    ...props,\r\n  });\r\n};\r\n\r\nexport const getGlass = (props: MeshPhysicalMaterialParameters): Material => {\r\n  return new THREE.MeshPhysicalMaterial({\r\n    metalness: 0.5,\r\n    roughness: 0,\r\n    transmission: 0.9,\r\n    ...props,\r\n    transparent: true,\r\n    color: '#FFFFFF',\r\n  });\r\n};\r\n","import React from 'react';\r\nimport { useGLTF } from '@react-three/drei';\r\nimport { GroupProps } from '@react-three/fiber';\r\nimport { MeshBVH } from 'three-mesh-bvh';\r\n\r\nimport { ModelData } from '../types/models';\r\nimport { getPlastic, getRubber, getSteel, getGlass } from '../utils/materials';\r\nimport { CHASSIS_MODEL_PATH } from './constants';\r\n\r\n// Preview the model: https://sandbox.babylonjs.com/\r\n// @see: https://github.com/pmndrs/drei#usegltf\r\n// useGLTF.preload(CHASSIS_MODEL_PATH);\r\n\r\ntype ChassisModelProps = {\r\n  bodyProps?: GroupProps,\r\n  wireframe?: boolean,\r\n  castShadow?: boolean,\r\n  receiveShadow?: boolean,\r\n  styled?: boolean,\r\n  baseColor?: string,\r\n};\r\n\r\nfunction ChassisModel(props: ChassisModelProps) {\r\n  const {\r\n    bodyProps = {},\r\n    wireframe = false,\r\n    styled = true,\r\n    castShadow = true,\r\n    receiveShadow = true,\r\n    baseColor: color,\r\n  } = props;\r\n\r\n  const { nodes, materials }: ModelData = useGLTF(CHASSIS_MODEL_PATH);\r\n\r\n  Object.keys(nodes).forEach((geometryKey) => {\r\n    if (geometryKey.startsWith('chassis_')) {\r\n      // @ts-ignore\r\n      nodes[geometryKey].geometry.boundsTree = new MeshBVH(nodes[geometryKey].geometry);\r\n    }\r\n  });\r\n\r\n  return (\r\n    <group {...bodyProps}>\r\n      <mesh\r\n        receiveShadow={receiveShadow}\r\n        castShadow={castShadow}\r\n        material={styled ? materials['Black paint'] : getSteel({wireframe, color: '#000000'})}\r\n        geometry={nodes.chassis_1.geometry}\r\n      />\r\n      <mesh\r\n        receiveShadow={receiveShadow}\r\n        castShadow={castShadow}\r\n        material={styled ? materials['Rubber'] : getRubber({wireframe, color: '#000000'})}\r\n        geometry={nodes.chassis_2.geometry}\r\n      />\r\n      <mesh\r\n        receiveShadow={receiveShadow}\r\n        castShadow={castShadow}\r\n        material={styled ? materials['Paint'] : getSteel({wireframe, color})}\r\n        geometry={nodes.chassis_3.geometry}\r\n      />\r\n      <mesh\r\n        receiveShadow={receiveShadow}\r\n        castShadow={castShadow}\r\n        material={styled ? materials['Underbody'] : getSteel({wireframe, color: '#000000'})}\r\n        geometry={nodes.chassis_4.geometry}\r\n      />\r\n      <mesh\r\n        receiveShadow={receiveShadow}\r\n        castShadow={castShadow}\r\n        material={styled ? materials['Chrom'] : getSteel({wireframe, color})}\r\n        geometry={nodes.chassis_5.geometry}\r\n      />\r\n      <mesh\r\n        receiveShadow={receiveShadow}\r\n        castShadow={castShadow}\r\n        material={styled ? materials['Interior (dark)'] : getPlastic({wireframe, color: '#000000'})}\r\n        geometry={nodes.chassis_6.geometry}\r\n      />\r\n      <mesh\r\n        receiveShadow={receiveShadow}\r\n        castShadow={castShadow}\r\n        material={styled ? materials['Interior (light)'] : getPlastic({wireframe, color})}\r\n        geometry={nodes.chassis_7.geometry}\r\n      />\r\n      <mesh\r\n        receiveShadow={receiveShadow}\r\n        castShadow={castShadow}\r\n        material={styled ? materials['Reflector'] : getPlastic({wireframe, color})}\r\n        geometry={nodes.chassis_8.geometry}\r\n      />\r\n      <mesh\r\n        receiveShadow={receiveShadow}\r\n        castShadow={castShadow}\r\n        material={styled ? materials['Glass'] : getGlass({wireframe, color})}\r\n        geometry={nodes.chassis_9.geometry} />\r\n      <mesh\r\n        receiveShadow={receiveShadow}\r\n        castShadow={castShadow}\r\n        material={styled ? materials['Steel'] : getSteel({wireframe, color})}\r\n        geometry={nodes.chassis_10.geometry}\r\n      />\r\n      <mesh\r\n        receiveShadow={receiveShadow}\r\n        castShadow={castShadow}\r\n        material={styled ? materials['Black plastic'] : getPlastic({wireframe, color: '#000000'})}\r\n        geometry={nodes.chassis_11.geometry}\r\n      />\r\n      <mesh\r\n        receiveShadow={receiveShadow}\r\n        castShadow={castShadow}\r\n        material={styled ? materials['Headlight'] : getGlass({wireframe, color})}\r\n        geometry={nodes.chassis_12.geometry}\r\n      />\r\n      <mesh\r\n        receiveShadow={receiveShadow}\r\n        castShadow={castShadow}\r\n        material={styled ? materials['Reverse lights'] : getGlass({wireframe, color})}\r\n        geometry={nodes.chassis_13.geometry} />\r\n      <mesh\r\n        receiveShadow={receiveShadow}\r\n        castShadow={castShadow}\r\n        material={styled ? materials['Orange plastic'] : getPlastic({wireframe, color})}\r\n        geometry={nodes.chassis_14.geometry}\r\n      />\r\n      <mesh\r\n        receiveShadow={receiveShadow}\r\n        castShadow={castShadow}\r\n        material={styled ? materials['Tail lights'] : getGlass({wireframe, color})}\r\n        geometry={nodes.chassis_15.geometry}\r\n      />\r\n      <mesh\r\n        receiveShadow={receiveShadow}\r\n        castShadow={castShadow}\r\n        material={styled ? materials['License Plate'] : getSteel({wireframe, color})}\r\n        geometry={nodes.chassis_16.geometry}\r\n      />\r\n    </group>\r\n  )\r\n}\r\n\r\nexport default ChassisModel;\r\n","import React, { useEffect, useRef } from 'react';\r\nimport { Line2 } from 'three/examples/jsm/lines/Line2';\r\nimport * as THREE from 'three';\r\nimport { useFrame } from '@react-three/fiber';\r\nimport throttle from 'lodash/throttle';\r\nimport { RootState } from '@react-three/fiber/dist/declarations/src/core/store';\r\nimport { Intersection } from 'three/src/core/Raycaster';\r\nimport { acceleratedRaycast } from 'three-mesh-bvh';\r\nimport { DebouncedFunc } from 'lodash';\r\n\r\nimport { NumVec3 } from '../../../types/vectors';\r\nimport { SENSOR_DISTANCE } from './constants';\r\nimport { INTERSECT_THROTTLE_TIMEOUT, ON_RAY_THROTTLE_TIMEOUT } from '../constants/performance';\r\n\r\nconst beamColor = new THREE.Color(0x009900);\r\nconst beamWarningColor = new THREE.Color(0xFFFF00);\r\nconst beamDangerColor = new THREE.Color(0xFF0000);\r\nconst lineWidth = 0.5;\r\n\r\nTHREE.Mesh.prototype.raycast = acceleratedRaycast;\r\n\r\ntype SensorRayProps = {\r\n  index: number,\r\n  from: NumVec3,\r\n  to: NumVec3,\r\n  angleX: number,\r\n  obstacles?: THREE.Object3D[],\r\n  visible?: boolean,\r\n  onRay?: (index: number, distance: number | undefined) => void,\r\n};\r\n\r\nconst SensorRay = (props: SensorRayProps) => {\r\n  const {\r\n    index,\r\n    from,\r\n    to,\r\n    angleX,\r\n    obstacles = [],\r\n    visible = false,\r\n    onRay = (index, distance) => {},\r\n  } = props;\r\n\r\n  const lineRef = useRef<Line2>();\r\n\r\n  const positionRef = useRef<THREE.Vector3>(new THREE.Vector3());\r\n  const directionRef = useRef<THREE.Vector3>(new THREE.Vector3());\r\n  const raycasterRef = useRef<THREE.Raycaster>(new THREE.Raycaster());\r\n\r\n  const intersectObjectsThrottledRef = useRef<DebouncedFunc<(...args: any[]) => any> | null>(null);\r\n  const onRayCallbackThrottledRef = useRef<DebouncedFunc<(...args: any[]) => any> | null>(null);\r\n\r\n  const intersectionRef = useRef<Intersection[]>([]);\r\n  raycasterRef.current.near = 0;\r\n  raycasterRef.current.far = SENSOR_DISTANCE;\r\n\r\n  // @ts-ignore\r\n  raycasterRef.current.firstHitOnly = true;\r\n\r\n  const intersectObjects = () => {\r\n    intersectionRef.current = raycasterRef.current.intersectObjects(obstacles, true);\r\n  };\r\n\r\n  // if (!intersectObjectsThrottledRef.current) {\r\n  //   intersectObjectsThrottledRef.current = throttle(intersectObjects, INTERSECT_THROTTLE_TIMEOUT, {\r\n  //     leading: true,\r\n  //     trailing: true,\r\n  //   });\r\n  // }\r\n  intersectObjectsThrottledRef.current = throttle(intersectObjects, INTERSECT_THROTTLE_TIMEOUT, {\r\n    leading: true,\r\n    trailing: true,\r\n  });\r\n\r\n  const onRayCallback = (index: number, distance: number | undefined): void => {\r\n    onRay(index, distance);\r\n  };\r\n\r\n  if (!onRayCallbackThrottledRef.current) {\r\n    onRayCallbackThrottledRef.current = throttle(onRayCallback, ON_RAY_THROTTLE_TIMEOUT, {\r\n      leading: true,\r\n      trailing: true,\r\n    });\r\n  }\r\n\r\n  useFrame((state: RootState, delta: number) => {\r\n    if (!lineRef?.current) {\r\n      return;\r\n    }\r\n\r\n    lineRef.current.getWorldPosition(positionRef.current);\r\n    lineRef.current.getWorldDirection(directionRef.current);\r\n\r\n    raycasterRef.current.set(positionRef.current, directionRef.current);\r\n\r\n    if (intersectObjectsThrottledRef.current) {\r\n      intersectObjectsThrottledRef.current();\r\n    }\r\n\r\n    const distance = intersectionRef.current.length\r\n      ? intersectionRef.current[0].distance\r\n      : undefined;\r\n\r\n    if (onRayCallbackThrottledRef.current) {\r\n      onRayCallbackThrottledRef.current(index, distance);\r\n    }\r\n\r\n    if (distance === undefined) {\r\n      lineRef.current.material.color = beamColor;\r\n    } else if (distance > (SENSOR_DISTANCE - SENSOR_DISTANCE / 4)) {\r\n      lineRef.current.material.color = beamWarningColor;\r\n    } else {\r\n      lineRef.current.material.color = beamDangerColor;\r\n    }\r\n  });\r\n\r\n  const onUnmount = () => {\r\n    if (intersectObjectsThrottledRef.current) {\r\n      intersectObjectsThrottledRef.current.cancel();\r\n    }\r\n    if (onRayCallbackThrottledRef.current) {\r\n      onRayCallbackThrottledRef.current.cancel();\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    return onUnmount;\r\n  }, [])\r\n\r\n  useEffect(() => {\r\n    if (!lineRef.current) {\r\n      return;\r\n    }\r\n    lineRef.current.rotateY(angleX);\r\n  }, [angleX]);\r\n\r\n  const lineGeometry = new THREE.BufferGeometry().setFromPoints([\r\n    new THREE.Vector3(...from),\r\n    new THREE.Vector3(...to),\r\n  ]);\r\n\r\n  return (\r\n    <group>\r\n      {/* @ts-ignore */}\r\n      <line ref={lineRef} geometry={lineGeometry}>\r\n        <lineBasicMaterial\r\n          attach=\"material\"\r\n          color={beamColor}\r\n          linewidth={lineWidth}\r\n          visible={visible}\r\n        />\r\n      </line>\r\n    </group>\r\n  )\r\n};\r\n\r\nexport default SensorRay;\r\n","// Throttle the check of the ray intersection with other objects.\r\nexport const INTERSECT_THROTTLE_TIMEOUT = 100;\r\n\r\n// Throttle the onRay sensor events.\r\nexport const ON_RAY_THROTTLE_TIMEOUT = 100;\r\n\r\n// Throttle the onSensors sensor events.\r\nexport const ON_SENSORS_THROTTLE_TIMEOUT = 100;\r\n\r\n// Throttle the onMove events.\r\nexport const ON_MOVE_THROTTLE_TIMEOUT = 100;\r\n\r\n// Throttle the update cat label events.\r\nexport const ON_UPDATE_LABEL_THROTTLE_TIMEOUT = 600;\r\n","import React, { useEffect, useRef } from 'react';\r\nimport * as THREE from 'three';\r\nimport throttle from 'lodash/throttle';\r\nimport { DebouncedFunc } from 'lodash';\r\nimport { useThree } from '@react-three/fiber';\r\n\r\nimport { CHASSIS_OBJECT_NAME, SENSOR_DISTANCE, SENSOR_HEIGHT } from './constants';\r\nimport SensorRay from './SensorRay';\r\nimport { CarMetaData, SensorValuesType } from '../types/car';\r\nimport { ON_SENSORS_THROTTLE_TIMEOUT } from '../constants/performance';\r\n\r\ntype SensorsProps = {\r\n  sensorsNum: number,\r\n  visibleSensors?: boolean,\r\n  onSensors?: (sensors: SensorValuesType) => void,\r\n};\r\n\r\nconst Sensors = (props: SensorsProps) => {\r\n  const { visibleSensors = false, sensorsNum, onSensors = () => {} } = props;\r\n  const obstacles = useRef<THREE.Object3D[]>([]);\r\n  const sensorDistances = useRef<SensorValuesType>(new Array(sensorsNum).fill(undefined));\r\n  const { scene } = useThree();\r\n  const onSensorsCallbackThrottledRef = useRef<DebouncedFunc<(...args: any[]) => any> | null>(null);\r\n\r\n  const onSensorsCallback = () => {\r\n    onSensors(sensorDistances.current);\r\n  };\r\n\r\n  if (!onSensorsCallbackThrottledRef.current) {\r\n    onSensorsCallbackThrottledRef.current = throttle(onSensorsCallback, ON_SENSORS_THROTTLE_TIMEOUT, {\r\n      leading: true,\r\n      trailing: true,\r\n    });\r\n  }\r\n\r\n  const onRay = (index: number, distance: number | undefined): void => {\r\n    sensorDistances.current[index] = typeof distance === 'number'\r\n      ? distance\r\n      : null;\r\n    if (onSensorsCallbackThrottledRef.current) {\r\n      onSensorsCallbackThrottledRef.current();\r\n    }\r\n  };\r\n\r\n  // @ts-ignore\r\n  obstacles.current = scene.children\r\n    .filter((object: THREE.Object3D) => object.type === 'Group')\r\n    .map((object: THREE.Object3D) => object.getObjectByName(CHASSIS_OBJECT_NAME))\r\n    .filter((object: THREE.Object3D | undefined) => {\r\n      if (!object || !object.userData) {\r\n        return false;\r\n      }\r\n      // @ts-ignore\r\n      const userData: CarMetaData = object.userData;\r\n      return userData?.isSensorObstacle;\r\n    });\r\n\r\n  const angleStep = 2 * Math.PI / sensorsNum;\r\n  const sensorRays = new Array(sensorsNum).fill(null).map((_, index) => {\r\n    return (\r\n      <SensorRay\r\n        key={index}\r\n        index={index}\r\n        from={[0, SENSOR_HEIGHT, 0]}\r\n        to={[0, SENSOR_HEIGHT, SENSOR_DISTANCE]}\r\n        angleX={angleStep * index}\r\n        visible={visibleSensors}\r\n        obstacles={obstacles.current}\r\n        onRay={onRay}\r\n      />\r\n    );\r\n  });\r\n\r\n  const onUnmount = () => {\r\n    if (onSensorsCallbackThrottledRef.current) {\r\n      onSensorsCallbackThrottledRef.current.cancel();\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    return onUnmount;\r\n  }, []);\r\n\r\n  return (\r\n    <>\r\n      {sensorRays}\r\n    </>\r\n  )\r\n};\r\n\r\nexport default Sensors;\r\n","import React, { CSSProperties } from 'react';\r\nimport { Html } from '@react-three/drei';\r\n\r\ntype CarLabelProps = {\r\n  content: React.ReactNode,\r\n};\r\n\r\nfunction CarLabel(props: CarLabelProps) {\r\n  const { content } = props;\r\n\r\n  const labelStyle: CSSProperties = {\r\n    backgroundColor: 'rgba(255, 255, 255, 0.7)',\r\n    padding: '0px 5px',\r\n    borderRadius: '10px',\r\n    color: 'black',\r\n    fontSize: '10px',\r\n    whiteSpace: 'nowrap',\r\n  };\r\n\r\n  return (\r\n    <Html position={[0, 2.5, 0]}>\r\n      <div style={labelStyle}>\r\n        {content}\r\n      </div>\r\n    </Html>\r\n  )\r\n}\r\n\r\nexport default CarLabel;\r\n","import React from 'react';\r\nimport { GroupProps } from '@react-three/fiber';\r\n\r\nimport { CHASSIS_HEIGHT, CHASSIS_LENGTH, CHASSIS_WIDTH } from './constants';\r\n\r\ntype ChassisModelSimpleProps = {\r\n  bodyProps?: GroupProps,\r\n  wireframe?: boolean,\r\n  castShadow?: boolean,\r\n  receiveShadow?: boolean,\r\n  styled?: boolean,\r\n  baseColor?: string,\r\n};\r\n\r\nfunction ChassisModelSimple(props: ChassisModelSimpleProps) {\r\n  const {\r\n    castShadow = true,\r\n    receiveShadow = true,\r\n    baseColor: color,\r\n  } = props;\r\n\r\n  const boxArgs: number[] = [\r\n    CHASSIS_WIDTH - 0.2,\r\n    CHASSIS_HEIGHT - 0.4,\r\n    CHASSIS_LENGTH - 0.2,\r\n  ];\r\n\r\n  return (\r\n    <mesh castShadow={castShadow} receiveShadow={receiveShadow} >\r\n      {/* @ts-ignore */}\r\n      <boxBufferGeometry args={boxArgs} />\r\n      <meshPhysicalMaterial color={color} />\r\n    </mesh>\r\n  );\r\n}\r\n\r\nexport default ChassisModelSimple;\r\n","import { BoxProps, useBox } from '@react-three/cannon';\r\nimport React, { forwardRef } from 'react';\r\nimport * as THREE from 'three';\r\nimport { GroupProps } from '@react-three/fiber';\r\n\r\nimport { CHASSIS_MASS, CHASSIS_OBJECT_NAME, CHASSIS_SIZE } from './constants';\r\nimport { NumVec3 } from '../../../types/vectors';\r\nimport ChassisModel from './ChassisModel';\r\nimport Sensors from './Sensors';\r\nimport CarLabel from './CarLabel';\r\nimport { SensorValuesType } from '../types/car';\r\nimport ChassisModelSimple from './ChassisModelSimple';\r\n\r\ntype ChassisProps = {\r\n  sensorsNum: number,\r\n  weight?: number,\r\n  wireframe?: boolean,\r\n  castShadow?: boolean,\r\n  receiveShadow?: boolean,\r\n  withSensors?: boolean,\r\n  visibleSensors?: boolean,\r\n  styled?: boolean,\r\n  label?: React.ReactNode,\r\n  movable?: boolean,\r\n  baseColor?: string,\r\n  chassisPosition: NumVec3,\r\n  bodyProps: BoxProps,\r\n  onCollide?: (event: any) => void,\r\n  userData?: Record<string, any>,\r\n  collisionFilterGroup?: number,\r\n  collisionFilterMask?: number,\r\n  onSensors?: (sensors: SensorValuesType) => void,\r\n  performanceBoost: boolean,\r\n}\r\n\r\nconst Chassis = forwardRef<THREE.Object3D | undefined, ChassisProps>((props, ref) => {\r\n  const {\r\n    sensorsNum,\r\n    wireframe = false,\r\n    styled = true,\r\n    castShadow = true,\r\n    receiveShadow = true,\r\n    movable = true,\r\n    withSensors = false,\r\n    visibleSensors = false,\r\n    weight = CHASSIS_MASS,\r\n    label = null,\r\n    baseColor,\r\n    chassisPosition,\r\n    bodyProps,\r\n    userData = {},\r\n    collisionFilterGroup,\r\n    collisionFilterMask,\r\n    onCollide = () => {},\r\n    onSensors = () => {},\r\n    performanceBoost,\r\n  } = props;\r\n\r\n  const boxSize = CHASSIS_SIZE;\r\n  useBox(\r\n    () => ({\r\n      mass: weight,\r\n      allowSleep: false,\r\n      args: boxSize,\r\n      collisionFilterGroup,\r\n      collisionFilterMask,\r\n      onCollide,\r\n      userData,\r\n      type: movable ? 'Dynamic' : 'Static',\r\n      ...bodyProps,\r\n    }),\r\n    // @ts-ignore\r\n    ref\r\n  )\r\n\r\n  const groupProps: GroupProps = {\r\n    position: chassisPosition,\r\n  };\r\n\r\n  const sensors = withSensors ? (\r\n    <Sensors\r\n      visibleSensors={visibleSensors}\r\n      sensorsNum={sensorsNum}\r\n      onSensors={onSensors}\r\n    />\r\n  ) : null;\r\n\r\n  const carLabel = label ? (\r\n    <CarLabel content={label} />\r\n  ) : null;\r\n\r\n  const chassisModel = performanceBoost ? (\r\n    <ChassisModelSimple\r\n      bodyProps={groupProps}\r\n      castShadow={castShadow}\r\n      receiveShadow={receiveShadow}\r\n      baseColor={baseColor}\r\n    />\r\n  ) : (\r\n    <ChassisModel\r\n      bodyProps={groupProps}\r\n      castShadow={castShadow}\r\n      receiveShadow={receiveShadow}\r\n      wireframe={wireframe}\r\n      styled={styled}\r\n      baseColor={baseColor}\r\n    />\r\n  );\r\n\r\n  return (\r\n    <group ref={ref} name={CHASSIS_OBJECT_NAME}>\r\n      <mesh>\r\n        {chassisModel}\r\n      </mesh>\r\n      {sensors}\r\n      {carLabel}\r\n    </group>\r\n  )\r\n})\r\n\r\nexport default Chassis;\r\n","import React from 'react';\r\nimport { useGLTF } from '@react-three/drei';\r\nimport { GroupProps } from '@react-three/fiber';\r\n\r\nimport { ModelData } from '../types/models';\r\nimport { getRubber, getSteel } from '../utils/materials';\r\nimport { WHEEL_MODEL_PATH } from './constants';\r\n\r\n// Preview the model.\r\n// @see: https://github.com/pmndrs/drei#usegltf\r\n// useGLTF.preload(WHEEL_MODEL_PATH);\r\n\r\ntype WheelModelProps = {\r\n  castShadow?: boolean,\r\n  receiveShadow?: boolean,\r\n  groupProps?: GroupProps,\r\n  styled?: boolean,\r\n  wireframe?: boolean,\r\n  baseColor?: string,\r\n};\r\n\r\nfunction WheelModel(props: WheelModelProps) {\r\n  const {\r\n    castShadow = true,\r\n    receiveShadow = true,\r\n    groupProps = {},\r\n    styled = true,\r\n    wireframe = false,\r\n    baseColor: color,\r\n  } = props;\r\n\r\n  const { nodes, materials }: ModelData = useGLTF(WHEEL_MODEL_PATH);\r\n\r\n  const tire = nodes.wheel_1?.geometry;\r\n  const disc = nodes.wheel_2?.geometry;\r\n  const cap = nodes.wheel_3?.geometry;\r\n\r\n  const tireMaterial = styled\r\n    ? materials.Rubber\r\n    : getRubber({ wireframe, color: '#000000' });\r\n\r\n  // const discMaterial = styled\r\n  //   ? materials.Steel\r\n  //   : getSteel({ wireframe });\r\n\r\n  const discMaterial = getSteel({ wireframe, color });\r\n\r\n  const capMaterial = styled\r\n    ? materials.Chrom\r\n    : getSteel({ wireframe, color });\r\n\r\n  return (\r\n    <group {...groupProps}>\r\n      <mesh\r\n        geometry={tire}\r\n        material={tireMaterial}\r\n        castShadow={castShadow}\r\n        receiveShadow={receiveShadow}\r\n      />\r\n      <mesh\r\n        geometry={disc}\r\n        material={discMaterial}\r\n        castShadow={castShadow}\r\n        receiveShadow={receiveShadow}\r\n      />\r\n      <mesh\r\n        geometry={cap}\r\n        material={capMaterial}\r\n        castShadow={castShadow}\r\n        receiveShadow={receiveShadow}\r\n      />\r\n    </group>\r\n  )\r\n}\r\n\r\nexport default WheelModel;\r\n","import React from 'react';\r\nimport { GroupProps } from '@react-three/fiber';\r\n\r\nimport { WHEEL_WIDTH, WHEEL_RADIUS } from './constants';\r\n\r\ntype WheelModelSimpleProps = {\r\n  castShadow?: boolean,\r\n  receiveShadow?: boolean,\r\n  groupProps?: GroupProps,\r\n  styled?: boolean,\r\n  wireframe?: boolean,\r\n  baseColor?: string,\r\n};\r\n\r\nfunction WheelModelSimple(props: WheelModelSimpleProps) {\r\n  const {\r\n    castShadow = true,\r\n    receiveShadow = true,\r\n    baseColor: color,\r\n  } = props;\r\n\r\n  const cylinderArgs: [number, number, number, number] = [\r\n    WHEEL_RADIUS,\r\n    WHEEL_RADIUS,\r\n    WHEEL_WIDTH,\r\n    20,\r\n  ];\r\n\r\n  return (\r\n    <mesh castShadow={castShadow} receiveShadow={receiveShadow} >\r\n      <cylinderBufferGeometry args={cylinderArgs} />\r\n      <meshPhysicalMaterial color={color} />\r\n    </mesh>\r\n  );\r\n}\r\n\r\nexport default WheelModelSimple;\r\n","import React, { forwardRef } from 'react';\r\nimport { useCylinder, CylinderProps } from '@react-three/cannon';\r\nimport * as THREE from 'three';\r\n\r\nimport { NumVec3, NumVec4 } from '../../../types/vectors';\r\nimport { WHEEL_MASS, WHEEL_OBJECT_NAME, WHEEL_WIDTH } from './constants';\r\nimport WheelModel from './WheelModel';\r\nimport WheelModelSimple from './WheelModelSimple';\r\n\r\ntype WheelProps = {\r\n  radius: number,\r\n  mass?: number,\r\n  width?: number,\r\n  segments?: number,\r\n  castShadow?: boolean,\r\n  receiveShadow?: boolean,\r\n  isLeft?: boolean,\r\n  styled?: boolean,\r\n  wireframe?: boolean,\r\n  baseColor?: string,\r\n  collisionFilterGroup?: number,\r\n  collisionFilterMask?: number,\r\n  bodyProps?: CylinderProps,\r\n  performanceBoost: boolean,\r\n}\r\n\r\nconst Wheel = forwardRef<THREE.Object3D | undefined, WheelProps>((props, ref) => {\r\n  const {\r\n    radius,\r\n    width = WHEEL_WIDTH,\r\n    mass = WHEEL_MASS,\r\n    segments = 16,\r\n    castShadow = true,\r\n    receiveShadow = true,\r\n    isLeft = false,\r\n    styled = true,\r\n    wireframe = false,\r\n    bodyProps = {},\r\n    baseColor,\r\n    performanceBoost\r\n  } = props;\r\n\r\n  const wheelSize: NumVec4 = [radius, radius, width, segments];\r\n\r\n  // The rotation should be applied to the shape (not the body).\r\n  const rotation: NumVec3 = [0, 0, ((isLeft ? 1 : -1) * Math.PI) / 2];\r\n\r\n  useCylinder(\r\n    () => ({\r\n      mass,\r\n      type: 'Kinematic',\r\n      collisionFilterGroup: 0,\r\n      args: wheelSize,\r\n      ...bodyProps,\r\n    }),\r\n    // @ts-ignore\r\n    ref,\r\n  )\r\n\r\n  const wheelModel = performanceBoost ? (\r\n    <WheelModelSimple\r\n      castShadow={castShadow}\r\n      receiveShadow={receiveShadow}\r\n      baseColor={baseColor}\r\n    />\r\n  ) : (\r\n    <WheelModel\r\n      castShadow={castShadow}\r\n      receiveShadow={receiveShadow}\r\n      styled={styled}\r\n      wireframe={wireframe}\r\n      baseColor={baseColor}\r\n    />\r\n  );\r\n\r\n  return (\r\n    <mesh ref={ref} name={WHEEL_OBJECT_NAME}>\r\n      <mesh rotation={rotation}>\r\n        {wheelModel}\r\n      </mesh>\r\n    </mesh>\r\n  )\r\n})\r\n\r\nexport default Wheel;\r\n","import { getSearchParam } from './url';\r\n\r\nconst LOG_SEARCH_PARAM_NAME = 'debug';\r\n\r\nconst logToConsole = !!getSearchParam(LOG_SEARCH_PARAM_NAME);\r\n\r\ntype LoggerParams = {\r\n  context: string,\r\n};\r\n\r\ntype LoggerCallback = (...params: any[]) => void;\r\n\r\ntype Logger = {\r\n  info: LoggerCallback,\r\n  warn: LoggerCallback,\r\n  error: LoggerCallback,\r\n};\r\n\r\nexport const loggerBuilder = (params: LoggerParams): Logger => {\r\n  const { context } = params;\r\n\r\n  const info: LoggerCallback = (message, ...optionalParams) => {\r\n    if (!logToConsole) {\r\n      return;\r\n    }\r\n    console.log(\r\n      `%c${context}`,\r\n      'background: orange; color: white; padding: 0 3px; border-radius: 3px;',\r\n      '→',\r\n      message,\r\n      ...optionalParams\r\n    );\r\n  };\r\n\r\n  const warn: LoggerCallback = (message, ...optionalParams) => {\r\n    if (!logToConsole) {\r\n      return;\r\n    }\r\n    console.info(\r\n      `%c${context}`,\r\n      'background: red; color: white; padding: 0 3px; border-radius: 3px;',\r\n      '→',\r\n      message,\r\n      ...optionalParams\r\n    );\r\n  };\r\n\r\n  const error: LoggerCallback = (message, ...optionalParams) => {\r\n    if (!logToConsole) {\r\n      return;\r\n    }\r\n    console.error(context, message, ...optionalParams);\r\n  };\r\n\r\n  return { info, warn, error };\r\n};\r\n","import { loggerBuilder } from './logger';\r\n\r\nexport const write = (key: string, data: any): boolean => {\r\n  const logger = loggerBuilder({context: 'storage::write'});\r\n  try {\r\n    const stringifiedData = JSON.stringify(data);\r\n    localStorage.setItem(key, stringifiedData);\r\n    logger.info(`Wrote data with the key \"${key}\" to storage successfully`);\r\n  } catch (error) {\r\n    logger.error('Cannot write data to storage', error);\r\n    return false;\r\n  }\r\n  return true;\r\n};\r\n\r\nexport const read = (key: string): any | null => {\r\n  const logger = loggerBuilder({context: 'storage::read'});\r\n  try {\r\n    const stringifiedData: string | null = localStorage.getItem(key);\r\n    logger.info(`Read data with the key \"${key}\" from storage successfully`);\r\n    if (!stringifiedData) {\r\n      return stringifiedData;\r\n    }\r\n    return JSON.parse(stringifiedData);\r\n  } catch (error) {\r\n    logger.error('Cannot read data to storage', error);\r\n    return null;\r\n  }\r\n};\r\n\r\nexport const remove = (key: string): void => {\r\n  const logger = loggerBuilder({context: 'storage::remove'});\r\n  localStorage.removeItem(key);\r\n  logger.info(`Removed data with the key \"${key}\" from storage`);\r\n};\r\n","import { NumVec3, RectanglePoints } from '../../../types/vectors';\r\nimport { CHASSIS_WIDTH, CHASSIS_LENGTH } from '../car/constants';\r\n\r\n// @TODO: Parking lot size should be a configurable from the outside.\r\n// Move this constants to the component parameters.\r\n\r\n// const PARKING_SPOT_POSITION: NumVec3 = [-0.91, 0, -2];\r\nconst PARKING_SPOT_POSITION: NumVec3 = [-3.6, 0, -2.1];\r\n\r\nconst [x, y, z] = PARKING_SPOT_POSITION;\r\n\r\nconst outerW = CHASSIS_WIDTH + 0.3;\r\nconst outerL = CHASSIS_LENGTH + 0.3;\r\n\r\nconst innerW = 1.2;\r\nconst innerL = 2.44;\r\n\r\nconst innerX = x + (outerW - innerW) / 2;\r\nconst innerY = y;\r\nconst innerZ = z + (outerL - innerL) / 2;\r\n\r\nexport const PARKING_SPOT_OUTER_CORNERS: [number, number, number][] = [\r\n  [x + outerW, y, z + outerL], // Front-left\r\n  [x, y, z + outerL], // Front-right\r\n  [x, y, z], // Back-right\r\n  [x + outerW, y, z], // Back-left\r\n];\r\n\r\nexport const PARKING_SPOT_INNER_CORNERS: [number, number, number][] = [\r\n  [innerX + innerW, innerY, innerZ + innerL], // Front-left\r\n  [innerX, innerY, innerZ + innerL], // Front-right\r\n  [innerX, innerY, innerZ], // Back-right\r\n  [innerX + innerW, innerY, innerZ], // Back-left\r\n];\r\n\r\nexport const PARKING_SPOT_POINTS: RectanglePoints = {\r\n  fl: [innerX + innerW, innerY, innerZ + innerL],\r\n  fr: [innerX, innerY, innerZ + innerL],\r\n  br: [innerX, innerY, innerZ],\r\n  bl: [innerX + innerW, innerY, innerZ],\r\n};\r\n","import { Gene, Generation, Genome } from '../../../libs/genetic';\r\nimport {\r\n  CarLicencePlateType,\r\n  CarsType,\r\n  EngineOptionsType,\r\n  SensorValuesType, SensorValueType,\r\n  WheelOptionsType\r\n} from '../../world/types/car';\r\nimport { RectanglePoints } from '../../../types/vectors';\r\nimport { CAR_SENSORS_NUM, engineFormula, carLoss, wheelsFormula } from '../../../libs/carGenetic';\r\nimport { SENSOR_DISTANCE_FALLBACK } from '../../world/car/constants';\r\nimport { read, remove, write } from '../../../utils/storage';\r\nimport { PARKING_SPOT_POINTS } from '../../world/constants/parking';\r\n\r\nconst GENERATION_STORAGE_KEY = 'generation';\r\nconst GENERATION_INDEX_STORAGE_KEY = 'generation-index';\r\nconst LOSS_HISTORY_INDEX_STORAGE_KEY = 'loss-history';\r\nconst AVG_LOSS_HISTORY_INDEX_STORAGE_KEY = 'avg-loss-history';\r\n\r\nconst generateLicencePlate = (\r\n  generationIndex: number | null,\r\n  genomeIndex: number\r\n): CarLicencePlateType => {\r\n  const generationIdx = generationIndex !== null ? (generationIndex + 1) : '';\r\n  const genomeIdx = genomeIndex + 1;\r\n  return `CAR-${generationIdx}-${genomeIdx}`;\r\n};\r\n\r\ntype GenerationToCarsProps = {\r\n  generationIndex: number | null,\r\n  generation: Generation,\r\n  onLossUpdate?: (licencePlate: CarLicencePlateType, loss: number) => void,\r\n};\r\n\r\nexport const generationToCars = (props: GenerationToCarsProps): CarsType => {\r\n  const {\r\n    generationIndex,\r\n    generation,\r\n    onLossUpdate = () => {},\r\n  } = props;\r\n  const cars: CarsType = {};\r\n  generation.forEach((genome: Genome, genomeIndex) => {\r\n    const licencePlate = generateLicencePlate(generationIndex, genomeIndex);\r\n\r\n    const onEngine = (sensors: SensorValuesType): EngineOptionsType => {\r\n      const formulaOutput = engineFormula(genome, cleanUpSensors(sensors));\r\n      if (formulaOutput === -1) {\r\n        return 'backwards';\r\n      }\r\n      if (formulaOutput === 1) {\r\n        return 'forward'\r\n      }\r\n      return 'neutral';\r\n    };\r\n\r\n    const onWheel = (sensors: SensorValuesType): WheelOptionsType => {\r\n      const formulaOutput = wheelsFormula(genome, cleanUpSensors(sensors));\r\n      if (formulaOutput === -1) {\r\n        return 'left';\r\n      }\r\n      if (formulaOutput === 1) {\r\n        return 'right'\r\n      }\r\n      return 'straight';\r\n    };\r\n\r\n    const onMove = (wheelsPoints: RectanglePoints) => {\r\n      const loss = carLoss({\r\n        wheelsPosition: wheelsPoints,\r\n        parkingLotCorners: PARKING_SPOT_POINTS,\r\n      });\r\n      onLossUpdate(licencePlate, loss);\r\n    };\r\n\r\n    cars[licencePlate] = {\r\n      licencePlate,\r\n      generationIndex: generationIndex !== null ? generationIndex : -1,\r\n      sensorsNum: CAR_SENSORS_NUM,\r\n      genomeIndex,\r\n      onEngine,\r\n      onWheel,\r\n      onMove,\r\n      onHit: () => {},\r\n    };\r\n  });\r\n  return cars;\r\n};\r\n\r\nconst cleanUpSensors = (sensors: SensorValuesType): number[] => {\r\n  return sensors.map((sensor: SensorValueType) => {\r\n    if (sensor === null || sensor === undefined) {\r\n      return SENSOR_DISTANCE_FALLBACK;\r\n    }\r\n    return sensor;\r\n  });\r\n};\r\n\r\nexport const formatLossValue = (lossValue: number | null | undefined): number | null => {\r\n  if (typeof lossValue !== 'number') {\r\n    return null;\r\n  }\r\n  return Math.ceil(lossValue * 100) / 100;\r\n};\r\n\r\nexport const generateWorldVersion = (\r\n  generationIndex: number | null,\r\n  batchIndex: number | null\r\n): string => {\r\n  const generation = generationIndex === null ? -1 : generationIndex;\r\n  const batch = batchIndex === null ? -1: batchIndex;\r\n  return `world-${generation}-${batch}`;\r\n};\r\n\r\nexport const genomeStringToGenome = (genomeString: string): Genome => {\r\n  return genomeString\r\n    .split(' ')\r\n    .map<Gene>((geneString: string) => {\r\n      const gene: Gene = parseInt(geneString, 10) === 1 ? 1 : 0;\r\n      return gene;\r\n    });\r\n};\r\n\r\ntype GenerationDataInStorage = {\r\n  generation: Generation | null,\r\n  generationIndex: number | null,\r\n  lossHistory: number[] | null,\r\n  avgLossHistory: number[] | null,\r\n};\r\n\r\nexport const loadGenerationFromStorage = (): GenerationDataInStorage => {\r\n  const generationIndex: number | null = read(GENERATION_INDEX_STORAGE_KEY)\r\n  const generation: Generation | null = read(GENERATION_STORAGE_KEY);\r\n  const lossHistory: number[] | null = read(LOSS_HISTORY_INDEX_STORAGE_KEY);\r\n  const avgLossHistory: number[] | null = read(AVG_LOSS_HISTORY_INDEX_STORAGE_KEY);\r\n  return {\r\n    generation,\r\n    generationIndex,\r\n    lossHistory,\r\n    avgLossHistory,\r\n  };\r\n};\r\n\r\nexport const saveGenerationToStorage = (data: GenerationDataInStorage): boolean => {\r\n  const {\r\n    generation,\r\n    generationIndex,\r\n    lossHistory,\r\n    avgLossHistory,\r\n  } = data;\r\n\r\n  if (!generation || !generation.length || !generationIndex || !lossHistory || !avgLossHistory) {\r\n    return false;\r\n  }\r\n\r\n  const keySuccess = write(GENERATION_INDEX_STORAGE_KEY, generationIndex);\r\n  const generationSuccess = write(GENERATION_STORAGE_KEY, generation);\r\n  const lossHistorySuccess = write(LOSS_HISTORY_INDEX_STORAGE_KEY, lossHistory);\r\n  const avgLossHistorySuccess = write(AVG_LOSS_HISTORY_INDEX_STORAGE_KEY, avgLossHistory);\r\n\r\n  return keySuccess && generationSuccess && lossHistorySuccess && avgLossHistorySuccess;\r\n};\r\n\r\nexport const removeGenerationFromStorage = (): void => {\r\n  remove(GENERATION_STORAGE_KEY);\r\n  remove(GENERATION_INDEX_STORAGE_KEY);\r\n  remove(LOSS_HISTORY_INDEX_STORAGE_KEY);\r\n  remove(AVG_LOSS_HISTORY_INDEX_STORAGE_KEY);\r\n};\r\n","export const LOSS_VALUE_GOOD_THRESHOLD = 1;\r\nexport const LOSS_VALUE_BAD_THRESHOLD = 2;\r\n\r\nexport const FITNESS_ALPHA = 0.5;\r\n\r\nexport const BAD_SIMULATION_RETRIES_ENABLED = true;\r\nexport const BAD_SIMULATION_BATCH_INDEX_CHECK = 1;\r\nexport const BAD_SIMULATION_RETRIES_NUM = 1;\r\nexport const BAD_SIMULATION_MIN_LOSS_INCREASE_PERCENTAGE = 110;\r\n","import React, { MutableRefObject, useEffect, useRef, useState } from 'react';\r\nimport { BoxProps, CylinderProps, useRaycastVehicle } from '@react-three/cannon';\r\nimport * as THREE from 'three';\r\nimport { DebouncedFunc } from 'lodash';\r\nimport { useFrame } from '@react-three/fiber';\r\nimport { RootState } from '@react-three/fiber/dist/declarations/src/core/store';\r\nimport throttle from 'lodash/throttle';\r\n\r\nimport Chassis from './Chassis';\r\nimport Wheel from './Wheel';\r\nimport {\r\n  CHASSIS_BACK_WHEEL_SHIFT,\r\n  CHASSIS_BASE_COLOR,\r\n  CHASSIS_FRONT_WHEEL_SHIFT,\r\n  CHASSIS_GROUND_CLEARANCE,\r\n  CHASSIS_RELATIVE_POSITION,\r\n  CHASSIS_WHEEL_WIDTH,\r\n  SENSORS_NUM,\r\n  WHEEL_CUSTOM_SLIDING_ROTATION_SPEED,\r\n  WHEEL_DAMPING_COMPRESSION,\r\n  WHEEL_DAMPING_RELAXATION,\r\n  WHEEL_FRICTION_SLIP,\r\n  WHEEL_MAX_SUSPENSION_FORCE,\r\n  WHEEL_MAX_SUSPENSION_TRAVEL,\r\n  WHEEL_RADIUS,\r\n  WHEEL_ROLL_INFLUENCE,\r\n  WHEEL_SUSPENSION_REST_LENGTH,\r\n  WHEEL_SUSPENSION_STIFFNESS\r\n} from './constants';\r\nimport {\r\n  CarMetaData,\r\n  CarType,\r\n  RaycastVehiclePublicApi,\r\n  SensorValuesType,\r\n  userCarUUID,\r\n  WheelInfoOptions,\r\n} from '../types/car';\r\nimport { ON_MOVE_THROTTLE_TIMEOUT, ON_UPDATE_LABEL_THROTTLE_TIMEOUT } from '../constants/performance';\r\nimport { formatLossValue } from '../../evolution/utils/evolution';\r\nimport { RectanglePoints, ThreeRectanglePoints } from '../../../types/vectors';\r\nimport { carLoss as getCarLoss } from '../../../libs/carGenetic';\r\nimport { LOSS_VALUE_BAD_THRESHOLD, LOSS_VALUE_GOOD_THRESHOLD } from '../../evolution/constants/evolution';\r\nimport { PARKING_SPOT_POINTS } from '../constants/parking';\r\n\r\nexport type OnCarReadyArgs = {\r\n  api: RaycastVehiclePublicApi,\r\n  chassis: THREE.Object3D,\r\n  wheelsNum: number,\r\n};\r\n\r\ntype CarProps = {\r\n  uuid: userCarUUID,\r\n  bodyProps: BoxProps,\r\n  wheelRadius?: number,\r\n  wireframe?: boolean,\r\n  styled?: boolean,\r\n  movable?: boolean,\r\n  withSensors?: boolean,\r\n  withLabel?: boolean,\r\n  visibleSensors?: boolean,\r\n  baseColor?: string,\r\n  onCollide?: (carMetaData: CarMetaData, event: any) => void,\r\n  onSensors?: (sensors: SensorValuesType) => void,\r\n  onMove?: (wheelsPositions: RectanglePoints) => void,\r\n  collisionFilterGroup?: number,\r\n  collisionFilterMask?: number,\r\n  onCarReady?: (args: OnCarReadyArgs) => void,\r\n  onCarDestroy?: () => void,\r\n  car?: CarType,\r\n  performanceBoost?: boolean,\r\n}\r\n\r\nconst flWheelIndex = 0;\r\nconst frWheelIndex = 1;\r\nconst blWheelIndex = 2;\r\nconst brWheelIndex = 3;\r\n\r\nfunction Car(props: CarProps) {\r\n  const {\r\n    uuid,\r\n    wheelRadius = WHEEL_RADIUS,\r\n    wireframe = false,\r\n    withLabel = false,\r\n    styled = true,\r\n    withSensors = false,\r\n    visibleSensors = false,\r\n    movable = false,\r\n    baseColor = CHASSIS_BASE_COLOR,\r\n    collisionFilterGroup,\r\n    collisionFilterMask,\r\n    bodyProps = {},\r\n    onCollide = () => {},\r\n    onCarReady = () => {},\r\n    onCarDestroy = () => {},\r\n    onSensors = () => {},\r\n    onMove = () => {},\r\n    car = { licencePlate: '', generationIndex: 0, genomeIndex: 0 },\r\n    performanceBoost = false,\r\n  } = props;\r\n\r\n  const chassis = useRef<THREE.Object3D | undefined>();\r\n  const apiRef = useRef<RaycastVehiclePublicApi | undefined>();\r\n  const wheelsRef = useRef<MutableRefObject<THREE.Object3D | undefined>[]>([]);\r\n  const wheelsPositionRef = useRef<ThreeRectanglePoints>({\r\n    fl: new THREE.Vector3(),\r\n    fr: new THREE.Vector3(),\r\n    bl: new THREE.Vector3(),\r\n    br: new THREE.Vector3(),\r\n  });\r\n  const [carLoss, setCarLoss] = useState<number | null>(null);\r\n  const onUpdateLabelThrottledRef = useRef<DebouncedFunc<(...args: any[]) => any> | null>(null);\r\n  const onMoveThrottledRef = useRef<DebouncedFunc<(...args: any[]) => any> | null>(null);\r\n\r\n  const wheels: MutableRefObject<THREE.Object3D | undefined>[] = [];\r\n  const wheelInfos: WheelInfoOptions[] = [];\r\n\r\n  const wheelInfo = {\r\n    isFrontWheel: false,\r\n    radius: wheelRadius,\r\n    directionLocal: [0, -1, 0], // Same as Physics gravity.\r\n    axleLocal: [-1, 0, 0], // wheel rotates around X-axis, invert if wheels rotate the wrong way\r\n    chassisConnectionPointLocal: [1, 0, 1],\r\n    suspensionStiffness: WHEEL_SUSPENSION_STIFFNESS,\r\n    suspensionRestLength: WHEEL_SUSPENSION_REST_LENGTH,\r\n    maxSuspensionForce: WHEEL_MAX_SUSPENSION_FORCE,\r\n    maxSuspensionTravel: WHEEL_MAX_SUSPENSION_TRAVEL,\r\n    dampingRelaxation: WHEEL_DAMPING_RELAXATION,\r\n    dampingCompression: WHEEL_DAMPING_COMPRESSION,\r\n    frictionSlip: WHEEL_FRICTION_SLIP,\r\n    rollInfluence: WHEEL_ROLL_INFLUENCE,\r\n    useCustomSlidingRotationalSpeed: true,\r\n    customSlidingRotationalSpeed: WHEEL_CUSTOM_SLIDING_ROTATION_SPEED,\r\n  };\r\n\r\n  // FrontLeft [-X, Y, Z].\r\n  const flWheel = useRef<THREE.Object3D | undefined>();\r\n  const flWheelInfo = {\r\n    ...wheelInfo,\r\n    isFrontWheel: true,\r\n    chassisConnectionPointLocal: [\r\n      -CHASSIS_WHEEL_WIDTH / 2,\r\n      CHASSIS_GROUND_CLEARANCE,\r\n      CHASSIS_FRONT_WHEEL_SHIFT,\r\n    ],\r\n  };\r\n\r\n  // FrontRight [X, Y, Z].\r\n  const frWheel = useRef<THREE.Object3D | undefined>();\r\n  const frWheelInfo = {\r\n    ...wheelInfo,\r\n    isFrontWheel: true,\r\n    chassisConnectionPointLocal: [\r\n      CHASSIS_WHEEL_WIDTH / 2,\r\n      CHASSIS_GROUND_CLEARANCE,\r\n      CHASSIS_FRONT_WHEEL_SHIFT\r\n    ],\r\n  };\r\n\r\n  // BackLeft [-X, Y, -Z].\r\n  const blWheel = useRef<THREE.Object3D | undefined>();\r\n  const blWheelInfo = {\r\n    ...wheelInfo,\r\n    isFrontWheel: false,\r\n    chassisConnectionPointLocal: [\r\n      -CHASSIS_WHEEL_WIDTH / 2,\r\n      CHASSIS_GROUND_CLEARANCE,\r\n      CHASSIS_BACK_WHEEL_SHIFT,\r\n    ],\r\n  };\r\n\r\n  // BackRight [X, Y, -Z].\r\n  const brWheel = useRef<THREE.Object3D | undefined>();\r\n  const brWheelInfo = {\r\n    ...wheelInfo,\r\n    isFrontWheel: false,\r\n    chassisConnectionPointLocal: [\r\n      CHASSIS_WHEEL_WIDTH / 2,\r\n      CHASSIS_GROUND_CLEARANCE,\r\n      CHASSIS_BACK_WHEEL_SHIFT,\r\n    ],\r\n  };\r\n\r\n  wheels[flWheelIndex] = flWheel;\r\n  wheels[frWheelIndex] = frWheel;\r\n  wheels[blWheelIndex] = blWheel;\r\n  wheels[brWheelIndex] = brWheel;\r\n\r\n  wheelInfos[flWheelIndex] = flWheelInfo;\r\n  wheelInfos[frWheelIndex] = frWheelInfo;\r\n  wheelInfos[blWheelIndex] = blWheelInfo;\r\n  wheelInfos[brWheelIndex] = brWheelInfo;\r\n\r\n  const isSensorObstacle = !movable;\r\n\r\n  const [vehicle, vehicleAPI] = useRaycastVehicle(() => ({\r\n    chassisBody: chassis,\r\n    wheels,\r\n    wheelInfos,\r\n    indexForwardAxis: 2,\r\n    indexRightAxis: 0,\r\n    indexUpAxis: 1,\r\n  }));\r\n\r\n  const wheelMetaData: CarMetaData = {\r\n    uuid: 'wheel',\r\n    type: 'wheel',\r\n    isSensorObstacle,\r\n  };\r\n\r\n  const wheelBodyProps: CylinderProps = {\r\n    position: bodyProps.position,\r\n    userData: wheelMetaData,\r\n  };\r\n\r\n  const carMetaData: CarMetaData = {\r\n    uuid,\r\n    type: 'chassis',\r\n    isSensorObstacle,\r\n  };\r\n\r\n  apiRef.current = vehicleAPI;\r\n  wheelsRef.current = wheels;\r\n\r\n  const onUnmount = () => {\r\n    if (onUpdateLabelThrottledRef.current) {\r\n      onUpdateLabelThrottledRef.current.cancel();\r\n    }\r\n    if (onMoveThrottledRef.current) {\r\n      onMoveThrottledRef.current.cancel();\r\n    }\r\n    onCarDestroy();\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (!apiRef.current || !chassis.current) {\r\n      return onUnmount;\r\n    }\r\n    onCarReady({\r\n      api: apiRef.current,\r\n      chassis: chassis.current,\r\n      wheelsNum: wheelsRef.current.length,\r\n    });\r\n    return onUnmount;\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  if (!onMoveThrottledRef.current) {\r\n    onMoveThrottledRef.current = throttle(onMove, ON_MOVE_THROTTLE_TIMEOUT, {\r\n      leading: true,\r\n      trailing: true,\r\n    });\r\n  }\r\n\r\n  // @TODO: Move the logic of label content population to the evolution components.\r\n  // Car shouldn't know about the evolution loss function.\r\n  const onUpdateLabel = (wheelsPositions: RectanglePoints) => {\r\n    const loss = getCarLoss({\r\n      wheelsPosition: wheelsPositions,\r\n      parkingLotCorners: PARKING_SPOT_POINTS,\r\n    });\r\n    setCarLoss(loss);\r\n  };\r\n\r\n  if (!onUpdateLabelThrottledRef.current) {\r\n    onUpdateLabelThrottledRef.current = throttle(onUpdateLabel, ON_UPDATE_LABEL_THROTTLE_TIMEOUT, {\r\n      leading: false,\r\n      trailing: true,\r\n    });\r\n  }\r\n\r\n  useFrame((state: RootState, delta: number) => {\r\n    if (!wheels || wheels.length !== 4) {\r\n      return;\r\n    }\r\n    if (\r\n      !wheels[flWheelIndex].current ||\r\n      !wheels[frWheelIndex].current ||\r\n      !wheels[blWheelIndex].current ||\r\n      !wheels[brWheelIndex].current\r\n    ) {\r\n      return;\r\n    }\r\n\r\n    // @ts-ignore\r\n    wheels[flWheelIndex].current.getWorldPosition(wheelsPositionRef.current.fr);\r\n    // @ts-ignore\r\n    wheels[frWheelIndex].current.getWorldPosition(wheelsPositionRef.current.fl);\r\n    // @ts-ignore\r\n    wheels[blWheelIndex].current.getWorldPosition(wheelsPositionRef.current.br);\r\n    // @ts-ignore\r\n    wheels[brWheelIndex].current.getWorldPosition(wheelsPositionRef.current.bl);\r\n\r\n    const {fl, fr, bl, br} = wheelsPositionRef.current;\r\n    const wheelPositions: RectanglePoints = {\r\n      fl: fl.toArray(),\r\n      fr: fr.toArray(),\r\n      bl: bl.toArray(),\r\n      br: br.toArray(),\r\n    };\r\n    if (onMoveThrottledRef.current) {\r\n      onMoveThrottledRef.current(wheelPositions);\r\n    }\r\n\r\n    // @TODO: Move the logic of label content population to the evolution components.\r\n    // Car shouldn't know about the evolution loss function.\r\n    if (withLabel && onUpdateLabelThrottledRef.current) {\r\n      onUpdateLabelThrottledRef.current(wheelPositions);\r\n    }\r\n  });\r\n\r\n  let distanceColor = 'black';\r\n  if (carLoss !== null) {\r\n    if (carLoss <= LOSS_VALUE_GOOD_THRESHOLD) {\r\n      distanceColor = 'limegreen';\r\n    } else if (carLoss <= LOSS_VALUE_BAD_THRESHOLD) {\r\n      distanceColor = 'orange';\r\n    } else {\r\n      distanceColor = 'red';\r\n    }\r\n  }\r\n  const label = withLabel ? (\r\n    <span>\r\n      Loss:\r\n      {' '}\r\n      <span style={{color: distanceColor, fontWeight: 'bold'}}>\r\n        {formatLossValue(carLoss)}\r\n      </span>\r\n    </span>\r\n  ) : null;\r\n\r\n  return (\r\n    <group ref={vehicle}>\r\n      <Chassis\r\n        ref={chassis}\r\n        sensorsNum={car.sensorsNum || SENSORS_NUM}\r\n        chassisPosition={CHASSIS_RELATIVE_POSITION}\r\n        styled={styled}\r\n        wireframe={wireframe}\r\n        movable={movable}\r\n        label={label}\r\n        withSensors={withSensors}\r\n        visibleSensors={visibleSensors}\r\n        baseColor={baseColor}\r\n        bodyProps={{ ...bodyProps }}\r\n        onCollide={(event) => onCollide(carMetaData, event)}\r\n        onSensors={onSensors}\r\n        userData={carMetaData}\r\n        collisionFilterGroup={collisionFilterGroup}\r\n        collisionFilterMask={collisionFilterMask}\r\n        performanceBoost={performanceBoost}\r\n      />\r\n      <Wheel\r\n        ref={flWheel}\r\n        radius={wheelRadius}\r\n        bodyProps={wheelBodyProps}\r\n        styled={styled}\r\n        wireframe={wireframe}\r\n        baseColor={baseColor}\r\n        performanceBoost={performanceBoost}\r\n        isLeft\r\n      />\r\n      <Wheel\r\n        ref={frWheel}\r\n        radius={wheelRadius}\r\n        bodyProps={wheelBodyProps}\r\n        styled={styled}\r\n        wireframe={wireframe}\r\n        baseColor={baseColor}\r\n        performanceBoost={performanceBoost}\r\n      />\r\n      <Wheel\r\n        ref={blWheel}\r\n        radius={wheelRadius}\r\n        bodyProps={wheelBodyProps}\r\n        styled={styled}\r\n        wireframe={wireframe}\r\n        baseColor={baseColor}\r\n        performanceBoost={performanceBoost}\r\n        isLeft\r\n      />\r\n      <Wheel\r\n        ref={brWheel}\r\n        radius={wheelRadius}\r\n        bodyProps={wheelBodyProps}\r\n        styled={styled}\r\n        wireframe={wireframe}\r\n        baseColor={baseColor}\r\n        performanceBoost={performanceBoost}\r\n      />\r\n    </group>\r\n  )\r\n}\r\n\r\nexport default Car;\r\n","import React, { useRef, useState } from 'react';\r\n\r\nimport Car from '../car/Car';\r\nimport { NumVec3 } from '../../../types/vectors';\r\nimport { CHASSIS_BASE_COLOR, CHASSIS_BASE_TOUCHED_COLOR, CHASSIS_LENGTH, CHASSIS_WIDTH } from '../car/constants';\r\nimport { CarMetaData } from '../types/car';\r\nimport { generateStaticCarUUID } from '../utils/uuid';\r\n\r\ntype CarBaseColors = Record<string, string>;\r\n\r\ntype StaticCarsProps = {\r\n  rows: number,\r\n  cols: number,\r\n  collisionFilterGroup: number,\r\n  collisionFilterMask: number,\r\n  skipCells?: number[][],\r\n  performanceBoost?: boolean,\r\n};\r\n\r\nfunction StaticCars(props: StaticCarsProps) {\r\n  const {\r\n    rows,\r\n    cols,\r\n    collisionFilterGroup,\r\n    collisionFilterMask,\r\n    skipCells = [[]],\r\n    performanceBoost = false,\r\n  } = props;\r\n\r\n  const [carBaseColors, setCarBaseColors] = useState<CarBaseColors>({});\r\n  const carBaseColorsRef = useRef<CarBaseColors>({});\r\n\r\n  const onCollide = (carMetaData: CarMetaData, event: any) => {\r\n    const touchedCarUUID = carMetaData.uuid;\r\n    if (!touchedCarUUID) {\r\n      return;\r\n    }\r\n    const newCarBaseColors = {\r\n      ...carBaseColorsRef.current,\r\n      [touchedCarUUID]: CHASSIS_BASE_TOUCHED_COLOR,\r\n    };\r\n    carBaseColorsRef.current = newCarBaseColors;\r\n    setCarBaseColors(newCarBaseColors);\r\n  };\r\n\r\n  const staticCarPositions: NumVec3[] = [];\r\n  for (let row = 0; row < rows; row += 1) {\r\n    for (let col = 0; col < cols; col += 1) {\r\n      if (skipCells.find(([skipRow, skipCol]) => (skipRow === row && skipCol === col))) {\r\n        continue;\r\n      }\r\n      const marginedLength = 1.4 * CHASSIS_LENGTH;\r\n      const marginedWidth = 3.5 * CHASSIS_WIDTH;\r\n      const x = -0.5 * marginedWidth + row * marginedWidth;\r\n      const z = -2 * marginedLength + col * marginedLength;\r\n      staticCarPositions.push([x, 0.6, z]);\r\n    }\r\n  }\r\n\r\n  const staticCars = staticCarPositions.map((position: NumVec3, index: number) => {\r\n    const uuid = generateStaticCarUUID(index);\r\n    const baseColor = uuid in carBaseColors ? carBaseColors[uuid] : CHASSIS_BASE_COLOR;\r\n    return (\r\n      <Car\r\n        key={index}\r\n        uuid={uuid}\r\n        bodyProps={{ position }}\r\n        wireframe={false}\r\n        styled={false}\r\n        movable={false}\r\n        baseColor={baseColor}\r\n        collisionFilterGroup={collisionFilterGroup}\r\n        collisionFilterMask={collisionFilterMask}\r\n        onCollide={onCollide}\r\n        performanceBoost={performanceBoost}\r\n      />\r\n    );\r\n  });\r\n\r\n  return (\r\n    <>\r\n      {staticCars}\r\n    </>\r\n  );\r\n}\r\n\r\nexport default StaticCars;\r\n","import { userCarUUID } from '../types/car';\r\n\r\nexport const generateStaticCarUUID = (carIndex: number): userCarUUID => {\r\n  return `car-static-${carIndex}`;\r\n};\r\n","export type DynamicCarsPosition = 'middle' | 'front' | 'rear';\r\n\r\nexport const DYNAMIC_CARS_POSITION_REAR: DynamicCarsPosition = 'rear';\r\nexport const DYNAMIC_CARS_POSITION_MIDDLE: DynamicCarsPosition = 'middle';\r\nexport const DYNAMIC_CARS_POSITION_FRONT: DynamicCarsPosition = 'front';\r\n","import React, { useRef } from 'react';\r\n\r\nimport Car, { OnCarReadyArgs } from '../car/Car';\r\nimport { CarType, EngineOptionsType, SensorValuesType, userCarUUID, WheelOptionsType } from '../types/car';\r\nimport { carEvents, off, on } from '../utils/events';\r\nimport {\r\n  onEngineBackward,\r\n  onEngineForward,\r\n  onEngineNeutral, onPressBreak, onReleaseBreak,\r\n  onWheelsLeft,\r\n  onWheelsRight,\r\n  onWheelsStraight\r\n} from '../utils/controllers';\r\nimport { getRandomColor } from '../../../utils/colors';\r\nimport { RectanglePoints } from '../../../types/vectors';\r\nimport { CHASSIS_SIMPLIFIED_BASE_COLOR } from '../car/constants';\r\nimport { DynamicCarsPosition, DYNAMIC_CARS_POSITION_FRONT } from '../constants/cars';\r\n\r\ntype DynamicCarsProps = {\r\n  cars: CarType[],\r\n  collisionFilterGroup?: number,\r\n  collisionFilterMask?: number,\r\n  withSensors?: boolean,\r\n  withLabels?: boolean,\r\n  visibleSensors?: boolean,\r\n  controllable?: boolean,\r\n  withRandomColors?: boolean,\r\n  withRandomStartingPoint?: boolean,\r\n  performanceBoost?: boolean,\r\n  carsPosition?: DynamicCarsPosition,\r\n};\r\n\r\nfunction DynamicCars(props: DynamicCarsProps) {\r\n  const {\r\n    cars,\r\n    collisionFilterGroup,\r\n    collisionFilterMask,\r\n    withSensors = false,\r\n    visibleSensors = false,\r\n    withLabels = false,\r\n    controllable = false,\r\n    withRandomColors = false,\r\n    withRandomStartingPoint = false,\r\n    performanceBoost = false,\r\n    carsPosition = DYNAMIC_CARS_POSITION_FRONT,\r\n  } = props;\r\n  const carsUUIDs = useRef<userCarUUID[]>([]);\r\n  const carsAPIs = useRef<Record<userCarUUID, OnCarReadyArgs>>({});\r\n\r\n  const activeCars = cars.map((car) => {\r\n    const uuid = car.licencePlate;\r\n    carsUUIDs.current.push(uuid);\r\n\r\n    const onForward = () => { onEngineForward(carsAPIs.current[uuid].api) };\r\n    const onBackward = () => { onEngineBackward(carsAPIs.current[uuid].api) };\r\n    const onNeutral = () => { onEngineNeutral(carsAPIs.current[uuid].api) };\r\n    const onLeft = () => { onWheelsLeft(carsAPIs.current[uuid].api) };\r\n    const onRight = () => { onWheelsRight(carsAPIs.current[uuid].api) };\r\n    const onStraight = () => { onWheelsStraight(carsAPIs.current[uuid].api) };\r\n    const onBreak = () => { onPressBreak(carsAPIs.current[uuid].api) };\r\n    const onBreakRelease = () => { onReleaseBreak(carsAPIs.current[uuid].api) };\r\n\r\n    const onCarReady = (args: OnCarReadyArgs) => {\r\n      carsAPIs.current[uuid] = args;\r\n      if (controllable) {\r\n        on(carEvents.engineForward, onForward);\r\n        on(carEvents.engineBackward, onBackward);\r\n        on(carEvents.engineNeutral, onNeutral);\r\n        on(carEvents.wheelsLeft, onLeft);\r\n        on(carEvents.wheelsRight, onRight);\r\n        on(carEvents.wheelsStraight, onStraight);\r\n        on(carEvents.pressBreak, onBreak);\r\n        on(carEvents.releaseBreak, onBreakRelease);\r\n      }\r\n    };\r\n\r\n    const onCarDestroy = () => {\r\n      if (controllable) {\r\n        off(carEvents.engineForward, onForward);\r\n        off(carEvents.engineBackward, onBackward);\r\n        off(carEvents.engineNeutral, onNeutral);\r\n        off(carEvents.wheelsLeft, onLeft);\r\n        off(carEvents.wheelsRight, onRight);\r\n        off(carEvents.wheelsStraight, onStraight);\r\n        off(carEvents.pressBreak, onBreak);\r\n        off(carEvents.releaseBreak, onBreakRelease);\r\n      }\r\n    };\r\n\r\n    const onSensors = (sensors: SensorValuesType): void => {\r\n      if (car.onEngine) {\r\n        const engineOption: EngineOptionsType = car.onEngine(sensors);\r\n        switch (engineOption) {\r\n          case 'backwards':\r\n            onBackward();\r\n            break;\r\n          case 'neutral':\r\n            onNeutral();\r\n            break;\r\n          case 'forward':\r\n            onForward();\r\n            break;\r\n        }\r\n      }\r\n      if (car.onWheel) {\r\n        const wheelOption: WheelOptionsType = car.onWheel(sensors);\r\n        switch (wheelOption) {\r\n          case 'left':\r\n            onLeft();\r\n            break;\r\n          case 'straight':\r\n            onStraight();\r\n            break;\r\n          case 'right':\r\n            onRight();\r\n            break;\r\n        }\r\n      }\r\n    };\r\n\r\n    const onMove = (wheelsPositions: RectanglePoints) => {\r\n      if (car.onMove) {\r\n        car.onMove(wheelsPositions);\r\n      }\r\n    };\r\n\r\n    const zPositions: Record<DynamicCarsPosition, number> = {\r\n      'rear': withRandomStartingPoint ? -7 - 2 * Math.random() : -7,\r\n      'middle': 0,\r\n      'front': withRandomStartingPoint ? 7 + 2 * Math.random() : 7,\r\n    };\r\n\r\n    const z = zPositions[carsPosition]\r\n    const position = [0, 2, z];\r\n    const angularVelocity = [-0.2, 0, 0];\r\n\r\n    const styledCar = !withRandomColors;\r\n    const carColor = withRandomColors\r\n      ? getRandomColor()\r\n      : performanceBoost\r\n        ? CHASSIS_SIMPLIFIED_BASE_COLOR\r\n        : undefined;\r\n\r\n    return (\r\n      <Car\r\n        key={uuid}\r\n        uuid={uuid}\r\n        bodyProps={{\r\n          position,\r\n          angularVelocity,\r\n        }}\r\n        wireframe={false}\r\n        collisionFilterGroup={collisionFilterGroup}\r\n        collisionFilterMask={collisionFilterMask}\r\n        withSensors={withSensors}\r\n        visibleSensors={visibleSensors}\r\n        onCarReady={onCarReady}\r\n        onCarDestroy={onCarDestroy}\r\n        onSensors={onSensors}\r\n        onMove={onMove}\r\n        movable\r\n        styled={styledCar}\r\n        baseColor={carColor}\r\n        car={car}\r\n        withLabel={withLabels}\r\n        performanceBoost={performanceBoost}\r\n      />\r\n    );\r\n  });\r\n\r\n  return (\r\n    <>\r\n      {activeCars}\r\n    </>\r\n  );\r\n}\r\n\r\nexport default DynamicCars;\r\n","import { RaycastVehiclePublicApi } from '../types/car';\r\nimport { CAR_MAX_BREAK_FORCE, CAR_MAX_FORCE, CAR_MAX_STEER_VALUE } from '../car/constants';\r\n\r\nexport const onEngineForward = (carAPI: RaycastVehiclePublicApi, wheelsNum: number = 4): void => {\r\n  for (let wheelIdx = 0; wheelIdx < wheelsNum; wheelIdx += 1) {\r\n    carAPI.setBrake(0, wheelIdx);\r\n  }\r\n  carAPI.applyEngineForce(-CAR_MAX_FORCE, 2);\r\n  carAPI.applyEngineForce(-CAR_MAX_FORCE, 3);\r\n};\r\n\r\nexport const onEngineBackward = (carAPI: RaycastVehiclePublicApi, wheelsNum: number = 4): void => {\r\n  for (let wheelIdx = 0; wheelIdx < wheelsNum; wheelIdx += 1) {\r\n    carAPI.setBrake(0, wheelIdx);\r\n  }\r\n  carAPI.applyEngineForce(CAR_MAX_FORCE, 2);\r\n  carAPI.applyEngineForce(CAR_MAX_FORCE, 3);\r\n};\r\n\r\nexport const onEngineNeutral = (carAPI: RaycastVehiclePublicApi): void => {\r\n  carAPI.applyEngineForce(0, 2);\r\n  carAPI.applyEngineForce(0, 3);\r\n};\r\n\r\nexport const onWheelsLeft = (carAPI: RaycastVehiclePublicApi): void => {\r\n  carAPI.setSteeringValue(CAR_MAX_STEER_VALUE, 0);\r\n  carAPI.setSteeringValue(CAR_MAX_STEER_VALUE, 1);\r\n};\r\n\r\nexport const onWheelsRight = (carAPI: RaycastVehiclePublicApi): void => {\r\n  carAPI.setSteeringValue(-CAR_MAX_STEER_VALUE, 0);\r\n  carAPI.setSteeringValue(-CAR_MAX_STEER_VALUE, 1);\r\n};\r\n\r\nexport const onWheelsStraight = (carAPI: RaycastVehiclePublicApi,): void => {\r\n  carAPI.setSteeringValue(0, 0);\r\n  carAPI.setSteeringValue(0, 1);\r\n};\r\n\r\nexport const onPressBreak = (carAPI: RaycastVehiclePublicApi, wheelsNum: number = 4): void => {\r\n  for (let wheelIdx = 0; wheelIdx < wheelsNum; wheelIdx += 1) {\r\n    carAPI.setBrake(CAR_MAX_BREAK_FORCE, wheelIdx);\r\n  }\r\n};\r\n\r\nexport const onReleaseBreak = (carAPI: RaycastVehiclePublicApi, wheelsNum: number = 4): void => {\r\n  for (let wheelIdx = 0; wheelIdx < wheelsNum; wheelIdx += 1) {\r\n    carAPI.setBrake(0, wheelIdx);\r\n  }\r\n};\r\n","import colors from 'nice-color-palettes';\r\n\r\nexport const getRandomColor = (): string => {\r\n  const flatColors = colors.flat();\r\n  const colorIndex = Math.floor(Math.random() * flatColors.length);\r\n  return flatColors[colorIndex];\r\n};\r\n","import React from 'react';\r\nimport { Line } from '@react-three/drei';\r\nimport { PARKING_SPOT_INNER_CORNERS, PARKING_SPOT_OUTER_CORNERS } from '../constants/parking';\r\n\r\ntype ParkingSpotProps = {\r\n  color?: string,\r\n};\r\n\r\n// @TODO: Parking lot size should be a configurable from the outside.\r\n// Move this constants to the component parameters.\r\n\r\nconst innerLineVisible = false;\r\n\r\nfunction ParkingSpot(props: ParkingSpotProps) {\r\n  const { color = 'yellow' } = props;\r\n\r\n  const innerLineComponent = innerLineVisible ? (\r\n    <Line\r\n      points={[\r\n        ...PARKING_SPOT_INNER_CORNERS,\r\n        PARKING_SPOT_INNER_CORNERS[0], // Closing the line.\r\n      ]}\r\n      color={color}\r\n      lineWidth={4}\r\n      dashed={false}\r\n    />\r\n  ) : null;\r\n\r\n  return (\r\n    <>\r\n      <Line\r\n        points={[\r\n          ...PARKING_SPOT_OUTER_CORNERS,\r\n          PARKING_SPOT_OUTER_CORNERS[0], // Closing the line.\r\n        ]}\r\n        color={color}\r\n        lineWidth={4}\r\n        dashed={false}\r\n      />\r\n      {innerLineComponent}\r\n    </>\r\n  );\r\n}\r\n\r\nexport default ParkingSpot;\r\n","import React from 'react';\r\n\r\nimport Ground from '../surroundings/Ground';\r\nimport StaticCars from '../cars/StaticCars';\r\nimport DynamicCars from '../cars/DynamicCars';\r\nimport { DYNAMIC_CARS_POSITION_MIDDLE } from '../constants/cars';\r\nimport ParkingSpot from '../surroundings/ParkingSpot';\r\n\r\n// Collision groups and masks must be powers of 2.\r\n// @see: https://github.com/schteppe/cannon.js/blob/master/demos/collisionFilter.html\r\nconst COLLISION_GROUP_ACTIVE_CARS = 0b0001;\r\nconst COLLISION_GROUP_STATIC_OBJECTS = 0b0010;\r\nconst COLLISION_MASK_ACTIVE_CARS = COLLISION_GROUP_STATIC_OBJECTS // It can only collide with static objects.\r\nconst COLLISION_MASK_STATIC_OBJECTS = COLLISION_GROUP_ACTIVE_CARS // It can only collide with active cars.\r\n\r\ntype ParkingManualProps = {\r\n  withLabels?: boolean,\r\n  withSensors?: boolean,\r\n  performanceBoost?: boolean,\r\n};\r\n\r\nfunction ParkingManual(props: ParkingManualProps) {\r\n  const {\r\n    withLabels = false,\r\n    withSensors = false,\r\n    performanceBoost = false,\r\n  } = props;\r\n\r\n  return (\r\n    <>\r\n      <Ground\r\n        userData={{ uuid: 'ground' }}\r\n        collisionFilterGroup={COLLISION_GROUP_STATIC_OBJECTS}\r\n        collisionFilterMask={COLLISION_MASK_STATIC_OBJECTS}\r\n      />\r\n      <ParkingSpot />\r\n      <DynamicCars\r\n        cars={[{licencePlate: 'manual-car', generationIndex: 0, genomeIndex: 0}]}\r\n        collisionFilterGroup={COLLISION_GROUP_ACTIVE_CARS}\r\n        collisionFilterMask={COLLISION_MASK_ACTIVE_CARS}\r\n        withSensors={withSensors}\r\n        withLabels={withLabels}\r\n        performanceBoost={performanceBoost}\r\n        carsPosition={DYNAMIC_CARS_POSITION_MIDDLE}\r\n        controllable\r\n        visibleSensors\r\n      />\r\n      <StaticCars\r\n        rows={2}\r\n        cols={5}\r\n        skipCells={[[0, 2]]}\r\n        collisionFilterGroup={COLLISION_GROUP_STATIC_OBJECTS}\r\n        collisionFilterMask={COLLISION_MASK_STATIC_OBJECTS}\r\n        performanceBoost={performanceBoost}\r\n      />\r\n    </>\r\n  );\r\n}\r\n\r\nexport default ParkingManual;\r\n","import React from 'react';\r\nimport { Block } from 'baseui/block';\r\nimport { Notification } from 'baseui/notification';\r\n\r\nimport World from '../world/World';\r\nimport ParkingManual from '../world/parkings/ParkingManual';\r\n\r\nfunction EvolutionTabManual() {\r\n  return (\r\n    <Block>\r\n      <World\r\n        performanceBoost={false}\r\n        withJoystickControl\r\n        withKeyboardControl\r\n      >\r\n        <ParkingManual\r\n          performanceBoost={false}\r\n          withLabels\r\n          withSensors\r\n        />\r\n      </World>\r\n      <Block marginTop=\"20px\">\r\n        <Notification overrides={{Body: {style: {width: 'auto'}}}}>\r\n          Try to park the car by yourself<br/><br/>\r\n          <small>WASD keys to drive, SPACE to break, Joystick for mobile</small>\r\n        </Notification>\r\n      </Block>\r\n    </Block>\r\n  );\r\n}\r\n\r\nexport default EvolutionTabManual;\r\n","// Picks the random item based on its weight.\r\n// The items with higher weight will be picked more often.\r\nexport const weightedRandom = <T>(items: T[], weights: number[]): { item: T, index: number } => {\r\n  if (items.length !== weights.length) {\r\n    throw new Error('Items and weights must be of the same size');\r\n  }\r\n\r\n  // Preparing the cumulative weights array.\r\n  // For example:\r\n  // - weights = [1, 4, 3]\r\n  // - cumulativeWeights = [1, 5, 8]\r\n  const cumulativeWeights: number[] = [];\r\n  for (let i = 0; i < weights.length; i += 1) {\r\n    cumulativeWeights[i] = weights[i] + (cumulativeWeights[i - 1] || 0);\r\n  }\r\n\r\n  // Getting the random number in a range [0...sum(weights)]\r\n  // For example:\r\n  // - weights = [1, 4, 3]\r\n  // - maxCumulativeWeight = 8\r\n  // - range for the random number is [0...8]\r\n  const maxCumulativeWeight = cumulativeWeights[cumulativeWeights.length - 1];\r\n  const randomNumber = maxCumulativeWeight * Math.random();\r\n\r\n  // Picking the random item based on its weight.\r\n  // The items with higher weight will be picked more often.\r\n  for (let i = 0; i < items.length; i += 1) {\r\n    if (cumulativeWeights[i] >= randomNumber) {\r\n      return {\r\n        item: items[i],\r\n        index: i,\r\n      };\r\n    }\r\n  }\r\n  return {\r\n    item: items[items.length - 1],\r\n    index: items.length - 1,\r\n  };\r\n};\r\n","import { weightedRandom } from './math/probability';\r\n\r\nexport type Gene = 0 | 1;\r\n\r\nexport type Genome = Gene[];\r\n\r\nexport type Generation = Genome[];\r\n\r\nexport type GenerationParams = {\r\n  generationSize: number,\r\n  genomeLength: number,\r\n};\r\n\r\nfunction createGenome(length: number): Genome {\r\n  return new Array(length)\r\n    .fill(null)\r\n    .map(() => (Math.random() < 0.5 ? 0 : 1));\r\n}\r\n\r\nexport function createGeneration(params: GenerationParams): Generation {\r\n  const { generationSize, genomeLength } = params;\r\n  return new Array(generationSize)\r\n    .fill(null)\r\n    .map(() => createGenome(genomeLength));\r\n}\r\n\r\n// The number between 0 and 1.\r\nexport type Probability = number;\r\n\r\n// The number between 0 and 100.\r\nexport type Percentage = number;\r\n\r\n// @see: https://en.wikipedia.org/wiki/Mutation_(genetic_algorithm)\r\nfunction mutate(genome: Genome, mutationProbability: Probability): Genome {\r\n  // Conceive children.\r\n  for (let geneIndex = 0; geneIndex < genome.length; geneIndex += 1) {\r\n    const gene: Gene = genome[geneIndex];\r\n    const mutatedGene: Gene = gene === 0 ? 1 : 0;\r\n    genome[geneIndex] = Math.random() < mutationProbability ? mutatedGene : gene;\r\n  }\r\n  return genome;\r\n}\r\n\r\ntype SelectionOptions = {\r\n  mutationProbability: Probability,\r\n  longLivingChampionsPercentage: Percentage,\r\n};\r\n\r\n// Performs Uniform Crossover: each bit is chosen from either parent with equal probability.\r\n// @see: https://en.wikipedia.org/wiki/Crossover_(genetic_algorithm)\r\nfunction mate(\r\n  father: Genome,\r\n  mother: Genome,\r\n  mutationProbability: Probability,\r\n): [Genome, Genome] {\r\n  if (father.length !== mother.length) {\r\n    throw new Error('Cannot mate different species');\r\n  }\r\n\r\n  const firstChild: Genome = [];\r\n  const secondChild: Genome = [];\r\n\r\n  // Conceive children.\r\n  for (let geneIndex = 0; geneIndex < father.length; geneIndex += 1) {\r\n    firstChild.push(\r\n      Math.random() < 0.5 ? father[geneIndex] : mother[geneIndex]\r\n    );\r\n    secondChild.push(\r\n      Math.random() < 0.5 ? father[geneIndex] : mother[geneIndex]\r\n    );\r\n  }\r\n\r\n  return [\r\n    mutate(firstChild, mutationProbability),\r\n    mutate(secondChild, mutationProbability),\r\n  ];\r\n}\r\n\r\nexport type FitnessFunction = (genome: Genome) => number;\r\n\r\n// @see: https://en.wikipedia.org/wiki/Selection_(genetic_algorithm)\r\nexport function select(\r\n  generation: Generation,\r\n  fitness: FitnessFunction,\r\n  options: SelectionOptions,\r\n) {\r\n  const {\r\n    mutationProbability,\r\n    longLivingChampionsPercentage,\r\n  } = options;\r\n\r\n  const newGeneration: Generation = [];\r\n\r\n  const oldGeneration = [...generation];\r\n  // First one - the fittest one.\r\n  oldGeneration.sort((genomeA: Genome, genomeB: Genome): number => {\r\n    const fitnessA = fitness(genomeA);\r\n    const fitnessB = fitness(genomeB);\r\n    if (fitnessA < fitnessB) {\r\n      return 1;\r\n    }\r\n    if (fitnessA > fitnessB) {\r\n      return -1;\r\n    }\r\n    return 0;\r\n  });\r\n\r\n  // Let long-liver champions continue living in the new generation.\r\n  const longLiversCount = Math.floor(longLivingChampionsPercentage * oldGeneration.length / 100);\r\n  if (longLiversCount) {\r\n    oldGeneration.slice(0, longLiversCount).forEach((longLivingGenome: Genome) => {\r\n      newGeneration.push(longLivingGenome);\r\n    });\r\n  }\r\n\r\n  // Get the data about he fitness of each individuum.\r\n  const fitnessPerOldGenome: number[] = oldGeneration.map((genome: Genome) => fitness(genome));\r\n\r\n  // Populate the next generation until it becomes the same size as a old generation.\r\n  while (newGeneration.length < generation.length) {\r\n    // Select random father and mother from the population.\r\n    // The fittest individuums have higher chances to be selected.\r\n    let father: Genome | null = null;\r\n    let fatherGenomeIndex: number | null = null;\r\n    let mother: Genome | null = null;\r\n    let matherGenomeIndex: number | null = null;\r\n\r\n    // To produce children the father and mother need each other.\r\n    // It must be two different individuums.\r\n    while (!father || !mother || fatherGenomeIndex === matherGenomeIndex) {\r\n      const {\r\n        item: randomFather,\r\n        index: randomFatherGenomeIndex,\r\n      } = weightedRandom<Genome>(generation, fitnessPerOldGenome);\r\n\r\n      const {\r\n        item: randomMother,\r\n        index: randomMotherGenomeIndex,\r\n      } = weightedRandom<Genome>(generation, fitnessPerOldGenome);\r\n\r\n      father = randomFather;\r\n      fatherGenomeIndex = randomFatherGenomeIndex;\r\n\r\n      mother = randomMother;\r\n      matherGenomeIndex = randomMotherGenomeIndex;\r\n    }\r\n\r\n    // Let father and mother produce two children.\r\n    const [firstChild, secondChild] = mate(father, mother, mutationProbability);\r\n\r\n    newGeneration.push(firstChild);\r\n\r\n    // Depending on the number of long-living champions it is possible that\r\n    // there will be the place for only one child, sorry.\r\n    if (newGeneration.length < generation.length) {\r\n      newGeneration.push(secondChild);\r\n    }\r\n  }\r\n\r\n  return newGeneration;\r\n}\r\n","import React from 'react';\r\nimport { Block } from 'baseui/block';\r\n\r\ntype FormElementsRowProps = {\r\n  nodes: React.ReactNode[],\r\n  buttons?: React.ReactNode,\r\n  alignBottom?: boolean,\r\n};\r\n\r\nconst marginX = '10px';\r\n\r\nconst FormElementsRow = (props: FormElementsRowProps) => {\r\n  const {nodes, buttons, alignBottom = false} = props;\r\n\r\n  const rows = nodes.map((node: React.ReactNode, nodeIndex: number) => {\r\n    const marginLeft = nodeIndex === 0 ? 0 : marginX;\r\n    const marginRight = nodeIndex === (nodes.length - 1) && !buttons ? 0 : marginX;\r\n\r\n    return (\r\n      <Block\r\n        key={nodeIndex}\r\n        display=\"flex\"\r\n        flex={1}\r\n        marginLeft={[0, marginLeft, marginLeft]}\r\n        marginRight={[0, marginRight, marginRight]}\r\n        flexDirection=\"column\"\r\n        justifyContent=\"flex-end\"\r\n      >\r\n        {node}\r\n      </Block>\r\n    );\r\n  });\r\n\r\n  const buttonsRow = buttons ? (\r\n    <Block\r\n      display=\"flex\"\r\n      marginLeft={[0, marginX, marginX]}\r\n      flexDirection=\"column\"\r\n      justifyContent=\"flex-end\"\r\n    >\r\n      {buttons}\r\n    </Block>\r\n  ) : null;\r\n\r\n  const alignItems = alignBottom ? 'flex-end' : 'flex-start';\r\n\r\n  return (\r\n    <Block\r\n      display=\"flex\"\r\n      flex={1}\r\n      flexDirection={['column', 'row', 'row']}\r\n      alignItems={['stretch', alignItems, alignItems]}\r\n      justifyContent=\"center\"\r\n    >\r\n      {rows}\r\n      {buttonsRow}\r\n    </Block>\r\n  );\r\n};\r\n\r\nexport default FormElementsRow;\r\n","import React from 'react';\r\nimport { GoInfo } from 'react-icons/all';\r\nimport { Button, SHAPE as BUTTON_SHAPE, KIND as BUTTON_KIND } from 'baseui/button';\r\nimport { StatefulTooltip } from 'baseui/tooltip';\r\n\r\ntype HintProps = {\r\n  hint: string,\r\n};\r\n\r\nconst Hint = (props: HintProps) => {\r\n  const {hint} = props;\r\n\r\n  return (\r\n    <StatefulTooltip\r\n      accessibilityType={'tooltip'}\r\n      content={hint}\r\n    >\r\n      <Button\r\n        shape={BUTTON_SHAPE.round}\r\n        kind={BUTTON_KIND.minimal}\r\n        overrides={{\r\n          BaseButton: {\r\n            style: {\r\n              paddingTop: 0,\r\n              paddingBottom: 0,\r\n              paddingLeft: 0,\r\n              paddingRight: 0,\r\n            },\r\n          },\r\n        }}\r\n      >\r\n        <GoInfo />\r\n      </Button>\r\n    </StatefulTooltip>\r\n  );\r\n};\r\n\r\nexport default Hint;\r\n","import React from 'react';\r\nimport { Block } from 'baseui/block';\r\n\r\ntype RowProps = {\r\n  children: React.ReactNode,\r\n};\r\n\r\nconst Row = (props: RowProps) => {\r\n  const {children} = props;\r\n\r\n  return (\r\n    <Block\r\n      display=\"flex\"\r\n      flexDirection=\"row\"\r\n      justifyContent=\"center\"\r\n      alignItems=\"center\"\r\n    >\r\n      {children}\r\n    </Block>\r\n  );\r\n};\r\n\r\nexport default Row;\r\n","import React, { useEffect, useState } from 'react';\r\nimport { Block } from 'baseui/block';\r\nimport { OnChangeParams, Select, SIZE as SELECT_SIZE } from 'baseui/select';\r\nimport { FormControl } from 'baseui/form-control';\r\nimport { \r\n  Button,\r\n  SIZE as BUTTON_SIZE,\r\n  SHAPE as BUTTON_SHAPE,\r\n  KIND as BUTTON_KIND,\r\n} from 'baseui/button';\r\nimport { Slider } from 'baseui/slider';\r\nimport { BiReset } from 'react-icons/all';\r\nimport { Checkbox, LABEL_PLACEMENT } from 'baseui/checkbox';\r\nimport {\r\n  Modal,\r\n  ModalHeader,\r\n  ModalBody,\r\n  ModalFooter,\r\n  ModalButton,\r\n  SIZE,\r\n  ROLE\r\n} from 'baseui/modal';\r\nimport { Notification, KIND as NOTIFICATION_KIND } from 'baseui/notification';\r\n\r\nimport { Percentage, Probability } from '../../libs/genetic';\r\nimport FormElementsRow from '../shared/FormElementsRow';\r\nimport Hint from '../shared/Hint';\r\nimport Row from '../shared/Row';\r\nimport { GENOME_LENGTH } from '../../libs/carGenetic';\r\n\r\nexport const SECOND: number = 1000;\r\n\r\nconst GENERATION_SIZES: number[] = [4, 10, 50, 100, 200, 500, 1000, 2000];\r\nconst BATCH_SIZES: number[] = [1, 2, 3, 5, 10, 15, 20, 30, 50, 100];\r\n\r\nexport const DEFAULT_PERFORMANCE_BOOST: boolean = false;\r\nexport const DEFAULT_GENERATION_SIZE: number = 100;\r\nexport const DEFAULT_BATCH_SIZE: number = 2;\r\nexport const DEFAULT_MUTATION_PROBABILITY: Probability = 0.04;\r\nexport const DEFAULT_LONG_LIVING_CHAMPIONS_PERCENTAGE: Percentage = 6;\r\nexport const DEFAULT_GENERATION_LIFETIME: number = 17;\r\nexport const TRAINED_CAR_GENERATION_LIFETIME: number = DEFAULT_GENERATION_LIFETIME;\r\n\r\ntype EvolutionBoardParamsProps = {\r\n  generationSize: number,\r\n  batchSize: number,\r\n  mutationProbability: Probability,\r\n  longLivingChampionsPercentage: Percentage,\r\n  generationLifetime: number,\r\n  performanceBoost: boolean,\r\n  onGenerationSizeChange: (size: number) => void,\r\n  onBatchSizeChange: (size: number) => void,\r\n  onGenerationLifetimeChange: (time: number) => void,\r\n  onMutationProbabilityChange: (probability: Probability) => void,\r\n  onLongLivingChampionsPercentageChange: (percentage: Percentage) => void,\r\n  onPerformanceBoost: (state: boolean) => void,\r\n  onReset: () => void,\r\n};\r\n\r\nfunction EvolutionBoardParams(props: EvolutionBoardParamsProps) {\r\n  const {\r\n    generationSize,\r\n    batchSize,\r\n    generationLifetime,\r\n    longLivingChampionsPercentage,\r\n    onGenerationSizeChange,\r\n    performanceBoost,\r\n    onBatchSizeChange,\r\n    onGenerationLifetimeChange,\r\n    mutationProbability,\r\n    onMutationProbabilityChange,\r\n    onLongLivingChampionsPercentageChange,\r\n    onPerformanceBoost,\r\n    onReset,\r\n  } = props;\r\n\r\n  const [mutationProbabilityInternal, setMutationProbabilityInternal] = useState<Probability>(mutationProbability);\r\n  const [generationLifetimeInternal, setGenerationLifetimeInternal] = useState<number>(generationLifetime);\r\n  const [longLivingChampionsPercentageInternal, setLongLivingChampionsPercentageInternal] = useState<Percentage>(longLivingChampionsPercentage);\r\n  const [confirmationModalOpen, setConfirmationModalOpen] = useState<boolean>(false);\r\n\r\n  useEffect(() => {\r\n    setMutationProbabilityInternal(mutationProbability);\r\n    setGenerationLifetimeInternal(generationLifetime);\r\n    setLongLivingChampionsPercentageInternal(longLivingChampionsPercentage);\r\n  }, [mutationProbability, generationLifetime, longLivingChampionsPercentage]);\r\n\r\n  const onConfirmationModalOpen = () => {\r\n    setConfirmationModalOpen(true);\r\n  };\r\n\r\n  const onConfirmationModalClose = () => {\r\n    setConfirmationModalOpen(false);\r\n  };\r\n\r\n  const onConfirmationModalConfirm = () => {\r\n    setConfirmationModalOpen(false);\r\n    onReset();\r\n  };\r\n\r\n  const generationSizeCurrentValue = [{\r\n    id: `${generationSize}`,\r\n    size: generationSize,\r\n  }];\r\n  const generationSizes = GENERATION_SIZES.map((size: number) => {\r\n    return {\r\n      id: `${size}`,\r\n      size,\r\n    };\r\n  });\r\n  const generationSizeSelector = (\r\n    <FormControl label={() => 'Generation size'}>\r\n      <Select\r\n        options={generationSizes}\r\n        value={generationSizeCurrentValue}\r\n        onChange={(params: OnChangeParams) => onGenerationSizeChange(params.value[0].size)}\r\n        labelKey=\"id\"\r\n        valueKey=\"size\"\r\n        size={SELECT_SIZE.compact}\r\n        clearable={false}\r\n        searchable={false}\r\n      />\r\n    </FormControl>\r\n  );\r\n\r\n  const batchSizeCurrentValue = [{\r\n    id: `${batchSize}`,\r\n    size: batchSize,\r\n  }];\r\n  const batchSizes = BATCH_SIZES.map((size: number) => {\r\n    return {\r\n      id: `${size}`,\r\n      size,\r\n    };\r\n  });\r\n  const batchSizeSelector = (\r\n    <FormControl label={() => 'Group size'}>\r\n      <Select\r\n        options={batchSizes}\r\n        value={batchSizeCurrentValue}\r\n        onChange={(params: OnChangeParams) => onBatchSizeChange(params.value[0].size)}\r\n        labelKey=\"id\"\r\n        valueKey=\"size\"\r\n        size={SELECT_SIZE.compact}\r\n        clearable={false}\r\n        searchable={false}\r\n      />\r\n    </FormControl>\r\n  );\r\n\r\n  const sliderOverrides = {\r\n    TickBar: {\r\n      style: {\r\n        paddingBottom: 0,\r\n      },\r\n    },\r\n    InnerThumb: ({$value, $thumbIndex}: {$value: number[], $thumbIndex: number}) => (\r\n      <React.Fragment>{$value[$thumbIndex]}</React.Fragment>\r\n    ),\r\n    ThumbValue: () => null,\r\n    Thumb: {\r\n      style: () => ({\r\n        color: 'white',\r\n        fontSize: '10px',\r\n        fontWeight: 600,\r\n      }),\r\n    },\r\n  };\r\n\r\n  const generationLifetimeChanger = (\r\n    <FormControl\r\n      label={() => 'Generation lifetime, s'}\r\n      caption={() => 'Time the cars have for parking'}\r\n    >\r\n      <Slider\r\n        step={1}\r\n        marks={false}\r\n        persistentThumb\r\n        min={10}\r\n        max={30}\r\n        value={[generationLifetimeInternal]}\r\n        onChange={({ value }) => value && setGenerationLifetimeInternal(value[0])}\r\n        onFinalChange={({value}) => onGenerationLifetimeChange(value[0])}\r\n        valueToLabel={(value) => `${value}s`}\r\n        overrides={sliderOverrides}\r\n      />\r\n    </FormControl>\r\n  );\r\n\r\n  const genesToBeMutated = Math.floor(GENOME_LENGTH * mutationProbabilityInternal);\r\n\r\n  const mutationProbabilityChanger = (\r\n    <FormControl\r\n      label={() => 'Gene mutation probability, %'}\r\n      caption={() => `≈${genesToBeMutated} out of ${GENOME_LENGTH} car genes will be mutated`}\r\n    >\r\n      <Slider\r\n        step={1}\r\n        marks={false}\r\n        persistentThumb\r\n        min={0}\r\n        max={100}\r\n        value={[Math.floor(mutationProbabilityInternal * 100)]}\r\n        onChange={({ value }) => value && setMutationProbabilityInternal(value[0] / 100)}\r\n        onFinalChange={({value}) => onMutationProbabilityChange(value[0] / 100)}\r\n        valueToLabel={(value) => `${value}%`}\r\n        overrides={sliderOverrides}\r\n      />\r\n    </FormControl>\r\n  );\r\n\r\n  const longLivingChampionsCount = Math.floor(generationSize * longLivingChampionsPercentageInternal / 100);\r\n  const longLivingChampionsChanger = (\r\n    <FormControl\r\n      label={() => 'Long-living champions, %'}\r\n      caption={() => `${longLivingChampionsCount} best cars will be copied to the next generation`}\r\n    >\r\n      <Slider\r\n        step={1}\r\n        marks={false}\r\n        persistentThumb\r\n        min={0}\r\n        max={100}\r\n        value={[longLivingChampionsPercentageInternal]}\r\n        onChange={({ value }) => value && setLongLivingChampionsPercentageInternal(value[0])}\r\n        onFinalChange={({value}) => onLongLivingChampionsPercentageChange(value[0])}\r\n        valueToLabel={(value) => `${value}%`}\r\n        overrides={sliderOverrides}\r\n      />\r\n    </FormControl>\r\n  );\r\n\r\n  const resetButton = (\r\n    <FormControl>\r\n      <Button\r\n        size={BUTTON_SIZE.compact}\r\n        shape={BUTTON_SHAPE.pill}\r\n        onClick={onConfirmationModalOpen}\r\n        startEnhancer={() => <BiReset size={18} />}\r\n        overrides={{\r\n          BaseButton: {\r\n            props: {\r\n              title: 'Reset evolution configuration and training progress',\r\n            },\r\n          },\r\n        }}\r\n      >\r\n        Reset\r\n      </Button>\r\n    </FormControl>\r\n  );\r\n\r\n  const performanceBooster = (\r\n    <Block>\r\n      <FormControl>\r\n        <Block marginTop=\"10px\">\r\n          <Checkbox\r\n            checked={performanceBoost}\r\n            // @ts-ignore\r\n            onChange={e => onPerformanceBoost(e.target.checked)}\r\n            labelPlacement={LABEL_PLACEMENT.right}\r\n          >\r\n            <Row>\r\n              <Block marginRight=\"5px\">\r\n                <small>Performance boost</small>\r\n              </Block>\r\n              <Hint\r\n                hint=\"Speed up the simulation by simplifying the geometry\"\r\n              />\r\n            </Row>\r\n          </Checkbox>\r\n        </Block>\r\n      </FormControl>\r\n    </Block>\r\n  );\r\n\r\n  const resetConfirmationModal = (\r\n    <Modal\r\n      onClose={onConfirmationModalClose}\r\n      closeable\r\n      isOpen={confirmationModalOpen}\r\n      animate\r\n      autoFocus\r\n      size={SIZE.default}\r\n      role={ROLE.dialog}\r\n    >\r\n      <ModalHeader>\r\n        Confirm evolution resetting\r\n      </ModalHeader>\r\n      <ModalBody>\r\n        <Notification\r\n          kind={NOTIFICATION_KIND.warning}\r\n          overrides={{\r\n            Body: {style: {width: 'auto'}},\r\n          }}\r\n        >\r\n          Resetting will clear the evolution configuration and also the training progress\r\n        </Notification>\r\n      </ModalBody>\r\n      <ModalFooter>\r\n        <ModalButton\r\n          size={BUTTON_SIZE.compact}\r\n          shape={BUTTON_SHAPE.pill}\r\n          onClick={onConfirmationModalClose}\r\n          kind={BUTTON_KIND.tertiary}\r\n        >\r\n          Cancel\r\n        </ModalButton>\r\n        <ModalButton\r\n          size={BUTTON_SIZE.compact}\r\n          shape={BUTTON_SHAPE.pill}\r\n          onClick={onConfirmationModalConfirm}\r\n          kind={BUTTON_KIND.primary}\r\n          startEnhancer={() => <BiReset size={18} />}\r\n        >\r\n          Reset\r\n        </ModalButton>\r\n      </ModalFooter>\r\n    </Modal>\r\n  );\r\n\r\n  return (\r\n    <Block display=\"flex\" flexDirection=\"column\">\r\n      <FormElementsRow\r\n        nodes={[\r\n          generationLifetimeChanger,\r\n          mutationProbabilityChanger,\r\n          longLivingChampionsChanger,\r\n        ]}\r\n      />\r\n      <FormElementsRow\r\n        nodes={[\r\n          generationSizeSelector,\r\n          batchSizeSelector,\r\n        ]}\r\n        buttons={resetButton}\r\n        alignBottom\r\n      />\r\n      <FormElementsRow\r\n        nodes={[\r\n          performanceBooster,\r\n        ]}\r\n      />\r\n      {resetConfirmationModal}\r\n    </Block>\r\n  );\r\n}\r\n\r\nexport default EvolutionBoardParams;\r\n","import React from 'react';\r\nimport { Block } from 'baseui/block';\r\nimport { Table, DIVIDER, SIZE as TABLE_SIZE } from 'baseui/table-semantic';\r\nimport { Tag, VARIANT as TAG_VARIANT, KIND as TAG_KIND } from 'baseui/tag';\r\nimport { StyledSpinnerNext } from 'baseui/spinner';\r\nimport { withStyle } from 'baseui';\r\n\r\nimport { CarLicencePlateType, CarsType, CarType } from '../world/types/car';\r\nimport { formatLossValue } from './utils/evolution';\r\nimport FadeIn from '../shared/FadeIn';\r\nimport { FITNESS_ALPHA, LOSS_VALUE_BAD_THRESHOLD, LOSS_VALUE_GOOD_THRESHOLD } from './constants/evolution';\r\nimport { carLossToFitness } from '../../libs/carGenetic';\r\n\r\nexport type CarsInProgressType = Record<CarLicencePlateType, boolean>;\r\nexport type CarsLossType = Record<CarLicencePlateType, number | null>;\r\n\r\ntype PopulationTableProps = {\r\n  cars: CarsType,\r\n  carsInProgress: CarsInProgressType,\r\n  carsLoss: CarsLossType,\r\n};\r\n\r\nconst sortTable = true;\r\n\r\nconst CellSpinner = withStyle(StyledSpinnerNext, {\r\n  width: '18px',\r\n  height: '18px',\r\n  borderLeftWidth: '3px',\r\n  borderRightWidth: '3px',\r\n  borderTopWidth: '3px',\r\n  borderBottomWidth: '3px',\r\n  borderTopColor: 'black',\r\n});\r\n\r\nfunction PopulationTable(props: PopulationTableProps) {\r\n  const { cars, carsInProgress, carsLoss } = props;\r\n  const carsArray: CarType[] = Object.values<CarType>(cars);\r\n\r\n  const columns = [\r\n    'Licence Plate',\r\n    'Loss',\r\n    'Fitness',\r\n  ];\r\n\r\n  const rowsData: React.ReactNode[][] = carsArray\r\n    .sort((carA: CarType, carB: CarType): number => {\r\n      if (!sortTable) {\r\n        return 0;\r\n      }\r\n      const lossA = getCarLoss(carsLoss, carA);\r\n      const lossB = getCarLoss(carsLoss, carB);\r\n      if (lossA === null && lossB !== null) {\r\n        return 1;\r\n      }\r\n      if (lossA !== null && lossB === null) {\r\n        return -1;\r\n      }\r\n      if (lossA === null || lossB === null) {\r\n        return 0;\r\n      }\r\n      if (lossA === lossB) {\r\n        return 0;\r\n      }\r\n      if (lossA <= lossB) {\r\n        return -1;\r\n      }\r\n      return 1;\r\n    })\r\n    .map((car: CarType) => {\r\n      const licencePlateCell = (\r\n        <Tag\r\n          closeable={false}\r\n          kind={TAG_KIND.neutral}\r\n          variant={TAG_VARIANT.light}\r\n        >\r\n          {car.licencePlate}\r\n        </Tag>\r\n      );\r\n\r\n      const carLossFormatted: number | null = getCarLoss(carsLoss, car);\r\n      let carLossColor = '';\r\n      if (carLossFormatted !== null) {\r\n        if (carLossFormatted < LOSS_VALUE_GOOD_THRESHOLD) {\r\n          carLossColor = 'limegreen';\r\n        } else if (carLossFormatted < LOSS_VALUE_BAD_THRESHOLD) {\r\n          carLossColor = 'orange';\r\n        } else {\r\n          carLossColor = 'red';\r\n        }\r\n      }\r\n      const lossCell = carsInProgress[car.licencePlate] ? (\r\n        <FadeIn>\r\n          <CellSpinner />\r\n        </FadeIn>\r\n      ) : (\r\n        <Block color={carLossColor}>\r\n          {carLossFormatted}\r\n        </Block>\r\n      );\r\n\r\n      const fitnessValue: number | null = getCarFitness(carsLoss, car);\r\n      const fitnessCell = carsInProgress[car.licencePlate] ? (\r\n        <FadeIn>\r\n          <CellSpinner />\r\n        </FadeIn>\r\n      ) : (\r\n        <Block color={carLossColor}>\r\n          {fitnessValue}\r\n        </Block>\r\n      );\r\n\r\n      return [\r\n        licencePlateCell,\r\n        lossCell,\r\n        fitnessCell,\r\n      ];\r\n    });\r\n\r\n  return (\r\n    <Block>\r\n      <Table\r\n        columns={columns}\r\n        data={rowsData}\r\n        emptyMessage=\"No population yet\"\r\n        divider={DIVIDER.grid}\r\n        size={TABLE_SIZE.compact}\r\n        overrides={{\r\n          Root: {\r\n            style: {\r\n              maxHeight: '343px',\r\n            },\r\n          },\r\n          TableBodyCell: {\r\n            style: {\r\n              verticalAlign: 'center',\r\n            },\r\n          },\r\n        }}\r\n      />\r\n    </Block>\r\n  );\r\n}\r\n\r\nfunction getCarLoss(carsLoss: CarsLossType, car: CarType): number | null {\r\n  return carsLoss.hasOwnProperty(car.licencePlate) && typeof carsLoss[car.licencePlate] === 'number'\r\n    ? formatLossValue(carsLoss[car.licencePlate])\r\n    : null;\r\n}\r\n\r\nfunction getCarFitness(carsLoss: CarsLossType, car: CarType): number | null {\r\n  return carsLoss.hasOwnProperty(car.licencePlate) && typeof carsLoss[car.licencePlate] === 'number'\r\n    ? formatLossValue(carLossToFitness(carsLoss[car.licencePlate] || 0, FITNESS_ALPHA))\r\n    : null;\r\n}\r\n\r\nexport default PopulationTable;\r\n","import React, { useCallback, useEffect, useRef, useState } from 'react';\r\nimport { Label1 } from 'baseui/typography';\r\nimport { Block } from 'baseui/block';\r\n\r\nimport './Timer.css';\r\n\r\ntype TimeMs = number;\r\n\r\ntype TimerProps = {\r\n  timeout?: TimeMs,\r\n  interval?: TimeMs,\r\n  version?: string,\r\n}\r\n\r\nfunction Timer(props: TimerProps) {\r\n  const {timeout = null, interval = 1000, version = ''} = props;\r\n\r\n  const [timePassed, setTimePassed] = useState<number>(0);\r\n  const timePassedRef = useRef<number>(0);\r\n\r\n  const timerRef = useRef<NodeJS.Timeout | null>(null);\r\n\r\n  const reversedTime = timeout !== null;\r\n\r\n  const onInterval = () => {\r\n    timePassedRef.current += interval;\r\n    setTimePassed(timePassedRef.current);\r\n  };\r\n\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  const onIntervalCallback = useCallback(onInterval, [timeout, interval]);\r\n\r\n  useEffect(() => {\r\n    if (timerRef.current) {\r\n      clearInterval(timerRef.current);\r\n    }\r\n    timePassedRef.current = 0;\r\n    setTimePassed(0);\r\n    timerRef.current = setInterval(onIntervalCallback, interval);\r\n    return () => {\r\n      if (timerRef.current) {\r\n        clearInterval(timerRef.current);\r\n      }\r\n    };\r\n  }, [onIntervalCallback, interval, version]);\r\n\r\n  const formattedTime = timeout !== null\r\n    ? formatTime(timeout - timePassed)\r\n    : formatTime(timePassed);\r\n\r\n  return (\r\n    <Block display=\"flex\" flexDirection=\"row\" alignItems=\"flex-end\">\r\n      <Block marginRight=\"5px\">\r\n        <div className={reversedTime ? 'timer-loader-reverse' : 'timer-loader'} />\r\n      </Block>\r\n      <Label1>\r\n        <b><code>{formattedTime}</code></b>\r\n      </Label1>\r\n    </Block>\r\n  );\r\n}\r\n\r\nfunction formatTime(timeMs: TimeMs): string {\r\n  let timeSec = Math.max(Math.floor(timeMs / 1000), 0);\r\n  let secPrefix = '';\r\n  if (timeSec < 60) {\r\n    secPrefix = timeSec < 10 ? '0' : '';\r\n    return `${secPrefix}${timeSec}s`;\r\n  }\r\n  const timeMin = Math.floor(timeSec / 60);\r\n  timeSec = timeSec % 60;\r\n  secPrefix = timeSec < 10 ? '0' : '';\r\n  return `${timeMin}m${secPrefix}${timeSec}s`;\r\n}\r\n\r\nexport default Timer;\r\n","import React from 'react';\r\nimport { Label3 } from 'baseui/typography';\r\nimport {Tag, VARIANT as TAG_VARIANT} from 'baseui/tag';\r\nimport { Block } from 'baseui/block';\r\nimport {Notification, KIND as NOTIFICATION_KIND} from 'baseui/notification';\r\nimport { VscDebugRestart } from 'react-icons/all';\r\n\r\nimport Timer from '../shared/Timer';\r\n\r\ntype EvolutionTimingProps = {\r\n  generationIndex?: number | null,\r\n  totalBatches?: number | null,\r\n  batchIndex?: number | null,\r\n  generationLifetimeMs?: number,\r\n  batchVersion?: string,\r\n  worldVersion?: string,\r\n  retry?: boolean,\r\n  groupLabel?: string,\r\n  batchLifetimeLabel?: string,\r\n};\r\n\r\nfunction EvolutionTiming(props: EvolutionTimingProps) {\r\n  const {\r\n    generationIndex,\r\n    batchIndex,\r\n    totalBatches,\r\n    generationLifetimeMs,\r\n    batchVersion,\r\n    worldVersion,\r\n    retry = false,\r\n    groupLabel = 'Group',\r\n    batchLifetimeLabel = 'Group lifetime',\r\n  } = props;\r\n\r\n  const batchesCounter = retry ? (\r\n    <Block marginBottom=\"-2px\">\r\n      <VscDebugRestart title=\"Retrying the first group since the loss value increased\" />\r\n    </Block>\r\n  ) : (\r\n    <>\r\n      <small>#</small>{(batchIndex || 0) + 1}\r\n      {totalBatches && (<span> / {totalBatches}</span>)}\r\n    </>\r\n  );\r\n\r\n  const generationInfo = generationIndex !== undefined ? (\r\n    <TimingColumn caption=\"Generation\">\r\n      <Tag closeable={false} variant={TAG_VARIANT.solid} kind=\"neutral\">\r\n        <small>#</small>{(generationIndex || 0) + 1}\r\n      </Tag>\r\n    </TimingColumn>\r\n  ) : null;\r\n\r\n  const groupInfo = batchIndex !== undefined ? (\r\n    <TimingColumn caption={groupLabel}>\r\n      <Tag closeable={false} variant={TAG_VARIANT.solid} kind=\"neutral\">\r\n        {batchesCounter}\r\n      </Tag>\r\n    </TimingColumn>\r\n  ) : null;\r\n\r\n  const groupLifetime = generationLifetimeMs !== undefined && batchVersion !== undefined ? (\r\n    <TimingColumn caption={batchLifetimeLabel}>\r\n      <Block padding=\"3px\">\r\n        <Timer timeout={generationLifetimeMs} version={batchVersion} />\r\n      </Block>\r\n    </TimingColumn>\r\n  ) : null;\r\n\r\n  const worldAge = worldVersion !== undefined ? (\r\n    <TimingColumn caption=\"World age\">\r\n      <Block padding=\"3px\">\r\n        <Timer version={worldVersion} />\r\n      </Block>\r\n    </TimingColumn>\r\n  ) : null;\r\n\r\n  return (\r\n    <Notification\r\n      closeable={false}\r\n      kind={NOTIFICATION_KIND.warning}\r\n      overrides={{\r\n        Body: {style: {width: 'auto'}},\r\n        InnerContainer: {style: {flex: 1}},\r\n      }}\r\n    >\r\n      <Block\r\n        display=\"flex\"\r\n        flexDirection={['column', 'row', 'row']}\r\n        alignItems={['flex-start', 'flex-end', 'center']}\r\n        justifyContent=\"space-between\"\r\n        width=\"auto\"\r\n        flex=\"1\"\r\n      >\r\n        {generationInfo}\r\n        {groupInfo}\r\n        {groupLifetime}\r\n        {worldAge}\r\n      </Block>\r\n    </Notification>\r\n  );\r\n}\r\n\r\ntype TimingColumnProps = {\r\n  caption: string,\r\n  children: React.ReactNode,\r\n};\r\n\r\nfunction TimingColumn(props: TimingColumnProps) {\r\n  const {caption, children} = props;\r\n  return (\r\n    <Block\r\n      display=\"flex\"\r\n      flexDirection={['row', 'column', 'row']}\r\n      alignItems=\"center\"\r\n      marginLeft=\"5px\"\r\n      marginRight=\"5px\"\r\n    >\r\n      <Block\r\n        marginRight={['5px', '0', '5px']}\r\n        marginBottom={['0', '5px', '0']}\r\n        color=\"black\"\r\n        $style={{textAlign: 'center'}}\r\n      >\r\n        {caption}:\r\n      </Block>\r\n      <Label3>\r\n        {children}\r\n      </Label3>\r\n    </Block>\r\n  );\r\n}\r\n\r\nexport default EvolutionTiming;\r\n","import * as React from 'react';\r\nimport { useState } from 'react';\r\nimport { Block } from 'baseui/block';\r\nimport { Datum, Point, ResponsiveLine, Serie } from '@nivo/line';\r\nimport { Checkbox } from 'baseui/checkbox';\r\n\r\nimport { formatLossValue } from './utils/evolution';\r\n\r\ntype LossHistoryProps = {\r\n  history: number[],\r\n  avgHistory: number[],\r\n};\r\n\r\n// @see: Nivo docs: https://nivo.rocks/line\r\nfunction LossHistory(props: LossHistoryProps) {\r\n  const {history, avgHistory} = props;\r\n\r\n  const [showAvgHistory, setShowAvgHistory] = useState<boolean>(true);\r\n  const [showMinLoss, setShowMinLoss] = useState<boolean>(true);\r\n\r\n  const emptyStateHistoryData: [number] = [0];\r\n  const historyData: Datum[] = (history.length ? history : emptyStateHistoryData).map(\r\n    (loss: number, generationIndex: number): Datum => {\r\n      const miss = loss === Infinity ? null : formatLossValue(loss);\r\n      return {\r\n        x: generationIndex,\r\n        y: miss,\r\n      };\r\n    }\r\n  );\r\n\r\n  const emptyStateAvgHistoryData: [number] = [0];\r\n  const avgHistoryData: Datum[] = (avgHistory.length ? avgHistory : emptyStateAvgHistoryData).map(\r\n    (loss: number, generationIndex: number): Datum => {\r\n      const miss = loss === Infinity ? null : formatLossValue(loss);\r\n      return {\r\n        x: generationIndex,\r\n        y: miss,\r\n      };\r\n    }\r\n  );\r\n\r\n  const chartData: Serie[] = [];\r\n\r\n  const minLossSeriesId = 'Min Loss';\r\n  const avgLossSeriesId = 'P50 Avg Loss';\r\n\r\n  if (showMinLoss) {\r\n    chartData.push({\r\n      id: minLossSeriesId,\r\n      data: historyData,\r\n      color: 'black',\r\n    });\r\n  }\r\n\r\n  if (showAvgHistory) {\r\n    chartData.push({\r\n      id: avgLossSeriesId,\r\n      data: avgHistoryData,\r\n      color: '#AAAAAA',\r\n    });\r\n  }\r\n\r\n  const chart = (\r\n    <ResponsiveLine\r\n      data={chartData}\r\n      margin={{ top: 3, right: 10, bottom: 42, left: 50 }}\r\n      xScale={history.length <= 20\r\n        ? { type: 'point' }\r\n        : { type: 'linear', min: 0, max: 'auto' }\r\n      }\r\n      yScale={{ type: 'linear', min: 0, max: 'auto' }}\r\n      yFormat=\" >-.2f\"\r\n      curve={'monotoneX'}\r\n      axisBottom={{\r\n        legend: 'Generation #',\r\n        legendOffset: 36,\r\n        legendPosition: 'middle',\r\n      }}\r\n      axisLeft={{\r\n        legend: 'Loss',\r\n        legendOffset: -40,\r\n        legendPosition: 'middle',\r\n      }}\r\n      pointSize={6}\r\n      pointColor={(datum: Datum) => {\r\n        return datum.color || 'black';\r\n      }}\r\n      pointBorderWidth={1}\r\n      pointBorderColor={'white'}\r\n      useMesh={true}\r\n      enableCrosshair={true}\r\n      enableSlices={false}\r\n      colors={(datum: Datum) => {\r\n        return datum.color || 'black';\r\n      }}\r\n      tooltip={({point}: {point: Point}) => {\r\n        const {data, serieId} = point;\r\n        return (\r\n          <Block $style={{\r\n            backgroundColor: 'white',\r\n            padding: '8px',\r\n            borderRadius: '8px',\r\n            boxShadow: '0 2px 1px -1px rgba(0,0,0,0.2), 0 1px 1px 0 rgba(0,0,0,0.14), 0 1px 3px 0 rgba(0,0,0,0.12)'\r\n          }}>\r\n            <Block marginBottom=\"3px\">\r\n              <small>\r\n                Generation: <b>{data.xFormatted}</b>\r\n              </small>\r\n            </Block>\r\n            <Block>\r\n              <small>\r\n                {serieId}: <b>{data.yFormatted}</b>\r\n              </small>\r\n            </Block>\r\n          </Block>\r\n        );\r\n      }}\r\n      legends={[\r\n        {\r\n          anchor: 'top-right',\r\n          direction: 'column',\r\n          justify: false,\r\n          translateX: -10,\r\n          translateY: 0,\r\n          itemsSpacing: 0,\r\n          itemDirection: 'left-to-right',\r\n          itemWidth: 80,\r\n          itemHeight: 20,\r\n          itemOpacity: 1,\r\n          symbolSize: 8,\r\n          symbolShape: 'circle',\r\n          symbolBorderColor: 'rgba(0, 0, 0, .5)',\r\n        }\r\n      ]}\r\n    />\r\n  );\r\n\r\n  const chartControls = (\r\n    <Block display=\"flex\" flexDirection=\"row\" marginTop=\"20px\" marginLeft=\"47px\">\r\n      <Block marginRight=\"30px\">\r\n        <Checkbox\r\n          disabled={!showAvgHistory}\r\n          checked={showMinLoss}\r\n          onChange={() => setShowMinLoss(!showMinLoss)}\r\n        >\r\n          {minLossSeriesId}\r\n        </Checkbox>\r\n      </Block>\r\n\r\n      <Block>\r\n        <Checkbox\r\n          disabled={!showMinLoss}\r\n          checked={showAvgHistory}\r\n          onChange={() => setShowAvgHistory(!showAvgHistory)}\r\n        >\r\n          {avgLossSeriesId}\r\n        </Checkbox>\r\n      </Block>\r\n    </Block>\r\n  );\r\n\r\n  return (\r\n    <Block>\r\n      <Block\r\n        height=\"300px\"\r\n        $style={{\r\n          fontFamily: 'system-ui, \"Helvetica Neue\", Helvetica, Arial, sans-serif',\r\n          fontSize: '14px',\r\n        }}\r\n      >\r\n        {chart}\r\n      </Block>\r\n      <Block>\r\n        {chartControls}\r\n      </Block>\r\n    </Block>\r\n  );\r\n}\r\n\r\nexport default LossHistory;\r\n","import * as React from 'react';\r\nimport { Block } from 'baseui/block';\r\nimport { CSSProperties, FormEvent, useState } from 'react';\r\nimport { Textarea } from 'baseui/textarea';\r\nimport { Button, SHAPE as BUTTON_SHAPE, KIND as BUTTON_KIND, SIZE as BUTTON_SIZE } from 'baseui/button';\r\nimport { BiEdit, FaRegSave } from 'react-icons/all';\r\n\r\nimport { Gene, Genome } from '../../libs/genetic';\r\nimport { CarLicencePlateType } from '../world/types/car';\r\nimport { FormControl } from 'baseui/form-control';\r\nimport { formatLossValue } from './utils/evolution';\r\nimport { CAR_SENSORS_NUM, carLossToFitness, decodeGenome, FormulaCoefficients } from '../../libs/carGenetic';\r\nimport { FITNESS_ALPHA } from './constants/evolution';\r\n\r\ntype GenomePreviewProps = {\r\n  genome: Genome | null,\r\n  title?: string,\r\n  licencePlate?: CarLicencePlateType | null,\r\n  loss?: number | null,\r\n  editable?: boolean,\r\n  onGenomeEdit?: (genome: Genome) => void,\r\n};\r\n\r\nconst genomeSeparator = ' ';\r\n\r\nconst commonGenomeStyles: CSSProperties = {\r\n  paddingTop: '15px',\r\n  paddingRight: '15px',\r\n  paddingBottom: '15px',\r\n  paddingLeft: '15px',\r\n  fontSize: '12px',\r\n  backgroundColor: '#FFFFFF',\r\n  lineHeight: '20px',\r\n  fontFamily: 'monospace',\r\n};\r\n\r\nfunction GenomePreview(props: GenomePreviewProps) {\r\n  const {\r\n    title,\r\n    genome,\r\n    licencePlate,\r\n    loss,\r\n    editable = false,\r\n    onGenomeEdit = (genome: Genome) => {},\r\n  } = props;\r\n\r\n  const [shortEngineFormula] = useState<boolean>(true);\r\n  const [shortWheelsFormula] = useState<boolean>(true);\r\n\r\n  const [isEditableGenome, setIsEditableGenome] = useState<boolean>(false);\r\n  const [editedGenome, setEditedGenome] = useState<Genome | null>(genome);\r\n  const [genomeError, setGenomeError] = useState<string | null>(null);\r\n\r\n  const onGenomeUpdate = (genomeString: string) => {\r\n    if (!genome) {\r\n      return;\r\n    }\r\n\r\n    const genomeFromString: Genome = genomeString\r\n      .trim()\r\n      .split('')\r\n      .filter((geneString: string) => ['0', '1'].includes(geneString))\r\n      .map((geneString: string) => {\r\n        const gene: Gene = geneString === '0' ? 0 : 1;\r\n        return gene;\r\n      });\r\n    setEditedGenome(genomeFromString);\r\n\r\n    if (genomeFromString.length !== genome.length) {\r\n      setGenomeError(`Genome must have ${genome.length} genes. Currently it has ${genomeFromString.length} genes.`);\r\n    } else {\r\n      setGenomeError(null);\r\n    }\r\n  };\r\n\r\n  const onEditToggle = () => {\r\n    if (editedGenome && isEditableGenome && !genomeError) {\r\n      onGenomeEdit(editedGenome)\r\n    }\r\n    setIsEditableGenome(!isEditableGenome);\r\n  };\r\n\r\n  const genomeCaption = (\r\n    <Block display=\"flex\" flexDirection=\"row\">\r\n      {genome && (\r\n        <Block marginRight=\"10px\">\r\n          Genes: <b>{genome.length}</b>\r\n        </Block>\r\n      )}\r\n      {licencePlate && (\r\n        <Block marginRight=\"15px\">\r\n          Licence plate: <b>{licencePlate}</b>\r\n        </Block>\r\n      )}\r\n      {loss && (\r\n        <Block marginRight=\"15px\">\r\n          Loss: <b>{formatLossValue(loss)}</b>\r\n        </Block>\r\n      )}\r\n      {loss && (\r\n        <Block>\r\n          Fitness: <b>{formatLossValue(carLossToFitness(loss, FITNESS_ALPHA))}</b>\r\n        </Block>\r\n      )}\r\n    </Block>\r\n  );\r\n\r\n  const label = title || 'Car genome';\r\n\r\n  const genomeEditButtonIcon = !isEditableGenome ? (\r\n    <BiEdit title=\"Edit genome\" />\r\n  ) : null;\r\n\r\n  const genomeSaveButtonIcon = isEditableGenome ? (\r\n    <FaRegSave title=\"Save genome\" />\r\n  ) : null;\r\n\r\n  const genomeEditButtons = editable ? (\r\n    <Block\r\n      display=\"flex\"\r\n      flexDirection=\"row\"\r\n      justifyContent=\"flex-end\"\r\n      alignItems=\"center\"\r\n      marginBottom=\"-30px\"\r\n    >\r\n      <Button\r\n        onClick={onEditToggle}\r\n        shape={BUTTON_SHAPE.pill}\r\n        kind={BUTTON_KIND.minimal}\r\n        size={BUTTON_SIZE.default}\r\n        disabled={!!genomeError}\r\n        overrides={{\r\n          BaseButton: {\r\n            style: {\r\n              paddingTop: 0,\r\n              paddingRight: 0,\r\n              paddingBottom: 0,\r\n              paddingLeft: 0,\r\n              marginTop: '5px',\r\n              display: 'block',\r\n            },\r\n            props: {\r\n              title: isEditableGenome ? 'Save genome' : 'Edit genome',\r\n            },\r\n          },\r\n        }}\r\n      >\r\n        <Block>\r\n          {genomeEditButtonIcon}\r\n          {genomeSaveButtonIcon}\r\n        </Block>\r\n      </Button>\r\n    </Block>\r\n  ) : null;\r\n\r\n  const genomePreviewLabel = (\r\n    <Block>\r\n      {label}\r\n    </Block>\r\n  );\r\n\r\n  const genomeString = (genome || []).join(genomeSeparator);\r\n  const genomePreviewOutput = (\r\n    <FormControl\r\n      label={genomePreviewLabel}\r\n      caption={genomeCaption}\r\n    >\r\n      <CodeBlock>\r\n        {genomeString}\r\n      </CodeBlock>\r\n    </FormControl>\r\n  );\r\n\r\n  const editedGenomeString = (editedGenome || []).join(genomeSeparator);\r\n  const genomeEditableOutput = (\r\n    <FormControl\r\n      label={() => genomePreviewLabel}\r\n      caption={(\r\n        <span>\r\n          Copy/paste whole genome or double-click the specific gene and change it\r\n        </span>\r\n      )}\r\n      error={genomeError}\r\n    >\r\n      <Textarea\r\n        value={editedGenomeString}\r\n        onChange={(event: FormEvent<HTMLTextAreaElement>) => {\r\n          // @ts-ignore\r\n          onGenomeUpdate(event.target.value);\r\n        }}\r\n        overrides={{\r\n          Input: {\r\n            style: {\r\n              ...commonGenomeStyles,\r\n              height: '120px',\r\n            },\r\n          },\r\n        }}\r\n        error={!!genomeError}\r\n        autoFocus\r\n      />\r\n    </FormControl>\r\n  );\r\n\r\n  const genomeOutput = isEditableGenome ? genomeEditableOutput : genomePreviewOutput;\r\n\r\n  let decodedEngineFormula = null;\r\n  let decodedWheelsFormula = null;\r\n  if (genome) {\r\n    const { engineFormulaCoefficients, wheelsFormulaCoefficients } = decodeGenome(genome);\r\n    decodedEngineFormula = (\r\n      <Coefficients\r\n        label=\"Engine formula\"\r\n        caption={\r\n          `Multipliers for ${CAR_SENSORS_NUM} car sensors (+1 bias unit) that define the engine mode (backward, neutral, forward)`\r\n        }\r\n        coefficients={engineFormulaCoefficients}\r\n        shortNumbers={shortEngineFormula}\r\n      />\r\n    );\r\n    decodedWheelsFormula = (\r\n      <Coefficients\r\n        label=\"Wheels formula\"\r\n        caption={\r\n          `Multipliers for ${CAR_SENSORS_NUM} car sensors (+1 bias unit) that define the wheels direction (left, straight, right)`\r\n        }\r\n        coefficients={wheelsFormulaCoefficients}\r\n        shortNumbers={shortWheelsFormula}\r\n      />\r\n    );\r\n  }\r\n\r\n  const blocksMarginBottom = '30px';\r\n\r\n  return (\r\n    <Block>\r\n      <Block marginBottom={blocksMarginBottom}>\r\n        {genomeEditButtons}\r\n        {genomeOutput}\r\n      </Block>\r\n\r\n      <Block marginBottom={blocksMarginBottom}>\r\n        {decodedEngineFormula}\r\n      </Block>\r\n\r\n      <Block marginBottom={blocksMarginBottom}>\r\n        {decodedWheelsFormula}\r\n      </Block>\r\n    </Block>\r\n  );\r\n}\r\n\r\ntype CoefficientsProps = {\r\n  label: string,\r\n  caption: string,\r\n  coefficients: FormulaCoefficients,\r\n  shortNumbers: boolean,\r\n};\r\n\r\nfunction Coefficients(props: CoefficientsProps) {\r\n  const {coefficients, label, caption, shortNumbers} = props;\r\n  const coefficientsString = coefficients\r\n    .map((coefficient: number) => formatCoefficient(coefficient, shortNumbers))\r\n    .join(', ');\r\n  return (\r\n    <Block>\r\n      <FormControl\r\n        label={() => label}\r\n        caption={() => caption}\r\n      >\r\n        <CodeBlock>\r\n          {coefficientsString}\r\n        </CodeBlock>\r\n      </FormControl>\r\n    </Block>\r\n  );\r\n}\r\n\r\ntype CodeBlockProps = {\r\n  children: React.ReactNode,\r\n};\r\n\r\nfunction CodeBlock(props: CodeBlockProps) {\r\n  const {children} = props;\r\n  return (\r\n    <>\r\n      <Block $style={{\r\n        ...commonGenomeStyles,\r\n        border: '1px dotted #CCCCCC',\r\n        borderRadius: '3px',\r\n      }}>\r\n        <code>\r\n          {children}\r\n        </code>\r\n      </Block>\r\n    </>\r\n  );\r\n}\r\n\r\nfunction formatCoefficient(coefficient: number, shortNumber: boolean = true): number {\r\n  if (shortNumber) {\r\n    return Math.ceil(coefficient * 1000) / 1000;\r\n  }\r\n  return coefficient;\r\n}\r\n\r\nexport default GenomePreview;\r\n","import React from 'react';\r\nimport { Panel, StatelessAccordion } from 'baseui/accordion';\r\nimport { Genome } from '../../libs/genetic';\r\nimport GenomePreview from './GenomePreview';\r\nimport { CarLicencePlateType } from '../world/types/car';\r\n\r\nconst GENOME_PANELS = {\r\n  firstBestGenome: 'first-best-genome',\r\n  secondBestGenome: 'second-best-genome',\r\n};\r\n\r\ntype BestGenomesProps = {\r\n  bestGenomePanelTitle?: string,\r\n  bestGenome: Genome | null,\r\n  bestCarLicencePlate?: CarLicencePlateType | null,\r\n  minLoss?: number | null,\r\n  secondBestGenomePanelTitle?: string,\r\n  secondBestGenome?: Genome | null,\r\n  secondBestCarLicencePlate?: CarLicencePlateType | null,\r\n  secondMinLoss?: number | null,\r\n  editable?: boolean,\r\n  onBestGenomeEdit?: (genome: Genome) => void,\r\n};\r\n\r\nfunction BestGenomes(props: BestGenomesProps): React.ReactElement {\r\n  const {\r\n    bestGenomePanelTitle = '1st Best Car Genome',\r\n    bestGenome,\r\n    bestCarLicencePlate,\r\n    minLoss,\r\n    secondBestGenomePanelTitle = '2nd Best Car Genome',\r\n    secondBestGenome,\r\n    secondBestCarLicencePlate,\r\n    secondMinLoss,\r\n    editable = false,\r\n    onBestGenomeEdit = (genome: Genome) => {},\r\n  } = props;\r\n\r\n  const [genomeExpandedTabs, setGenomeExpandedTabs] = React.useState<React.Key[]>([\r\n    GENOME_PANELS.firstBestGenome\r\n  ]);\r\n\r\n  const onPanelChange = (\r\n    {key, expanded}: {key: React.Key, expanded: React.Key[]}\r\n  ) => {\r\n    const newGenomeExpandedTabs = [...genomeExpandedTabs];\r\n    const openedTabIndex = newGenomeExpandedTabs.indexOf(key);\r\n    if (openedTabIndex === -1) {\r\n      newGenomeExpandedTabs.push(key);\r\n    } else {\r\n      newGenomeExpandedTabs.splice(openedTabIndex);\r\n    }\r\n    setGenomeExpandedTabs(newGenomeExpandedTabs);\r\n  };\r\n\r\n  const bestGenomePreview = (\r\n    <GenomePreview\r\n      genome={bestGenome}\r\n      licencePlate={bestCarLicencePlate}\r\n      loss={minLoss}\r\n      editable={editable}\r\n      onGenomeEdit={onBestGenomeEdit}\r\n    />\r\n  );\r\n\r\n  const secondBestGenomePreview = secondBestGenome !== undefined ? (\r\n    <GenomePreview\r\n      genome={secondBestGenome}\r\n      licencePlate={secondBestCarLicencePlate}\r\n      loss={secondMinLoss}\r\n    />\r\n  ) : null;\r\n\r\n  const panels = [];\r\n\r\n  const firstBestGenomePanel = (\r\n    <Panel title={bestGenomePanelTitle} key={GENOME_PANELS.firstBestGenome}>\r\n      {bestGenomePreview}\r\n    </Panel>\r\n  );\r\n\r\n  const secondBestGenomePanel = secondBestGenomePreview ? (\r\n    <Panel title={secondBestGenomePanelTitle} key={GENOME_PANELS.secondBestGenome}>\r\n      {secondBestGenomePreview}\r\n    </Panel>\r\n  ) : null;\r\n\r\n  panels.push(firstBestGenomePanel);\r\n  if (secondBestGenomePanel) {\r\n    panels.push(secondBestGenomePanel);\r\n  }\r\n\r\n  return (\r\n    <StatelessAccordion\r\n      expanded={genomeExpandedTabs}\r\n      onChange={onPanelChange}\r\n    >\r\n      {panels}\r\n    </StatelessAccordion>\r\n  );\r\n}\r\n\r\nexport default BestGenomes;\r\n","import React from 'react';\r\nimport { Block } from 'baseui/block';\r\n\r\nimport PopulationTable, { CarsInProgressType, CarsLossType } from './PopulationTable';\r\nimport EvolutionBoardParams from './EvolutionBoardParams';\r\nimport EvolutionTiming from './EvolutionTiming';\r\nimport LossHistory from './LossHistory';\r\nimport BestGenomes from './BestGenomes';\r\nimport { CarLicencePlateType, CarsType } from '../world/types/car';\r\nimport { Genome, Percentage, Probability } from '../../libs/genetic';\r\n\r\ntype EvolutionAnalyticsProps = {\r\n  generationIndex: number | null,\r\n  carsBatchIndex: number | null,\r\n  totalBatches: number | null,\r\n  worldIndex: number,\r\n  generationLifetimeMs: number,\r\n  generationSize: number,\r\n  carsBatchSize: number,\r\n  mutationProbability: Probability,\r\n  performanceBoost: boolean,\r\n  needToRetry: boolean,\r\n  longLivingChampionsPercentage: Percentage,\r\n  generationLifetime: number,\r\n  batchVersion: string,\r\n  onGenerationSizeChange: (size: number) => void,\r\n  onBatchSizeChange: (size: number) => void,\r\n  onGenerationLifetimeChange: (time: number) => void,\r\n  onReset: () => void,\r\n  onMutationProbabilityChange: (probability: Probability) => void,\r\n  onLongLivingChampionsPercentageChange: (percentage: Percentage) => void,\r\n  onPerformanceBoost: (state: boolean) => void,\r\n  lossHistory: number[],\r\n  avgLossHistory: number[],\r\n  cars: CarsType,\r\n  carsInProgress: CarsInProgressType,\r\n  carsLoss: CarsLossType[],\r\n  bestGenome: Genome | null,\r\n  bestCarLicencePlate: CarLicencePlateType | null,\r\n  minLoss: number | null,\r\n  secondBestGenome: Genome | null,\r\n  secondBestCarLicencePlate: CarLicencePlateType | null,\r\n  secondMinLoss: number | null,\r\n};\r\n\r\nfunction EvolutionAnalytics(props: EvolutionAnalyticsProps) {\r\n  const {\r\n    generationIndex,\r\n    carsBatchIndex,\r\n    totalBatches,\r\n    needToRetry,\r\n    mutationProbability,\r\n    longLivingChampionsPercentage,\r\n    worldIndex,\r\n    generationLifetimeMs,\r\n    generationSize,\r\n    performanceBoost,\r\n    carsBatchSize,\r\n    generationLifetime,\r\n    batchVersion,\r\n    onGenerationSizeChange,\r\n    onBatchSizeChange,\r\n    onGenerationLifetimeChange,\r\n    onReset,\r\n    onMutationProbabilityChange,\r\n    onLongLivingChampionsPercentageChange,\r\n    onPerformanceBoost,\r\n    lossHistory,\r\n    avgLossHistory,\r\n    cars,\r\n    carsInProgress,\r\n    carsLoss,\r\n    bestGenome,\r\n    bestCarLicencePlate,\r\n    minLoss,\r\n    secondBestGenome,\r\n    secondBestCarLicencePlate,\r\n    secondMinLoss,\r\n  } = props;\r\n\r\n  const timingDetails = (\r\n    <Block marginBottom=\"30px\" marginTop=\"20px\">\r\n      <EvolutionTiming\r\n        generationIndex={generationIndex}\r\n        batchIndex={carsBatchIndex}\r\n        totalBatches={totalBatches}\r\n        batchVersion={batchVersion}\r\n        worldVersion={`${worldIndex}`}\r\n        generationLifetimeMs={generationLifetimeMs}\r\n        retry={needToRetry}\r\n      />\r\n    </Block>\r\n  );\r\n\r\n  const evolutionParams = (\r\n    <Block marginBottom=\"30px\">\r\n      <EvolutionBoardParams\r\n        generationSize={generationSize}\r\n        batchSize={carsBatchSize}\r\n        mutationProbability={mutationProbability}\r\n        generationLifetime={generationLifetime}\r\n        longLivingChampionsPercentage={longLivingChampionsPercentage}\r\n        performanceBoost={performanceBoost}\r\n        onGenerationSizeChange={onGenerationSizeChange}\r\n        onBatchSizeChange={onBatchSizeChange}\r\n        onGenerationLifetimeChange={onGenerationLifetimeChange}\r\n        onMutationProbabilityChange={onMutationProbabilityChange}\r\n        onLongLivingChampionsPercentageChange={onLongLivingChampionsPercentageChange}\r\n        onPerformanceBoost={onPerformanceBoost}\r\n        onReset={onReset}\r\n      />\r\n    </Block>\r\n  );\r\n\r\n  const lossHistoryChart = (\r\n    <Block marginBottom=\"30px\">\r\n      <LossHistory\r\n        history={lossHistory}\r\n        avgHistory={avgLossHistory}\r\n      />\r\n    </Block>\r\n  );\r\n\r\n  const populationTable = (\r\n    <Block>\r\n      <PopulationTable\r\n        cars={cars}\r\n        carsInProgress={carsInProgress}\r\n        carsLoss={\r\n          generationIndex !== null && carsLoss[generationIndex]\r\n            ? carsLoss[generationIndex]\r\n            : {}\r\n        }\r\n      />\r\n    </Block>\r\n  );\r\n\r\n  return (\r\n    <>\r\n      {timingDetails}\r\n      {evolutionParams}\r\n      <Block display=\"flex\" flexDirection={['column', 'column', 'row-reverse']}>\r\n        <Block flex={2} marginBottom=\"30px\" marginLeft={['0px', '0px', '15px']}>\r\n          {lossHistoryChart}\r\n        </Block>\r\n        <Block flex={1} marginBottom=\"30px\" marginRight={['0px', '0px', '15px']}>\r\n          {populationTable}\r\n        </Block>\r\n      </Block>\r\n      <BestGenomes\r\n        bestGenome={bestGenome}\r\n        bestCarLicencePlate={bestCarLicencePlate}\r\n        minLoss={minLoss}\r\n        secondBestGenome={secondBestGenome}\r\n        secondBestCarLicencePlate={secondBestCarLicencePlate}\r\n        secondMinLoss={secondMinLoss}\r\n      />\r\n    </>\r\n  );\r\n}\r\n\r\nexport default EvolutionAnalytics;\r\n","import React from 'react';\r\n\r\nimport Ground from '../surroundings/Ground';\r\nimport StaticCars from '../cars/StaticCars';\r\nimport DynamicCars from '../cars/DynamicCars';\r\nimport { DynamicCarsPosition } from '../constants/cars';\r\nimport ParkingSpot from '../surroundings/ParkingSpot';\r\nimport { CarType } from '../types/car';\r\n\r\n// Collision groups and masks must be powers of 2.\r\n// @see: https://github.com/schteppe/cannon.js/blob/master/demos/collisionFilter.html\r\nconst COLLISION_GROUP_ACTIVE_CARS = 0b0001;\r\nconst COLLISION_GROUP_STATIC_OBJECTS = 0b0010;\r\nconst COLLISION_MASK_ACTIVE_CARS = COLLISION_GROUP_STATIC_OBJECTS // It can only collide with static objects.\r\nconst COLLISION_MASK_STATIC_OBJECTS = COLLISION_GROUP_ACTIVE_CARS // It can only collide with active cars.\r\n\r\ntype ParkingAutomaticProps = {\r\n  cars: CarType[],\r\n  withVisibleSensors?: boolean,\r\n  withLabels?: boolean,\r\n  performanceBoost?: boolean,\r\n  carsPosition?: DynamicCarsPosition,\r\n};\r\n\r\nfunction ParkingAutomatic(props: ParkingAutomaticProps) {\r\n  const {\r\n    cars,\r\n    withVisibleSensors = false,\r\n    withLabels = false,\r\n    performanceBoost = false,\r\n    carsPosition,\r\n  } = props;\r\n\r\n  return (\r\n    <>\r\n      <Ground\r\n        userData={{ uuid: 'ground' }}\r\n        collisionFilterGroup={COLLISION_GROUP_STATIC_OBJECTS}\r\n        collisionFilterMask={COLLISION_MASK_STATIC_OBJECTS}\r\n      />\r\n      <ParkingSpot />\r\n      <DynamicCars\r\n        cars={cars}\r\n        collisionFilterGroup={COLLISION_GROUP_ACTIVE_CARS}\r\n        collisionFilterMask={COLLISION_MASK_ACTIVE_CARS}\r\n        controllable\r\n        withSensors\r\n        visibleSensors={withVisibleSensors}\r\n        withLabels={withLabels}\r\n        withRandomColors={false}\r\n        performanceBoost={performanceBoost}\r\n        carsPosition={carsPosition}\r\n      />\r\n      <StaticCars\r\n        rows={2}\r\n        cols={5}\r\n        skipCells={[[0, 2]]}\r\n        collisionFilterGroup={COLLISION_GROUP_STATIC_OBJECTS}\r\n        collisionFilterMask={COLLISION_MASK_STATIC_OBJECTS}\r\n        performanceBoost={performanceBoost}\r\n      />\r\n    </>\r\n  );\r\n}\r\n\r\nexport default ParkingAutomatic;\r\n","import React, { useState } from 'react';\r\nimport { Block } from 'baseui/block';\r\nimport { \r\n  Button,\r\n  SIZE as BUTTON_SIZE,\r\n  SHAPE as BUTTON_SHAPE,\r\n  KIND as BUTTON_KIND,\r\n} from 'baseui/button';\r\nimport { BiDownload, BiUpload } from 'react-icons/all';\r\nimport { saveAs } from 'file-saver';\r\nimport {\r\n  Modal,\r\n  ModalHeader,\r\n  ModalBody,\r\n  SIZE,\r\n  ROLE\r\n} from 'baseui/modal';\r\nimport { FileUploader } from 'baseui/file-uploader';\r\nimport { Notification, KIND as NOTIFICATION_KIND } from 'baseui/notification';\r\nimport { Paragraph3 } from 'baseui/typography';\r\n\r\nimport Row from '../shared/Row';\r\nimport { Generation, Percentage, Probability } from '../../libs/genetic';\r\nimport demoCheckpoint from '../../checkpoints/ckpt--population-1000--generation-36.json';\r\n\r\nexport type EvolutionCheckpoint = {\r\n  dateTime: string,\r\n  generationIndex: number,\r\n  lossHistory: number[],\r\n  avgLossHistory: number[],\r\n  performanceBoost: boolean,\r\n  generationSize: number,\r\n  generationLifetime: number,\r\n  carsBatchSize: number,\r\n  mutationProbability: Probability,\r\n  longLivingChampionsPercentage: Percentage,\r\n  generation: Generation,\r\n};\r\n\r\ntype EvolutionCheckpointSaverProps = {\r\n  onRestoreFromCheckpoint: (checkpoint: EvolutionCheckpoint) => void,\r\n  onCheckpointToFile: () => EvolutionCheckpoint,\r\n};\r\n\r\nfunction EvolutionCheckpointSaver(props: EvolutionCheckpointSaverProps) {\r\n  const {\r\n    onRestoreFromCheckpoint,\r\n    onCheckpointToFile,\r\n  } = props;\r\n\r\n  const [showCheckpointModal, setShowCheckpointModal] = useState<boolean>(false);\r\n  const [checkpointIsProcessing, setCheckpointIsProcessing] = useState<boolean>(false);\r\n  const [checkpointErrorMessage, setCheckpointErrorMessage] = useState<string | null>(null);\r\n\r\n  const onSaveEvolution = () => {\r\n    const checkpoint: EvolutionCheckpoint = onCheckpointToFile();\r\n    const fileName = `ckpt--population-${checkpoint.generationSize}--generation-${checkpoint.generationIndex}.json`;\r\n    const checkpointString: string = JSON.stringify(checkpoint);\r\n    const checkpointBlob = new Blob(\r\n      [checkpointString],\r\n      { type: 'application/json' },\r\n    );\r\n    saveAs(checkpointBlob, fileName);\r\n  };\r\n\r\n  const onCheckpointModalOpen = () => {\r\n    setCheckpointErrorMessage(null);\r\n    setCheckpointIsProcessing(false);\r\n    setShowCheckpointModal(true);\r\n  };\r\n\r\n  const onCheckpointModalClose = () => {\r\n    setShowCheckpointModal(false);\r\n  };\r\n\r\n  const onCancelCheckpointUpload = () => {\r\n    setCheckpointIsProcessing(false);\r\n  };\r\n\r\n  const onFileDrop = (acceptedFiles: File[]) => {\r\n    try {\r\n      setCheckpointIsProcessing(true);\r\n\r\n      const onFileReaderLoaded = (event: Event) => {\r\n        // @ts-ignore\r\n        const checkpoint: EvolutionCheckpoint = JSON.parse(event.target.result);\r\n        onRestoreFromCheckpoint(checkpoint);\r\n        setCheckpointIsProcessing(false);\r\n        onCheckpointModalClose();\r\n      };\r\n  \r\n      const fileReader = new FileReader();\r\n      fileReader.onload = onFileReaderLoaded;\r\n      fileReader.readAsText(acceptedFiles[0]);\r\n    } catch (error: any) {\r\n      setCheckpointErrorMessage(error.message);\r\n      setCheckpointIsProcessing(false);\r\n    }\r\n  };\r\n\r\n  const onUseDemoCheckpoint = () => {\r\n    try {\r\n      // @ts-ignore\r\n      onRestoreFromCheckpoint(demoCheckpoint);\r\n      onCheckpointModalClose();\r\n    } catch (error: any) {\r\n      setCheckpointErrorMessage(error.message);\r\n    }\r\n  };\r\n\r\n  const checkpointError = checkpointErrorMessage ? (\r\n    <Notification\r\n      kind={NOTIFICATION_KIND.negative}\r\n      overrides={{\r\n        Body: {style: {width: 'auto'}},\r\n      }}\r\n    >\r\n      {checkpointErrorMessage}\r\n    </Notification>\r\n  ) : null;\r\n\r\n  const checkpointModal = (\r\n    <Modal\r\n      onClose={onCheckpointModalClose}\r\n      closeable\r\n      isOpen={showCheckpointModal}\r\n      animate\r\n      autoFocus\r\n      size={SIZE.default}\r\n      role={ROLE.dialog}\r\n    >\r\n      <ModalHeader>Restore evolution from the checkpoint file</ModalHeader>\r\n      <ModalBody>\r\n        {checkpointError}\r\n        <Paragraph3>\r\n          Checkpoint is a <code>json</code> file that contain the history of the evolution and the list of genomes from the latest generation.\r\n        </Paragraph3>\r\n        <Paragraph3>\r\n          You may save your own evolution progress to the checkpoint file.\r\n        </Paragraph3>\r\n\r\n        <Block marginBottom=\"20px\">\r\n          <Button\r\n            size={BUTTON_SIZE.compact}\r\n            shape={BUTTON_SHAPE.pill}\r\n            kind={BUTTON_KIND.secondary}\r\n            onClick={onUseDemoCheckpoint}\r\n          >\r\n            Use demo checkpoint  \r\n          </Button>\r\n        </Block>\r\n\r\n        <FileUploader\r\n          onCancel={onCancelCheckpointUpload}\r\n          onDrop={onFileDrop}\r\n          accept=\"application/json\"\r\n          multiple={false}\r\n          progressMessage={checkpointIsProcessing ? 'Processing...' : ''}\r\n        />\r\n      </ModalBody>\r\n    </Modal>\r\n  );\r\n\r\n  return (\r\n    <>\r\n      <Row>\r\n        <Block marginRight=\"5px\">\r\n          <Button\r\n            startEnhancer={() => <BiDownload size={18} />}\r\n            size={BUTTON_SIZE.compact}\r\n            shape={BUTTON_SHAPE.pill}\r\n            onClick={onSaveEvolution}\r\n          >\r\n            Save evolution\r\n          </Button>\r\n        </Block>\r\n\r\n        <Block marginLeft=\"5px\">\r\n          <Button\r\n            startEnhancer={() => <BiUpload size={18} />}\r\n            size={BUTTON_SIZE.compact}\r\n            shape={BUTTON_SHAPE.pill}\r\n            onClick={onCheckpointModalOpen}\r\n          >\r\n            Restore evolution\r\n          </Button>\r\n        </Block>\r\n      </Row>\r\n\r\n      {checkpointModal}\r\n    </>\r\n  );\r\n}\r\n\r\nexport default EvolutionCheckpointSaver;\r\n","import React, { useEffect, useRef, useState } from 'react';\r\nimport _ from 'lodash';\r\nimport { Block } from 'baseui/block';\r\nimport { useSnackbar, DURATION } from 'baseui/snackbar';\r\nimport { Check } from 'baseui/icon';\r\nimport { BiUpload } from 'react-icons/all';\r\nimport { Notification } from 'baseui/notification';\r\n\r\nimport { createGeneration, Generation, Genome, Percentage, Probability, select } from '../../libs/genetic';\r\nimport { CarsLossType, CarsInProgressType } from './PopulationTable';\r\nimport { CarLicencePlateType, CarsType, CarType } from '../world/types/car';\r\nimport {\r\n  DEFAULT_BATCH_SIZE,\r\n  DEFAULT_GENERATION_LIFETIME,\r\n  DEFAULT_GENERATION_SIZE,\r\n  DEFAULT_LONG_LIVING_CHAMPIONS_PERCENTAGE,\r\n  DEFAULT_MUTATION_PROBABILITY,\r\n  DEFAULT_PERFORMANCE_BOOST,\r\n  SECOND,\r\n} from './EvolutionBoardParams';\r\nimport { carLossToFitness, GENOME_LENGTH } from '../../libs/carGenetic';\r\nimport {\r\n  generateWorldVersion,\r\n  generationToCars,\r\n  loadGenerationFromStorage,\r\n  removeGenerationFromStorage,\r\n  saveGenerationToStorage\r\n} from './utils/evolution';\r\nimport { \r\n  deleteSearchParam,\r\n  getBooleanSearchParam,\r\n  getFloatSearchParam,\r\n  getIntSearchParam,\r\n  setSearchParam,\r\n} from '../../utils/url';\r\nimport EvolutionAnalytics from './EvolutionAnalytics';\r\nimport { loggerBuilder } from '../../utils/logger';\r\nimport ParkingAutomatic from '../world/parkings/ParkingAutomatic';\r\nimport World from '../world/World';\r\nimport { BAD_SIMULATION_BATCH_INDEX_CHECK, BAD_SIMULATION_MIN_LOSS_INCREASE_PERCENTAGE, BAD_SIMULATION_RETRIES_ENABLED, BAD_SIMULATION_RETRIES_NUM, FITNESS_ALPHA } from './constants/evolution';\r\nimport EvolutionCheckpointSaver, { EvolutionCheckpoint } from './EvolutionCheckpointSaver';\r\nimport { DynamicCarsPosition } from '../world/constants/cars';\r\nimport { DYNAMIC_CARS_POSITION_FRONT } from '../world/constants/cars';\r\n\r\nconst GENERATION_SIZE_URL_PARAM = 'generation';\r\nconst GROUP_SIZE_URL_PARAM = 'group';\r\nconst GENERATION_LIFETIME_URL_PARAM = 'lifetime';\r\nconst MUTATION_PROBABILITY_URL_PARAM = 'mutation';\r\nconst LONG_LIVING_CHAMPIONS_URL_PARAM = 'champions';\r\nconst PERFORMANCE_BOOST_URL_PARAM = 'boost';\r\n\r\n//  Genome array, concatenated to a string (i.e. '1010011')\r\ntype GenomeKey = string;\r\n\r\ntype GenomeLossType = Record<GenomeKey, number | null>;\r\n\r\nfunction EvolutionTabEvolution() {\r\n  const {enqueue} = useSnackbar();\r\n\r\n  const [performanceBoost, setPerformanceBoost] = useState<boolean>(\r\n    getBooleanSearchParam(PERFORMANCE_BOOST_URL_PARAM, DEFAULT_PERFORMANCE_BOOST)\r\n  );\r\n\r\n  const [worldIndex, setWorldIndex] = useState<number>(0);\r\n\r\n  const [generationSize, setGenerationSize] = useState<number>(\r\n    getIntSearchParam(GENERATION_SIZE_URL_PARAM, DEFAULT_GENERATION_SIZE)\r\n  );\r\n  const [restoredFromGenerationIndex, setRestoredFromGenerationIndex] = useState<number | null>(null);\r\n  const [generationIndex, setGenerationIndex] = useState<number | null>(null);\r\n  const [generation, setGeneration] = useState<Generation>([]);\r\n  const [generationLifetime, setGenerationLifetime] = useState<number>(\r\n    getIntSearchParam(GENERATION_LIFETIME_URL_PARAM, DEFAULT_GENERATION_LIFETIME)\r\n  );\r\n\r\n  const [cars, setCars] = useState<CarsType>({});\r\n  const [carsBatch, setCarsBatch] = useState<CarType[]>([]);\r\n  const [carsBatchSize, setCarsBatchSize] = useState<number>(\r\n    getIntSearchParam(GROUP_SIZE_URL_PARAM, DEFAULT_BATCH_SIZE)\r\n  );\r\n  const [carsBatchIndex, setCarsBatchIndex] = useState<number | null>(null);\r\n  const carsRef = useRef<CarsType>({});\r\n\r\n  const [bestGenome, setBestGenome] = useState<Genome | null>(null);\r\n  const [minLoss, setMinLoss] = useState<number | null>(null);\r\n  const [bestCarLicencePlate, setBestCarLicencePlate] = useState<CarLicencePlateType | null>(null);\r\n  const [secondBestGenome, setSecondBestGenome] = useState<Genome | null>(null);\r\n  const [secondMinLoss, setSecondMinLoss] = useState<number | null>(null);\r\n  const [secondBestCarLicencePlate, setSecondBestCarLicencePlate] = useState<CarLicencePlateType | null>(null);\r\n\r\n  const [dynamicCarsPosition] = useState<DynamicCarsPosition>(DYNAMIC_CARS_POSITION_FRONT);\r\n\r\n  const batchTimer = useRef<NodeJS.Timeout | null>(null);\r\n\r\n  const carsLossRef = useRef<CarsLossType[]>([{}]);\r\n  const [carsLoss, setCarsLoss] = useState<CarsLossType[]>([{}]);\r\n  const [lossHistory, setLossHistory] = useState<number[]>([]);\r\n  const [avgLossHistory, setAvgLossHistory] = useState<number[]>([]);\r\n  const genomeLossRef = useRef<GenomeLossType[]>([{}]);\r\n\r\n  const [mutationProbability, setMutationProbability] = useState<Probability>(\r\n    getFloatSearchParam(MUTATION_PROBABILITY_URL_PARAM, DEFAULT_MUTATION_PROBABILITY)\r\n  );\r\n  const [longLivingChampionsPercentage, setLongLivingChampionsPercentage] = useState<Percentage>(\r\n    getIntSearchParam(LONG_LIVING_CHAMPIONS_URL_PARAM, DEFAULT_LONG_LIVING_CHAMPIONS_PERCENTAGE)\r\n  );\r\n\r\n  const [badSimulationRetriesNum, setBadSimulationRetriesNum] = useState<number>(BAD_SIMULATION_RETRIES_NUM);\r\n\r\n  const logger = loggerBuilder({ context: 'EvolutionTab' });\r\n  const carsBatchesTotal: number = Math.ceil(Object.keys(cars).length / carsBatchSize);\r\n  const carsInProgress: CarsInProgressType = carsBatch.reduce((cars: CarsInProgressType, car: CarType) => {\r\n    cars[car.licencePlate] = true;\r\n    return cars;\r\n  }, {});\r\n  const batchVersion = generateWorldVersion(generationIndex, carsBatchIndex);\r\n  const generationLifetimeMs = generationLifetime * SECOND;\r\n\r\n  const onCommonStateReset = () => {\r\n    setGeneration([]);\r\n    setCarsBatch([]);\r\n    setCars({});\r\n    setCarsLoss([{}]);\r\n    carsRef.current = {};\r\n    carsLossRef.current = [{}];\r\n    genomeLossRef.current = [{}];\r\n    setLossHistory([]);\r\n    setAvgLossHistory([]);\r\n    setBestGenome(null);\r\n    setMinLoss(null);\r\n    setBestCarLicencePlate(null);\r\n    setSecondBestGenome(null);\r\n    setSecondMinLoss(null);\r\n    setSecondBestCarLicencePlate(null);\r\n  };\r\n\r\n  const onEvolutionRestart = () => {\r\n    cancelBatchTimer();\r\n    onCommonStateReset();\r\n    setWorldIndex(worldIndex + 1);\r\n    setGenerationIndex(0);\r\n    setCarsBatchIndex(null);\r\n  };\r\n\r\n  const onCarLossUpdate = (licensePlate: CarLicencePlateType, loss: number) => {\r\n    if (generationIndex === null) {\r\n      return;\r\n    }\r\n\r\n    // Save the car loss to the \"LicencePlate → Loss\" map.\r\n    if (!carsLossRef.current[generationIndex]) {\r\n      carsLossRef.current[generationIndex] = {};\r\n    }\r\n    carsLossRef.current[generationIndex][licensePlate] = loss;\r\n\r\n    // Save the car loss to the \"GenomeKey → Loss\" map.\r\n    if (!genomeLossRef.current[generationIndex]) {\r\n      genomeLossRef.current[generationIndex] = {};\r\n    }\r\n    if (carsRef.current[licensePlate]) {\r\n      const carGenomeIndex = carsRef.current[licensePlate].genomeIndex;\r\n      const carGenome: Genome = generation[carGenomeIndex];\r\n      const carGenomeKey: GenomeKey = carGenome.join('');\r\n      genomeLossRef.current[generationIndex][carGenomeKey] = loss;\r\n    }\r\n  };\r\n\r\n  const onGenerationSizeChange = (size: number) => {\r\n    setGenerationSize(size);\r\n    setSearchParam(GENERATION_SIZE_URL_PARAM, `${size}`);\r\n    onEvolutionRestart();\r\n  };\r\n\r\n  const onSetDefaultFilterValues = () => {\r\n    deleteSearchParam(GENERATION_SIZE_URL_PARAM);\r\n    deleteSearchParam(GROUP_SIZE_URL_PARAM);\r\n    deleteSearchParam(GENERATION_LIFETIME_URL_PARAM);\r\n    deleteSearchParam(MUTATION_PROBABILITY_URL_PARAM);\r\n    deleteSearchParam(LONG_LIVING_CHAMPIONS_URL_PARAM);\r\n    deleteSearchParam(PERFORMANCE_BOOST_URL_PARAM);\r\n\r\n    setGenerationSize(DEFAULT_GENERATION_SIZE);\r\n    setCarsBatchSize(DEFAULT_BATCH_SIZE);\r\n    setGenerationLifetime(DEFAULT_GENERATION_LIFETIME);\r\n    setMutationProbability(DEFAULT_MUTATION_PROBABILITY);\r\n    setLongLivingChampionsPercentage(DEFAULT_LONG_LIVING_CHAMPIONS_PERCENTAGE);\r\n    setPerformanceBoost(DEFAULT_PERFORMANCE_BOOST);\r\n  };\r\n\r\n  const onReset = () => {\r\n    removeGenerationFromStorage();\r\n    onSetDefaultFilterValues();\r\n    onEvolutionRestart();\r\n    enqueue({\r\n      message: 'Evolution setup and training progress have been reset',\r\n      startEnhancer: ({size}) => <Check size={size} />,\r\n    }, DURATION.medium);\r\n  };\r\n\r\n  const onMutationProbabilityChange = (probability: Probability) => {\r\n    setMutationProbability(probability);\r\n    setSearchParam(MUTATION_PROBABILITY_URL_PARAM, `${probability}`);\r\n  };\r\n\r\n  const onLongLivingChampionsPercentageChange = (percentage: Percentage) => {\r\n    setLongLivingChampionsPercentage(percentage);\r\n    setSearchParam(LONG_LIVING_CHAMPIONS_URL_PARAM, `${percentage}`);\r\n  };\r\n\r\n  const onPerformanceBoost = (state: boolean) => {\r\n    setPerformanceBoost(state);\r\n    setSearchParam(PERFORMANCE_BOOST_URL_PARAM, `${state ? 'true' : 'false'}`);\r\n  };\r\n\r\n  const onBatchSizeChange = (size: number) => {\r\n    setCarsBatchSize(size);\r\n    setSearchParam(GROUP_SIZE_URL_PARAM, `${size}`);\r\n    onEvolutionRestart();\r\n  };\r\n\r\n  const onGenerationLifetimeChange = (time: number) => {\r\n    setGenerationLifetime(time);\r\n    setSearchParam(GENERATION_LIFETIME_URL_PARAM, `${time}`);\r\n  };\r\n\r\n  const onRestoreFromCheckpoint = (checkpoint: EvolutionCheckpoint) => {\r\n    cancelBatchTimer();\r\n    \r\n    setSearchParam(MUTATION_PROBABILITY_URL_PARAM, `${checkpoint.mutationProbability}`);\r\n    setSearchParam(LONG_LIVING_CHAMPIONS_URL_PARAM, `${checkpoint.longLivingChampionsPercentage}`);\r\n    setSearchParam(GENERATION_LIFETIME_URL_PARAM, `${checkpoint.generationLifetime}`);\r\n    setSearchParam(PERFORMANCE_BOOST_URL_PARAM, `${checkpoint.performanceBoost ? 'true' : 'false'}`);\r\n    setSearchParam(GENERATION_SIZE_URL_PARAM, `${checkpoint.generationSize}`);\r\n    setSearchParam(GROUP_SIZE_URL_PARAM, `${checkpoint.carsBatchSize}`);\r\n\r\n    saveGenerationToStorage({\r\n      generation: checkpoint.generation,\r\n      generationIndex: checkpoint.generationIndex,\r\n      lossHistory: checkpoint.lossHistory,\r\n      avgLossHistory: checkpoint.avgLossHistory,\r\n    });\r\n\r\n    document.location.reload();\r\n  };\r\n\r\n  const onCheckpointToFile = (): EvolutionCheckpoint => {\r\n    const checkpoint: EvolutionCheckpoint = {\r\n      dateTime: (new Date()).toISOString(),\r\n      generationIndex: generationIndex || 0,\r\n      performanceBoost,\r\n      generationSize,\r\n      generationLifetime,\r\n      carsBatchSize,\r\n      mutationProbability,\r\n      longLivingChampionsPercentage,\r\n      lossHistory,\r\n      avgLossHistory,\r\n      generation,\r\n    };\r\n    return checkpoint;\r\n  };\r\n\r\n  const cancelBatchTimer = () => {\r\n    logger.info('Trying to cancel batch timer');\r\n    if (batchTimer.current === null) {\r\n      return;\r\n    }\r\n    clearTimeout(batchTimer.current);\r\n    batchTimer.current = null;\r\n  };\r\n\r\n  const syncBestGenome = (): string | null | undefined => {\r\n    if (generationIndex === null) {\r\n      return;\r\n    }\r\n\r\n    const generationLoss: CarsLossType = carsLossRef.current[generationIndex];\r\n    if (!generationLoss) {\r\n      return;\r\n    }\r\n\r\n    let bestCarLicensePlate: CarLicencePlateType | null = null;\r\n    let minLoss: number = Infinity;\r\n    let bestGenomeIndex: number = -1;\r\n\r\n    Object.keys(generationLoss).forEach((licencePlate: CarLicencePlateType) => {\r\n      const carLoss: number | null = generationLoss[licencePlate];\r\n      if (carLoss === null) {\r\n        return;\r\n      }\r\n      if (carLoss < minLoss) {\r\n        minLoss = carLoss;\r\n        bestCarLicensePlate = licencePlate;\r\n        bestGenomeIndex = cars[licencePlate].genomeIndex;\r\n      }\r\n    });\r\n\r\n    if (bestGenomeIndex === -1) {\r\n      return;\r\n    }\r\n\r\n    setMinLoss(minLoss);\r\n    setBestGenome(generation[bestGenomeIndex]);\r\n    setBestCarLicencePlate(bestCarLicensePlate);\r\n\r\n    return bestCarLicensePlate;\r\n  };\r\n\r\n  const syncSecondBestGenome = (\r\n    bestLicensePlateSoFar: string | null | undefined\r\n  ): string | null | undefined => {\r\n    if (generationIndex === null || !bestLicensePlateSoFar) {\r\n      return;\r\n    }\r\n\r\n    const generationLoss: CarsLossType = carsLossRef.current[generationIndex];\r\n    if (!generationLoss) {\r\n      return;\r\n    }\r\n\r\n    let secondBestCarLicensePlate: CarLicencePlateType | null = null;\r\n    let secondMinLoss: number = Infinity;\r\n    let secondBestGenomeIndex: number = -1;\r\n\r\n    Object.keys(generationLoss).forEach((licencePlate: CarLicencePlateType) => {\r\n      // Skipping the best car genome.\r\n      if (licencePlate === bestLicensePlateSoFar) {\r\n        return;\r\n      }\r\n      const carLoss: number | null = generationLoss[licencePlate];\r\n      if (carLoss === null) {\r\n        return;\r\n      }\r\n      if (carLoss < secondMinLoss) {\r\n        secondMinLoss = carLoss;\r\n        secondBestCarLicensePlate = licencePlate;\r\n        secondBestGenomeIndex = cars[licencePlate].genomeIndex;\r\n      }\r\n    });\r\n\r\n    if (secondBestGenomeIndex === -1) {\r\n      return;\r\n    }\r\n\r\n    setSecondMinLoss(secondMinLoss);\r\n    setSecondBestGenome(generation[secondBestGenomeIndex]);\r\n    setSecondBestCarLicencePlate(secondBestCarLicensePlate);\r\n\r\n    return secondBestCarLicensePlate;\r\n  };\r\n\r\n  const syncLossHistory = () => {\r\n    if (generationIndex === null) {\r\n      return;\r\n    }\r\n    const generationLoss: CarsLossType = carsLossRef.current[generationIndex];\r\n\r\n    // Sync min loss history.\r\n    const newLossHistory = [...lossHistory];\r\n    if (generationLoss) {\r\n      newLossHistory[generationIndex] = Object.values(generationLoss).reduce(\r\n        (minVal: number, currVal: number | null) => {\r\n          if (currVal === null) {\r\n            return minVal;\r\n          }\r\n          return Math.min(minVal, currVal);\r\n        },\r\n        Infinity\r\n      );\r\n    } else {\r\n      newLossHistory[generationIndex] = Infinity;\r\n    }\r\n    setLossHistory(newLossHistory);\r\n\r\n    // Sync avg loss history.\r\n    const newAvgLossHistory = [...avgLossHistory];\r\n    if (generationLoss) {\r\n      let nonNullLosses = 0;\r\n\r\n      const ascSortedGenerationLoss = Object.values<number | null>(generationLoss)\r\n        .sort((a: number | null, b: number | null): number => {\r\n          const aTuned: number = a === null ? Infinity : a;\r\n          const bTuned: number = b === null ? Infinity : b;\r\n          if (aTuned < bTuned) {\r\n            return -1;\r\n          }\r\n          if (aTuned > bTuned) {\r\n            return 1;\r\n          }\r\n          return 0;\r\n        }\r\n      );\r\n\r\n      const P50GenerationLoss = ascSortedGenerationLoss.slice(\r\n        0,\r\n        Math.ceil(ascSortedGenerationLoss.length * 0.5),\r\n      );\r\n\r\n      const lossSum = P50GenerationLoss.reduce(\r\n        (sum: number, currVal: number | null) => {\r\n          if (currVal === null) {\r\n            return sum;\r\n          }\r\n          nonNullLosses += 1;\r\n          return sum + currVal;\r\n        },\r\n        0\r\n      );\r\n      newAvgLossHistory[generationIndex] = nonNullLosses ? lossSum / nonNullLosses : 0;\r\n    } else {\r\n      newAvgLossHistory[generationIndex] = Infinity;\r\n    }\r\n    setAvgLossHistory(newAvgLossHistory);\r\n  };\r\n\r\n  const carFitnessFunction = (generationIndex: number) => (genome: Genome): number => {\r\n    const genomeKey = genome.join('');\r\n    if (\r\n      generationIndex === null ||\r\n      !genomeLossRef.current[generationIndex] ||\r\n      typeof genomeLossRef.current[generationIndex][genomeKey] !== 'number'\r\n    ) {\r\n      throw new Error('Fitness value for specified genome is undefined');\r\n    }\r\n    const loss = genomeLossRef.current[generationIndex][genomeKey];\r\n    if (typeof loss !== 'number') {\r\n      throw new Error('Loss value is not a number');\r\n    }\r\n    return carLossToFitness(loss, FITNESS_ALPHA);\r\n  };\r\n\r\n  const isValidGenerationFromStorage = (generation: Generation | null): boolean => {\r\n    return !!(\r\n      generation &&\r\n      generation.length === generationSize &&\r\n      generation[0].length === GENOME_LENGTH\r\n    );\r\n  };\r\n\r\n  const getGenerationIndexFromStorage = (): number | null => {\r\n    const {\r\n      generation: generationFromStorage,\r\n      generationIndex: generationIndexFromStorage,\r\n    } = loadGenerationFromStorage();\r\n    if (\r\n      isValidGenerationFromStorage(generationFromStorage) &&\r\n      generationIndexFromStorage\r\n    ) {\r\n      return generationIndexFromStorage;\r\n    }\r\n    return null;\r\n  };\r\n\r\n  const getLossHistoryFromStorage = (): number[] | null => {\r\n    const {\r\n      lossHistory: lossHistoryFromStorage,\r\n      generation: generationFromStorage,\r\n    } = loadGenerationFromStorage();\r\n    if (\r\n      isValidGenerationFromStorage(generationFromStorage) &&\r\n      lossHistoryFromStorage\r\n    ) {\r\n      return lossHistoryFromStorage;\r\n    }\r\n    return null;\r\n  };\r\n\r\n  const getAvgLossHistoryFromStorage = (): number[] | null => {\r\n    const {\r\n      avgLossHistory: avgLossHistoryFromStorage,\r\n      generation: generationFromStorage,\r\n    } = loadGenerationFromStorage();\r\n    if (\r\n      isValidGenerationFromStorage(generationFromStorage) &&\r\n      avgLossHistoryFromStorage\r\n    ) {\r\n      return avgLossHistoryFromStorage;\r\n    }\r\n    return null;\r\n  };\r\n\r\n  const getGenerationFromStorage = (): Generation | null => {\r\n    const {\r\n      generation: generationFromStorage,\r\n    } = loadGenerationFromStorage();\r\n    if (isValidGenerationFromStorage(generationFromStorage)) {\r\n      return generationFromStorage;\r\n    }\r\n    if (generationFromStorage) {\r\n      try {\r\n        const debugGenerationSize = generationFromStorage.length;\r\n        const debugGenomeLength = generationFromStorage[0].length;\r\n        logger.warn(`Generation from storage is invalid: generation size ${debugGenerationSize}, genome length ${debugGenomeLength}`);\r\n      } catch (err) {\r\n        logger.warn('Generation from storage is invalid');\r\n      }\r\n    }\r\n    return null;\r\n  };\r\n\r\n  const startEvolution = () => {\r\n    logger.info('Start evolution');\r\n    let generationStartIndex = 0;\r\n\r\n    const generationIndexFromStorage = getGenerationIndexFromStorage();\r\n    const lossHistoryFromStorage = getLossHistoryFromStorage();\r\n    const avgLossHistoryFromStorage = getAvgLossHistoryFromStorage();\r\n\r\n    if (generationIndexFromStorage && lossHistoryFromStorage && avgLossHistoryFromStorage) {\r\n      generationStartIndex = generationIndexFromStorage;\r\n      setRestoredFromGenerationIndex(generationIndexFromStorage);\r\n      setLossHistory(lossHistoryFromStorage);\r\n      setAvgLossHistory(avgLossHistoryFromStorage);\r\n    }\r\n\r\n    setGenerationIndex(generationStartIndex);\r\n  };\r\n\r\n  const createFirstGeneration = () => {\r\n    if (generationIndex === null) {\r\n      return;\r\n    }\r\n    logger.info('Create first generation');\r\n    let firstGeneration: Generation = createGeneration({\r\n      generationSize,\r\n      genomeLength: GENOME_LENGTH,\r\n    });\r\n\r\n    const generationFromStorage: Generation | null = getGenerationFromStorage();\r\n    const generationIndexFromStorage: number | null = getGenerationIndexFromStorage();\r\n    if (generationFromStorage && generationIndexFromStorage) {\r\n      firstGeneration = generationFromStorage;\r\n      enqueue({\r\n        message:\r\n          `Generation #${generationIndexFromStorage} has been restored from the saved checkpoint. To start from scratch, press the Reset button.`,\r\n        startEnhancer: ({size}) => <BiUpload size={size} />,\r\n      }, DURATION.medium);\r\n    }\r\n\r\n    setGeneration(firstGeneration);\r\n    setBestGenome(firstGeneration[0]);\r\n    setSecondBestGenome(firstGeneration[1]);\r\n  };\r\n\r\n  const mateExistingGeneration = () => {\r\n    if (generationIndex === null) {\r\n      return;\r\n    }\r\n    logger.info(`Mate generation #${generationIndex}`);\r\n    try {\r\n      const newGeneration = select(\r\n        generation,\r\n        carFitnessFunction(generationIndex - 1),\r\n        {\r\n          mutationProbability,\r\n          longLivingChampionsPercentage: longLivingChampionsPercentage,\r\n        },\r\n      );\r\n      setGeneration(newGeneration);\r\n      saveGenerationToStorage({\r\n        generation: newGeneration,\r\n        generationIndex,\r\n        lossHistory,\r\n        avgLossHistory,\r\n      });\r\n    } catch (e: any) {\r\n      // If selection failed for some reason, clone the existing generation and try again.\r\n      setGeneration([...generation]);\r\n      const errorMessage = 'The selection for the new generation has failed. Cloning the existing generation to try it next time.';\r\n      const exceptionMessage = e && e.message ? e.message : '';\r\n      logger.warn(errorMessage, exceptionMessage);\r\n    }\r\n  };\r\n\r\n  const createCarsFromGeneration = () => {\r\n    if (!generation || !generation.length) {\r\n      return;\r\n    }\r\n    logger.info(`Create cars from generation #${generationIndex}`);\r\n    const cars = generationToCars({\r\n      generation,\r\n      generationIndex,\r\n      onLossUpdate: onCarLossUpdate,\r\n    });\r\n    setCars(cars);\r\n    setCarsBatchIndex(0);\r\n    carsRef.current = _.cloneDeep(cars);\r\n  };\r\n\r\n  const generateNextCarsBatch = () => {\r\n    if (carsBatchIndex === null || generationIndex === null) {\r\n      return;\r\n    }\r\n    if (!cars || !Object.keys(cars).length) {\r\n      return;\r\n    }\r\n    if (carsBatchIndex >= carsBatchesTotal) {\r\n      return;\r\n    }\r\n    logger.info(`Generate cars batch #${carsBatchIndex}`);\r\n    const batchStart = carsBatchSize * carsBatchIndex;\r\n    const batchEnd = batchStart + carsBatchSize;\r\n    const carsBatch: CarType[] = Object.values(cars).slice(batchStart, batchEnd);\r\n    setCarsBatch(carsBatch);\r\n  };\r\n\r\n  const needToRetry = \r\n    BAD_SIMULATION_RETRIES_ENABLED &&\r\n    carsBatchIndex === BAD_SIMULATION_BATCH_INDEX_CHECK &&\r\n    badSimulationRetriesNum > 0 &&\r\n    lossHistory.length > 1 &&\r\n    lossHistory[lossHistory.length - 1] > (lossHistory[lossHistory.length - 2] * BAD_SIMULATION_MIN_LOSS_INCREASE_PERCENTAGE / 100);\r\n\r\n  const onBatchLifetimeEnd = () => {\r\n    if (carsBatchIndex === null) {\r\n      return;\r\n    }\r\n    logger.info(`Batch #${carsBatchIndex} lifetime ended`);\r\n    setCarsLoss(_.cloneDeep<CarsLossType[]>(carsLossRef.current));\r\n    syncLossHistory();\r\n    const bestLicensePlate = syncBestGenome();\r\n    syncSecondBestGenome(bestLicensePlate);\r\n    let nextBatchIndex = carsBatchIndex + 1;\r\n\r\n    // Retrying logic\r\n    if (BAD_SIMULATION_RETRIES_ENABLED && carsBatchIndex) {\r\n      if (badSimulationRetriesNum === 0) {\r\n        if (carsBatchIndex > BAD_SIMULATION_BATCH_INDEX_CHECK) {\r\n          logger.info(`Resetting the simulation retries counter back to #${BAD_SIMULATION_RETRIES_NUM}`);\r\n          setBadSimulationRetriesNum(BAD_SIMULATION_RETRIES_NUM);\r\n        }\r\n      } else if (needToRetry) {\r\n        logger.info(`Retry needed. Number of retries left: ${badSimulationRetriesNum - 1}`);\r\n        setBadSimulationRetriesNum(badSimulationRetriesNum - 1);\r\n        nextBatchIndex = 0;\r\n      }\r\n    }\r\n\r\n    if (nextBatchIndex >= carsBatchesTotal) {\r\n      setCarsBatch([]);\r\n      if (generationIndex !== null) {\r\n        setCarsBatchIndex(null);\r\n        setGenerationIndex(generationIndex + 1);\r\n      }\r\n      return;\r\n    }\r\n    setCarsBatchIndex(nextBatchIndex);\r\n  };\r\n\r\n  const countDownBatchLifetime = (onLifetimeEnd: () => void) => {\r\n    if (carsBatchIndex === null) {\r\n      return;\r\n    }\r\n    if (!carsBatch || !carsBatch.length) {\r\n      return;\r\n    }\r\n    logger.info(`Batch #${carsBatchIndex} lifetime started`);\r\n    cancelBatchTimer();\r\n    batchTimer.current = setTimeout(onLifetimeEnd, generationLifetimeMs);\r\n  };\r\n\r\n  // Start the evolution.\r\n  useEffect(() => {\r\n    startEvolution();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  // Once generation index is changed we need to create (or mate) a new generation.\r\n  useEffect(() => {\r\n    if (generationIndex === 0 || generationIndex === restoredFromGenerationIndex) {\r\n      createFirstGeneration();\r\n    } else {\r\n      mateExistingGeneration();\r\n    }\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [generationIndex, worldIndex]);\r\n\r\n  // Once generation is changed we need to create cars.\r\n  useEffect(() => {\r\n    createCarsFromGeneration();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [generation]);\r\n\r\n  // Once the cars batch index is updated we need to generate a cars batch.\r\n  useEffect(() => {\r\n    generateNextCarsBatch();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [carsBatchIndex]);\r\n\r\n  // Once the new cars batch is created we need to start generation timer.\r\n  useEffect(() => {\r\n    countDownBatchLifetime(onBatchLifetimeEnd);\r\n    return () => {\r\n      cancelBatchTimer();\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [carsBatch]);\r\n\r\n  return (\r\n    <Block>\r\n      <World\r\n        version={batchVersion}\r\n        performanceBoost={performanceBoost}\r\n      >\r\n        <ParkingAutomatic\r\n          performanceBoost={performanceBoost}\r\n          cars={carsBatch}\r\n          withVisibleSensors\r\n          withLabels\r\n          carsPosition={dynamicCarsPosition}\r\n        />\r\n      </World>\r\n      <Block marginTop=\"20px\">\r\n        <Notification overrides={{Body: {style: {width: 'auto'}}}}>\r\n          Train the car to do self-parking using genetic algorithm<br/><br/>\r\n          <small>For better results, increase the population size to 500-1000 and wait for 50-100 generations.</small>\r\n        </Notification>\r\n      </Block>\r\n      <EvolutionAnalytics\r\n        mutationProbability={mutationProbability}\r\n        onMutationProbabilityChange={onMutationProbabilityChange}\r\n        longLivingChampionsPercentage={longLivingChampionsPercentage}\r\n        generationIndex={generationIndex}\r\n        carsBatchIndex={carsBatchIndex}\r\n        totalBatches={carsBatchesTotal}\r\n        worldIndex={worldIndex}\r\n        needToRetry={needToRetry}\r\n        generationLifetimeMs={generationLifetimeMs}\r\n        generationSize={generationSize}\r\n        performanceBoost={performanceBoost}\r\n        carsBatchSize={carsBatchSize}\r\n        generationLifetime={generationLifetime}\r\n        batchVersion={batchVersion}\r\n        onGenerationSizeChange={onGenerationSizeChange}\r\n        onBatchSizeChange={onBatchSizeChange}\r\n        onGenerationLifetimeChange={onGenerationLifetimeChange}\r\n        onLongLivingChampionsPercentageChange={onLongLivingChampionsPercentageChange}\r\n        onPerformanceBoost={onPerformanceBoost}\r\n        onReset={onReset}\r\n        lossHistory={lossHistory}\r\n        avgLossHistory={avgLossHistory}\r\n        cars={cars}\r\n        carsInProgress={carsInProgress}\r\n        carsLoss={carsLoss}\r\n        bestGenome={bestGenome}\r\n        bestCarLicencePlate={bestCarLicencePlate}\r\n        minLoss={minLoss}\r\n        secondBestGenome={secondBestGenome}\r\n        secondBestCarLicencePlate={secondBestCarLicencePlate}\r\n        secondMinLoss={secondMinLoss}\r\n      />\r\n\r\n      <Block marginTop=\"30px\">\r\n        <EvolutionCheckpointSaver\r\n          onRestoreFromCheckpoint={onRestoreFromCheckpoint}\r\n          onCheckpointToFile={onCheckpointToFile}\r\n        />\r\n      </Block>\r\n    </Block>\r\n  );\r\n}\r\n\r\nexport default EvolutionTabEvolution;\r\n","import { Genome } from '../../../libs/genetic';\r\nimport { DynamicCarsPosition } from '../../world/constants/cars';\r\nimport { genomeStringToGenome } from '../utils/evolution';\r\n\r\nexport const BEST_GENOMES: Record<DynamicCarsPosition, Genome[]> = {\r\n  'rear': [].map<Genome>((genomeString: string) => genomeStringToGenome(genomeString)),\r\n  'middle': [\r\n    '0 1 0 1 1 1 0 1 1 0 1 1 0 1 0 0 0 1 1 1 1 1 0 1 0 1 1 0 0 0 1 1 0 1 0 0 1 1 1 1 0 1 0 1 0 1 0 0 0 1 0 0 1 1 0 0 0 1 0 1 0 1 1 0 0 1 0 0 0 1 0 0 1 1 1 1 0 1 1 1 0 1 0 0 1 1 1 1 1 1 1 0 1 1 0 0 1 1 1 1 1 1 0 0 0 0 1 1 0 0 0 0 0 0 0 1 0 1 0 1 0 1 1 0 0 1 0 0 0 1 1 1 0 0 1 0 0 0 1 1 1 1 1 0 1 0 0 0 0 1 0 0 0 0 0 0 1 1 0 0 1 0 0 0 0 1 1 0 0 1 1 0 0 0 0 0 1 0 0 1',\r\n    '0 0 1 0 1 0 1 1 0 0 1 1 1 1 0 1 1 1 0 0 1 1 0 1 0 0 0 1 1 0 0 1 0 1 1 1 0 1 1 0 1 0 1 0 0 0 0 1 1 0 1 0 0 0 1 1 1 0 0 0 0 1 1 0 0 1 0 0 1 1 1 0 0 1 0 0 0 1 1 1 0 0 1 0 0 1 1 1 0 1 0 1 1 0 1 0 0 1 1 0 1 1 0 0 0 0 1 1 1 0 0 1 0 1 0 1 0 1 1 1 1 1 0 1 1 1 0 0 0 0 0 0 1 1 1 1 1 1 0 1 1 0 1 0 0 0 0 0 1 1 0 1 1 0 0 1 0 1 1 1 0 1 0 0 1 1 1 1 1 1 1 1 1 0 1 1 1 0 0 1',\r\n  ].map<Genome>((genomeString: string) => genomeStringToGenome(genomeString)),\r\n  'front': [\r\n    '0 1 0 1 1 0 0 0 1 1 0 0 0 1 0 1 1 1 0 0 1 1 1 0 0 0 1 1 1 0 0 1 0 1 1 1 0 0 1 0 0 1 1 1 0 0 0 1 1 1 1 0 0 1 1 0 1 1 0 0 1 0 1 0 0 1 0 1 0 1 1 0 1 1 0 0 0 0 1 1 0 0 0 1 1 0 0 1 0 0 1 1 1 0 0 1 1 0 1 0 0 1 1 0 0 0 1 0 0 1 0 0 0 0 0 0 1 0 1 0 0 1 1 1 0 1 1 1 1 1 1 1 0 0 0 1 1 0 0 0 1 0 0 0 1 0 0 1 0 0 0 0 1 1 1 1 0 0 0 1 1 1 1 1 1 0 1 1 0 1 0 0 1 0 0 0 1 0 0 0',\r\n    '0 0 0 1 1 1 1 1 1 0 1 1 1 0 0 1 1 1 1 1 1 1 1 0 1 0 1 0 0 0 1 1 0 0 1 1 0 1 0 1 1 0 0 1 0 0 0 1 1 1 1 0 1 0 1 1 1 1 1 0 0 0 0 0 0 1 1 1 1 1 0 0 1 0 1 1 1 0 0 0 0 0 1 1 0 0 1 0 0 0 0 0 1 0 1 0 1 0 0 1 1 0 0 1 0 0 0 0 0 0 0 0 0 1 1 1 1 0 0 1 0 1 1 0 0 0 1 0 1 1 1 1 0 1 1 1 0 1 0 1 0 1 1 0 0 1 1 1 0 1 1 0 0 1 0 1 0 1 1 0 1 1 1 0 1 1 0 1 0 1 1 1 0 1 0 0 1 1 0 1',\r\n    '0 1 0 1 1 1 1 1 0 1 1 0 0 1 0 1 0 0 0 1 1 0 1 0 1 1 0 1 0 0 1 1 0 1 0 0 0 1 0 1 0 0 0 1 1 1 0 0 0 0 1 0 0 1 0 1 0 0 1 0 1 0 1 1 0 1 1 1 0 1 1 0 0 0 1 1 1 1 0 1 0 0 1 0 0 0 0 0 1 0 0 1 0 1 0 1 0 0 1 1 1 0 1 0 0 1 1 1 0 0 1 0 1 1 1 1 0 0 0 0 0 1 1 0 0 1 0 1 1 1 1 1 0 0 1 0 0 0 1 1 0 0 1 1 0 1 1 0 1 1 0 0 0 0 0 1 1 1 1 0 1 0 1 1 1 1 0 1 1 0 1 0 1 0 0 0 1 0 1 0',\r\n    '1 1 0 0 1 1 0 1 1 1 0 0 0 1 0 0 1 0 1 0 1 0 1 0 0 0 1 0 0 0 1 1 1 1 0 0 1 0 1 1 0 1 1 1 1 0 0 1 0 0 1 1 1 0 1 0 0 1 1 0 0 0 1 1 0 0 0 0 1 0 1 1 0 0 1 0 0 0 1 0 0 0 0 0 1 0 1 1 0 1 1 0 1 0 0 1 0 1 1 1 0 0 0 1 0 1 0 1 0 0 1 0 0 0 0 1 1 1 1 0 0 1 1 1 0 1 1 0 1 1 0 1 1 0 0 0 0 1 1 0 0 1 0 0 0 1 0 0 1 1 1 0 0 1 1 0 1 0 0 0 1 0 1 0 0 1 1 0 0 1 0 0 0 0 1 1 0 0 1 0',\r\n    // '0 1 1 1 0 1 0 1 1 1 1 0 0 0 1 1 1 1 0 0 1 1 1 1 1 1 1 1 1 0 1 0 0 1 0 1 1 1 0 0 1 1 0 1 1 0 1 1 0 1 1 0 1 1 0 1 1 1 1 0 0 0 1 1 1 0 1 0 1 0 1 0 1 0 0 1 0 1 1 1 0 0 0 0 1 1 0 1 0 1 0 0 0 0 0 0 0 1 1 1 1 0 0 1 0 1 0 1 0 1 1 0 1 0 1 0 0 1 0 0 0 1 0 0 1 1 0 1 0 0 1 1 0 1 1 1 0 0 1 0 1 1 0 0 0 0 0 1 1 0 0 0 0 1 0 1 1 1 0 1 0 0 1 1 1 1 1 1 1 1 0 0 1 0 0 1 1 1 1 0',\r\n    // '1 0 0 0 1 0 1 1 1 1 0 0 1 1 1 0 1 1 0 0 1 0 0 0 0 1 1 1 0 0 0 1 0 1 0 0 1 0 0 1 0 1 0 0 1 1 1 1 0 0 1 1 1 0 1 1 0 0 0 1 0 0 0 0 0 1 1 0 0 1 1 1 1 1 1 0 1 0 1 1 0 0 0 0 1 1 1 1 1 1 0 1 1 0 0 1 0 1 1 1 0 0 1 0 0 0 1 1 1 0 1 0 1 1 1 0 0 0 0 1 0 1 0 1 1 0 1 0 0 0 0 1 1 1 0 0 1 0 1 1 0 0 1 1 0 1 0 0 1 0 1 0 1 1 0 1 0 0 0 1 0 0 1 0 0 0 0 1 0 0 1 0 0 0 1 0 0 1 0 0',\r\n    // '1 1 1 0 0 0 1 0 0 0 1 0 0 0 0 0 1 0 0 0 1 1 1 1 0 0 1 1 0 1 1 0 0 1 0 0 0 0 1 1 0 0 0 0 1 0 0 0 1 1 0 0 1 1 0 0 0 0 0 1 1 1 0 0 0 1 1 1 1 1 1 0 0 0 1 0 0 1 0 0 0 0 1 1 1 0 1 1 0 1 1 1 0 1 1 1 0 0 1 1 0 1 0 0 0 1 1 1 0 0 0 0 0 0 0 0 1 0 0 1 0 1 0 1 0 1 1 1 1 0 1 1 1 0 1 0 0 1 0 1 1 0 0 1 1 1 1 1 1 1 1 0 0 1 0 0 1 0 1 0 1 1 0 0 0 1 1 1 1 1 0 0 0 1 1 0 1 1 0 1',\r\n  ].map<Genome>((genomeString: string) => genomeStringToGenome(genomeString)),\r\n};\r\n","import React from 'react';\r\nimport { Block } from 'baseui/block';\r\nimport { Button, SIZE as BUTTON_SIZE, KIND as BUTTON_KIND, SHAPE as BUTTON_SHAPE } from 'baseui/button';\r\nimport { Checkbox, LABEL_PLACEMENT } from 'baseui/checkbox';\r\nimport { ButtonGroup, MODE as BUTTON_GROUP_MODE, SIZE as BUTTON_GROUP_SIZE } from 'baseui/button-group';\r\n\r\nimport EvolutionTiming from './EvolutionTiming';\r\nimport BestGenomes from './BestGenomes';\r\nimport { Genome } from '../../libs/genetic';\r\nimport { FormControl } from 'baseui/form-control';\r\nimport Row from '../shared/Row';\r\nimport Hint from '../shared/Hint';\r\nimport { DynamicCarsPosition } from '../world/constants/cars';\r\n\r\ntype AutomaticParkingAnalyticsProps = {\r\n  genomes: Genome[],\r\n  generationLifetimeMs: number,\r\n  batchVersion: string,\r\n  bestGenome: Genome | null,\r\n  minLoss: number | null,\r\n  carsBatchIndex: number | null,\r\n  performanceBoost: boolean,\r\n  selectedGenomeIndex: number,\r\n  carsPosition: DynamicCarsPosition,\r\n  onCarsPositionChange: (carsPosition: DynamicCarsPosition) => void,\r\n  onChangeGenomeIndex: (index: number) => void,\r\n  onBestGenomeEdit?: (genome: Genome) => void,\r\n  onPerformanceBoost: (state: boolean) => void,\r\n};\r\n\r\nfunction AutomaticParkingAnalytics(props: AutomaticParkingAnalyticsProps) {\r\n  const {\r\n    genomes,\r\n    bestGenome,\r\n    generationLifetimeMs,\r\n    batchVersion,\r\n    minLoss,\r\n    carsBatchIndex,\r\n    selectedGenomeIndex,\r\n    performanceBoost,\r\n    carsPosition,\r\n    onCarsPositionChange,\r\n    onChangeGenomeIndex,\r\n    onPerformanceBoost,\r\n    onBestGenomeEdit = (genome: Genome) => {},\r\n  } = props;\r\n\r\n  const timingDetails = (\r\n    <Block marginBottom=\"20px\" marginTop=\"20px\">\r\n      <EvolutionTiming\r\n        batchIndex={carsBatchIndex}\r\n        batchVersion={batchVersion}\r\n        generationLifetimeMs={generationLifetimeMs}\r\n        groupLabel=\"Parking attempt\"\r\n        batchLifetimeLabel=\"Lifetime\"\r\n      />\r\n    </Block>\r\n  );\r\n\r\n  const carLicencePlates = genomes.map((genome: Genome, genomeIndex: number) => (\r\n    <Block\r\n      key={genomeIndex}\r\n      display=\"inline-block\"\r\n      marginRight=\"4px\"\r\n      marginBottom=\"4px\"\r\n    >\r\n      <Button \r\n        size={BUTTON_SIZE.compact}\r\n        shape={BUTTON_SHAPE.pill}\r\n        kind={genomeIndex === selectedGenomeIndex ? BUTTON_KIND.primary : BUTTON_KIND.secondary}\r\n        onClick={() => {\r\n          onChangeGenomeIndex(genomeIndex);\r\n        }}\r\n      >\r\n        CAR-{genomeIndex}\r\n      </Button>\r\n    </Block>\r\n  ));\r\n\r\n  const carsSwitcher = (\r\n    <Block marginTop=\"20px\" marginBottom=\"20px\">\r\n      <FormControl\r\n        label={() => 'Select the pre-trained car genome'}\r\n      >\r\n        <Block>\r\n          {carLicencePlates}\r\n        </Block>\r\n      </FormControl>\r\n    </Block>\r\n  );\r\n\r\n  const performanceBooster = (\r\n    <FormControl>\r\n      <Block>\r\n        <Checkbox\r\n          checked={performanceBoost}\r\n          // @ts-ignore\r\n          onChange={e => onPerformanceBoost(e.target.checked)}\r\n          labelPlacement={LABEL_PLACEMENT.right}\r\n        >\r\n          <Row>\r\n            <Block marginRight=\"5px\">\r\n              <small>Performance boost</small>\r\n            </Block>\r\n            <Hint\r\n              hint=\"Speed up the simulation by simplifying the geometry\"\r\n            />\r\n          </Row>\r\n        </Checkbox>\r\n      </Block>\r\n    </FormControl>\r\n  );\r\n\r\n  const selectedCarsPosition: Record<DynamicCarsPosition, number> = {\r\n    'middle': 0,\r\n    'front': 1,\r\n    'rear': 3,\r\n  };\r\n\r\n  const carsPositionFromIndex = (positionIndex: number): DynamicCarsPosition => {\r\n    // @ts-ignore\r\n    const positions: DynamicCarsPosition[] = Object.keys(selectedCarsPosition);\r\n    return positions[positionIndex];\r\n  };\r\n\r\n  const carsStartPositionChanger = (\r\n    <Block>\r\n      <FormControl label=\"Car start position\">\r\n        <ButtonGroup\r\n          mode={BUTTON_GROUP_MODE.radio}\r\n          size={BUTTON_GROUP_SIZE.compact}\r\n          selected={selectedCarsPosition[carsPosition]}\r\n          onClick={(_event, index) => {\r\n            onCarsPositionChange(carsPositionFromIndex(index));\r\n          }}\r\n        >\r\n          <Button>Center</Button>\r\n          <Button>Right</Button>\r\n      </ButtonGroup>\r\n      </FormControl>\r\n    </Block>\r\n  );\r\n\r\n  return (\r\n    <>\r\n      {timingDetails}\r\n\r\n      <Block\r\n        display=\"flex\"\r\n        flexDirection=\"row\"\r\n        alignItems=\"flex-end\"\r\n      >\r\n        <Block marginRight=\"20px\">\r\n          {carsStartPositionChanger}\r\n        </Block>\r\n        <Block marginBottom=\"5px\">\r\n          {performanceBooster}\r\n        </Block>\r\n      </Block>\r\n\r\n      {carsSwitcher}\r\n\r\n      <BestGenomes\r\n        bestGenomePanelTitle=\"Self-parking car genome\"\r\n        bestGenome={bestGenome}\r\n        minLoss={minLoss}\r\n        onBestGenomeEdit={onBestGenomeEdit}\r\n        editable\r\n      />\r\n    </>\r\n  );\r\n}\r\n\r\nexport default AutomaticParkingAnalytics;\r\n","import React, { useEffect, useRef, useState } from 'react';\r\nimport { Block } from 'baseui/block';\r\nimport { useSnackbar, DURATION } from 'baseui/snackbar';\r\nimport { Check } from 'baseui/icon';\r\nimport { Notification } from 'baseui/notification';\r\n\r\nimport { Generation, Genome } from '../../libs/genetic';\r\nimport { CarLicencePlateType, CarType } from '../world/types/car';\r\nimport {\r\n  SECOND,\r\n  TRAINED_CAR_GENERATION_LIFETIME\r\n} from './EvolutionBoardParams';\r\nimport { generationToCars } from './utils/evolution';\r\nimport { loggerBuilder } from '../../utils/logger';\r\nimport { BEST_GENOMES } from './constants/genomes';\r\nimport AutomaticParkingAnalytics from './AutomaticParkingAnalytics';\r\nimport World from '../world/World';\r\nimport ParkingAutomatic from '../world/parkings/ParkingAutomatic';\r\nimport { DynamicCarsPosition, DYNAMIC_CARS_POSITION_MIDDLE } from '../world/constants/cars';\r\nimport { DYNAMIC_CARS_POSITION_FRONT } from '../world/constants/cars';\r\nimport { getIntSearchParam, getStringSearchParam, setSearchParam } from '../../utils/url';\r\n\r\nconst defaultGenomeIndex = 0;\r\n\r\nconst GENOME_IDX_URL_PARAM = 'genome_idx';\r\nconst START_POSITION_URL_PARAM = 'position';\r\nconst DEFAULT_START_POSITION = DYNAMIC_CARS_POSITION_FRONT;\r\n\r\nfunction EvolutionTabAutomatic() {\r\n  const {enqueue} = useSnackbar();\r\n\r\n  const bestTrainedCarLossRef = useRef<number | null>(null);\r\n  const onTrainedCarLossUpdate = (licensePlate: CarLicencePlateType, loss: number) => {\r\n    bestTrainedCarLossRef.current = loss;\r\n  };\r\n\r\n  const [performanceBoost, setPerformanceBoost] = useState<boolean>(false);\r\n\r\n  const [selectedGenomeIndex, setSelectedGenomeIndex] = useState<number>(\r\n    getIntSearchParam(GENOME_IDX_URL_PARAM, defaultGenomeIndex)\r\n  );\r\n\r\n  const [dynamicCarsPosition, setDynamicCarsPosition] = useState<DynamicCarsPosition>(getCarsPositionFromURL());\r\n\r\n  const bestDefaultTrainedGeneration: Generation = [\r\n    BEST_GENOMES[dynamicCarsPosition][defaultGenomeIndex],\r\n  ];\r\n\r\n  const [bestTrainedCarLoss, setBestTrainedCarLoss] = useState<number | null>(null);\r\n  const [bestTrainedCarCycleIndex, setBestTrainedCarCycleIndex] = useState<number>(0);\r\n  const [bestTrainedGeneration, setBestTrainedGeneration] = useState<Generation>(bestDefaultTrainedGeneration);\r\n  const [bestTrainedCars, setBestTrainedCars] = useState<CarType[]>(\r\n    Object.values(\r\n      generationToCars({\r\n        generation: bestDefaultTrainedGeneration,\r\n        generationIndex: 0,\r\n        onLossUpdate: onTrainedCarLossUpdate,\r\n      })\r\n    )\r\n  );\r\n\r\n  const automaticParkingLifetimeTimer = useRef<NodeJS.Timeout | null>(null);\r\n\r\n  const logger = loggerBuilder({ context: 'AutomaticTab' });\r\n\r\n  const automaticParkingCycleLifetimeMs = TRAINED_CAR_GENERATION_LIFETIME * SECOND;\r\n  const automaticWorldVersion = `automatic-${bestTrainedCarCycleIndex}`;\r\n\r\n  const onAutomaticCycleLifetimeEnd = () => {\r\n    logger.info(`Automatic cycle #${bestTrainedCarCycleIndex} lifetime ended`);\r\n    setBestTrainedCarLoss(bestTrainedCarLossRef.current);\r\n    setBestTrainedCarCycleIndex(bestTrainedCarCycleIndex + 1);\r\n  };\r\n\r\n  const cancelAutomaticCycleTimer = () => {\r\n    logger.info('Trying to cancel automatic parking cycle timer');\r\n    if (automaticParkingLifetimeTimer.current === null) {\r\n      return;\r\n    }\r\n    clearTimeout(automaticParkingLifetimeTimer.current);\r\n    automaticParkingLifetimeTimer.current = null;\r\n  };\r\n\r\n  const countDownAutomaticParkingCycleLifetime = (onLifetimeEnd: () => void) => {\r\n    logger.info(`Automatic parking cycle started`);\r\n    cancelAutomaticCycleTimer();\r\n    automaticParkingLifetimeTimer.current = setTimeout(onLifetimeEnd, automaticParkingCycleLifetimeMs);\r\n  };\r\n\r\n  const onPerformanceBoost = (state: boolean) => {\r\n    setPerformanceBoost(state);\r\n  };\r\n\r\n  const onBestGenomeEdit = (editedGenome: Genome) => {\r\n    logger.info('Updating genome', editedGenome);\r\n\r\n    const updatedGeneration: Generation = [editedGenome];\r\n\r\n    setBestTrainedGeneration(updatedGeneration);\r\n\r\n    setBestTrainedCars(Object.values(\r\n      generationToCars({\r\n        generation: updatedGeneration,\r\n        generationIndex: 0,\r\n        onLossUpdate: onTrainedCarLossUpdate,\r\n      })\r\n    ));\r\n\r\n    bestTrainedCarLossRef.current = null;\r\n    setBestTrainedCarLoss(null);\r\n    setBestTrainedCarCycleIndex(bestTrainedCarCycleIndex + 1);\r\n\r\n    countDownAutomaticParkingCycleLifetime(onAutomaticCycleLifetimeEnd);\r\n\r\n    enqueue({\r\n      message: 'Genome has been updated and applied to the displayed car',\r\n      startEnhancer: ({size}) => <Check size={size} />,\r\n    }, DURATION.medium);\r\n  };\r\n\r\n  const onChangeGenomeIndex = (index: number) => {\r\n    setSelectedGenomeIndex(index);\r\n    onBestGenomeEdit(BEST_GENOMES[dynamicCarsPosition][index]);\r\n    setSearchParam(GENOME_IDX_URL_PARAM, `${index}`);\r\n  };\r\n\r\n  const onCarsPositionChange = (position: DynamicCarsPosition) => {\r\n    setDynamicCarsPosition(position);\r\n    setSelectedGenomeIndex(defaultGenomeIndex);\r\n    onBestGenomeEdit(BEST_GENOMES[position][defaultGenomeIndex]);\r\n    setSearchParam(START_POSITION_URL_PARAM, position);\r\n    setSearchParam(GENOME_IDX_URL_PARAM, `${defaultGenomeIndex}`);\r\n  };\r\n\r\n  // Start the automatic parking cycles.\r\n  useEffect(() => {\r\n    countDownAutomaticParkingCycleLifetime(onAutomaticCycleLifetimeEnd);\r\n    return () => {\r\n      cancelAutomaticCycleTimer();\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [bestTrainedCarCycleIndex]);\r\n\r\n  return (\r\n    <Block>\r\n      <World\r\n        version={automaticWorldVersion}\r\n        performanceBoost={performanceBoost}\r\n      >\r\n        <ParkingAutomatic\r\n          performanceBoost={performanceBoost}\r\n          cars={bestTrainedCars}\r\n          carsPosition={dynamicCarsPosition}\r\n          withVisibleSensors\r\n          withLabels\r\n        />\r\n      </World>\r\n      <Block marginTop=\"20px\">\r\n        <Notification overrides={{Body: {style: {width: 'auto'}}}}>\r\n          See the trained (almost) self-parking car in action<br/><br/>\r\n          <small>You may also update genome values to see how it affects the car's behavior</small>\r\n        </Notification>\r\n      </Block>\r\n      <AutomaticParkingAnalytics\r\n        genomes={BEST_GENOMES[dynamicCarsPosition]}\r\n        bestGenome={bestTrainedGeneration[0]}\r\n        minLoss={bestTrainedCarLoss}\r\n        generationLifetimeMs={automaticParkingCycleLifetimeMs}\r\n        batchVersion={automaticWorldVersion}\r\n        carsBatchIndex={bestTrainedCarCycleIndex}\r\n        performanceBoost={performanceBoost}\r\n        selectedGenomeIndex={selectedGenomeIndex}\r\n        carsPosition={dynamicCarsPosition}\r\n        onCarsPositionChange={onCarsPositionChange}\r\n        onBestGenomeEdit={onBestGenomeEdit}\r\n        onChangeGenomeIndex={onChangeGenomeIndex}\r\n        onPerformanceBoost={onPerformanceBoost}\r\n      />\r\n    </Block>\r\n  );\r\n}\r\n\r\nfunction getCarsPositionFromURL(): DynamicCarsPosition {\r\n  // @ts-ignore\r\n  const carPositionFromUrl: DynamicCarsPosition = getStringSearchParam(\r\n    START_POSITION_URL_PARAM,\r\n    DEFAULT_START_POSITION\r\n  );\r\n  if ([DYNAMIC_CARS_POSITION_FRONT, DYNAMIC_CARS_POSITION_MIDDLE].includes(carPositionFromUrl)) {\r\n    return carPositionFromUrl;\r\n  }\r\n  return DEFAULT_START_POSITION;\r\n}\r\n\r\nexport default EvolutionTabAutomatic;\r\n","import React, { useState } from 'react';\r\nimport { Tab, Tabs } from 'baseui/tabs';\r\nimport { Block } from 'baseui/block';\r\n\r\nimport { StyleObject } from 'styletron-standard';\r\nimport ErrorBoundary from '../shared/ErrorBoundary';\r\nimport { getSearchParam, setSearchParam } from '../../utils/url';\r\nimport EvolutionTabManual from './EvolutionTabManual';\r\nimport EvolutionTabEvolution from './EvolutionTabEvolution';\r\nimport EvolutionTabAutomatic from './EvolutionTabAutomatic';\r\nimport { BiDna } from 'react-icons/bi';\r\nimport { FaRegHandSpock } from 'react-icons/fa';\r\nimport { RiGuideLine } from 'react-icons/ri';\r\n\r\nconst WORLD_SEARCH_PARAM = 'parking';\r\n\r\nconst TAB_KEYS: Record<string, string> = {\r\n  evolution: 'evolution',\r\n  automatic: 'automatic',\r\n  manual: 'manual',\r\n};\r\n\r\nconst tabBarStyle: StyleObject = {\r\n  paddingLeft: 0,\r\n  paddingRight: 0,\r\n  overflow: 'hidden',\r\n};\r\n\r\nconst tabContentStyle: StyleObject = {\r\n  paddingLeft: 0,\r\n  paddingRight: 0,\r\n  paddingTop: 0,\r\n  paddingBottom: 0,\r\n};\r\n\r\nconst tabStyle: StyleObject = {\r\n  marginLeft: 0,\r\n  marginRight: 0,\r\n  paddingLeft: '20px',\r\n  paddingRight: '20px',\r\n};\r\n\r\nfunction EvolutionTabs() {\r\n  let worldKey: string = getSearchParam(WORLD_SEARCH_PARAM) || TAB_KEYS.evolution;\r\n  if (!TAB_KEYS.hasOwnProperty(worldKey)) {\r\n    worldKey = TAB_KEYS.evolution;\r\n  }\r\n\r\n  const [activeWorldKey, setActiveWorldKey] = useState<string | number>(worldKey);\r\n\r\n  const onTabSwitch = ({ activeKey }: {activeKey: React.Key}) => {\r\n    setActiveWorldKey(activeKey);\r\n    setSearchParam(WORLD_SEARCH_PARAM, `${activeKey}`);\r\n  }\r\n\r\n  return (\r\n    <Tabs\r\n      overrides={{\r\n        TabBar: { style: tabBarStyle },\r\n        TabContent: { style: tabContentStyle },\r\n        Tab: { style: tabStyle },\r\n      }}\r\n      onChange={onTabSwitch}\r\n      activeKey={activeWorldKey}\r\n    >\r\n      <Tab\r\n        key={TAB_KEYS.evolution}\r\n        title={(\r\n          <TabTitle\r\n            icon={<BiDna size={16} />}\r\n            title=\"Parking Evolution\"\r\n          />\r\n        )}\r\n      >\r\n        <ErrorBoundary>\r\n          <EvolutionTabEvolution />\r\n        </ErrorBoundary>\r\n      </Tab>\r\n\r\n      <Tab\r\n        key={TAB_KEYS.automatic}\r\n        title={(\r\n          <TabTitle\r\n            icon={<RiGuideLine  size={16} />}\r\n            title=\"Automatic Parking\"\r\n          />\r\n        )}\r\n      >\r\n        <ErrorBoundary>\r\n          <EvolutionTabAutomatic />\r\n        </ErrorBoundary>\r\n      </Tab>\r\n\r\n      <Tab\r\n        key={TAB_KEYS.manual}\r\n        title={(\r\n          <TabTitle\r\n            icon={<FaRegHandSpock size={15} />}\r\n            title=\"Manual Parking\"\r\n          />\r\n        )}\r\n      >\r\n        <ErrorBoundary>\r\n          <EvolutionTabManual />\r\n        </ErrorBoundary>\r\n      </Tab>\r\n    </Tabs>\r\n  );\r\n}\r\n\r\ntype TabTitleProps = {\r\n  icon: React.ReactNode,\r\n  title: string,\r\n};\r\n\r\nconst TabTitle = (props: TabTitleProps) => {\r\n  const {icon, title} = props;\r\n  return (\r\n    <Block \r\n      display=\"flex\"\r\n      flexDirection=\"row\"\r\n      alignItems=\"center\"\r\n    >\r\n      <Block\r\n        display={['none', 'none', 'flex']}\r\n        marginRight={['0', '0', '8px']}\r\n        flexDirection=\"row\"\r\n        alignItems=\"center\"\r\n      >\r\n        {icon}\r\n      </Block>\r\n      <Block>\r\n        {title}\r\n      </Block>\r\n    </Block>\r\n  );\r\n};\r\n\r\nexport default EvolutionTabs;\r\n","import React from 'react';\r\n\r\nimport EvolutionTabs from '../evolution/EvolutionTabs';\r\n\r\nfunction HomeScreen() {\r\n  return (\r\n    <EvolutionTabs />\r\n  );\r\n}\r\n\r\nexport default HomeScreen;\r\n","import React from 'react';\r\nimport { HashRouter, Switch, Route } from 'react-router-dom';\r\n\r\nimport Layout from './components/shared/Layout';\r\nimport { routes } from './constants/routes';\r\nimport HomeScreen from './components/screens/HomeScreen';\r\n\r\nfunction App() {\r\n  return (\r\n    <HashRouter>\r\n      <Layout>\r\n        <Switch>\r\n          <Route path={[routes.home.path]} exact>\r\n            <HomeScreen />\r\n          </Route>\r\n        </Switch>\r\n      </Layout>\r\n    </HashRouter>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport App from './App';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}